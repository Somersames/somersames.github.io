<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>ä»£ç†æ¨¡å¼ä¹‹JDKä¸ºä»€ä¹ˆéœ€è¦å®ç°æ¥å£(ä¸‹ç¯‡)</title>
      <link href="/2020/04/21/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E4%B9%8BJDK%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3-%E4%B8%8B%E7%AF%87/"/>
      <url>/2020/04/21/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E4%B9%8BJDK%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3-%E4%B8%8B%E7%AF%87/</url>
      <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨ä¸Šç¯‡ä¸»è¦ä»‹ç»äº† JDK åŠ¨æ€ä»£ç†æ‰§è¡Œçš„ä¸€äº›æµç¨‹ï¼Œé€šè¿‡ Proxy ç±»æ¥å®ç°ç”Ÿæˆæ–°çš„ä»£ç†ç±»ï¼Œåœ¨è¿™ä¸€ç¯‡ä¸»è¦è®²çš„æ˜¯ Proxy æ˜¯å¦‚ä½•æ¥ç”Ÿæˆä»¥åŠç¼“å­˜ç”Ÿæˆçš„ä»£ç†ç±»</p><h2 id="äºŒçº§ç¼“å­˜"><a href="#äºŒçº§ç¼“å­˜" class="headerlink" title="äºŒçº§ç¼“å­˜"></a>äºŒçº§ç¼“å­˜</h2><p>åœ¨ä¸Šä¸€ç¯‡çš„ç»“å°¾æåˆ°è¿‡äº†ä¸€ä¸ªmapï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š</p><blockquote><p>ConcurrentMap&lt;Object, ConcurrentMap&lt;Object, Supplier<v>&gt;&gt;</v></p></blockquote><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸¤ä¸ª <code>ConcurrentMap</code> æ¥å®ç°çš„åµŒå¥—ï¼Œé‚£ä¹ˆ Java ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿé¦–å…ˆæŸ¥çœ‹ <code>CacheKey</code> çš„ä»£ç ã€‚å¦‚ä¸‹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/CacheKey%E7%9A%84%E7%94%9F%E6%88%90.png" alt=""></p><p>å¯ä»¥çœ‹åˆ° <code>CacheKey</code> æ˜¯ç»§æ‰¿è‡ª WeakReferenceï¼Œä»¥ä¾¿äºå½“è¯¥ <code>CacheKey</code> æ²¡äººä½¿ç”¨çš„æ—¶å€™å¯ä»¥è®© GC ç›´æ¥å›æ”¶ã€‚<code>ReferenceQueue</code> æ˜¯ WeakReference æ‰€ä½¿ç”¨çš„ã€‚</p><p>é‚£ä¹ˆå¯¹äº Java æ¥è®²ï¼Œå…¶æ˜¯ç”¨ä¸€ä¸ª classLoader ä¸º key çš„ cacheKey æ¥ç”Ÿæˆä¸€ä¸ª keyï¼Œè¿™ä¸ªkeyå°±æ˜¯äºŒçº§ç¼“å­˜çš„ç¬¬ä¸€ä¸ªkeyã€‚å›åˆ°ä¸Šè¿°çš„mapã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/map%E7%9A%84%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°åœ¨é¦–æ¬¡åˆå§‹åŒ–çš„æ—¶å€™ï¼Œmap è¿˜æ˜¯ä¼šä»¥åˆšåˆšçš„ <code>cacheKey</code> æ¥è·å–äºŒçº§ç¼“å­˜ï¼Œä½†æ˜¯é¦–æ¬¡ä¸€å®šæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ­¤æ—¶ç›´æ¥ new äº†ä¸€ä¸ª <code>ConcurrentMap</code> ä½œä¸º <code>value</code> æ¥æ”¾å…¥äºŒçº§ç¼“å­˜ã€‚<br>å†å¾€ä¸‹çœ‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter));</span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯ä¸€ä¸ª Java8 çš„ lambda è¡¨è¾¾å¼ï¼ŒæŸ¥çœ‹è¿™ä¸ªè¡¨è¾¾å¼å®ç°çš„åœ°æ–¹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/keyFactory.png" alt=""></p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/KeyX%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0.png" alt=""></p><p>ä¸Šé¢çš„ <code>KeyX</code> çš„ä½œç”¨æ˜¯ç”¨è¢«ä»£ç†çš„äººæ‰€å®ç°çš„æ¥å£è¿›è¡Œhashï¼ŒåŒæ—¶å°†å®ƒä»¬å®ç°çš„æ¥å£æ”¾å…¥ <code>refs</code>ï¼Œè¿™ä¸ª<code>refs</code>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œ</p><blockquote><p>è¿™ä¸ª refs å’Œ WeakReference æœ‰å…³ï¼Œä¸»è¦æ˜¯ç”¨äºå½“ WeakReference çš„å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™ä½œä¸ºä¸€ä¸ªç›‘å¬</p></blockquote><p>æ­¤æ—¶è¿™ä¸ª subKey å·²ç»ç”Ÿæˆäº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯</p><blockquote><p> Supplier<v> supplier = valuesMap.get(subKey);</v></p></blockquote><p>è¿™ä¸ªä¹Ÿæ˜¯ Java8 çš„ lambda å‡½æ•°ï¼Œå…·ä½“ä½œç”¨æ˜¯é€šè¿‡è°ƒç”¨å…¶ get æ–¹æ³•ï¼Œå¯ä»¥å¿«è¯»çš„æ‰§è¡Œå‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œï¼Œè¿™ä¸ª <code>supplier</code> æ˜¯ç”± <code>Factory</code> æ‰€å®ç°çš„ã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/supplier.png" alt=""></p><p>è¿™ä¸€æ®µä»£ç çš„å…·ä½“é€»è¾‘æ˜¯ï¼Œå½“ <code>supplier</code> ä¸ä¸ºç©ºçš„æ—¶å€™å°±ç›´æ¥é€šè¿‡ <code>get</code> æ–¹æ³•è·å–å…¶ valueï¼Œç„¶åè¿”å›ï¼Œä½†æ˜¯å¦‚æœä¸º <code>null</code> çš„è¯ï¼Œé‚£ä¹ˆé¦–å…ˆå°±è¦åˆå§‹åŒ–ä¸€ä¸ª <code>Factory</code>ï¼Œç„¶ååœ¨è¿™æœŸé—´ï¼Œå¦‚æœæœ‰ç°æˆå°† <code>supplier</code> èµ‹å€¼äº†ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šè¿›è¡Œç©ºåˆ¤æ–­ï¼Œå¦‚æœæ›¿æ¢ <code>valueMap</code> æˆåŠŸï¼Œåˆ™ç›´æ¥è¿”å›åˆšåˆšç”Ÿæˆçš„ <code>factory</code>ï¼Œå¦åˆ™è¿”å› <code>valueMap</code> é‡Œé¢çš„å€¼ã€‚</p><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ª value å°±æ˜¯ä¸€ä¸ªä»£ç†ç±»çš„çš„ç±»åç§°ã€‚</p><h2 id="ä»£ç†ç±»ç”Ÿæˆ"><a href="#ä»£ç†ç±»ç”Ÿæˆ" class="headerlink" title="ä»£ç†ç±»ç”Ÿæˆ"></a>ä»£ç†ç±»ç”Ÿæˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title">get</span><span class="params">()</span> </span>&#123; <span class="comment">// serialize access</span></span><br><span class="line">    <span class="comment">// re-check</span></span><br><span class="line">    Supplier&lt;V&gt; supplier = valuesMap.get(subKey);</span><br><span class="line">    <span class="keyword">if</span> (supplier != <span class="keyword">this</span>) &#123;</span><br><span class="line">        <span class="comment">// something changed while we were waiting:</span></span><br><span class="line">        <span class="comment">// might be that we were replaced by a CacheValue</span></span><br><span class="line">        <span class="comment">// or were removed because of failure -&gt;</span></span><br><span class="line">        <span class="comment">// return null to signal WeakCache.get() to retry</span></span><br><span class="line">        <span class="comment">// the loop</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// else still us (supplier == this)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// create new value</span></span><br><span class="line">    V value = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        value = Objects.requireNonNull(valueFactory.apply(key, parameter));</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123; <span class="comment">// remove us on failure</span></span><br><span class="line">            valuesMap.remove(subKey, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// the only path to reach here is with non-null value</span></span><br><span class="line">    <span class="keyword">assert</span> value != <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// wrap value with CacheValue (WeakReference)</span></span><br><span class="line">    CacheValue&lt;V&gt; cacheValue = <span class="keyword">new</span> CacheValue&lt;&gt;(value);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// put into reverseMap</span></span><br><span class="line">    reverseMap.put(cacheValue, Boolean.TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// try replacing us with CacheValue (this should always succeed)</span></span><br><span class="line">    <span class="keyword">if</span> (!valuesMap.replace(subKey, <span class="keyword">this</span>, cacheValue)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(<span class="string">"Should not reach here"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// successfully replaced us with new CacheValue -&gt; return the value</span></span><br><span class="line">    <span class="comment">// wrapped by it</span></span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³•å°±æ˜¯ <code>Factory.get()</code>ï¼Œè¯¥æ–¹æ³•ç”± <code>synchronized</code> ä¿®é¥°ï¼Œæ˜¯ç”¨äºç”Ÿæˆä»£ç†ç±»çš„ class æ–‡ä»¶çš„ã€‚è€Œç”Ÿæˆä»£ç†ç±»çš„æ–¹æ³•åœ¨ <code>ProxyClassFactory</code> çš„ apply é‡Œé¢ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123;</span><br><span class="line">    Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = <span class="keyword">new</span> IdentityHashMap&lt;&gt;(interfaces.length);</span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class="line">       <span class="comment">// ...... çœç•¥</span></span><br><span class="line">        <span class="keyword">if</span> (!interfaceClass.isInterface()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                interfaceClass.getName() + <span class="string">" is not an interface"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...... çœç•¥</span></span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; intf : interfaces) &#123;</span><br><span class="line">        <span class="keyword">int</span> flags = intf.getModifiers();</span><br><span class="line">        <span class="keyword">if</span> (!Modifier.isPublic(flags)) &#123;</span><br><span class="line">            accessFlags = Modifier.FINAL;</span><br><span class="line">            String name = intf.getName();</span><br><span class="line">            <span class="keyword">int</span> n = name.lastIndexOf(<span class="string">'.'</span>);</span><br><span class="line">            String pkg = ((n == -<span class="number">1</span>) ? <span class="string">""</span> : name.substring(<span class="number">0</span>, n + <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">if</span> (proxyPkg == <span class="keyword">null</span>) &#123;</span><br><span class="line">                proxyPkg = pkg;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!pkg.equals(proxyPkg)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">                    <span class="string">"non-public interfaces from different packages"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//...... çœç•¥</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Choose a name for the proxy class to generate.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">long</span> num = nextUniqueNumber.getAndIncrement();</span><br><span class="line">    String proxyName = proxyPkg + proxyClassNamePrefix + num;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Generate the specified proxy class.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">byte</span>[] proxyClassFile = ProxyGenerator.generateProxyClass(</span><br><span class="line">        proxyName, interfaces, accessFlags);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> defineClass0(loader, proxyName,</span><br><span class="line">                            proxyClassFile, <span class="number">0</span>, proxyClassFile.length);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassFormatError e) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * A ClassFormatError here means that (barring bugs in the</span></span><br><span class="line"><span class="comment">         * proxy class generation code) there was some other</span></span><br><span class="line"><span class="comment">         * invalid aspect of the arguments supplied to the proxy</span></span><br><span class="line"><span class="comment">         * class creation (such as virtual machine limitations</span></span><br><span class="line"><span class="comment">         * exceeded).</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(e.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæœ‰å‡ ä¸ªé‡è¦çš„æ–¹æ³•è¯´ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯æ¥å£ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ JDKåŠ¨æ€ä»£ç†å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£äº†ï¼Œå› ä¸ºä¸æ˜¯æ¥å£çš„è¯è¿™ä¸ªåœ°æ–¹éªŒè¯è¿‡ä¸å»</span></span><br><span class="line"><span class="keyword">if</span> (!interfaceClass.isInterface()) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(</span><br><span class="line">        interfaceClass.getName() + <span class="string">" is not an interface"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‡³äºç”Ÿæˆçš„ç±»ï¼Œå¯ä»¥é€šè¿‡ç”Ÿæˆæ–‡ä»¶æ¥æŸ¥çœ‹äº†ã€‚å½“ç”Ÿæˆå®Œ class æ–‡ä»¶ä¹‹åï¼Œå›åˆ° <code>Proxy.newProxyInstance</code> æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class="line"><span class="keyword">final</span> InvocationHandler ih = h;</span><br><span class="line"><span class="keyword">if</span> (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class="line">    AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> Void <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            cons.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> cons.newInstance(<span class="keyword">new</span> Object[]&#123;h&#125;);</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæ˜¯å°†å‚æ•°ä¸Šçš„ <code>InvocationHandler</code> é€šè¿‡æ„é€ å™¨å°†ä»£ç†ç±»ä¸­çš„ <code>InvocationHandler</code> èµ‹å€¼ï¼Œä»è€Œä½¿ç”¨<br><code>invoke</code> æ–¹æ³•æ¥å®ç°ä»£ç†ã€‚</p><h2 id="ç”Ÿæˆçš„ä»£ç†ç±»"><a href="#ç”Ÿæˆçš„ä»£ç†ç±»" class="headerlink" title="ç”Ÿæˆçš„ä»£ç†ç±»"></a>ç”Ÿæˆçš„ä»£ç†ç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by Fernflower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> design_model.proxy.jdk.Car;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> $<span class="title">Proxy0</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $Proxy0(InvocationHandler var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"equals"</span>, Class.forName(<span class="string">"java.lang.Object"</span>));</span><br><span class="line">            m3 = Class.forName(<span class="string">"design_model.proxy.jdk.Car"</span>).getMethod(<span class="string">"run"</span>);</span><br><span class="line">            m2 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"toString"</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">"java.lang.Object"</span>).getMethod(<span class="string">"hashCode"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä»£ç†æ¨¡å¼ä¹‹JDKä¸ºä»€ä¹ˆéœ€è¦å®ç°æ¥å£(ä¸Šç¯‡)</title>
      <link href="/2020/04/15/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E4%B9%8BJDK%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3-%E4%B8%8A%E7%AF%87/"/>
      <url>/2020/04/15/%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E4%B9%8BJDK%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3-%E4%B8%8A%E7%AF%87/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é¦–å…ˆä»£ç†æ¨¡å¼åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œç”±äºJDKé‡‡ç”¨çš„æ˜¯åŠ¨æ€ä»£ç†ï¼Œæ‰€ä»¥é™æ€ä»£ç†åœ¨è¿™é‡Œä¸å†ä»‹ç»ã€‚</p><h2 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h2><h3 id="JDKåŠ¨æ€ä»£ç†"><a href="#JDKåŠ¨æ€ä»£ç†" class="headerlink" title="JDKåŠ¨æ€ä»£ç†"></a>JDKåŠ¨æ€ä»£ç†</h3><p>é¦–å…ˆ<code>JDK</code>çš„åŠ¨æ€ä»£ç†è¦æ±‚çœŸå®çš„å¯¹è±¡å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£ï¼Œè€Œä»£ç†ç±»åˆ™å®ç°<code>InvocationHandler</code>æ¥å£æ¥å®ŒæˆåŠ¨æ€ä»£ç†ã€‚å¦‚ä¸‹ä»£ç ï¼š</p><blockquote><p>æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">jdkProxy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¢«ä»£ç†çš„ç±»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bus</span> <span class="keyword">implements</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jdkProxy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æµ‹è¯•"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>ä»£ç†ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProxyTest</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"before---------"</span>);</span><br><span class="line">        Object object = method.invoke(target,args);</span><br><span class="line">        System.out.println(<span class="string">"after---------"</span>);</span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getInstance</span><span class="params">(Object target)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.target = target;</span><br><span class="line">        Class&lt;?&gt; clazz = target.getClass();</span><br><span class="line">        <span class="keyword">return</span> Proxy.newProxyInstance(<span class="keyword">new</span> SelfClassLoader(),clazz.getInterfaces(),<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä»£ç†æ¨¡å¼ä¸­çœŸå®å¯¹è±¡ç»§æ‰¿ä¸€ä¸ªæ¥å£å¦‚æœè¯´æ˜¯ä¸ºäº†åœ¨ä»£ç†ç±»ä¸­ç»Ÿä¸€ç®¡ç†ï¼Œé‚£ä¹ˆåœ¨ <code>JDKåŠ¨æ€ä»£ç†</code> ä¸­å¦‚æœè¢«ä»£ç†çš„å¯¹è±¡è¿˜å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£å°±æœ‰ç‚¹ç¹çäº†ï¼Œä½†æ˜¯å¯¹äº Java è¯­è¨€æ¥è¯´å…¶å®ä¹Ÿæ²¡åŠæ³•ã€‚æˆ‘ä»¬éƒ½è®¤ä¸ºå¾ˆç¹ççš„ä¸€ä¸ªå®ç°ï¼ŒJDK å¼€å‘äººå‘˜åº”è¯¥ä¹Ÿä¼šæƒ³åˆ°è¿™ä¸€ç‚¹ã€‚</p><p>ä¸‹é¢å°±æ¥è§£é‡Šä¸‹ä¸ºä»€ä¹ˆåŠ¨æ€ä»£ç†å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£ã€‚</p><h4 id="ä¸ºä»€ä¹ˆå¿…é¡»å®ç°ä¸€ä¸ªæ¥å£"><a href="#ä¸ºä»€ä¹ˆå¿…é¡»å®ç°ä¸€ä¸ªæ¥å£" class="headerlink" title="ä¸ºä»€ä¹ˆå¿…é¡»å®ç°ä¸€ä¸ªæ¥å£"></a>ä¸ºä»€ä¹ˆå¿…é¡»å®ç°ä¸€ä¸ªæ¥å£</h4><p>åœ¨å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œé¦–å…ˆè¦è¯´æ˜çš„æ˜¯ <code>JDKåŠ¨æ€ä»£ç†</code> å®ç°çš„åŸç†æ˜¯é‡æ–°ä¸ºå¯¹è±¡ç±»ç”Ÿæˆäº†ä¸€ä¸ªå­ç±»ï¼Œè¿™ä¸ªç±»ç”±äºæ˜¯ JDK è‡ªå·±ç”Ÿæˆçš„ï¼Œäºæ˜¯ä¼šä»¥<code>$</code>å¼€å¤´ï¼Œåœ¨ JDK æ–‡æ¡£ä¸­æœ‰å¦‚ä¸‹è¯´æ˜ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">A proxy class has the following properties:</span><br><span class="line"></span><br><span class="line">Proxy classes are <span class="keyword">public</span>, <span class="keyword">final</span>, and not <span class="keyword">abstract</span>.</span><br><span class="line">The unqualified name of a proxy class is unspecified. The space of class names that begin with the string "$Proxy" should be, however, reserved for proxy classes.</span><br><span class="line">A proxy <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">reflect</span>.<span class="title">Proxy</span>.</span></span><br></pre></td></tr></table></figure></p><p>å…¶å®è¿˜æœ‰å¾ˆå¤šè¯´æ˜ï¼Œä½†æ˜¯æ¶‰åŠåˆ°æœ¬æ–‡çš„ä¹Ÿå°±ä¸Šé¢ä¸‰æ¡ã€‚</p><ol><li>proxyç±»æ˜¯éæŠ½è±¡ç±»ï¼Œä¸”ç”±<code>public final</code>ä¿®é¥°ã€‚</li><li>proxyç±»æ˜¯ä»¥<code>$Proxy</code>å¼€å¤´çš„åŠ ç±»çš„åç§°ã€‚</li><li>proxyç±»æ˜¯<code>java.lang.reflect.Proxy</code>çš„å­ç±»ã€‚</li></ol><p>é‚£ä¹ˆæ—¢ç„¶æ˜¯<code>$Proxy</code>å¼€å¤´çš„ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥å°†ç”Ÿæˆçš„å­ç±»æ‰“å°å‡ºæ¥å‘¢ï¼Ÿï¼Œå¦‚ä¸‹ä»£ç ï¼š</p><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–°ç”Ÿæˆçš„ç±»å…¶å®æ˜¯ç›´æ¥ç»§æ‰¿äº† <code>Proxy</code> ç±»ï¼Œç”±äºJavaçš„å•ç»§æ‰¿æ–¹å¼ï¼Œæ­¤æ—¶å¦‚æœè¦è·å–å¯¹è±¡ç±»é‡Œé¢çš„æ–¹æ³•é‚£ä¹ˆå°±å¿…é¡»å®ç°ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä¹Ÿå°±å¯¹è±¡ç±»å¿…é¡»è¦å®ç°ä¸€ä¸ªæ¥å£ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Car car = (Car) <span class="keyword">new</span> ProxyTest().getInstance(<span class="keyword">new</span> Bus());</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆå½“æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªä»£ç çš„æ—¶å€™ç©¶ç«Ÿåœ¨æ‰§è¡Œä»€ä¹ˆå‘¢ï¼Ÿåœ¨è¿™é‡Œ debug æ¥è·Ÿè¸ªæºç è§£é‡Š JDK åˆ°åº•æ˜¯å¦‚ä½•ç”Ÿäº§ Proxy ä»£ç†ç±»çš„.</p><blockquote><p>newProxyInstanceæ–¹æ³•<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/newProxyInstance.png" alt=""></p></blockquote><p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œç›®å‰æš‚æ—¶éœ€è¦æ³¨æ„çº¢æ¡†ä¸­çš„æ–¹æ³•ï¼Œä»£ç†ç±»æ˜¯åœ¨è¯¥æ–¹æ³•é‡Œé¢æ˜¯ç”Ÿæˆçš„ã€‚</p><p><code>Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</code> è¿™ä¸€è¡Œä»£ç ï¼Œåœ¨è¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ª classï¼Œç„¶åé€šè¿‡åå°„æ¥åˆå§‹åŒ–è¿™ä¸ª classï¼Œæœ€åè¿™ä¸ª class å°±æ˜¯ JDK ç”Ÿæˆçš„ä»£ç†ç±»ã€‚</p><blockquote><p>getProxyClass0</p></blockquote><p>è€Œåœ¨ <code>getProxyClass0</code> æ–¹æ³•é‡Œé¢å°±æ˜¯é€šè¿‡ <code>proxyClassCache.get(loader, interfaces)</code>æ¥è·å– Proxyï¼Œå¦‚æœé‡Œé¢åŒ…å«è¯¥ classLoader åŠ è½½çš„ interface çš„è¯ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦åˆ™å°±æ˜¯å†åˆå§‹åŒ–ä¸€æ¬¡ï¼Œç„¶åè¿”å›ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Class&lt;?&gt; getProxyClass0(ClassLoader loader,</span><br><span class="line">                                           Class&lt;?&gt;... interfaces) &#123;</span><br><span class="line">    <span class="keyword">if</span> (interfaces.length &gt; <span class="number">65535</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"interface limit exceeded"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If the proxy class defined by the given loader implementing</span></span><br><span class="line">    <span class="comment">// the given interfaces exists, this will simply return the cached copy;</span></span><br><span class="line">    <span class="comment">// otherwise, it will create the proxy class via the ProxyClassFactory</span></span><br><span class="line">    <span class="keyword">return</span> proxyClassCache.get(loader, interfaces);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>proxyClassCache.get(loader, interfaces)</p></blockquote><p>ä»è¿™ä¸ªæ–¹æ³•ä¹‹åå°±æ˜¯çœŸæ­£å¼€å§‹ç”Ÿæˆ Proxy ç±»çš„è¿‡ç¨‹ï¼Œç”±äºè¿™é‡Œé¢åŒ…å«ä¸€äº› Java8 çš„ lambdaè¡¨è¾¾å¼ ç”¨æ³•ï¼Œå¯¹äºä¸å¤ªäº†è§£çš„äººå¯èƒ½ä¼šæœ‰ç‚¹çœ‹ä¸æ‡‚ã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%96%87%E7%AB%A0/proxy.png" alt=""></p><p>ä¸Šé¢çš„å›¾ç»™å‡ºäº†åˆå§‹åŒ– map çš„ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªmapçš„ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;Object, ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt;&gt; map</span><br><span class="line">        = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¸¤å±‚çš„ ConcurrentMapï¼Œè€Œä¹‹æ‰€ä»¥ä¸ºä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡æ˜¯è·Ÿå®ç°çš„æ¥å£ç›¸å…³çš„ï¼Œæ˜¯ç”±äºç¬¬ä¸€å±‚çš„ key æ˜¯ç”± classLoader æ‰€ç”Ÿæˆçš„ keyï¼Œè€Œç¬¬äºŒå±‚æµ‹è¯•keyXï¼Œä¸æ‰€å®ç°çš„æ¥å£æœ‰å…³ã€‚<br>å‰©ä¸‹çš„å°†ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é‡æ¸©Javaä¸­String</title>
      <link href="/2020/04/06/%E9%87%8D%E6%B8%A9Java%E4%B8%ADString/"/>
      <url>/2020/04/06/%E9%87%8D%E6%B8%A9Java%E4%B8%ADString/</url>
      <content type="html"><![CDATA[<p>æœ¬æ–‡çš„å†…å®¹éƒ½æ˜¯åŸºäº JDK1.8 æ¥å†™çš„ï¼Œä¸»è¦æ˜¯å¤ä¹ ä¸‹ String ç±»çš„è®¾è®¡ã€‚</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>String æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å­—ç¬¦ä¸²çš„ç±»ï¼Œå…¶å†…éƒ¨æ˜¯é€šè¿‡ char æ•°ç»„æ¥å®ç°ï¼Œåœ¨ Java ä¸­ï¼Œ1byte = 8bitï¼Œ1char = 2byte, æ‰€ä»¥åœ¨ Java ä¸­ï¼ŒString çš„code pointæ˜¯16ä½ã€‚<br>String ç±»æ˜¯ç”± final å…³é”®å­—æ¥ä¿®é¥°çš„ï¼Œå› æ­¤è¡¨æ˜è¯¥ç±»ä¸å¯ä»¥è¢«ç»§æ‰¿ï¼ŒåŒæ—¶ String åˆå®ç°äº† Serializableã€Comparableã€CharSequenceæ¥å£ï¼Œè¡¨æ˜ String å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œä»¥åŠä½¿ç”¨cpmpareToæ¥æ¯”è¾ƒä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼ã€‚</p><h2 id="å­—ç¬¦é›†ç¼–ç "><a href="#å­—ç¬¦é›†ç¼–ç " class="headerlink" title="å­—ç¬¦é›†ç¼–ç "></a>å­—ç¬¦é›†ç¼–ç </h2><h3 id="å†…ç "><a href="#å†…ç " class="headerlink" title="å†…ç "></a>å†…ç </h3><p>å†…ç æŒ‡çš„æ˜¯ç¨‹åºå†…éƒ¨è‡ªå·±ä½¿ç”¨çš„å­—ç¬¦é›†ï¼Œjavaä¸­æ˜¯ä»¥ <code>UTF-16</code> æ¥è¡¨ç¤ºçš„</p><blockquote><p>The Java programming language represents text in sequences of 16-bit code units, using the UTF-16 encoding.</p></blockquote><p>UTF-16æœ€å¤šå¯ä»¥è¡¨ç¤º 65535 ç§å­—ç¬¦ï¼Œé‚£ä¹ˆä¸åœ¨ 65535 ä¹‹å†…çš„å­—ç¬¦ï¼Œè¯¥å¦‚ä½•è¡¨ç¤ºå‘¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨ä¸¤ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºè¿™ä¸ªå­—ç¬¦ã€‚ä»¥ğŸ˜è¿™ä¸ªemojeä¸ºä¾‹å­ï¼šå…¶Codeçš„ç¼–ç æ˜¯<code>1F601</code>ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å…·ä½“æ–¹æ³•æ˜¯ï¼š</span><br><span class="line"></span><br><span class="line">Code Pointå‡å»<span class="number">0x10000</span>ï¼Œ å¾—åˆ°çš„å€¼æ˜¯é•¿åº¦ä¸º<span class="number">20</span>bitï¼ˆä¸è¶³çš„è¡¥<span class="number">0</span>ï¼‰ï¼›</span><br><span class="line">å°†å¾—åˆ°æ•°å€¼çš„é«˜ä½çš„<span class="number">10</span>æ¯”ç‰¹çš„å€¼ åŠ ä¸Š<span class="number">0xD800</span>çš„å‰<span class="number">6</span>ä½å¾—åˆ°ç¬¬ä¸€ä¸ªCode Unitã€‚</span><br><span class="line">æ­¥éª¤<span class="number">1</span>å¾—åˆ°æ•°å€¼çš„ä½ä½çš„<span class="number">10</span>æ¯”ç‰¹çš„å€¼ åŠ ä¸Š<span class="number">0xDC00</span>çš„å‰<span class="number">6</span>ä½å¾—åˆ°ç¬¬äºŒä¸ªCode Unitã€‚</span><br></pre></td></tr></table></figure></p><p>äºæ˜¯è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">1F</span>601 - <span class="number">0x10000</span> = <span class="number">1111011000000001</span></span><br><span class="line">ä¸æ»¡<span class="number">20</span>ä½çš„è¡¥<span class="number">0</span>ï¼›</span><br><span class="line">æ‰€ä»¥å¾—åˆ°ï¼š<span class="number">00001111011000000001</span>ã€‚</span><br><span class="line"><span class="number">0xD800</span>ï¼š<span class="number">1101100000000000</span></span><br><span class="line"><span class="number">0xDC00</span>ï¼š<span class="number">1101110000000000</span></span><br><span class="line">äºæ˜¯é«˜ä½çš„ä»£ç†å°±æ˜¯ï¼š<span class="number">1101100000111101</span></span><br><span class="line">äºæ˜¯ä½ä½çš„ä»£ç†å°±æ˜¯ï¼š<span class="number">1101111000000001</span></span><br><span class="line">æœ€ç»ˆå¾—åˆ°ï¼šd83d,de01</span><br></pre></td></tr></table></figure></p><p>åœ¨ String çš„ä»£ç ä¸­ä½“ç°å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">codePointAt</span><span class="params">(CharSequence seq, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> c1 = seq.charAt(index);</span><br><span class="line">    <span class="keyword">if</span> (isHighSurrogate(c1) &amp;&amp; ++index &lt; seq.length()) &#123;</span><br><span class="line">        <span class="keyword">char</span> c2 = seq.charAt(index);</span><br><span class="line">        <span class="keyword">if</span> (isLowSurrogate(c2)) &#123;</span><br><span class="line">            <span class="keyword">return</span> toCodePoint(c1, c2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">toCodePoint</span><span class="params">(<span class="keyword">char</span> high, <span class="keyword">char</span> low)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Optimized form of:</span></span><br><span class="line">    <span class="comment">// return ((high - MIN_HIGH_SURROGATE) &lt;&lt; 10)</span></span><br><span class="line">    <span class="comment">//         + (low - MIN_LOW_SURROGATE)</span></span><br><span class="line">    <span class="comment">//         + MIN_SUPPLEMENTARY_CODE_POINT;</span></span><br><span class="line">    <span class="keyword">return</span> ((high &lt;&lt; <span class="number">10</span>) + low) + (MIN_SUPPLEMENTARY_CODE_POINT</span><br><span class="line">                                    - (MIN_HIGH_SURROGATE &lt;&lt; <span class="number">10</span>)</span><br><span class="line">                                    - MIN_LOW_SURROGATE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>æ³¨æ„è¿™ä¸ªhigh &lt;&lt; 10æ˜¯å› ä¸ºcodeè½¬æˆ16è¿›åˆ¶çš„æ—¶å€™ï¼Œè¿˜è¡¥äº†4ä¸ª0<br>å½“ String åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ª code point çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦æ˜¯é«˜ä½ä»£ç†ï¼Œæ˜¯çš„è¯åœ¨åˆ¤æ–­ä¸‹ä¸€ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯ä½ä½ä»£ç†ï¼Œæ˜¯çš„å°±é€šè¿‡<code>toCodePoint</code>æ¥æ¨å¯¼å‡ºåŸæ¥çš„codeã€‚</p></blockquote><h2 id="readResolveæ–¹æ³•"><a href="#readResolveæ–¹æ³•" class="headerlink" title="readResolveæ–¹æ³•"></a>readResolveæ–¹æ³•</h2><p>è¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†ä¿è¯åºåˆ—åŒ–çš„æ—¶å€™ï¼Œé¿å…ç”Ÿæˆå¤šä¸ª String å¯¹è±¡ï¼Œé¦–å…ˆå½“ä¸€ä¸ªå¯¹è±¡è¢«ååºåˆ—åŒ–çš„æ—¶å€™ï¼Œå…¶è°ƒç”¨é“¾å¦‚ä¸‹:</p><blockquote><p>ObjectInputStream -&gt; readObject() -&gt; readObject0(boolean unshared) -&gt; readOrdinaryObject(boolean unshared) </p></blockquote><p>åœ¨<code>readOrdinaryObject</code>ä¸­ï¼Œä¸»è¦æ˜¯éœ€è¦æ³¨æ„å¦‚ä¸‹ä¸¤æ®µä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Object obj;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    obj = desc.isInstantiable() ? desc.newInstance() : <span class="keyword">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">    <span class="keyword">throw</span> (IOException) <span class="keyword">new</span> InvalidClassException(</span><br><span class="line">        desc.forClass().getName(),</span><br><span class="line">        <span class="string">"unable to create instance"</span>).initCause(ex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (obj != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">    handles.lookupException(passHandle) == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">    desc.hasReadResolveMethod())</span><br><span class="line">&#123;</span><br><span class="line">    Object rep = desc.invokeReadResolve(obj);</span><br><span class="line">    <span class="keyword">if</span> (unshared &amp;&amp; rep.getClass().isArray()) &#123;</span><br><span class="line">        rep = cloneArray(rep);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (rep != obj) &#123;</span><br><span class="line">        <span class="comment">// Filter the replacement object</span></span><br><span class="line">        <span class="keyword">if</span> (rep != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (rep.getClass().isArray()) &#123;</span><br><span class="line">                filterCheck(rep.getClass(), Array.getLength(rep));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                filterCheck(rep.getClass(), -<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handles.setObject(passHandle, obj = rep);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ObjectStreamClassï¼š</span><br><span class="line">readResolveMethod = getInheritableMethod(cl, <span class="string">"readResolve"</span>, <span class="keyword">null</span>, Object.class);</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæ²¡æœ‰é‡å†™<code>readResolve</code>çš„è¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¾¿ä¼šç›´æ¥è¿”å›<code>newInstance</code> ç”Ÿæˆçš„æ–°å¯¹è±¡äº†ã€‚</p><h2 id="final-çš„ä½¿ç”¨"><a href="#final-çš„ä½¿ç”¨" class="headerlink" title="final çš„ä½¿ç”¨"></a>final çš„ä½¿ç”¨</h2><p>åœ¨ String ä¸­ï¼Œå¯ä»¥çœ‹åˆ°éœ€è¦åœ°æ–¹ä½¿ç”¨åˆ°äº† final å­—æ®µï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span> value[];</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields = <span class="keyword">new</span> ObjectStreamField[<span class="number">0</span>];</span><br></pre></td></tr></table></figure></p><p>è¿™äº›éƒ½å¥½ç†è§£ï¼Œä½†æ˜¯å…¶ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•é‡Œé¢çš„å˜é‡åå´ä¹Ÿä½¿ç”¨äº†finalï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">indexOfSupplementary</span><span class="params">(<span class="keyword">int</span> ch, <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Character.isValidCodePoint(ch)) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span>[] value = <span class="keyword">this</span>.value;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span> hi = Character.highSurrogate(ch);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span> lo = Character.lowSurrogate(ch);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> max = value.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = fromIndex; i &lt; max; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value[i] == hi &amp;&amp; value[i + <span class="number">1</span>] == lo) &#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæˆ‘ä¸ªäººæ„Ÿè§‰å…¶å®æ˜¯æ²¡ä»€ä¹ˆä½œç”¨çš„ï¼Œå› ä¸ºæ–¹æ³•å†…éƒ¨çš„<code>value</code>ä¼šéšç€<code>this.value</code>çš„å˜åŒ–è€Œå˜åŒ–(ä¸€èˆ¬ä¸å¯èƒ½)ï¼Œæ‰€ä»¥è¿™é‡Œçš„finalï¼Œä¹Ÿå°±<code>hi</code>å’Œ<code>lo</code>ä»¥åŠ<code>max</code>æœ‰ä½œç”¨ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªæ–¹æ³•å†…éƒ¨ï¼Œ<br>åœ¨å¤šçº¿ç¨‹çš„ç«æ€æ¡ä»¶ä¸‹ä¸æ”¹å˜ã€‚</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>SpringBootä¸­å¼‚æ­¥çº¿ç¨‹çš„å¤„ç†</title>
      <link href="/2020/04/02/SpringBoot%E4%B8%AD%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%A4%84%E7%90%86/"/>
      <url>/2020/04/02/SpringBoot%E4%B8%AD%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<p>åœ¨å·¥ä½œæˆ–è€…å­¦ä¹ çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šæ¥è§¦åˆ°å¼‚æ­¥ç¼–ç¨‹ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯é€šè¿‡æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç„¶åè°ƒç”¨<code>submit</code>æ–¹æ³•æˆ–è€…<code>execute</code>æ–¹æ³•æ¥æ‰§è¡Œã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">simpleThreadPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ExecutorService executor = <span class="keyword">new</span> ThreadPoolExecutor(<span class="number">4</span>,<span class="number">5</span>,<span class="number">0</span>, TimeUnit.SECONDS,<span class="keyword">new</span> LinkedBlockingDeque&lt;Runnable&gt;());</span><br><span class="line">        executor.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"run"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        Callable&lt;String&gt; callable = <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"callable"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Future future = executor.submit(callable);</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨Springbootä¸­å…¶å®ä¹Ÿå¯ä»¥è¿™æ ·åšï¼Œä½†æ˜¯ä¸åˆ©äºåæœŸçš„ç»´æŠ¤ï¼ŒåŠ å…¥åæœŸéœ€è¦æŠŠ <code>runable</code> çš„æ–¹æ³•ä¿®æ”¹ä¸ºåŒæ­¥ç±»å‹çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦å¤§é‡çš„æ”¹åŠ¨ä»£ç ï¼Œå¦‚æœè¯´å¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°çš„äº†çš„è¯ï¼Œå°±ä¼šå¾ˆå®¹æ˜“æ¼æ‰äº†ä¸€å¤„å¯¼è‡´bugçš„äº§ç”Ÿã€‚</p><h2 id="Springçš„è§£å†³æ–¹æ³•"><a href="#Springçš„è§£å†³æ–¹æ³•" class="headerlink" title="Springçš„è§£å†³æ–¹æ³•"></a>Springçš„è§£å†³æ–¹æ³•</h2><h3 id="ä¸éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥"><a href="#ä¸éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥" class="headerlink" title="ä¸éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥"></a>ä¸éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥</h3><p>å…¶å®åœ¨Springä¸­å°±æœ‰ç±»ä¼¼çš„è§£å†³æ–¹æ³•ï¼Œåªä¸è¿‡éœ€è¦æˆ‘ä»¬è‡ªå·±é…ç½®ã€‚<br>é¦–å…ˆæ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"asyncPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolTaskExecutor <span class="title">asyncPool</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">10</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">10</span>);</span><br><span class="line">        executor.setQueueCapacity(<span class="number">100</span>);</span><br><span class="line">        executor.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">30</span>);</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæœ€å¥½çš„åšæ³•æ˜¯å°†å…¶é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ä»¥åè°ƒæ•´å°±ä¸éœ€è¦æ”¹åŠ¨ä»£ç ï¼Œä¸è¿‡æ­¤å¤„ä¸ºäº†æ¼”ç¤ºï¼Œä¹Ÿå°±ç›´æ¥å›ºå®šäº†ã€‚</p><blockquote><p>æ–°å»ºä¸€ä¸ª <code>Service</code> æµ‹è¯•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"asyncPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"asyncPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayB</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="string">"B"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>è°ƒç”¨</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AsyncService asyncService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noReturnAsync</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        asyncService.sayB();</span><br><span class="line">        asyncService.sayA();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ–°å»ºä¸€ä¸ªæµ‹è¯•ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(classes = AsyncApplication.class)</span><br><span class="line"><span class="meta">@WebAppConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestServiceTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    TestService testService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noReturnAsync</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        testService.noReturnAsync();</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶åœ¨æ§åˆ¶å°ä¼šå‘ç°æ˜¯å…ˆæ‰“å°çš„ Aï¼Œç„¶åå†æ‰“å°çš„ Bï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥è‚¯å®šç¡®è®¤çš„æ˜¯è‚¯å®šæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚</p><p>ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªä¸šåŠ¡æ–¹æ³•å¹¶ä¸æ˜¯é€šç”¨çš„ï¼Œå‡å¦‚æœ‰ä¸€ä¸ª <code>C</code> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ TestServcie ç±»é‡Œé¢å•ç‹¬ä¸€ä¸ªäººä½¿ç”¨çš„ï¼Œè¿™ä¸ªæƒ…å†µä¸‹å¦‚æœéœ€è¦åœ¨ TestServicde é‡Œé¢ä½¿ç”¨çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡ Aop æ¥è·å–å½“å‰çš„ä»£ç†å¯¹è±¡ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AsyncService asyncService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noReturnAsync</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        asyncService.sayB();</span><br><span class="line">        asyncService.sayA();</span><br><span class="line">        C();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"asyncPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">C</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"C"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¿™æ ·å†™çš„è¯ï¼ŒCæ–¹æ³•å°±ä¼šè¢«å½“æˆä¸€ä¸ªåŒæ­¥æ–¹æ³•ï¼Œäºæ˜¯å°±éœ€è¦é€šè¿‡ <code>AopContext.currentProxy()</code> æ¥åˆ‡æ¢ä»£ç†å¯¹è±¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AsyncService asyncService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noReturnAsync</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        asyncService.sayB();</span><br><span class="line">        asyncService.sayA();</span><br><span class="line">        ((TestService) AopContext.currentProxy()).C();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>(<span class="string">"asyncPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">C</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"C"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœæ˜¯ä½¿ç”¨ <code>((TestService) AopContext.currentProxy()).C()</code> çš„è¯ï¼Œåˆ™å¿…é¡»è¦æ–°å¢å¦‚ä¸‹Bean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanFactoryPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        BeanDefinition beanDefinition = beanFactory.getBeanDefinition(org.springframework.scheduling.config.TaskManagementConfigUtils.ASYNC_ANNOTATION_PROCESSOR_BEAN_NAME);</span><br><span class="line">        beanDefinition.getPropertyValues().add(<span class="string">"exposeProxy"</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥"><a href="#éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥" class="headerlink" title="éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥"></a>éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥</h3><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯ä¸éœ€è¦è¿”å›å€¼çš„å¼‚æ­¥æ–¹æ³•ï¼Œé‚£ä¹ˆå…¶å®å¾ˆå¤šåœºæ™¯ä¸‹éƒ½æ˜¯éœ€è¦è¿”å›å€¼çš„ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹æ³•æ¥å®ç°:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Async</span>(<span class="string">"asyncPool"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Future&lt;String&gt; <span class="title">futureA</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1100</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AsyncResult&lt;String&gt;(<span class="string">"A"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è°ƒç”¨æ–¹å¼è¿˜æ˜¯å’Œä¹‹å‰ä¸€ç›´ï¼Œå°±æ˜¯æœ€åéœ€è¦ç”¨ä¸€ä¸ª <code>Future</code> æ¥æ¥ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">noReturnAsync</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        Future future = asyncService.futureA();</span><br><span class="line">        asyncService.sayB();</span><br><span class="line">        asyncService.sayA();</span><br><span class="line">        System.out.println(future.get());</span><br><span class="line">        ((TestService) AopContext.currentProxy()).C();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ES7ä¸­å¤§å°å†™ä¸æ•æ„Ÿçš„æ¨¡ç³ŠåŒ¹é…</title>
      <link href="/2020/03/20/ES7%E4%B8%AD%E5%A4%A7%E5%B0%8F%E5%86%99%E4%B8%8D%E6%95%8F%E6%84%9F%E7%9A%84%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D/"/>
      <url>/2020/03/20/ES7%E4%B8%AD%E5%A4%A7%E5%B0%8F%E5%86%99%E4%B8%8D%E6%95%8F%E6%84%9F%E7%9A%84%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D/</url>
      <content type="html"><![CDATA[<p>åœ¨ES7.0ä¸­</p><p>å¦‚æœè¦å®ç°å¤§å°å†™çš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œåˆ™é¦–å…ˆå¿…é¡»è¦è‡ªå®šä¹‰ <code>analysis</code>ï¼Œåœ¨è‡ªå®šä¹‰çš„ <code>analysis</code> é‡Œé¢ï¼Œå¦‚æœæ˜¯é’ˆå¯¹keywordç±»å‹çš„å­—æ®µï¼Œ analysis è¦å®šä¹‰æˆ normalizerï¼Œè€Œå¯¹äºtextç±»å‹çš„è¯ï¼Œåˆ™éœ€è¦ä¸ºanalyzerã€‚å¦‚ä¸‹æ¼”ç¤ºçš„æ˜¯<code>normalizer</code>ç±»å‹çš„å®šä¹‰ã€‚</p><blockquote><p>æ–°å»ºç´¢å¼•<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"settings"</span>: &#123;</span><br><span class="line">    <span class="attr">"analysis"</span>: &#123;</span><br><span class="line">      <span class="attr">"normalizer"</span>: &#123;</span><br><span class="line">        <span class="attr">"self_normalizer"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"custom"</span>,</span><br><span class="line">          <span class="attr">"char_filter"</span>: [],</span><br><span class="line">          <span class="attr">"filter"</span>: [</span><br><span class="line">            <span class="string">"lowercase"</span>,</span><br><span class="line">            <span class="string">"asciifolding"</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">    <span class="attr">"properties"</span>:&#123;</span><br><span class="line">      <span class="attr">"field_1"</span>:&#123;</span><br><span class="line">        <span class="attr">"type"</span>:<span class="string">"keyword"</span>,</span><br><span class="line">        <span class="attr">"normalizer"</span>: <span class="string">"self_normalizer"</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>æ­¤æ—¶å‘ESä¸­æ–°å¢å‡ æ¡æ•°æ®ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"took"</span>: <span class="number">6</span>,</span><br><span class="line"><span class="attr">"timed_out"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">"_shards"</span>: &#123;</span><br><span class="line"><span class="attr">"total"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">"successful"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"hits"</span>: &#123;</span><br><span class="line"><span class="attr">"total"</span>: &#123;</span><br><span class="line"><span class="attr">"value"</span>: <span class="number">4</span>,</span><br><span class="line"><span class="attr">"relation"</span>: <span class="string">"eq"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"max_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="attr">"hits"</span>: [</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="attr">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="attr">"_id"</span>: <span class="string">"2"</span>,</span><br><span class="line"><span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="attr">"_source"</span>: &#123;</span><br><span class="line"><span class="attr">"field_1"</span>: <span class="string">"abc"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="attr">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line"><span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="attr">"_source"</span>: &#123;</span><br><span class="line"><span class="attr">"field_1"</span>: <span class="string">"ABC"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="attr">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="attr">"_id"</span>: <span class="string">"3"</span>,</span><br><span class="line"><span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="attr">"_source"</span>: &#123;</span><br><span class="line"><span class="attr">"field_1"</span>: <span class="string">"aBC"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="attr">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="attr">"_id"</span>: <span class="string">"4"</span>,</span><br><span class="line"><span class="attr">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="attr">"_source"</span>: &#123;</span><br><span class="line"><span class="attr">"field_1"</span>: <span class="string">"Abc"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„å¯¹äº<code>field_1</code>ï¼Œåœ¨Esä¸­çš„å€¼å¤§å°å†™éƒ½æœ‰çš„ï¼Œæ­¤æ—¶è¿›è¡Œæ¨¡ç³ŠæŸ¥è¯¢ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"must"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">"bool"</span>: &#123;</span><br><span class="line">            <span class="attr">"must"</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">"wildcard"</span>: &#123;</span><br><span class="line">                  <span class="attr">"field_1"</span>: &#123;</span><br><span class="line">                    <span class="attr">"value"</span>: <span class="string">"*a*"</span>,</span><br><span class="line">                    <span class="attr">"boost"</span>: <span class="number">1</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"adjust_pure_negative"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"boost"</span>: <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"adjust_pure_negative"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">"boost"</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>è¿”å›å€¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"took"</span>: <span class="number">9</span>,</span><br><span class="line"><span class="string">"timed_out"</span>: <span class="keyword">false</span>,</span><br><span class="line"><span class="string">"_shards"</span>: &#123;</span><br><span class="line"><span class="string">"total"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"successful"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"skipped"</span>: <span class="number">0</span>,</span><br><span class="line"><span class="string">"failed"</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"hits"</span>: &#123;</span><br><span class="line"><span class="string">"total"</span>: &#123;</span><br><span class="line"><span class="string">"value"</span>: <span class="number">4</span>,</span><br><span class="line"><span class="string">"relation"</span>: <span class="string">"eq"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">"max_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="string">"hits"</span>: [</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="string">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="string">"_id"</span>: <span class="string">"2"</span>,</span><br><span class="line"><span class="string">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="string">"_source"</span>: &#123;</span><br><span class="line"><span class="string">"field_1"</span>: <span class="string">"abc"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="string">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="string">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line"><span class="string">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="string">"_source"</span>: &#123;</span><br><span class="line"><span class="string">"field_1"</span>: <span class="string">"ABC"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="string">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="string">"_id"</span>: <span class="string">"3"</span>,</span><br><span class="line"><span class="string">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="string">"_source"</span>: &#123;</span><br><span class="line"><span class="string">"field_1"</span>: <span class="string">"aBC"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"_index"</span>: <span class="string">"test_ascii"</span>,</span><br><span class="line"><span class="string">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line"><span class="string">"_id"</span>: <span class="string">"4"</span>,</span><br><span class="line"><span class="string">"_score"</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="string">"_source"</span>: &#123;</span><br><span class="line"><span class="string">"field_1"</span>: <span class="string">"Abc"</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springbootå¤šæ•°æ®æº-sqlSessionFactory</title>
      <link href="/2020/03/19/springboot%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90-sqlSessionFactory/"/>
      <url>/2020/03/19/springboot%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90-sqlSessionFactory/</url>
      <content type="html"><![CDATA[<p>åœ¨SpringBootä¸­ï¼ŒåŠ¨æ€çš„åˆ‡æ¢æ•°æ®æºçš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡<code>AbstractRoutingDataSource</code>æ¥é€šè¿‡æ³¨è§£å®ç°ï¼Œå¦ä¸€ç§åˆ™æ˜¯é€šè¿‡é…ç½®ä¸åŒçš„<code>SqlSessionFactory</code>æ¥è¯»å–ä¸åŒæ–‡ä»¶å¤¹çš„mapperï¼Œä»è€Œå®ç°å¤šæ•°æ®æºã€‚<br>ä»£ç å¦‚ä¸‹ï¼š</p><blockquote><p>DataSourceOneConfig</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"xyz.somersames.dao.one"</span>&#125; ,sqlSessionTemplateRef = <span class="string">"dataSourceOneSqlSessionTemplate"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceOneConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceOneT"</span>)</span><br><span class="line">    <span class="comment">// è¿™é‡Œåé¢åŠ ä¸€ä¸ªTæ˜¯é˜²æ­¢Springå‡ºç°skiped mapperFactoryBean é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.one"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceOneSqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">setSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"dataSourceOneT"</span>)</span> DataSource dataSource) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        bean.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver().getResources(<span class="string">"classpath:mapper/one/*.xml"</span>));</span><br><span class="line">        <span class="keyword">return</span> bean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceOneTransactionManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">setTransactionManager</span><span class="params">(@Qualifier(<span class="string">"dataSourceOneT"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceOneSqlSessionTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">setSqlSessionTemplate</span><span class="params">(@Qualifier(<span class="string">"dataSourceOneSqlSessionFactory"</span>)</span> SqlSessionFactory sqlSessionFactory) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>DataSourceTwoConfig</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = &#123;<span class="string">"xyz.somersames.dao.two"</span>&#125; ,sqlSessionTemplateRef = <span class="string">"dataSourceTwoSqlSessionTemplate"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceTwoConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceTwoT"</span>)</span><br><span class="line">    <span class="comment">// è¿™é‡Œåé¢åŠ ä¸€ä¸ªTæ˜¯é˜²æ­¢Springå‡ºç°skiped mapperFactoryBean é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•æ³¨å…¥</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource.two"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceTwoSqlSessionFactory"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">setSqlSessionFactory</span><span class="params">(@Qualifier(<span class="string">"dataSourceTwoT"</span>)</span> DataSource dataSource) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SqlSessionFactoryBean bean = <span class="keyword">new</span> SqlSessionFactoryBean();</span><br><span class="line">        bean.setDataSource(dataSource);</span><br><span class="line">        bean.setMapperLocations(<span class="keyword">new</span> PathMatchingResourcePatternResolver().getResources(<span class="string">"classpath:mapper/two/*.xml"</span>));</span><br><span class="line">        <span class="keyword">return</span> bean.getObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceTwoTransactionManager"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceTransactionManager <span class="title">setTransactionManager</span><span class="params">(@Qualifier(<span class="string">"dataSourceTwoT"</span>)</span> DataSource dataSource) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"dataSourceTwoSqlSessionTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> SqlSessionTemplate <span class="title">setSqlSessionTemplate</span><span class="params">(@Qualifier(<span class="string">"dataSourceTwoSqlSessionFactory"</span>)</span> SqlSessionFactory sqlSessionFactory) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ·»åŠ äº†è¿™ä¸¤ä¸ªé…ç½®ä»¥åï¼ŒdataSourceOneT ä¼šæ‰«æ <code>mapper/one</code> ä¸‹é¢çš„ xml æ–‡ä»¶ï¼Œè€Œ dataSourceTwoT ä¼šæ‰«æ <code>mapper/two</code> ä¸‹é¢çš„ xml æ–‡ä»¶ã€‚<br>ç„¶åæ·»åŠ é…ç½®æ–‡ä»¶</p><blockquote><p>application.yml</p></blockquote><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8091</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    one:</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">      type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="attr">    two:</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">      url:</span> <span class="attr">jdbc:mysql://localhost:3306/test_lock?useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">      type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œé¡ºå¸¦è¯´ä¸€å¥ï¼ŒSqlSessionFactory è´Ÿè´£æ‰“å¼€ SqlSessionï¼Œä¸€ä¸ªSqlSessionä»£è¡¨çš„å°±æ˜¯ä¸€æ¬¡å›è¯ï¼Œä½†æ˜¯å¦‚æœä½ åœ¨æ–¹æ³•ä¸ŠåŠ äº†ä¸€ä¸ª <code>@Transactional</code> æ³¨è§£ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•é‡Œé¢çš„æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªSqlSession</p>]]></content>
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SpringBoot2.xæ˜¯æ€æ ·åªåˆå§‹åŒ–LettuceConnectionFactoryçš„å‘¢</title>
      <link href="/2020/01/05/SpringBoot2-x%E6%98%AF%E6%80%8E%E6%A0%B7%E5%8F%AA%E5%88%9D%E5%A7%8B%E5%8C%96LettuceConnectionFactory%E7%9A%84%E5%91%A2/"/>
      <url>/2020/01/05/SpringBoot2-x%E6%98%AF%E6%80%8E%E6%A0%B7%E5%8F%AA%E5%88%9D%E5%A7%8B%E5%8C%96LettuceConnectionFactory%E7%9A%84%E5%91%A2/</url>
      <content type="html"><![CDATA[<h2 id="SpringBoot1-5ä½¿ç”¨Rediså’Œ2-xçš„åŒºåˆ«"><a href="#SpringBoot1-5ä½¿ç”¨Rediså’Œ2-xçš„åŒºåˆ«" class="headerlink" title="SpringBoot1.5ä½¿ç”¨Rediså’Œ2.xçš„åŒºåˆ«"></a>SpringBoot1.5ä½¿ç”¨Rediså’Œ2.xçš„åŒºåˆ«</h2><p>åœ¨ SpringBoot1.5 çš„ç‰ˆæœ¬çš„æ—¶å€™ï¼Œå¦‚æœè¦åˆ›å»ºä¸€ä¸ª RedisTemplate çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨å¦‚ä¸‹ä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate&lt;String,Object&gt; <span class="title">redisTemplate</span><span class="params">(JedisConnectionFactory jedisConnectionFactory)</span></span>&#123;</span><br><span class="line">        RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        redisTemplate.setConnectionFactory(jedisConnectionFactory);</span><br><span class="line">        <span class="comment">// æ·»åŠ åºåˆ—åŒ–ä»£ç </span></span><br><span class="line">        <span class="keyword">return</span> redisTemplateï¼›</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶ååœ¨ä¸šåŠ¡ç±»ä¸­ç›´æ¥é€šè¿‡ <code>@Autowired</code> æ³¨è§£æ¥è°ƒç”¨ redisTemplateï¼Œä½†æ˜¯å¦‚æœå°† SpringBoot1.5 å‡çº§åˆ° 2.0 ä¹‹åï¼Œä½ ä¼šå‘ç°è¿™æ ·å†™çš„è¯ï¼ŒSpringBoot å¯åŠ¨çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚æŠ¥é”™å†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">The following candidates were found but could not be injected:</span><br><span class="line">- Bean method <span class="string">'redisConnectionFactory'</span> in <span class="string">'JedisConnectionConfiguration'</span> not loaded because <span class="meta">@ConditionalOnBean</span> (types: org.springframework.data.redis.connection.RedisConnectionFactory; SearchStrategy: all) found beans of type <span class="string">'org.springframework.data.redis.connection.RedisConnectionFactory'</span> redisConnectionFactory</span><br><span class="line">    </span><br><span class="line">Consider revisiting the entries above or defining a bean of type <span class="string">'org.springframework.data.redis.connection.jedis.JedisConnectionFactory'</span> in your configuration.</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæç¤ºè¯´æ˜äº† <code>redisConnectionFactory</code> æ²¡æœ‰è¢«åŠ è½½åˆ°ï¼Œè¿™ä¸ªæ—¶å€™å…ˆå»å®˜æ–¹æ–‡æ¡£ä¸Šçœ‹ä¸‹ changelogï¼Œç„¶ååœ¨çœ‹ä¸‹æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆå˜åŒ–ã€‚<br><a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide#redis" target="_blank" rel="noopener">SpringBoot1.xå‡çº§åˆ°2.Xçš„ç®€ä»‹</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Redis</span><br><span class="line">Lettuce is now used instead of Jedis as the Redis driver when you use spring-boot-starter-data-redis. If you are using higher level Spring Data constructs you should find that the change is transparent.</span><br><span class="line"></span><br><span class="line">We still support Jedis. Switch dependencies <span class="keyword">if</span> you prefer Jedis by excluding io.lettuce:lettuce-core and adding redis.clients:jedis instead.</span><br><span class="line"></span><br><span class="line">Connection pooling is optional and, <span class="keyword">if</span> you are using it, you now need to add commons-pool2 yourself as Lettuce, contrary to Jedis, does not bring it transitively.</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯è¯´ SpringBoot2.x å·²ç»å°† LettuceConnectionFactory ä½œä¸ºå®˜æ–¹çš„ Redis è¿æ¥å·¥å…·äº†ï¼Œé‚£ä¹ˆå°è¯•ç€å°† <code>LettuceConnectionFactory</code> ä½œä¸ºé‚£ä¸ª redisTemplate çš„å…¥å‚ï¼Œæœ€åè°ƒæ•´å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate&lt;String,Object&gt; <span class="title">redisTemplate</span><span class="params">(LettuceConnectionFactory lettuceConnectionFactory)</span></span>&#123;</span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">    redisTemplate.setConnectionFactory(lettuceConnectionFactory);</span><br><span class="line">    <span class="comment">// åºåˆ—åŒ–ä»£ç </span></span><br><span class="line">    <span class="keyword">return</span> redisTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>äºæ˜¯å¯åŠ¨å°±ä¸å†æŠ¥é”™äº†ã€‚è€Œä¸”ä¹Ÿå¯ä»¥æ­£å¸¸çš„ä½¿ç”¨ã€‚ä½†æ˜¯å¦‚æœä½ è¿˜æ˜¯æƒ³ä½¿ç”¨ Jedis çš„è¯ï¼Œç›´æ¥ exclued <code>io.lettuce:lettuce-core</code> å³å¯ã€‚</p><h2 id="ä¸ºä»€ä¹ˆåœ¨SpringBoot2-xä¸­ä¸¤ä¸ªRedisConnectionFactoryåªä¼šåŠ è½½ä¸€ä¸ª"><a href="#ä¸ºä»€ä¹ˆåœ¨SpringBoot2-xä¸­ä¸¤ä¸ªRedisConnectionFactoryåªä¼šåŠ è½½ä¸€ä¸ª" class="headerlink" title="ä¸ºä»€ä¹ˆåœ¨SpringBoot2.xä¸­ä¸¤ä¸ªRedisConnectionFactoryåªä¼šåŠ è½½ä¸€ä¸ª"></a>ä¸ºä»€ä¹ˆåœ¨SpringBoot2.xä¸­ä¸¤ä¸ªRedisConnectionFactoryåªä¼šåŠ è½½ä¸€ä¸ª</h2><h3 id="SpringBoot2-xä¸­åŠ è½½çš„åŠ è½½æœºåˆ¶redisConnectionFactoryçš„å®ç°"><a href="#SpringBoot2-xä¸­åŠ è½½çš„åŠ è½½æœºåˆ¶redisConnectionFactoryçš„å®ç°" class="headerlink" title="SpringBoot2.xä¸­åŠ è½½çš„åŠ è½½æœºåˆ¶redisConnectionFactoryçš„å®ç°"></a>SpringBoot2.xä¸­åŠ è½½çš„åŠ è½½æœºåˆ¶redisConnectionFactoryçš„å®ç°</h3><p>é¦–å…ˆ Redis çš„ä¸€äº›é…ç½®éƒ½æ˜¯ä¾èµ–äº <code>RedisAutoConfiguration</code>ï¼Œè¿™ä¸ªç±»æ˜¯åœ¨ <code>spring-boot-autoconfigure</code> é‡Œé¢ï¼Œé¦–å…ˆçœ‹ä¸‹è¿™ä¸ªç±»çš„å¤§ä½“ç»“æ„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(RedisOperations.class)</span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(RedisProperties.class)</span><br><span class="line"><span class="meta">@Import</span>(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"redisTemplate"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"><span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"><span class="keyword">return</span> template;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é¦–å…ˆè¿™ä¸ªç±»ä¸Šé¢æœ‰å››ä¸ªæ³¨è§£ï¼Œé‚£ä¹ˆè¿™å››ä¸ªæ³¨è§£çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ol><li>@Configuration(proxyBeanMethods = false)ï¼Œå£°æ˜è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼ŒåŒæ—¶ä¹Ÿè¯´æ˜äº†ä¸è¦è®© SpringBoot ä¸ºè¿™ä¸ªç±»ç”Ÿæˆä»£ç†ç±»</li><li>@ConditionalOnClass(RedisOperations.class)ï¼Œå½“ classPath ä¸­å‡ºç°äº† <code>RedisOperations</code> è¿™ä¸ªç±»ä¹‹åï¼Œè¯¥ç±»æ‰ä¼šåŠ è½½æˆä¸€ä¸ªBean</li><li>@EnableConfigurationProperties(RedisProperties.class)ï¼Œå°†é…ç½®ç±» <code>RedisProperties</code> åŠ è½½è¿›æ¥ï¼Œç”±äº</li><li>@Import({ LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class })</li></ol><p>åœ¨ä¸Šè¿°çš„å‡ ä¸ªæ³¨è§£é‡Œé¢ï¼Œæœ€é‡è¦çš„æ˜¯ <code>@Import</code> æ³¨è§£ï¼Œè¿™ä¸ªæ³¨è§£å¯ä»¥å…è®¸æˆ‘ä»¬åœ¨</p><p>TODO</p><h2 id="LettuceConnectionConfiguration-å’Œ-JedisConnectionConfiguration"><a href="#LettuceConnectionConfiguration-å’Œ-JedisConnectionConfiguration" class="headerlink" title="LettuceConnectionConfiguration å’Œ JedisConnectionConfiguration"></a>LettuceConnectionConfiguration å’Œ JedisConnectionConfiguration</h2><p>å½“æŸ¥çœ‹è¿™ä¸¤ä¸ªç±»é‡Œé¢çš„æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå‘ç°åœ¨åˆ›å»º <code>redisConnectionFactory</code> è¿™ä¸ªBeançš„æ—¶å€™ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ª @ConditionalOnMissingBean(RedisConnectionFactory.class) æ³¨è§£ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(RedisConnectionFactory.class)</span><br><span class="line"><span class="function">LettuceConnectionFactory <span class="title">redisConnectionFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        ObjectProvider&lt;LettuceClientConfigurationBuilderCustomizer&gt; builderCustomizers,</span></span></span><br><span class="line"><span class="function"><span class="params">        ClientResources clientResources)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">    LettuceClientConfiguration clientConfig = getLettuceClientConfiguration(builderCustomizers, clientResources,</span><br><span class="line">            getProperties().getLettuce().getPool());</span><br><span class="line">    <span class="keyword">return</span> createLettuceConnectionFactory(clientConfig);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(RedisConnectionFactory.class)</span><br><span class="line"><span class="function">JedisConnectionFactory <span class="title">redisConnectionFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        ObjectProvider&lt;JedisClientConfigurationBuilderCustomizer&gt; builderCustomizers)</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createJedisConnectionFactory(builderCustomizers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸¤ä¸ªæ³¨è§£éƒ½æ˜¯å½“ <code>RedisConnectionFactory.class</code> è¿™ä¸ª Bean ä¸å­˜åœ¨çš„æ—¶å€™æ‰ä¼šåˆ›å»ºï¼Œè€Œä¸”åœ¨ <code>RedisAutoConfiguration</code> ä¸­ï¼Œé¦–å…ˆ import çš„æ˜¯ <code>LettuceConnectionConfiguration</code>ï¼Œæ‰€ä»¥æœ€åæ‰ä¼šå¯¼è‡´åœ¨ SpringBoot2.x çš„æ—¶å€™ï¼Œé»˜è®¤åŠ è½½çš„ <code>redisConnectionFactory</code> æ˜¯ <code>LettuceConnectionFactory</code>ã€‚</p>]]></content>
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æµ…è°ˆå·¥å‚æ¨¡å¼</title>
      <link href="/2019/12/27/%E6%B5%85%E8%B0%88%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/2019/12/27/%E6%B5%85%E8%B0%88%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å·¥å‚æ¨¡å¼è§£å†³çš„æ˜¯é¢‘ç¹çš„ä¿®æ”¹æŸä¸€äº› new æ“ä½œï¼Œéšè—çœŸå®çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæ–¹ä¾¿ä»¥åæ›´åŠ å¿«é€Ÿçš„æ–°å¢å’Œæ‰©å±•ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç»´æŠ¤ä¸€ç±»å…³ç³»ã€‚</p><h3 id="ç®€å•å·¥å‚ï¼š"><a href="#ç®€å•å·¥å‚ï¼š" class="headerlink" title="ç®€å•å·¥å‚ï¼š"></a>ç®€å•å·¥å‚ï¼š</h3><p>æŠŠå¯¹è±¡çš„åˆ›å»ºæ”¾åˆ°ä¸€ä¸ªUtilä¸­ï¼Œé€šè¿‡ä¸åŒçš„å…¥å‚æ¥åˆ›å»ºä¸åŒçš„ç±»ã€‚è¿™ä¹Ÿæ˜¯æ—¥å¸¸ç¼–ç ä¸­ç»å¸¸ç”¨åˆ°çš„ï¼Œä¸è¿‡ç¼ºç‚¹å°±æ˜¯æ¯æ¬¡æ–°å¢ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œéƒ½éœ€è¦ä¿®æ”¹<code>if/else</code>åˆ¤æ–­ï¼Œæœ‰ç‚¹ç¹çã€‚</p><h3 id="å·¥å‚æ–¹æ³•ï¼š"><a href="#å·¥å‚æ–¹æ³•ï¼š" class="headerlink" title="å·¥å‚æ–¹æ³•ï¼š"></a>å·¥å‚æ–¹æ³•ï¼š</h3><p>å°†å«æœ‰ç›¸åŒå±æ€§çš„ç±»æŠ½è±¡æˆä¸€ä¸ªå·¥å‚ï¼Œè¿™ä¸€ä¸ªå·¥å‚åªè´Ÿè´£è‡ªå·±çš„å¯¹è±¡çš„åˆ›å»ºï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œå¯¹æ‰©å±•å¼€æ”¾ã€‚</p><h3 id="æŠ½è±¡å·¥å‚ï¼š"><a href="#æŠ½è±¡å·¥å‚ï¼š" class="headerlink" title="æŠ½è±¡å·¥å‚ï¼š"></a>æŠ½è±¡å·¥å‚ï¼š</h3><p>å¯¹ç±»çš„æ“ä½œè¿›ä¸€æ­¥çš„åˆ’åˆ†ï¼Œå°†æŸç§ç±»çš„æ“ä½œå†æ¬¡è¿›è¡ŒæŠ½è±¡åŒ–ã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>å‡è®¾ç°åœ¨è¦å¼€å‘ä¸€ä¸ªé¤å…ç‚¹é¤ç³»ç»Ÿï¼Œé¦–å…ˆè‚¯å®šæ˜¯æœ‰é¡¾å®¢ä»¥åŠé£Ÿç‰©ã€‚ä¸ºäº†ä»¥åçš„æ‰©å±•æ€§ï¼Œåœ¨è¿™é‡Œé€šè¿‡ä¸‰ç§å·¥å‚æ–¹æ³•æ¥å®ç°ä¸åŒçš„éœ€æ±‚</p><h3 id="ç®€å•å·¥å‚"><a href="#ç®€å•å·¥å‚" class="headerlink" title="ç®€å•å·¥å‚"></a>ç®€å•å·¥å‚</h3><p>ç°åœ¨æœ‰ä¸¤ä¸ªç±»ï¼ŒUser å’Œ Foodï¼Œæ­¤æ—¶æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯äººéœ€è¦åƒé£Ÿç‰©ï¼Œå¯èƒ½ä½ æ¯«ä¸çŠ¹è±«çš„å†™ä¸‹äº†å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Potato</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temperaturel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Potato</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ çƒ­ä¸­"</span>);</span><br><span class="line">        <span class="keyword">this</span>.temperaturel = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> User().dinner();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dinner</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Potato potato = <span class="keyword">new</span> Potato(<span class="string">"åœŸè±†"</span>);</span><br><span class="line">        potato.cook();</span><br><span class="line">        System.out.println(<span class="string">"åƒæ™šé¤"</span> + potato.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åæ¥æœ‰ä¸€å¤©éœ€æ±‚å˜äº†ï¼Œç°åœ¨éœ€è¦å†åŠ ä¸€ä¸ªé£Ÿç‰©ä»¥ä¾›å®¢æˆ·é€‰æ‹©ï¼Œåæ¥ä½ æƒ³äº†ä¸‹ï¼Œå†³å®šå†™ä¸€ä¸ª <code>Util</code> ç±»ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">getFood</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(name != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"Potato"</span>.equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Potato(<span class="string">"åœŸè±†"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"Tomato"</span>.equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tomato(<span class="string">"è¥¿çº¢æŸ¿"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç æ˜æ˜¾çš„æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œè¿”å›çš„ Object åœ¨å¦ä¸€ä¸ªåœ°æ–¹è¿›è¡Œå¼ºåˆ¶è½¬æ¢çš„æ—¶å€™ï¼Œç”±äºä¸çŸ¥é“è¿”å›çš„æ˜¯ Potato è¿˜æ˜¯ Tomatoï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æŠ›å‡ºè½¬æ¢å¼‚å¸¸ï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œå†ç»§ç»­ä¼˜åŒ–è¿™æ®µä»£ç ï¼Œç”±äºåœŸè±†å’Œè¥¿çº¢æŸ¿éƒ½æ˜¯é£Ÿç‰©çš„ä¸€ç§ï¼Œäºæ˜¯å¯ä»¥ç›´æ¥æŠ½è±¡ä¸€ä¸ªæ¥å£å‡ºæ¥ã€‚è¿™æ ·åœŸè±†å’Œé©¬é“ƒè–¯éƒ½å®ç°è¿™ä¸ªæ¥å£ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Food</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Potato</span> <span class="keyword">implements</span> <span class="title">Food</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temperaturel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Potato</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ çƒ­ä¸­"</span>);</span><br><span class="line">        <span class="keyword">this</span>.temperaturel = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tomato</span> <span class="keyword">implements</span> <span class="title">Food</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> temperaturel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tomato</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"åŠ çƒ­ä¸­"</span>);</span><br><span class="line">        <span class="keyword">this</span>.temperaturel = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™å‘¢ï¼Œä¿®æ”¹ Util ç±»ï¼Œè®©å®ƒè¿”å› Food è¿™ä¸ªæŠ½è±¡ï¼Œç„¶åé€šè¿‡å®ä¾‹åŒ–å­ç±»ï¼Œæ¥å®ç°æ¨¡ç‰ˆçš„è°ƒç”¨ï¼Œäºæ˜¯ç»§ç»­ä¿®æ”¹ Util ç±»ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FoodUtil</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Food <span class="title">getFood</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(name != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"Potato"</span>.equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Potato(<span class="string">"åœŸè±†"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">"Tomato"</span>.equals(name))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tomato(<span class="string">"è¥¿çº¢æŸ¿"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> User().dinner(<span class="string">"Potato"</span>);</span><br><span class="line">        <span class="keyword">new</span> User().dinner(<span class="string">"Tomato"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">dinner</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        Food food = FoodUtil.getFood(name);</span><br><span class="line">        food.cook();</span><br><span class="line">        System.out.println(<span class="string">"åƒæ™šé¤"</span> + food.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯éšç€é£Ÿç‰©ç§ç±»çš„ä¸æ–­å¢åŠ ï¼Œæ¯ä¸€æ¬¡æ–°å¢ä¸€ç§é£Ÿç‰©ï¼Œä½ éƒ½è¦å»ä¿®æ”¹<code>getFood</code>è¿™ä¸ªæ–¹æ³•ï¼Œæ¯æ¬¡ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œä½ è¿˜å¿…é¡»å¯¹å…¶è¿›è¡Œå›å½’æµ‹è¯•ï¼Œä¸‡ä¸€æ”¹é”™äº†ï¼Œæˆ–è€…<code>equals</code>æ–¹æ³•è°ƒç”¨è€…çš„<code>key</code>é‡å¤äº†ï¼Œé‚£å°±ä¼šå½±å“åˆ°ç³»ç»Ÿçš„è¿è¡Œäº†ã€‚è€Œä¸”è¿™ä¹Ÿä¸ç¬¦åˆè®¾è®¡æ¨¡å¼é‡Œé¢çš„å¼€é—­åŸåˆ™ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚æ‰€ä»¥æ­¤æ—¶ç»§ç»­å¯¹è¿™ä¸ª Util è¿›è¡Œä¿®æ”¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Food <span class="title">getFood</span><span class="params">(Class&lt;? extends Food&gt; clazz)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(clazz != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// åœ¨è¿™é‡Œæ–¹ä¾¿æ¼”ç¤ºæ˜¯è®¾è®¡æ¨¡å¼ï¼Œæ‰€ä»¥åœ¨Tomato å’Œ PotatoåŠ å…¥äº†æ— å‚çš„æ„é€ å™¨</span></span><br><span class="line">            <span class="keyword">return</span> clazz.newInstance();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™å°±æ˜¯ä¸€ä¸ªç®€å•å·¥å‚æ¨¡å¼ï¼Œç®€å•å·¥å‚æ¨¡å¼ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è®²å¹¶ä¸å±äºè®¾è®¡æ¨¡å¼å…¶ä¸­ä¹‹ä¸€ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä½¿ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºé¿å…ä¸€äº›æ— æ„ä¹‰çš„ new æ“ä½œã€‚<br>æ¥ä¸‹æ¥å°±æ¥è®²ä¸‹å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚</p><h2 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡çš„ä¸€ä¸ªå·¥å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FoodFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">Food <span class="title">createFood</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¥¿çº¢æŸ¿å·¥å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PotatoFactory</span> <span class="keyword">implements</span> <span class="title">FoodFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Food <span class="title">createFood</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Potato();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœŸè±†å·¥å‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TomatoFactory</span> <span class="keyword">implements</span> <span class="title">FoodFactory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Food <span class="title">createFood</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"æ¸…æ´—å¹²å‡€"</span>);</span><br><span class="line">        System.out.println(<span class="string">"åˆ‡å¥½"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tomato();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œå‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨çš„è¯ï¼Œåˆ™ç›´æ¥é€šè¿‡ new ä¸€ä¸ªå­ç±»å³å¯ï¼Œå¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        FoodFactory potatoFactory = <span class="keyword">new</span> PotatoFactory();</span><br><span class="line">        FoodFactory tomatoFactory = <span class="keyword">new</span> TomatoFactory();</span><br><span class="line">        tomatoFactory.createFood().cook();</span><br><span class="line">        potatoFactory.createFood().cook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå½“éœ€è¦æ·»åŠ å…¶ä»–é£Ÿç‰©çš„æ—¶å€™ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ª<code>Factory</code>ç±»ç„¶åå®ç°<code>FoodFactory</code>æ¥å£å³å¯ï¼Œè¿™å°±æ˜¯å·¥å‚æ¨¡å¼çš„å¥½å¤„ã€‚</p><h2 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h2><p>æŠ½è±¡å·¥å‚æ¨¡å¼æ˜¯å¯¹å·¥å‚çš„æ›´è¿›ä¸€æ­¥æŠ½è±¡ï¼Œä¾‹å¦‚ åœŸè±† å’Œ è¥¿çº¢æŸ¿æ˜¯ä¸€ç»„äº§å“ï¼Œå› ä¸ºå®ƒä»¬éƒ½åŒå±äºé£Ÿç‰©ã€‚ä½†æ˜¯ç°åœ¨æœ‰ä¸¤ä¸ªåœ°æ–¹éƒ½å¯ä»¥ç”Ÿäº§ åœŸè±† å’Œ è¥¿çº¢æŸ¿ï¼ŒAåœ°çš„æ˜¯é‡‘è‰²çš„ï¼ŒBåœ°ç”Ÿäº§çš„æ˜¯é“¶è‰²çš„ï¼Œäºæ˜¯æ­¤æ—¶ A å’Œ B å°±äº§ç”Ÿäº†ä¸€ä¸ªäº§å“ç­‰çº§ã€‚ä½†æ˜¯A å’Œ Béƒ½æ˜¯å…·æœ‰ä¸€ç»„é€šç”¨çš„ç‰¹æ€§ï¼Œå³ä½¿å¯ä»¥ç”Ÿäº§ä¸åŒçš„é¢œè‰² åœŸè±† å’Œ è¥¿çº¢æŸ¿ã€‚</p><pre><code class="java"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PlantFactory</span> </span>{    <span class="function">Tomato <span class="title">plantTomato</span><span class="params">()</span></span>;    <span class="function">Potato <span class="title">plantPotato</span><span class="params">()</span></span>;}<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AFactory</span> <span class="keyword">implements</span> <span class="title">PlantFactory</span></span>{    <span class="meta">@Override</span>    <span class="function"><span class="keyword">public</span> Tomato <span class="title">plantTomato</span><span class="params">()</span> </span>{        System.out.println(<span class="string">"plantTomato By A"</span>);        <span class="keyword">return</span> <span class="keyword">new</span> Tomato();    }    <span class="meta">@Override</span>    <span class="function"><span class="keyword">public</span> Potato <span class="title">plantPotato</span><span class="params">()</span> </span>{        System.out.println(<span class="string">"plantPotato By A"</span>);        <span class="keyword">return</span> <span class="keyword">new</span> Potato();    }}<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BFactory</span> <span class="keyword">implements</span> <span class="title">PlantFactory</span> </span>{    <span class="meta">@Override</span>    <span class="function"><span class="keyword">public</span> Tomato <span class="title">plantTomato</span><span class="params">()</span> </span>{        System.out.println(<span class="string">"plantTomato By B"</span>);        <span class="keyword">return</span> <span class="keyword">new</span> Tomato();    }    <span class="meta">@Override</span>    <span class="function"><span class="keyword">public</span> Potato <span class="title">plantPotato</span><span class="params">()</span> </span>{        System.out.println(<span class="string">"plantPotato By B"</span>);        <span class="keyword">return</span> <span class="keyword">new</span> Potato();    }}<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>{    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{        PlantFactory plantFactory = <span class="keyword">new</span> AFactory();        plantFactory.plantPotato().cook();    }}</code></pre><p>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸‰ç§è®¾è®¡æ¨¡å¼ä¸­ï¼Œé™¤äº†æŠ½è±¡å·¥å‚æ¨¡å¼å¾ˆå°‘ä½¿ç”¨åˆ°ï¼Œå…¶ä»–ä¸¤ç§åœ¨å¹³å¸¸å¼€å‘çš„é¡¹ç›®ä¸­åŸºæœ¬ä¸Šéƒ½å¯ä»¥çœ‹åˆ°ã€‚</p>]]></content>
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mysqlä¸­intç±»å‹çš„ç®€å•æ€»ç»“</title>
      <link href="/2019/12/17/Mysql%E4%B8%ADint%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/"/>
      <url>/2019/12/17/Mysql%E4%B8%ADint%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><p>é¦–å…ˆé—®ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>int(1)å’Œint(10)æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</li><li>int(3)å¯ä»¥å­˜å‚¨ 10000 è¿™ä¸ªæ•°å­—å—ï¼Ÿ</li><li>int(11)å¯ä»¥ç”¨æ¥å­˜å‚¨æ‰‹æœºå·ä¹ˆï¼Ÿ</li></ol><p>æœ¬æ¬¡çš„æºä»£ç ä»¥åŠæµ‹è¯•çš„ Mysql ç‰ˆæœ¬å‡ä¸º 8.0.17</p><h2 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h2><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªè¡¨ï¼ŒSQLå¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_int(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">3</span>) <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> ,</span><br><span class="line">    <span class="keyword">no</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    phone <span class="built_in">int</span>(<span class="number">11</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br></pre></td></tr></table></figure></p><p>å½“ä½ æ‰§è¡Œå®Œè¿™ä¸ª SQL ä»¥åï¼ŒMysqlä¼šå‘å‡ºä¸€ä¸ªå¦‚ä¸‹æç¤ºï¼š</p><blockquote><p>[2019-12-16 23:08:24] [HY000][1681] Integer display width is deprecated and will be removed in a future release.<br>é¦–å…ˆä¸ç®¡è¿™ä¸ªæç¤ºï¼Œå¾…ä¼šåæ–‡ä¼šè§£é‡Šçš„ã€‚</p></blockquote><p> ç„¶åæ–°å¢æµ‹è¯•æ•°æ®ï¼š<br> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`test_int`</span> (<span class="string">`id`</span>, <span class="string">`no`</span>, <span class="string">`phone`</span>) <span class="keyword">VALUES</span> (<span class="number">10000</span>, <span class="number">1008611</span>, <span class="number">123124</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`test_int`</span> (<span class="string">`id`</span>, <span class="string">`no`</span>, <span class="string">`phone`</span>) <span class="keyword">VALUES</span> (<span class="number">10</span>, <span class="number">134</span>, <span class="number">124</span>);</span><br></pre></td></tr></table></figure></p><p> ç„¶åå†è¿›è¡Œ select æŸ¥çœ‹ã€‚<br> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> mysql&gt; select * from test_int;</span><br><span class="line">+<span class="comment">-------+---------+--------+</span></span><br><span class="line">| id    | no      | phone  |</span><br><span class="line">+<span class="comment">-------+---------+--------+</span></span><br><span class="line">|    10 |     134 |    124 |</span><br><span class="line">| 10000 | 1008611 | 123124 |</span><br><span class="line">+<span class="comment">-------+---------+--------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p> å¯ä»¥çœ‹åˆ°å…¶å®å¹¶æ²¡æœ‰å½±å“åˆ°ä»»ä½•æ•°æ®çš„æ’å…¥ï¼ŒéšåæŸ¥è¯¢ Mysql çš„å®˜æ–¹æ–‡æ¡£ï¼Œé‡Œé¢æœ‰è¿™æ ·çš„ä¸€æ®µè¯</p><blockquote><p>If you specify ZEROFILL for a numeric column, MySQL automatically adds the UNSIGNED attribute to the column.</p></blockquote><p>éšåå†æ¬¡æ–°å»ºä¸€ä¸ªè¡¨ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_int_zerofill(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">3</span>) <span class="keyword">unsigned</span> zerofill <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> ,</span><br><span class="line">    <span class="keyword">no</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> zerofill <span class="keyword">not</span> <span class="literal">null</span> ,</span><br><span class="line">    phone <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">unsigned</span> zerofill</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br><span class="line"></span><br><span class="line">The ZEROFILL attribute is deprecated and will be removed in a future release. <span class="keyword">Use</span> the <span class="keyword">LPAD</span> <span class="keyword">function</span> <span class="keyword">to</span> zero-<span class="keyword">pad</span> numbers, <span class="keyword">or</span> <span class="keyword">store</span> the formatted numbers <span class="keyword">in</span> a <span class="built_in">CHAR</span> column.</span><br></pre></td></tr></table></figure></p><p>è™½ç„¶æç¤º ZEROFILL å¿«è¦è¢«åºŸå¼ƒäº†ï¼Œä½†æ˜¯ä¸ºäº†æ¼”ç¤ºåŒºåˆ«ï¼Œæ‰€ä»¥æš‚æ—¶è¿˜æ˜¯ä¸ç®¡äº†ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test_int_zerofill;</span><br><span class="line">+<span class="comment">-------+--------+-------------+</span></span><br><span class="line">| id    | no     | phone       |</span><br><span class="line">+<span class="comment">-------+--------+-------------+</span></span><br><span class="line">|   010 |  00010 | 00000000010 |</span><br><span class="line">| 12345 | 123456 | 00001234567 |</span><br><span class="line">+<span class="comment">-------+--------+-------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥å¯¹äºé—®é¢˜1ï¼Œæ‰€ä»¥ int(1) å’Œ int(10) å…¶å®æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼Œå”¯ä¸€æœ‰åŒºåˆ«çš„åœ°æ–¹å°±åœ¨äºå¦‚æœä½¿ç”¨äº† <code>unsigned zerofill</code> ä¿®é¥°çš„è¯ï¼Œé‚£ä¹ˆä¸è¶³é•¿åº¦çš„ä¼šåœ¨å·¦è¾¹è¿›è¡Œè¡¥ 0 ï¼Œè€Œå¦‚æœæ²¡æœ‰ç”¨ <code>unsigned zerofill</code> è¿›è¡Œä¿®é¥°çš„è¯ï¼Œå¯ä»¥è¯´åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚</p><p>å¯¹äºé—®é¢˜2ï¼Œå› ä¸º int æ‹¬å·é‡Œé¢çš„å€¼ä¸ä½æ•°æ— å…³ï¼Œ æ‰€ä»¥æ˜¯å¯ä»¥çš„ã€‚<br>åˆ°æ­¤ï¼Œå¯¹äºæ‰§è¡Œç¬¬ä¸€ä¸ªSQLæ‰€è¿›è¡Œçš„æç¤ºï¼Œæ˜¯å› ä¸º Mysql ä¹Ÿè§‰å¾—å…¶å®æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œè€Œæ˜¯æ›´åŠ æ¨èç”¨ <code>LDAP()</code> è¿™ä¸ªå‡½æ•°æ¥åˆ¤æ–­ã€‚</p><p>å¯¹äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œå¯ä»¥å°è¯•ä¸€ä¸ªæ‰‹æœºå·ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`test`</span>.<span class="string">`test_int_zerofill`</span> (<span class="string">`id`</span>, <span class="string">`no`</span>, <span class="string">`phone`</span>) <span class="keyword">VALUES</span> (<span class="number">10</span>, <span class="number">10</span>, <span class="number">13100000000</span>)</span><br><span class="line"></span><br><span class="line">[<span class="number">22001</span>][<span class="number">1264</span>] <span class="keyword">Data</span> truncation: <span class="keyword">Out</span> <span class="keyword">of</span> <span class="keyword">range</span> <span class="keyword">value</span> <span class="keyword">for</span> <span class="keyword">column</span> <span class="string">'phone'</span> <span class="keyword">at</span> <span class="keyword">row</span> <span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› åœ¨äº int ç±»å‹åœ¨ mysql é‡Œé¢æ˜¯å››ä¸ªå­—èŠ‚ï¼Œè€Œä¸€ä¸ªå­—èŠ‚æ˜¯ 8 ä½ï¼Œæ‰€ä»¥åœ¨ mysql é‡Œé¢ï¼Œä¸€ä¸ªint ç±»å‹æœ€å¤šå¯ä»¥å‚¨å­˜ 2^31(ä¸€ä¸ªç¬¦å·ä½ç½®)ï¼Œä¹Ÿå°±æ˜¯çº¦ 21 äº¿å·¦å³ï¼Œæ— ç¬¦å·çš„ä¹Ÿæœ€å¤š42äº¿ï¼Œä½†æ˜¯æ‰‹æœºå·æœ€ä½ä¹Ÿæ˜¯11ä½ï¼Œä¹Ÿå°±æ˜¯ 130 å¤šäº¿ã€‚æ‰€ä»¥è‚¯å®šæ˜¯æ— æ³•å­˜å‚¨çš„ã€‚<br>ä¸‹é¢æ˜¯ Mysql å®˜æ–¹ç»™å‡ºçš„ num ç±»å‹çš„å­˜å‚¨èŒƒå›´<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%88%AA%E5%B1%8F2019-12-17%E4%B8%8A%E5%8D%8812.25.08.png" alt=""></p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><p>ç”±äºæƒ³çœ‹ä¸‹ Mysql åˆ°åº•æ˜¯å¦‚ä½•å¤„ç† int ç±»å‹çš„æ•°å€¼çš„ï¼Œäºæ˜¯ä¸‹è½½å¹¶ä¸”ç¼–è¯‘äº† Mysql çš„æºç ï¼Œä¸€ç›´è·Ÿç€ debugï¼Œæœ€åæ‰¾åˆ°äº† Mysql åˆ¤æ–­ int æ˜¯å¦è¶…é•¿çš„ä¸€ä¸ªä»£ç ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">type_conversion_status Field_long::store(<span class="keyword">double</span> nr) &#123;</span><br><span class="line">  ASSERT_COLUMN_MARKED_FOR_WRITE;</span><br><span class="line">  type_conversion_status error = TYPE_OK;</span><br><span class="line">  int32 res;</span><br><span class="line">  nr = rint(nr);</span><br><span class="line">  <span class="keyword">if</span> (unsigned_flag) &#123;</span><br><span class="line">    <span class="keyword">if</span> (nr &lt; <span class="number">0</span>) &#123;</span><br><span class="line">      res = <span class="number">0</span>;</span><br><span class="line">      error = TYPE_WARN_OUT_OF_RANGE;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nr &gt; (<span class="keyword">double</span>)UINT_MAX32) &#123;</span><br><span class="line">      res = UINT_MAX32;</span><br><span class="line">      set_warning(Sql_condition::SL_WARNING, ER_WARN_DATA_OUT_OF_RANGE, <span class="number">1</span>);</span><br><span class="line">      error = TYPE_WARN_OUT_OF_RANGE;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      res = (int32)(ulong)nr;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (nr &lt; (<span class="keyword">double</span>)INT_MIN32) &#123;</span><br><span class="line">      res = (int32)INT_MIN32;</span><br><span class="line">      error = TYPE_WARN_OUT_OF_RANGE;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nr &gt; (<span class="keyword">double</span>)INT_MAX32) &#123;</span><br><span class="line">      res = (int32)INT_MAX32;</span><br><span class="line">      error = TYPE_WARN_OUT_OF_RANGE;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      res = (int32)(longlong)nr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (error)</span><br><span class="line">    set_warning(Sql_condition::SL_WARNING, ER_WARN_DATA_OUT_OF_RANGE, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> WORDS_BIGENDIAN</span></span><br><span class="line">  <span class="keyword">if</span> (table-&gt;s-&gt;db_low_byte_first) &#123;</span><br><span class="line">    int4store(ptr, res);</span><br><span class="line">  &#125; <span class="keyword">else</span></span><br><span class="line">#endif</span><br><span class="line">    longstore(ptr, res);</span><br><span class="line">  <span class="keyword">return</span> error;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™æ®µä»£ç é‡Œé¢ï¼ŒMysqlé¦–å…ˆä¼šåˆ¤æ–­æ˜¯å¦å¸¦æœ‰ç¬¦å·ä½ï¼Œå¦‚æœæ˜¯æ— ç¬¦å·ä½çš„è¯ï¼Œåˆ™æ˜¯ç›´æ¥åˆ¤æ–­æ˜¯å¦å¤§äº UINT_MAX32ï¼Œè€Œå¦‚æœæ˜¯æœ‰ç¬¦å·çš„è¯ï¼Œåˆ™æ˜¯åˆ¤æ–­æ˜¯å¦å°äº INT_MIN32 æˆ–è€…å¤§äº INT_MAX32ï¼Œå¦åˆ™ç›´æ¥ä¸ºæœ€å°æˆ–è€…æœ€å¤§å€¼ï¼Œç„¶åè®¾ç½®errorã€‚<br>PSï¼šè¿™ä¸€æ®µä»£ç æ˜¯è¿˜æœªè¿›è¡Œ InnoDB å¼•æ“å±‚ï¼Œå¯ä»¥çœ‹åˆ° Mysql æ˜¯åœ¨ Server å±‚è¿›è¡ŒSQLè¯­å¥çš„æ ¡éªŒã€‚</p>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>java validation çš„å›½é™…åŒ–</title>
      <link href="/2019/12/09/java-validation-%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96/"/>
      <url>/2019/12/09/java-validation-%E7%9A%84%E5%9B%BD%E9%99%85%E5%8C%96/</url>
      <content type="html"><![CDATA[<h1 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h1><p>åœ¨ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®é‡Œé¢ï¼Œè‚¯å®šæ˜¯æœ‰å„ç§å„æ ·çš„å…¥å‚æ ¡éªŒçš„ï¼Œå¦‚æœä¸šåŠ¡ä¸Šçš„ä¸€äº›é€»è¾‘æ ¡éªŒï¼Œå¯ä»¥æ”¾åœ¨ Service å±‚é¢è¿›è¡Œï¼Œä½†æ˜¯å¦‚æœæ˜¯ Controller é‡Œé¢çš„æ ¡éªŒï¼Œç›´æ¥å¯ä»¥ç”¨ validation è¿›è¡ŒéªŒè¯ã€‚é…åˆæ³¨è§£å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°å„ç§å„æ ·çš„å…¥å‚æ ¡éªŒã€‚<br>å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span>(message = <span class="string">"ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Max</span>(value = <span class="number">18</span>)</span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶ååœ¨Controlleré‡Œé¢<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testError</span><span class="params">(@Valid  @RequestBody User user ,Errors errors)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">        <span class="keyword">for</span> (ObjectError err : errors.getAllErrors()) &#123;</span><br><span class="line">            <span class="keyword">return</span> err.getDefaultMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å½“å…¥å‚çš„ JSON å¦‚æœ name æ˜¯ç©ºçš„è¯ï¼Œå°±ä¼šç›´æ¥è¿”å› <code>ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</code>ï¼Œå½“ç„¶è¿™é‡Œæ˜¯åšäº†ä¸€äº›ç®€åŒ–ï¼Œè¿”å›çš„åº”è¯¥è¿˜æœ‰ Code å’Œ Messageã€‚è¿™æ ·çš„è¯ä¸€ä¸ªç®€å•çš„ Controller æ£€éªŒå…¥å‚å°±å®ç°çš„ï¼Œä½†æ˜¯ä¸ºäº†æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè¿˜éœ€è¦è€ƒè™‘<code>å›½é™…åŒ–</code>ä»¥åŠ<code>å¯é…ç½®åŒ–</code>ã€‚</p><h2 id="æ‰©å±•æ€§"><a href="#æ‰©å±•æ€§" class="headerlink" title="æ‰©å±•æ€§"></a>æ‰©å±•æ€§</h2><p>å¦‚æœåœ¨ä¹‹åéœ€è¦æ›´æ”¹ä¸€ä¸ªæ ¡éªŒçš„æç¤ºè¯­ï¼Œé‚£ä¹ˆåœ¨ä¸Šé¢çš„ä»£ç é‡Œé¢æ˜¯éœ€è¦ä¿®æ”¹ä»£ç çš„ï¼Œé‚£ä¹ˆæœ€å¥½çš„åŠæ³•å°±æ˜¯æŠŠè¿™äº›æç¤ºä¿¡æ¯éƒ½åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆä»¥åéœ€è¦ä¿®æ”¹æŸäº›æç¤ºçš„è¯ï¼Œç›´æ¥æ”¹é…ç½®æ–‡ä»¶å³å¯ã€‚<br>åœ¨ Spring å®˜æ–¹æ–‡æ¡£çš„ <strong>4.7.1</strong> ä¸­æœ‰ä¸€ä¸ªç±» <code>MessageCodesResolver</code> å¯ä»¥ç”¨æ¥å®ç°é”™è¯¯ä¿¡æ¯çš„å¯é…ç½®åŒ–</p><h3 id="MessageCodesResolver"><a href="#MessageCodesResolver" class="headerlink" title="MessageCodesResolver"></a>MessageCodesResolver</h3><p>è¿™ä¸ªç±»éœ€è¦å’Œ<code>spring.mvc.message-codes-resolver-format</code>ä¸€èµ·æ¥ä½¿ç”¨ï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£çš„æç¤ºï¼ŒæŸ¥çœ‹<code>DefaultMessageCodesResolver.Format</code>ï¼Œä¼šå‘ç°è¿™ä¸ªå‚æ•°æœ‰ä¸¤ä¸ªæšä¸¾ï¼Œä¸€ä¸ªæ˜¯ PREFIX_ERROR_CODEï¼Œå¦ä¸€ä¸ªæ˜¯ POSTFIX_ERROR_CODEã€‚<br>è¿™ä¸¤ä¸ªä»€ä¹ˆæ„æ€å‘¢ï¼Œç®€å•æ¥è®²ï¼Œæ ¹æ®ä¸Šé¢çš„ User ç±»ï¼Œå¦‚æœæˆ‘è¦é…ç½®å½“ name ä¸ä¸ºç©ºçš„æç¤ºè¯­ï¼Œä¸‹é¢ä¸¤ç§æšä¸¾å¯¹åº”åœ¨é…ç½®æ–‡ä»¶ä¸­çš„é”®å€¼æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><ol><li>PREFIX_ERROR_CODE<blockquote><p>NotBlank.user.name = ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</p></blockquote></li><li>POSTFIX_ERROR_CODEã€‚<blockquote><p>user.name.NotBlank = ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</p></blockquote></li></ol><p>ä¸ªäººåå‘äºç¬¬äºŒç§å†™æ³•çš„ï¼Œå› ä¸ºæ„Ÿè§‰ç¬¬äºŒç§æ›´åŠ ç¬¦åˆé˜…è¯»ä¹ æƒ¯ã€‚</p><h2 id="messgaeé…ç½®æ–‡ä»¶"><a href="#messgaeé…ç½®æ–‡ä»¶" class="headerlink" title="messgaeé…ç½®æ–‡ä»¶"></a>messgaeé…ç½®æ–‡ä»¶</h2><p>æ—¢ç„¶éœ€è¦åšæˆé…ç½®æ–‡ä»¶ï¼Œé‚£ä¹ˆåœ¨ application.yml é‡Œé¢æŠŠä¸€äº›å±æ€§éƒ½é…ç½®å¥½ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  mvc:</span></span><br><span class="line"><span class="attr">    message-codes-resolver-format:</span> <span class="string">postfix_error_code</span></span><br><span class="line"><span class="attr">  messages:</span></span><br><span class="line"><span class="attr">    basename:</span> <span class="string">i18n/validation</span></span><br></pre></td></tr></table></figure></p><p>ç„¶ååœ¨ Resources ä¸‹é¢æ–°å»ºä¸€ä¸ª validation.properties<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user.name.NotBlank = ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</span><br><span class="line">user.age.Max = å¹´é¾„æœ€é«˜ä¸èƒ½é«˜äº<span class="number">18</span></span><br><span class="line">user.age.Min = å¹´é¾„æœ€é«˜ä¸èƒ½ä½äº<span class="number">10</span></span><br></pre></td></tr></table></figure></p><h3 id="Controller-æ ¡éªŒ"><a href="#Controller-æ ¡éªŒ" class="headerlink" title="Controller æ ¡éªŒ"></a>Controller æ ¡éªŒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">MessageSource messageSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping</span>(value = <span class="string">"test/cn"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testErrorCn</span><span class="params">(@Valid  @RequestBody User user ,Errors errors)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">        <span class="keyword">for</span> (ObjectError err : errors.getAllErrors()) &#123;</span><br><span class="line">            String msg = messageSource.getMessage(err, Locale.CHINA);</span><br><span class="line">            <span class="keyword">return</span> msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œæš‚æ—¶å…ˆä¸ç®¡ <code>Locale.CHINA</code> è¿™ä¸ªå‚æ•°çš„å«ä¹‰ï¼Œé¦–å…ˆé€šè¿‡ errors å…ˆåˆ¤æ–­å…¥å‚æ˜¯å¦æœ‰é—®é¢˜ï¼Œæœ‰çš„è¯ç›´æ¥é€šè¿‡ messageSource.getMessage() æ–¹æ³•ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯å³å¯ã€‚</p><h3 id="PsotManæµ‹è¯•"><a href="#PsotManæµ‹è¯•" class="headerlink" title="PsotManæµ‹è¯•"></a>PsotManæµ‹è¯•</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /test/cn HTTP/<span class="number">1.1</span></span><br><span class="line">Host: localhost:<span class="number">8071</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="string">"age"</span>:<span class="number">15</span>&#125;</span><br></pre></td></tr></table></figure><p>è¿”å›ï¼šç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</p><p>é‚£ä¹ˆä»¥åå¦‚æœéœ€è¦ä¿®æ”¹è¿”å›æç¤ºçš„è¯ï¼Œç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ï¼Œä»è€Œä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p><h3 id="å›½é™…åŒ–"><a href="#å›½é™…åŒ–" class="headerlink" title="å›½é™…åŒ–"></a>å›½é™…åŒ–</h3><p>å¦‚æœéœ€è¦å°†è¯¥æç¤ºå›½é™…åŒ–ï¼Œç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯ï¼Œæ–°å»ºä¸¤ä¸ªé…ç½®æ–‡ä»¶<code>validation_zh_CN.properties</code>ï¼Œ<code>validation_en_US.properties</code>ï¼Œç„¶ååˆ†åˆ«æ–°å»ºæç¤ºé…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">validation_zh_CN.propertiesï¼š</span><br><span class="line">user.name.NotBlank = ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</span><br><span class="line">user.age.Max = å¹´é¾„æœ€é«˜ä¸èƒ½é«˜äº18</span><br><span class="line">user.age.Min = å¹´é¾„æœ€é«˜ä¸èƒ½ä½äº10</span><br><span class="line"></span><br><span class="line">validation_en_US.propertiesï¼š</span><br><span class="line">user.name.NotBlank = user name can not be null</span><br><span class="line">user.age.Max = the max gae can not grater than 18</span><br><span class="line">user.age.Min = the max gae can not less than 10</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶åœ¨Controlleré‡Œé¢ä»£å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MessageSource messageSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"test"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testError</span><span class="params">(@Valid  @RequestBody User user ,Errors errors)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">            <span class="keyword">for</span> (ObjectError err : errors.getAllErrors()) &#123;</span><br><span class="line">                <span class="keyword">return</span> err.getDefaultMessage();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"test/cn"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testErrorCn</span><span class="params">(@Valid  @RequestBody User user ,Errors errors)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">            <span class="keyword">for</span> (ObjectError err : errors.getAllErrors()) &#123;</span><br><span class="line">                String msg = messageSource.getMessage(err, Locale.CHINA);</span><br><span class="line">                <span class="keyword">return</span> msg;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(value = <span class="string">"test/en"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testErrorEn</span><span class="params">(@Valid  @RequestBody User user ,Errors errors)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">            <span class="keyword">for</span> (ObjectError err : errors.getAllErrors()) &#123;</span><br><span class="line">                String msg = messageSource.getMessage(err, Locale.US);</span><br><span class="line">                <span class="keyword">return</span> msg;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"OK"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>Userçš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Max</span>(value = <span class="number">18</span>)</span><br><span class="line">    <span class="meta">@Min</span>(value = <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å½“æˆ‘ä»¬è¯·æ±‚ <code>test/en</code> å’Œ <code>test/cn</code>çš„æ—¶å€™å°±ä¼šå‡ºç°ä¸åŒçš„æç¤ºï¼Œ</p><ol><li>test/en<blockquote><p>user name can not be null</p></blockquote></li><li>test/cn<blockquote><p>ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º</p></blockquote></li></ol><p>è¿™å…¶ä¸­é‡è¦çš„å®ç°å°±æ˜¯ Locale.US å’Œ Locale.CHINAï¼Œåœ¨è¿™é‡Œå®ç°çš„è¯ï¼Œæœ€å¥½æ˜¯æ ¹æ®ç”¨æˆ·çš„é€‰æ‹©è¯­è¨€æ¥åŠ¨æ€çš„åˆ‡æ¢å®ç°Localçš„è½¬æ¢ã€‚</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>javaä¿¡å·é‡çš„ç®€å•äº†è§£</title>
      <link href="/2019/12/04/java%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3/"/>
      <url>/2019/12/04/java%E4%BF%A1%E5%8F%B7%E9%87%8F%E7%9A%84%E7%AE%80%E5%8D%95%E4%BA%86%E8%A7%A3/</url>
      <content type="html"><![CDATA[<!-- ä¿¡å·é‡åœ¨è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿä»¥åŠå¹¶å‘çš„æ—¶å€™ç»å¸¸ä½¿ç”¨åˆ°ï¼Œç”¨äºå¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ï¼ˆå¾…å®šï¼‰ --><p>åœ¨Javaè¯­è¨€é‡Œé¢ï¼ŒSemaphore çš„ä½œç”¨æ˜¯å¯ä»¥æ§åˆ¶å¯¹äºåŒä¸€ä¸ªä¸´ç•Œèµ„æºï¼Œå…è®¸å¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œã€‚<br>å½“çº¿ç¨‹æ‰§è¡Œåˆ°ä¸´ç•ŒåŒºåŸŸçš„æ—¶å€™ï¼Œéœ€è¦å…ˆå‘ Semaphore ç”³è¯·ä¸€ä¸ªä»¤ç‰Œï¼Œæ­¤æ—¶ Semaphore ä¼šåˆ¤æ–­ç°æœ‰çš„çš„ä»¤ç‰Œæ˜¯ä¸æ˜¯å°äº0ï¼Œå¦‚æœå°äº0ï¼Œåˆ™é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´è‡³æœ‰çº¿ç¨‹å°†ä»¤ç‰Œå½’è¿˜å›æ¥ã€‚</p><h2 id="ç”³è¯·åˆ°äº†permits"><a href="#ç”³è¯·åˆ°äº†permits" class="headerlink" title="ç”³è¯·åˆ°äº†permits"></a>ç”³è¯·åˆ°äº†permits</h2><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹ç›´æ¥ç”³è¯·åˆ°äº†permitsï¼Œåˆ™æ˜¯ç›´æ¥é€šè¿‡CASæ“ä½œå°† state å‡ä¸€å³å¯ï¼Œç„¶åçº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p><h2 id="æ— æ³•ç”³è¯·åˆ°permits"><a href="#æ— æ³•ç”³è¯·åˆ°permits" class="headerlink" title="æ— æ³•ç”³è¯·åˆ°permits"></a>æ— æ³•ç”³è¯·åˆ°permits</h2><p>å½“æ— æ³•ç”³è¯·åˆ° Semaphore çš„ permits çš„æ—¶å€™ï¼Œåˆ™ä¼šå°†å½“å‰çš„çº¿ç¨‹è¿›è¡Œé˜»å¡ï¼Œç›´åˆ°æœ‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œé‡Šæ”¾äº† permitã€‚</p><h3 id="Semaphore-çš„ç±»å…³ç³»"><a href="#Semaphore-çš„ç±»å…³ç³»" class="headerlink" title="Semaphore çš„ç±»å…³ç³»"></a>Semaphore çš„ç±»å…³ç³»</h3><p>é‚£ä¹ˆåœ¨ <code>Semaphore</code> é‡Œé¢ï¼Œå¦‚æœ <code>permits</code> å·²ç»è¢«é™åˆ°0ä»¥ä¸‹ï¼ŒæŒ‰ç…§ä¿¡å·é‡çš„è§„åˆ™ï¼Œåº”å½“å°†å½“å‰çº¿ç¨‹é˜»å¡ï¼Œç›´åˆ° <code>permits</code> å¤§äº 0ã€‚æŸ¥çœ‹ Semaphore çš„ç±»ç»„ç»‡ç»“æ„ï¼Œä¼šå‘ç°å®ƒçš„ä¸€äº›æ“ä½œå…¨éƒ¨éƒ½æ˜¯ä¾èµ–äºè‡ªå·±çš„ä¸€ä¸ª Sync å˜é‡ï¼Œæ­¤å¤–è¿˜æœ‰ä¸¤ä¸ªå˜é‡ç”¨äºå®ç°å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œéƒ½æ˜¯ç»§æ‰¿è‡ª <code>Sync</code>ï¼Œè€Œ <code>Sync</code> åˆ™æ˜¯ç»§æ‰¿è‡ª <code>AbstractQueuedSynchronizer</code> (ä¸‹æ–‡ç®€ç§°AQS)ã€‚æ‰€ä»¥ Semaphore çš„å®ç°å…¨éƒ¨æ˜¯ä¾èµ–äº AQSã€‚<br>ä»¥ä¸‹ä¸º Semaphore çš„ç±»å›¾ï¼š<br> <img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Semphore%E7%9A%84%E9%9D%9E%E5%85%AC%E5%B9%B3%E4%BE%9D%E8%B5%96.png" alt=""></p><!-- åœ¨è¿™é‡Œå½“è·å–çš„èµ„æºæ•°å·²ç»æˆä¸ºäº†è´Ÿæ•°ï¼Œé‚£ä¹ˆé¦–å…ˆä¼šå°†ä¸Šä¸€ä¸ªèŠ‚ç‚¹è®¾ç½®ä¸º`SINGLE`(-1)ï¼Œè¿™æ ·çš„è¯ï¼Œå½“ä¸Šä¸€ä¸ªèŠ‚ç‚¹è¢«é‡Šæ”¾æˆ–è€…è¢«å–æ¶ˆçš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„åç»­èŠ‚ç‚¹å°±ä¼šè¿è¡Œï¼Œ --><!-- AQSé‡Œé¢ï¼Œç‹¬å é”çš„è¯æ˜¯åœ¨é‡Šæ”¾é”çš„æ—¶å€™ä¼šè¿›è¡Œé€šçŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯å…±äº«é”å´ä¸æ˜¯ï¼Œå®ƒæ˜¯åœ¨å¼€å§‹è¿è¡Œçš„æ—¶å€™å°±ç›´æ¥é€šçŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ --><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ Semaphore æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>å¦‚ä¸‹Demo<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> no;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt; <span class="number">2</span> ;i++)&#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> SemaphoreTest(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1000000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(no + <span class="string">"start"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            semaphore.acquire();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;  </span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(no);</span><br><span class="line">        System.out.println(<span class="string">"semaphore"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.currentThread().sleep(<span class="number">10000</span>);</span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SemaphoreTest</span><span class="params">(<span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.no = no;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé¦–å…ˆè·å–åˆ° permits çš„çº¿ç¨‹ä¼šæ‰§è¡Œï¼Œè€Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ™ä¼šè¢«é˜»å¡ï¼Œç›´åˆ° permits è¢«é‡Šæ”¾ã€‚è¿™ä¹Ÿæ˜¯ Semaphore çš„ç›®çš„ï¼Œæ§åˆ¶æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶çš„è®¿é—®æŸä¸€ä¸ªèµ„æºã€‚</p><h4 id="è®¾ç½®permits"><a href="#è®¾ç½®permits" class="headerlink" title="è®¾ç½®permits"></a>è®¾ç½®permits</h4><p>åœ¨ Semaphore é‡Œé¢ï¼Œç›´æ¥ä½¿ç”¨ AQS é‡Œé¢çš„<code>state</code>å˜é‡æ¥å†³å®šå…è®¸å¤šå°‘ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªèµ„æºï¼Œé€šè¿‡ Semaphore çš„æ„é€ å‡½æ•°å°±å¯ä»¥å‘ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Semaphore</span><span class="params">(<span class="keyword">int</span> permits)</span> </span>&#123;</span><br><span class="line">    sync = <span class="keyword">new</span> NonfairSync(permits);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">NonfairSync</span> <span class="keyword">extends</span> <span class="title">Sync</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">2694183684443567898L</span>;</span><br><span class="line"></span><br><span class="line">    NonfairSync(<span class="keyword">int</span> permits) &#123;</span><br><span class="line">        <span class="keyword">super</span>(permits);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">tryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nonfairTryAcquireShared(acquires);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¯¥superå°±æ˜¯è°ƒç”¨ Sync çš„æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨ AQS é‡Œé¢çš„ <code>setStateæ–¹æ³•</code>ï¼Œæœ€åè®¾ç½® AQS çš„ stateã€‚</p><h4 id="è·å–permits"><a href="#è·å–permits" class="headerlink" title="è·å–permits"></a>è·å–permits</h4><p>å½“ä¸€ä¸ªçº¿ç¨‹å°è¯•è°ƒç”¨ acquire æ–¹æ³•çš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šé€šè¿‡ NonfairSync çš„ tryAcquireShared æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œé¢ï¼Œä¼šè·å–å½“å‰çº¿ç¨‹çš„ stateï¼Œç„¶åå‡å»å…¥å‚å¸¦è¿‡æ¥çš„å‚æ•°ï¼ˆé»˜è®¤æ˜¯ 1 ï¼‰ï¼Œæœ€ååˆ¤æ–­æ˜¯å¦å°äº 0ï¼Œè‹¥å¤§äº 0 çš„è¯ï¼Œåˆ™ç›´æ¥é‡‡ç”¨ CAS çš„æ“ä½œå°†å‰©ä½™çš„ state æ›¿æ¢æ‰ã€‚å°äº 0 çš„è¯ï¼Œç›´æ¥è¿”å›å¹¶ä¸”ä¼šè¿›å…¥å¦ä¸€ä¸ªæ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">int</span> <span class="title">nonfairTryAcquireShared</span><span class="params">(<span class="keyword">int</span> acquires)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> available = getState();</span><br><span class="line">        <span class="keyword">int</span> remaining = available - acquires;</span><br><span class="line">        <span class="keyword">if</span> (remaining &lt; <span class="number">0</span> ||</span><br><span class="line">            compareAndSetState(available, remaining))</span><br><span class="line">            <span class="keyword">return</span> remaining;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">compareAndSetState</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// See below for intrinsics setup to support this</span></span><br><span class="line">    <span class="keyword">return</span> unsafe.compareAndSwapInt(<span class="keyword">this</span>, stateOffset, expect, update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”±äº state æ˜¯ç”± <code>volatile</code> ä¿®é¥°çš„ï¼Œæ‰€ä»¥è¯´å½“ä¸€ä¸ªçº¿ç¨‹åŸå­æ€§çš„ä¿®æ”¹äº† stateï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿä¼šç«‹å³è·å–åˆ° state çš„æœ€æ–°çŠ¶æ€çš„ã€‚<br>è¿™ä¸ªæ–¹æ³•ä¸æ˜¯ä¸€ä¸ªåŸå­æ€§çš„ï¼Œä½†æ˜¯ç”±äº CAS æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿˜æ˜¯èƒ½ä¿è¯ä¸€è‡´æ€§çš„ã€‚å¦‚ä¸‹ï¼š</p><ol><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨è·å–åˆ°äº† available æ°å¥½ä¸º 1ï¼Œ å‡†å¤‡å‡å» 1 çš„æ—¶å€™ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªçº¿ç¨‹æ°å¥½ CAS æ‰§è¡Œå®Œæ¯•ï¼Œå°† state æ›´æ–°ä¸º 0 äº†ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ CAS çš„æ—¶å€™ï¼Œç”±äº expect å·²ç»ä¿®æ”¹ä¸º 0 äº†ï¼Œæ‰€ä»¥æ­¤æ—¶ CAS æ“ä½œä¸€å®šä¸æˆåŠŸã€‚</li><li>å¦‚æœåœ¨ getState ä¹‹å‰ï¼Œstate å·²ç»è¢«ä¿®æ”¹æˆ 0 çš„ï¼Œé‚£ä¹ˆç”±äº <code>remaining &lt; 0</code>ï¼Œæ‰€ä»¥ç›´æ¥è¿”å› remainingã€‚</li></ol><h4 id="çº¿ç¨‹é˜»å¡"><a href="#çº¿ç¨‹é˜»å¡" class="headerlink" title="çº¿ç¨‹é˜»å¡"></a>çº¿ç¨‹é˜»å¡</h4><p>åœ¨è¿™é‡Œå…ˆç®€å•ä»‹ç»ä¸‹çº¿ç¨‹çš„é˜»å¡æ–¹å¼ï¼š<br>é¦–å…ˆç”Ÿæˆä¸€ä¸ª Nodeï¼Œç„¶åå†åˆ¤æ–­ä¸‹é˜Ÿåˆ—çš„å°¾éƒ¨ tail æ˜¯ä¸æ˜¯ä¸º nullï¼Œå¦‚æœæ˜¯çš„è¯åˆå§‹åŒ– head å’Œ tailï¼Œå¹¶ä¸”å°†å½“å‰çº¿ç¨‹çš„ Node çš„å‰ç½®èŠ‚ç‚¹æŒ‡å‘ headï¼Œç„¶åé€šè¿‡ CAS æ“ä½œå°† tail è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹åˆ›å»ºçš„ nodeï¼Œ æœ€åå°† head çš„åç½®èŠ‚ç‚¹æŒ‡å‘è¯¥èŠ‚ç‚¹ã€‚</p><p>ç„¶åå†åˆ¤æ–­å‰ç½®èŠ‚ç‚¹æ˜¯ä¸æ˜¯ headï¼Œæ˜¯çš„è¯å°±å†æ¬¡å°è¯•è·å– stateï¼Œè‹¥è·å–ä¸åˆ°åˆ™ç›´æ¥å°†å‰ä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus ä¿®æ”¹ä¸º -1ï¼ˆå³åç½®èŠ‚ç‚¹çš„çº¿ç¨‹éœ€è¦è¢«å”¤é†’ï¼‰ç„¶åç›´æ¥é€šè¿‡<code>LockSupport.park(this)</code>å°†å…¶é˜»å¡ã€‚</p><p>å½“ CAS æ“ä½œå¤±è´¥ï¼Œä¸€èˆ¬éƒ½æ˜¯ state å·²ç»å°äº 0 äº†ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ doAcquireSharedInterruptibly æ–¹æ³•é‡Œé¢ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œé¢ä¼šä½¿ç”¨ AQS é‡Œé¢çš„ FIFO é˜Ÿåˆ—ï¼Œæ¥å®ç°å¯¹äºä¸´ç•Œèµ„æºçš„æ§åˆ¶ã€‚</p><h5 id="è¯¦ç»†"><a href="#è¯¦ç»†" class="headerlink" title="è¯¦ç»†"></a>è¯¦ç»†</h5><p>Semaphore é¦–å…ˆä¼šè¿›è¡Œåˆ›å»ºä¸€ä¸ª Nodeï¼Œåœ¨é¦–æ¬¡é˜»å¡æŸä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œç”±äº tail ä¸ºnullï¼Œæ‰€ä»¥ä¼šç›´æ¥è¿›å…¥ enq æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œé¢ä¼šå°† tail å’Œ head éƒ½è®¾ç½®ä¸ºä¸€ä¸ªæ–°çš„ nodeï¼Œç„¶åå±•å¼€ç¬¬äºŒæ¬¡çš„å¾ªç¯ï¼Œæœ€ååœ¨å°†å½“å‰çº¿ç¨‹çš„ node çš„ prev æŒ‡å‘ headï¼Œé€šè¿‡CASæ“ä½œå°† tail æŒ‡å®šä¸ºè¯¥nodeï¼Œæœ€åå°† head çš„ next æŒ‡å‘ è¯¥nodeï¼ˆæ³¨æ„è¿™ä¸€æ­¥ä¸ºéåŸå­æ€§çš„ï¼Œæ‰€ä»¥ä¼šå½±å“åˆ°åé¢çš„releaseæ–¹æ³•çš„ä¸€ä¸ªåˆ¤æ–­ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">addWaiter</span><span class="params">(Node mode)</span> </span>&#123;</span><br><span class="line">    Node node = <span class="keyword">new</span> Node(Thread.currentThread(), mode);</span><br><span class="line">    <span class="comment">// Try the fast path of enq; backup to full enq on failure</span></span><br><span class="line">    Node pred = tail;</span><br><span class="line">    <span class="keyword">if</span> (pred != <span class="keyword">null</span>) &#123;</span><br><span class="line">        node.prev = pred;</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetTail(pred, node)) &#123;</span><br><span class="line">            pred.next = node;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    enq(node);</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">enq</span><span class="params">(<span class="keyword">final</span> Node node)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Node t = tail;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123; <span class="comment">// Must initialize</span></span><br><span class="line">            <span class="keyword">if</span> (compareAndSetHead(<span class="keyword">new</span> Node()))</span><br><span class="line">                tail = head;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            node.prev = t;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetTail(t, node)) &#123;</span><br><span class="line">                t.next = node;</span><br><span class="line">                <span class="keyword">return</span> t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ª FIFO é˜Ÿåˆ—å°±ç”Ÿæˆäº†ï¼Œæ­¤æ—¶ head ä¸ºä¸€ä¸ªnodeï¼ˆwaitStatusä¸º0ï¼Œnextä¸ºè¢«é˜»å¡çš„çº¿ç¨‹ï¼‰ï¼Œå½“ä» addWaiter æ–¹æ³•è¿”å›çš„æ—¶å€™ï¼ŒSemaphore è¿˜ä¼šè¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çš„å‰ç½®èŠ‚ç‚¹æ˜¯ headï¼Œå°±å†æ¬¡å°è¯•ä¸€æ¬¡è·å– stateï¼Œå¦‚æœè·å–ä¸åˆ°çš„è¯å°±å°†å‰ç½®èŠ‚ç‚¹çš„ waitStatus è®¾ç½®æˆ -1ï¼Œç„¶åé€šè¿‡<code>LockSupport.park(this)</code>å°†æœ¬çº¿ç¨‹ä¸­æ–­ï¼Œè‡³æ­¤è¯¥çº¿ç¨‹è¢«é˜»å¡äº†ã€‚</p><p><strong>å¦‚æœåœ¨åˆ¤æ–­å‰ç½®èŠ‚ç‚¹æ˜¯ head ä¹‹åï¼Œç„¶åé€šè¿‡ tryAcquireShared è·å–åˆ°äº† state</strong> é‚£ä¹ˆæ­¤æ—¶å°±ä¼šè°ƒç”¨ setHeadAndPropagate å°†è‡ªå·±è®¾ç½®ä¸ºå¤´èŠ‚ç‚¹ï¼ŒåŒæ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦å”¤é†’åç»­çš„èŠ‚ç‚¹</p><h2 id="é‡Šæ”¾"><a href="#é‡Šæ”¾" class="headerlink" title="é‡Šæ”¾"></a>é‡Šæ”¾</h2><p>å‡å¦‚ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ˜¯ä¼šè°ƒç”¨ release æ–¹æ³•æ¥é‡Šæ”¾èµ„æºçš„ï¼Œé¦–å…ˆè¿˜æ˜¯ä»¥ CAS æ“ä½œåŸå­æ€§çš„å¢åŠ  stateï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">tryReleaseShared</span><span class="params">(<span class="keyword">int</span> releases)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">int</span> current = getState();</span><br><span class="line">        <span class="keyword">int</span> next = current + releases;</span><br><span class="line">        <span class="keyword">if</span> (next &lt; current) <span class="comment">// overflow</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">"Maximum permit count exceeded"</span>);</span><br><span class="line">        <span class="keyword">if</span> (compareAndSetState(current, next))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doReleaseShared</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Ensure that a release propagates, even if there are other</span></span><br><span class="line"><span class="comment">        * in-progress acquires/releases.  This proceeds in the usual</span></span><br><span class="line"><span class="comment">        * way of trying to unparkSuccessor of head if it needs</span></span><br><span class="line"><span class="comment">        * signal. But if it does not, status is set to PROPAGATE to</span></span><br><span class="line"><span class="comment">        * ensure that upon release, propagation continues.</span></span><br><span class="line"><span class="comment">        * Additionally, we must loop in case a new node is added</span></span><br><span class="line"><span class="comment">        * while we are doing this. Also, unlike other uses of</span></span><br><span class="line"><span class="comment">        * unparkSuccessor, we need to know if CAS to reset status</span></span><br><span class="line"><span class="comment">        * fails, if so rechecking.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Node h = head;</span><br><span class="line">        <span class="keyword">if</span> (h != <span class="keyword">null</span> &amp;&amp; h != tail) &#123;</span><br><span class="line">            <span class="keyword">int</span> ws = h.waitStatus;</span><br><span class="line">            <span class="keyword">if</span> (ws == Node.SIGNAL) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!compareAndSetWaitStatus(h, Node.SIGNAL, <span class="number">0</span>))</span><br><span class="line">                    <span class="keyword">continue</span>;            <span class="comment">// loop to recheck cases</span></span><br><span class="line">                unparkSuccessor(h);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ws == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                        !compareAndSetWaitStatus(h, <span class="number">0</span>, Node.PROPAGATE))</span><br><span class="line">                <span class="keyword">continue</span>;                <span class="comment">// loop on failed CAS</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (h == head)                   <span class="comment">// loop if head changed</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unparkSuccessor</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * If status is negative (i.e., possibly needing signal) try</span></span><br><span class="line"><span class="comment">        * to clear in anticipation of signalling.  It is OK if this</span></span><br><span class="line"><span class="comment">        * fails or if status is changed by waiting thread.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="keyword">int</span> ws = node.waitStatus;</span><br><span class="line">    <span class="keyword">if</span> (ws &lt; <span class="number">0</span>)</span><br><span class="line">        compareAndSetWaitStatus(node, ws, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * Thread to unpark is held in successor, which is normally</span></span><br><span class="line"><span class="comment">        * just the next node.  But if cancelled or apparently null,</span></span><br><span class="line"><span class="comment">        * traverse backwards from tail to find the actual</span></span><br><span class="line"><span class="comment">        * non-cancelled successor.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    Node s = node.next;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span> || s.waitStatus &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        s = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Node t = tail; t != <span class="keyword">null</span> &amp;&amp; t != node; t = t.prev)</span><br><span class="line">            <span class="keyword">if</span> (t.waitStatus &lt;= <span class="number">0</span>)</span><br><span class="line">                s = t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (s != <span class="keyword">null</span>)</span><br><span class="line">        LockSupport.unpark(s.thread);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å½“ CAS æ“ä½œæˆåŠŸä¹‹åè¿”å› trueï¼Œç„¶åè°ƒç”¨ doReleaseShared æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•é‡Œé¢ï¼Œä¼šé¦–å…ˆå°† head çš„çŠ¶æ€æ›´æ”¹ä¸º 0ï¼Œç„¶åç„¶åé€šè¿‡ unparkSuccessor æ¥å”¤é†’åé¢çš„çº¿ç¨‹ï¼Œåœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯é‚£ä¸€ä¸ª for å¾ªç¯é‡Œé¢çš„ä»£ç ã€‚</p><h3 id="ä¸ºä»€ä¹ˆforå¾ªç¯çš„æ—¶å€™éœ€è¦ä»å°¾èŠ‚ç‚¹å¼€å§‹"><a href="#ä¸ºä»€ä¹ˆforå¾ªç¯çš„æ—¶å€™éœ€è¦ä»å°¾èŠ‚ç‚¹å¼€å§‹" class="headerlink" title="ä¸ºä»€ä¹ˆforå¾ªç¯çš„æ—¶å€™éœ€è¦ä»å°¾èŠ‚ç‚¹å¼€å§‹"></a>ä¸ºä»€ä¹ˆforå¾ªç¯çš„æ—¶å€™éœ€è¦ä»å°¾èŠ‚ç‚¹å¼€å§‹</h3><p>åœ¨è¿™é‡Œå…¶å®æ˜¯ç”±äºå‰é¢åœ¨è®¾ç½®å°¾èŠ‚ç‚¹çš„æ—¶å€™ CAS è™½ç„¶æ˜¯ä¸€ä¸ªåŸå­æ€§æ“ä½œï¼Œä½†æ˜¯åœ¨ CAS æ“ä½œä¹‹åï¼Œç´§è·Ÿç€ <code>pred.next = node</code> è¿™ä¸€æ­¥ä¸ºéåŸå­æ€§çš„ï¼Œæ‰€ä»¥å°±å¯¼è‡´äº†æœ‰å¯èƒ½ä»å¤´éå†çš„æ—¶å€™ä¼šæ–­å¼€æ‰ï¼Œæ‰€ä»¥æ­¤æ—¶å°±éœ€è¦ä»å°¾èŠ‚ç‚¹å¼€å§‹ï¼Œå› ä¸ºè¿™æ ·ä¸€å®šä¸ä¼šæ–­å¼€çš„ï¼Œä¹Ÿæ˜¯æœ€æœ‰ä¿è¯çš„ã€‚</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Java8ä¸­çš„æµå¼ç®€å•æ€»ç»“</title>
      <link href="/2019/11/22/Java8%E4%B8%AD%E7%9A%84%E6%B5%81%E5%BC%8F%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/"/>
      <url>/2019/11/22/Java8%E4%B8%AD%E7%9A%84%E6%B5%81%E5%BC%8F%E7%AE%80%E5%8D%95%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>åœ¨å¤§é‡ä½¿ç”¨Java8ä¸­çš„æµå¼æ“ä½œä¹‹åï¼Œè§‰å¾—ç”¨èµ·æ¥è¿˜æŒºèˆ’æœçš„ï¼Œæ‰€ä»¥æ­£å¥½è¶è¿™ä¸ªæœºä¼šæ€»ç»“ä¸‹ã€‚</p><p>ä½¿ç”¨Java8çš„lambdaè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠé›†åˆè½¬ä¸ºä¸€ç§æµï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨ stream æ–¹æ³•ï¼Œä½†æ˜¯ stream å´æ˜¯ Collection ç±»é‡Œé¢çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ Collection çš„å­ç±»æ‰å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥ Map é›†åˆæ˜¯ä½¿ç”¨ä¸äº†çš„ï¼ŒåŒç†ï¼Œå¯¹äºæ•°ç»„ï¼Œå¯ä»¥é€šè¿‡<code>Arrays.stream()</code> æ–¹æ³•æ¥è®²æ•°ç»„è½¬ä¸ºä¸€ä¸ªStreamï¼Œè¿™æ ·ä¹Ÿå¯ä»¥ä½¿ç”¨Streamé‡Œé¢çš„æ–¹æ³•äº†ï¼Œ</p><h2 id="å°†é›†åˆè½¬ä¸ºæµ"><a href="#å°†é›†åˆè½¬ä¸ºæµ" class="headerlink" title="å°†é›†åˆè½¬ä¸ºæµ"></a>å°†é›†åˆè½¬ä¸ºæµ</h2><p>ä¸‹é¢ä»‹ç»å‡ ä¸ªå¾ˆå¸¸ç”¨çš„æ–¹æ³•æ¥ä»‹ç»æµå¼æ“ä½œçš„ä¾¿æ·æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; stringList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">stringList.add(<span class="string">"a1"</span>);</span><br><span class="line">stringList.add(<span class="string">"b1"</span>);</span><br><span class="line">stringList.add(<span class="string">"a2"</span>);</span><br><span class="line">stringList.add(<span class="string">"b2"</span>);</span><br><span class="line">stringList.stream();</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°äº†ä¸€ä¸ªæµå¼æ“ä½œï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨Streamé‡Œé¢å®šä¹‰å¥½çš„æ–¹æ³•äº†</p><h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>è¯¥æ–¹æ³•ç”¨äºè¿‡æ»¤æˆ‘ä»¬è®¾ç½®çš„ä¸€äº›åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">streamFilter</span><span class="params">(List&lt;String&gt; list)</span></span>&#123;</span><br><span class="line">        List&lt;String&gt; result = list.stream().filter(item -&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"a"</span>.equals(item))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;).collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåªæ˜¯ä¸€ä¸ªæ™®é€šçš„Stringæ•°ç»„éå†ï¼Œå¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬é€šè¿‡Java8ä¹‹å‰çš„ä»£ç å†™çš„è¯ï¼Œä¼šé¦–å…ˆ newä¸€ä¸ªListï¼Œç„¶åé€šè¿‡addæ–¹æ³•æ¥è¿›è¡Œæ’å…¥ï¼Œè¿™æ ·è™½ç„¶ä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯ä¼šæ˜¾å¾—ä¸æ˜¯é‚£ä¹ˆæ•´æ´ï¼Œä½†æ˜¯ç”¨æµå¼æ“ä½œçš„è¯ï¼Œæ„Ÿè§‰ä¼šæ–¹ä¾¿ä¸å°‘ã€‚</p><p>å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªæ¡ä»¶è¦è¿›è¡Œè¿‡æ»¤çš„è¯ï¼Œfilterä¹Ÿæ˜¯æ”¯æŒé“¾å¼è°ƒç”¨çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">streamFilter</span><span class="params">(List&lt;String&gt; list)</span></span>&#123;</span><br><span class="line">        List&lt;String&gt; result = list.stream().filter(item -&gt;&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">"a1"</span>.equals(item))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .filter(item -&gt; (item.startsWith(<span class="string">"a"</span>)))</span><br><span class="line">        .collect(Collectors.toList());</span><br><span class="line">        result.stream().forEach(item -&gt; System.out.println(item));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p>mapå¸¸ç”¨äºä¸€äº›éå†æ¡ä»¶ï¼Œä¾‹å¦‚å–å‡ºæŸäº›JavaBeançš„å±æ€§å¹¶ä½œä¸ºé›†åˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ä¸€ä¸ªPersoné›†åˆçš„æ‰€æœ‰å§“åå–å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å–å‡ºé›†åˆå†…æ‰€æœ‰çš„å§“å</span></span><br><span class="line">List&lt;String&gt; nameList = list.stream().map(Person::getName).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//å»é‡å–å‡ºé›†åˆå†…æ‰€æœ‰çš„å§“å</span></span><br><span class="line">List&lt;String&gt; nameDistinctList = list.stream().map(Person::getName).distinct().collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¾å‡ºæ‰€æœ‰æˆå¹´çš„äºº</span></span><br><span class="line">List&lt;String&gt; ageList = list.stream().filter(</span><br><span class="line">                item -&gt; (Objects.nonNull(item.getAge()) &amp;&amp; item.getAge() &gt; <span class="number">18</span>)</span><br><span class="line">        ).map(Person::getName).distinct().collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†æ‰€æœ‰å·²ç»æˆå¹´çš„äººæŒ‰ç…§å¹´é¾„è¿›è¡Œåˆ†ç»„</span></span><br><span class="line">Map&lt;Integer, List&lt;Person&gt;&gt; ageSameList = list.stream().filter(</span><br><span class="line">                item -&gt; (Objects.nonNull(item.getAge()) &amp;&amp; item.getAge() &gt; <span class="number">18</span>)</span><br><span class="line">        ).collect(Collectors.groupingBy(Person::getAge));</span><br></pre></td></tr></table></figure><h3 id="findFirst"><a href="#findFirst" class="headerlink" title="findFirst"></a>findFirst</h3><p>åœ¨æˆ‘çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ„Ÿè§‰è¿™ä¸ªæ–¹æ³•é…åˆæšä¸¾ç±»ç›¸å½“çš„å¥½ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ProvinceEnum &#123;</span><br><span class="line">    BEIJING(<span class="string">"åŒ—äº¬å¸‚"</span>,<span class="string">"110000"</span>),</span><br><span class="line">    TIANJIN(<span class="string">"å¤©æ´¥å¸‚"</span>,<span class="string">"120000"</span>),</span><br><span class="line">    HEBEI(<span class="string">"æ²³åŒ—çœ"</span>,<span class="string">"130000"</span>),</span><br><span class="line">    SHANXI(<span class="string">"å±±è¥¿çœ"</span>,<span class="string">"140000"</span>),</span><br><span class="line">    ;</span><br><span class="line">    <span class="keyword">private</span> String cn;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    ProvinceEnum(String cn, String code) &#123;</span><br><span class="line">        <span class="keyword">this</span>.cn = cn;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCnByCode</span><span class="params">(String code)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.stream(ProvinceEnum.values()).filter(</span><br><span class="line">                item -&gt; (StringUtils.isNotEmpty(item) &amp;&amp; item.getCn().equals(code))</span><br><span class="line">        ).map(ProvinceEnum::getCn).findFirst().orElse(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ç”±äºå…¶ä»–çš„æ–¹æ³•å¤§è‡´ä¸è¿™ä¸Šé¢å‡ ä¸ªæ–¹æ³•ç›¸ä¼¼ï¼Œæ‰€ä»¥å°±ä¸å†å†™demoäº†</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JDK1.7ä¸­çš„ConcurrentHashMapå®ç°ç»†èŠ‚(äºŒ)</title>
      <link href="/2019/09/15/JDK1-7%E4%B8%AD%E7%9A%84ConcurrentHashMap%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82/"/>
      <url>/2019/09/15/JDK1-7%E4%B8%AD%E7%9A%84ConcurrentHashMap%E5%AE%9E%E7%8E%B0%E7%BB%86%E8%8A%82/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨JDK1.7å‘JDK1.8å‡çº§çš„è¿‡ç¨‹ä¸­ï¼Œ<code>ConcurrentHashMap</code>ç”±åŸæ¥çš„å¯é‡å…¥é”å’Œ<code>CAS</code>é”ç›´æ¥è¢«æ›¿æ¢ä¸º<code>synchronized</code>å…³é”®å­—äº†ï¼Œè™½ç„¶è¯´åœ¨åŠŸèƒ½ä¸Šéƒ½æ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œä½†æ˜¯åœ¨è¿™é‡Œä¸€ç›´éƒ½æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œæ—¢ç„¶åœ¨1.7çš„ä½¿ç”¨è¿‡ç¨‹ä¸­æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œé‚£åˆ°åº•æ˜¯å‡ºäºä»€ä¹ˆåŸå› è¦å°†å…¶æ›¿æ¢å‘¢ã€‚</p><h2 id="JDK1-7ä¸­çš„ConcurrentHashMap"><a href="#JDK1-7ä¸­çš„ConcurrentHashMap" class="headerlink" title="JDK1.7ä¸­çš„ConcurrentHashMap"></a>JDK1.7ä¸­çš„ConcurrentHashMap</h2><p>åœ¨JDK1.7ä¸­ï¼Œå…¶ç»“æ„æ˜¯ç”±ä¸€ä¸ªå¯é‡å…¥é”<code>Segment</code>æ•°ç»„å’Œæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸‹çš„<code>HashEntry</code>æ•°ç»„æ¥å®ç°çš„ã€‚ç»“æ„å›¾å¦‚ä¸‹:<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/1.7ConcurrentHashMap.png" alt=""></p><p>ç”±äº segment æ˜¯ä¸€ä¸ªé”ï¼Œæ‰€ä»¥å¦‚æœåœ¨å¹¶å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹å°è¯•å‘ä¸€ä¸ª segment ä¸­çš„ HashEntry è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šè·å–åˆ°é”ï¼Œå…¶ä»–çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ç›´è‡³é”è¢«é‡Šæ”¾ï¼Œæ‰€ä»¥è¿™ä¸ªå®¹å™¨æ˜¯ä¸€ä¸ªå¹¶å‘å®‰å…¨çš„ã€‚</p><!--é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªå¯é‡å…¥é”å‘¢ï¼Œ--><p>æŸ¥çœ‹ put æ–¹æ³•çš„è°ƒç”¨é“¾çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°æœ€ç»ˆéƒ½æ˜¯è°ƒç”¨çš„æ˜¯<code>Segment</code>çš„<code>put</code>æ–¹æ³•ã€‚</p><p><code>segment</code> ç±»åœ¨ <code>ConCurrentHashMap</code> ä¸­çš„å˜é‡æ˜¯ä»¥ä¸€ä¸ªæ•°ç»„çš„å½¢å¼æ‰€å­˜åœ¨çš„ï¼Œç”±äº<code>segment</code>ç»§æ‰¿äº† ReentrantLock ï¼Œæ‰€ä»¥æ˜¯å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯é‡å…¥é”ï¼Œå› æ­¤åœ¨<code>JDK1.7</code>é‡Œé¢ï¼Œæ˜¯é€šè¿‡ <code>segment</code>çš„ é‡å…¥é”æœºåˆ¶æ¥å®ç°å¹¶å‘çš„å†™å…¥ã€‚åŒæ—¶ä¹Ÿå¯ä»¥å‘ç°å¦‚æœè°ƒç”¨çš„æ˜¯<code>ConcurrentHashMap</code>çš„æ— å‚æ„é€ å‡½æ•°çš„è¯ï¼Œé‚£ä¹ˆåˆå§‹åŒ–<code>Segment</code>æ•°ç»„å¤§å°å°±æ˜¯16ï¼Œå½“ç„¶è¿™ä¸ªæ•°ç»„å¤§å°å…¶å®æ˜¯å¯ä»¥è¢«è°ƒæ•´çš„ï¼Œä½†æ˜¯æ— è®ºæ€æ ·è¿›è¡Œè°ƒæ•´ï¼Œæœ€ç»ˆ segment æ•°ç»„çš„å¤§å°æ°¸è¿œéƒ½æ˜¯2çš„næ¬¡æ–¹ã€‚</p><h2 id="Segment"><a href="#Segment" class="headerlink" title="Segment"></a>Segment</h2><p>åœ¨<code>ConcurrentHashMap</code>é‡Œé¢ï¼Œä¸€ä¸ª<code>segment</code>å°±æ˜¯ä¸€ä¸ª<code>HashEntry</code>çš„æ•°ç»„ï¼Œè€Œä¸€ä¸ª<code>HashEntry</code>å°±æ˜¯ä¸€ä¸ª<code>bucket</code>ã€‚</p><blockquote><p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒConcurrentHashMap é»˜è®¤çš„ segment æ•°ç»„çš„å¤§å°æ˜¯16ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šåªå¯èƒ½æœ‰16ä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œå¤„ç†</p></blockquote><p>å½“è°ƒç”¨ put æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ä¸€ä¸ªå¯é‡å…¥é”çš„ CAS æ“ä½œæ¥å°è¯•è·å–è¯¥ segment é”ï¼Œå¦‚æœè·å–åˆ°äº†åˆ™ç›´æ¥æ–°å»ºä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œå¦‚æœè¿˜æœªè·å–åˆ°åˆ™ç›´æ¥è°ƒç”¨<code>scanAndLockForPut</code>æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> HashEntry&lt;K,V&gt; <span class="title">scanAndLockForPut</span><span class="params">(K key, <span class="keyword">int</span> hash, V value)</span> </span>&#123;</span><br><span class="line">    HashEntry&lt;K,V&gt; first = entryForHash(<span class="keyword">this</span>, hash);</span><br><span class="line">    HashEntry&lt;K,V&gt; e = first;</span><br><span class="line">    HashEntry&lt;K,V&gt; node = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> retries = -<span class="number">1</span>; <span class="comment">// negative while locating node</span></span><br><span class="line">    <span class="keyword">while</span> (!tryLock()) &#123;</span><br><span class="line">        HashEntry&lt;K,V&gt; f; <span class="comment">// to recheck first below</span></span><br><span class="line">        <span class="keyword">if</span> (retries &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="comment">// speculatively create node</span></span><br><span class="line">                    node = <span class="keyword">new</span> HashEntry&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                retries = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (key.equals(e.key))</span><br><span class="line">                retries = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                e = e.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (++retries &gt; MAX_SCAN_RETRIES) &#123;</span><br><span class="line">            lock();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((retries &amp; <span class="number">1</span>) == <span class="number">0</span> &amp;&amp;</span><br><span class="line">                 (f = entryForHash(<span class="keyword">this</span>, hash)) != first) &#123;</span><br><span class="line">            e = first = f; <span class="comment">// re-traverse if entry changed</span></span><br><span class="line">            retries = -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="scanAndLockForPutæ–¹æ³•çš„ä½œç”¨"><a href="#scanAndLockForPutæ–¹æ³•çš„ä½œç”¨" class="headerlink" title="scanAndLockForPutæ–¹æ³•çš„ä½œç”¨"></a>scanAndLockForPutæ–¹æ³•çš„ä½œç”¨</h3><p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œä¼šåœ¨ while å¾ªç¯é‡Œé¢å°è¯• 64 æ¬¡ï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªå¾ªç¯è¯­å¥é‡Œé¢æœ‰ä¸€äº›ç»†èŠ‚çš„æ“ä½œã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>åˆ¤æ–­å½“å‰å¤´èŠ‚ç‚¹ first æ˜¯å¦ä¸º nullï¼Œæ˜¯çš„è¯åˆ™åˆå§‹åŒ– node </li><li>å¦‚æœ first ä¸æ˜¯ nullï¼Œåˆ¤æ–­å½“å‰çš„ key æ˜¯å¦å’Œ first ç›¸ç­‰</li><li>å¦‚æœ first å³ä¸ä¸ºnullï¼Œå¹¶ä¸”å½“å‰çš„ key åˆä¸å’Œå…¥å‚çš„keyç›¸åŒï¼Œåˆ™ç›´æ¥å¯»æ‰¾å…¶ next èŠ‚ç‚¹ï¼Œç›´è‡³ next ä¸ºnullï¼Œç„¶åè¿›è¡Œç¬¬ä¸€æ­¥</li></ul><p>å…¶å®ä¸Šé¢çš„ä¸€äº›æ­¥éª¤ä»…ä»…æ˜¯è¯¥æ–¹æ³•å¾ªç¯çš„ç¬¬ä¸€æ­¥è¦åšçš„ï¼Œå½“ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤éƒ½è¿›è¡Œå®Œæ¯•ä¹‹åï¼Œé¦–å…ˆä¼šåˆ¤æ–­å¾ªç¯çš„æ¬¡æ•°æ˜¯å¦å·²ç»å¤§äº <code>MAX_SCAN_RETRIES</code> å¦‚æœæ˜¯çš„è¯ï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>lock</code> æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯çš„è¯åˆ™è°ƒç”¨ç¬¬ä¸‰ä¸ªåˆ¤æ–­ã€‚</p><p>ç¬¬ä¸‰ä¸ªåˆ¤æ–­ä¸­ä¼šåˆ¤æ–­å½“å‰å¾ªç¯æ¬¡æ•°æ˜¯ä¸æ˜¯å¶æ•°ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™ä¼šåˆ¤æ–­å½“å‰çš„å¤´èŠ‚ç‚¹è¿˜æ˜¯ä¸æ˜¯ä¹‹å‰çš„firstï¼Œå¦‚æœä¸æ˜¯çš„è¯åˆ™éœ€è¦é‡æ–°å°†æ–°çš„å¤´èŠ‚ç‚¹èµ‹å€¼ç»™ first ç„¶åå°†å¾ªç¯æ¬¡æ•°æ”¹æˆ1ï¼Œå†æ¬¡é‡è¯•ã€‚</p><p>å…¶å®è¿™ä¸ªæ–¹æ³•å¦‚æœä»”ç»†çœ‹çœ‹ï¼Œä½ ä¼šå‘ç°è²Œä¼¼æ²¡å•¥ä½œç”¨ï¼Œå› ä¸ºè¿”å›çš„æ˜¯ nodeï¼Œä½†æ˜¯ node ä¸€æ—¦ç¬¬ä¸€æ¬¡è¢«èµ‹å€¼ä¹‹åï¼Œä»¥åä¾¿ä¸ä¼šåšä»»ä½•çš„æ›´æ”¹ï¼Œæ‰€ä»¥æ­£å¦‚è¯¥æ–¹æ³•çš„æ³¨é‡Šæ‰€è¯´çš„ä¸€æ ·ï¼Œ<strong>è¿™ä¸ªæ–¹æ³•ä»…ä»…æ˜¯ä¸º JVM åšä¸€ä¸ªé¢„çƒ­è€Œå·²</strong>ã€‚</p><h3 id="ç»§ç»­è·å–é”"><a href="#ç»§ç»­è·å–é”" class="headerlink" title="ç»§ç»­è·å–é”"></a>ç»§ç»­è·å–é”</h3><p>å¦‚æœåœ¨ 64 æ¬¡ä»¥å†…è¿˜æ˜¯æœªè·å–åˆ°è¯¥é”ï¼Œåˆ™ä¼šè°ƒç”¨<code>lock</code>æ–¹æ³•ï¼Œç”±äº ConcurrentHashMap åœ¨åˆå§‹åŒ– segment çš„æ—¶å€™ï¼Œå¹¶æœªæ˜¾å¼è°ƒç”¨<code>ReentrantLock</code>çš„æ„é€ æ–¹æ³•ï¼Œè€Œ ReentrantLock åˆæ˜¯é»˜è®¤åˆå§‹åŒ–éå…¬å¹³é”ï¼Œæ‰€ä»¥æ­¤æ—¶åœ¨ scanAndLockForPut é‡Œé¢çš„ lock å…¶å®è°ƒç”¨çš„æ˜¯ NonfairSync é‡Œé¢çš„ lock æ–¹æ³•ï¼Œå³å†æ¬¡ä»¥éå…¬å¹³é”çš„æ–¹å¼æ¥å°è¯•è·å–é”<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line">        setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        acquire(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å½“æœ€åä¸€æ¬¡å¦‚æœ CAS æ“ä½œè¿˜æœªè·å–åˆ°é”çš„æ—¶å€™ï¼Œsegment å°±ä¼šè°ƒç”¨<strong>acquire(1)</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acquire</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!tryAcquire(arg) &amp;&amp;</span><br><span class="line">        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))</span><br><span class="line">        selfInterrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°çš„æ˜¯ if åˆ¤æ–­é‡Œé¢è¿˜æ˜¯ä¼šå†æ¬¡å°è¯•è·å–é”ï¼Œå½“è¿˜æœªè·å–åˆ°é”çš„æ—¶å€™ï¼Œå°±å°†è¯¥ Node æ”¾å…¥åˆ° FIFO é˜Ÿåˆ—çš„æœ«å°¾ï¼Œç„¶åç­‰å¾…ç€è¢«å”¤é†’æ‰§è¡Œ</p><p>ä»ä¸Šé¢çš„ä¸€ä¸ªæµç¨‹ä¸éš¾çœ‹å‡ºï¼Œåœ¨ segment é¦–å…ˆä¼šä»¥å¯é‡å…¥é”çš„æ–¹å¼æ¥å°è¯•æ€§çš„è·å–é”ï¼Œå½“æ²¡å–åˆ°çš„æ—¶å€™ä¼š<strong>whileå¾ªç¯</strong>64æ¬¡åšä¸€ä¸ªé¢„çƒ­ï¼Œå¦‚æœåœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­è¿˜æ˜¯æœªè·å–åˆ°é”ï¼Œåˆ™ä¼šè¿›è¡Œä¸¤æ¬¡<code>CAS</code>æ“ä½œ(åˆ†åˆ«åœ¨ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•é‡Œé¢)ï¼Œå¦‚æœæœ€ç»ˆè¿˜æ˜¯æ— æ³•è·å–åˆ°é”çš„è¯ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå°†è‡ªå·±æ”¾å…¥åˆ° AQS ä¸­çš„ FIFO é˜Ÿåˆ—ã€‚</p><p>å›è¿‡å¤´æ¥å†çœ‹ segment é‡Œé¢çš„ç¬¬ä¸€è¡Œä»£ç ï¼š</p><blockquote><p>HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value);</p></blockquote><p>é‚£ä¹ˆå¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œåœ¨JDK1.7é‡Œé¢ï¼Œputæ–¹æ³•å¦‚æœåœ¨å¤§é‡å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¦è·å–ä¸€ä¸ªé”ä¼šè¿›è¡Œéå¸¸å¤šçš„æ“ä½œï¼Œè€Œä¸”å®ƒé»˜è®¤çš„ segment æ•°ç»„å¤§å°è¿˜æ˜¯ 16 ï¼Œä¹Ÿå°±æ˜¯è¯´mapçš„æ‰€æœ‰é”®å€¼ï¼Œå‡ºç°ç¢°æ’çš„æ¦‚ç‡ä¸æ˜¯ 1/map.size()ï¼Œè€Œæ°¸è¿œæ˜¯ 1/16ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Leetcodeæ•°ç»„ä¸­è¿ç»­åˆ†ç»„</title>
      <link href="/2019/09/08/Leetcode%E6%95%B0%E7%BB%84%E4%B8%AD%E8%BF%9E%E7%BB%AD%E5%88%86%E7%BB%84/"/>
      <url>/2019/09/08/Leetcode%E6%95%B0%E7%BB%84%E4%B8%AD%E8%BF%9E%E7%BB%AD%E5%88%86%E7%BB%84/</url>
      <content type="html"><![CDATA[<p>åœ¨Leetcodeä¸Šæœ‰ä¸€é“é¢˜ç›®ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>In a deck of cards, each card has an integer written on it.<br>  Return true if and only if you can choose X &gt;= 2 such that it is possible to split the entire deck into 1 or more groups of cards, where:<br>  Each group has exactly X cards.<br>  All the cards in each group have the same integer.</p></blockquote><p>è¿™ä¸€é¢˜å°±æ˜¯ä¸€ä¸ªæ±‚æœ€å¤§å…¬çº¦æ•°çš„é¢˜ç›®ï¼Œå½“ä»»æ„ä¸¤ç»„çš„å…¬çº¦æ•°ä¸º1çš„æ—¶å€™ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±è¯´æ˜ï¼Œä»–ä»¬çš„åˆ†ç»„æ•°é‡ä¸ç›¸ç­‰å°±å¯ä»¥ç›´æ¥è¿”å›falseäº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasGroupsSizeX</span><span class="params">(<span class="keyword">int</span>[] deck)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10000</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> val : deck)&#123;</span><br><span class="line">            count[val]++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> sum = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> val: deck)&#123;</span><br><span class="line">            <span class="keyword">if</span>(sum == -<span class="number">1</span>)&#123;</span><br><span class="line">                sum = count[val];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sum = getGcd(sum,count[val]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(sum == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mysqlçš„å¹»è¯»(äºŒ)</title>
      <link href="/2019/08/27/mysql%E7%9A%84%E5%B9%BB%E8%AF%BB-%E4%BA%8C/"/>
      <url>/2019/08/27/mysql%E7%9A%84%E5%B9%BB%E8%AF%BB-%E4%BA%8C/</url>
      <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>åœ¨InnoDBé‡Œé¢ï¼Œæ˜¯é€šè¿‡å¿«ç…§è¯»æ¥å®ç°<code>RC</code>å’Œ<code>PR</code>éš”ç¦»çº§åˆ«çš„åŒºåˆ†ï¼Œå› ä¸ºåœ¨<code>RC</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€æ¬¡çš„selectéƒ½æ˜¯ä¸€ä¸ªå¿«ç…§è¯»ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥è¯»å–åˆ°å·²ç»æäº¤çš„æ•°æ®ï¼Œä»è€Œå¯¼è‡´å¹»è¯»ã€‚æ‰€ä»¥åœ¨<code>RC</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¿«ç…§è¯»å’Œå½“å‰è¯»éƒ½æ˜¯å¯ä»¥å‡ºç°å¹»è¯»ã€‚</p><p>ä½†æ˜¯åœ¨<code>PR</code>çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œç”±äºå¿«ç…§è¯»ä»…ä»…åªç”Ÿæˆä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨<code>PR</code>çº§åˆ«ä¸‹çš„å¿«ç…§è¯»æ˜¯æ— æ³•å‡ºç°å¹»è¯»çš„ï¼Œä½†æ˜¯å½“å‰è¯»ç¡®å®å¯ä»¥å‡ºç°å¹»è¯»ã€‚</p><p>æŸ¥çœ‹Mysqlå®˜æ–¹å¯¹äº<code>å¹»è¯»</code>çš„å®šä¹‰ã€‚</p><blockquote><p>The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. </p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº‹ç‰©åŒä¸€æ¡æŸ¥è¯¢è¯­å¥æŸ¥è¯¢å‡ºæ¥äº†ä¸¤ä¸ªä¸åŒçš„é›†åˆå°±å¯ä»¥ç§°ä¹‹ä¸ºå¹»è¯»ã€‚</p><h3 id="ANSI-SQL-éš”ç¦»çº§åˆ«"><a href="#ANSI-SQL-éš”ç¦»çº§åˆ«" class="headerlink" title="ANSI SQL éš”ç¦»çº§åˆ«"></a>ANSI SQL éš”ç¦»çº§åˆ«</h3><p>åœ¨<code>ANSI SQL éš”ç¦»çº§åˆ«</code>çš„å®šä¹‰ä¸­<code>PR</code>çº§åˆ«æ˜¯å¯ä»¥å‡ºç°å¹»è¯»çš„ã€‚<br>ä½†æ˜¯åœ¨InnoDBå¼•æ“é‡Œé¢è‡ªå·±é€šè¿‡<code>GAPé”</code>å’Œ<code>Next-Keyé”</code>ä½¿å¾—<code>PR</code>éš”ç¦»çº§åˆ«ä¸‹æ— æ³•å‡ºç°å¹»è¯»ã€‚åŸå› å°±åœ¨äºInnoDBçš„<code>GAP</code>é”</p><h2 id="GAPé”"><a href="#GAPé”" class="headerlink" title="GAPé”"></a>GAPé”</h2><p>åœ¨<code>InnoDB</code>é‡Œé¢ï¼ŒGAPé”æ˜¯ç”¨äºé˜²æ­¢å¹»è¯»çš„ä¸€ä¸ªæ‰‹æ®µï¼Œå…·ä½“çš„æ“ä½œæ˜¯é¦–å…ˆå½“æˆ‘ä»¬æ–°å¢ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œ<code>InnoDB</code>ä¼šåœ¨æ­¤æ—¶åŠ ä¸€ä¸ª<code>GAP</code>é”ä»è€Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹è¯¥åŒºé—´çš„ä¸€äº›æ•°æ®æ“ä½œï¼Œå¯¼è‡´å¹»è¯»çš„å‡ºç°ã€‚</p><h3 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h3><h4 id="PRçº§åˆ«ï¼š"><a href="#PRçº§åˆ«ï¼š" class="headerlink" title="PRçº§åˆ«ï¼š"></a><code>PR</code>çº§åˆ«ï¼š</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test_lock.test;</span><br><span class="line">+---------+-----------+----------------+------------+-------------+</span><br><span class="line">| user_id | user_name | user_password  | is_deleted | phone       |</span><br><span class="line">+---------+-----------+----------------+------------+-------------+</span><br><span class="line">| a       | zhangsan  | 123456         |          0 | 15112345678 |</span><br><span class="line">| b       | lisi      | lisi123456     |          0 | 15112345678 |</span><br><span class="line">| c       | wangwu    | wangwu123456   |          0 | 15112345678 |</span><br><span class="line">| d       | caocao    | caocao123456   |          0 | 15112345678 |</span><br><span class="line">| e       | liubei    | liubei123456   |          0 | 15112345678 |</span><br><span class="line">| f       | zhangfei  | zhangfei123456 |          0 | 15112345678 |</span><br><span class="line">| g       | guanyu    | guanyu123456   |          0 | 15112345678 |</span><br><span class="line">| h       | daqiao    | daqiao123456   |          0 | 15112345678 |</span><br><span class="line">| m       | xiaoqiao  | xiaoqiao123456 |          0 | 15112345678 |</span><br><span class="line">+---------+-----------+----------------+------------+-------------+</span><br><span class="line">9 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><em>äº‹ç‰©ä¸€</em>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_lock.test where  user_id &gt; &apos;g&apos; and user_id &lt; &apos;m&apos; for update ;</span><br><span class="line">+---------+-----------+---------------+------------+-------------+</span><br><span class="line">| user_id | user_name | user_password | is_deleted | phone       |</span><br><span class="line">+---------+-----------+---------------+------------+-------------+</span><br><span class="line">| h       | daqiao    | daqiao123456  |          0 | 15112345678 |</span><br><span class="line">+---------+-----------+---------------+------------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p><em>äº‹ç‰©äºŒ</em>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_lock.`test` values(&apos;i&apos;,&apos;daqiao&apos;,&apos;daqiao123456&apos;,0,&apos;15112345678&apos;);</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶åœ¨<code>PR</code>éš”ç¦»çº§åˆ«ä¸‹ä¼šé˜»å¡ã€‚</p><p>æ­¤æ—¶æŸ¥çœ‹æ•°æ®åº“ä¸­çš„é”ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ysql&gt; select * from performance_schema.data_locks;</span><br><span class="line">+--------+----------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+------------------------+-------------+-----------+</span><br><span class="line">| ENGINE | ENGINE_LOCK_ID                         | ENGINE_TRANSACTION_ID | THREAD_ID | EVENT_ID | OBJECT_SCHEMA | OBJECT_NAME | PARTITION_NAME | SUBPARTITION_NAME | INDEX_NAME | OBJECT_INSTANCE_BEGIN | LOCK_TYPE | LOCK_MODE              | LOCK_STATUS | LOCK_DATA |</span><br><span class="line">+--------+----------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+------------------------+-------------+-----------+</span><br><span class="line">| INNODB | 140169161014704:1068:140169076344152   |                235275 |        50 |       16 | test_lock     | test        | NULL           | NULL              | NULL       |       140169076344152 | TABLE     | IX                     | GRANTED     | NULL      |</span><br><span class="line">| INNODB | 140169161014704:7:4:14:140169076341272 |                235275 |        50 |       16 | test_lock     | test        | NULL           | NULL              | PRIMARY    |       140169076341272 | RECORD    | X,GAP,INSERT_INTENTION | WAITING     | &apos;m&apos;       |</span><br><span class="line">| INNODB | 140169161013840:1068:140169076338200   |                235274 |        47 |       20 | test_lock     | test        | NULL           | NULL              | NULL       |       140169076338200 | TABLE     | IX                     | GRANTED     | NULL      |</span><br><span class="line">| INNODB | 140169161013840:7:4:14:140169076335256 |                235274 |        47 |       20 | test_lock     | test        | NULL           | NULL              | PRIMARY    |       140169076335256 | RECORD    | X                      | GRANTED     | &apos;m&apos;       |</span><br><span class="line">| INNODB | 140169161013840:7:4:15:140169076335256 |                235274 |        47 |       20 | test_lock     | test        | NULL           | NULL              | PRIMARY    |       140169076335256 | RECORD    | X                      | GRANTED     | &apos;h&apos;       |</span><br><span class="line">+--------+----------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+------------------------+-------------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°åœ¨<code>m</code>åˆ—ç”±äº<code>GAP</code>é”å’Œ<code>INSERT_INTENTION</code>äº’ç›¸å†²çªï¼Œå¯¼è‡´<code>äº‹ç‰©äºŒ</code>æ— æ³•è¿›è¡Œæ’å…¥</p><blockquote><p>äº‹ç‰©ä¸€ç”±äºè¿›è¡Œ<code>for update</code>æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¼šå¯¹åŒºé—´åŠ ä¸€ä¸ªGAPé”<br>äº‹ç‰©äºŒç”±äºæ˜¯æ–°å¢ï¼Œæ‰€ä»¥ä¼šåŠ ä¸€ä¸ªæ’å…¥æ„å‘é”<br>ç”±äº<code>GAP</code>é”é˜»å¡ä½äº†æ’å…¥æ„å‘é”ï¼Œå¯¼è‡´<code>äº‹ç‰©äºŒ</code>æ— æ³•è¿›è¡Œæ’å…¥</p></blockquote><p>æ­¤æ—¶<code>äº‹ç‰©äºŒ</code>ä¹Ÿä¼šåœ¨è¿™é‡Œé˜»å¡ä½ï¼Œè€Œåœ¨<code>RC</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œ<code>äº‹ç‰©äºŒ</code>æ˜¯ä¸ä¼šç­‰å¾…çš„ã€‚<br>ä½†æ˜¯å¦‚æœä»”ç»†ä¸€ç‚¹ï¼Œå…¶å®è¿™é‡Œè¿˜å¯ä»¥å‘ç°å¦ä¸€ä¸ªé”ï¼Œå°±æ˜¯æ’å…¥æ„å‘é”<code>INSERT_INTENTION LOCK</code></p><h2 id="INSERT-INTENTION-LOCK"><a href="#INSERT-INTENTION-LOCK" class="headerlink" title="INSERT_INTENTION_LOCK"></a>INSERT_INTENTION_LOCK</h2><p>Mysqlå®˜æ–¹æ–‡æ¡£ä¸­å°†<code>INSERT_INTENTION</code>å®šä¹‰ä¸ºä¸€ä¸ª<code>GAP</code>é”ï¼Œä½†æ˜¯å®ƒçš„æ„ä¹‰å’ŒçœŸæ­£çš„<code>GAP</code>é”ä¹‹é—´æ˜¯æœ‰å¤©å¤§çš„å·®åˆ«çš„ï¼Œ<code>INSERT_INTENTION_LOCK</code>å¹¶ä¸ä¼šé˜»å¡<code>GAP</code>é”ï¼Œä½†ç›¸å<code>GAP</code>ä¼šé˜»å¡<code>INSERT_INTENTION_LOCK</code>ï¼Œå¹¶ä¸”è¯¥é”çš„é”å®šèŒƒå›´æ˜¯æ’å…¥è¡Œä¸€ç›´åˆ°ä¸‹ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¸€æ•´ä¸ªåŒºé—´<br>å¦‚ä¸‹ä¾‹å­ï¼š<br><em>äº‹ç‰©ä¸€</em>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_lock.`test` values(&apos;i&apos;,&apos;daqiao&apos;,&apos;daqiao123456&apos;,0,&apos;15112345678&apos;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure></p><p><em>äº‹ç‰©äºŒ</em>ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; start transaction ;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update test_lock.`test` set user_id=&apos;l&apos;  where  user_id = &apos;k&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 0  Changed: 0  Warnings: 0</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶æŸ¥çœ‹äº‹ç‰©ä¸­é”ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from performance_schema.data_locks;</span><br><span class="line">+--------+----------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+-----------+-------------+-----------+</span><br><span class="line">| ENGINE | ENGINE_LOCK_ID                         | ENGINE_TRANSACTION_ID | THREAD_ID | EVENT_ID | OBJECT_SCHEMA | OBJECT_NAME | PARTITION_NAME | SUBPARTITION_NAME | INDEX_NAME | OBJECT_INSTANCE_BEGIN | LOCK_TYPE | LOCK_MODE | LOCK_STATUS | LOCK_DATA |</span><br><span class="line">+--------+----------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+-----------+-------------+-----------+</span><br><span class="line">| INNODB | 140169161014704:1068:140169076344152   |                235293 |        50 |       48 | test_lock     | test        | NULL           | NULL              | NULL       |       140169076344152 | TABLE     | IX        | GRANTED     | NULL      |</span><br><span class="line">| INNODB | 140169161014704:7:4:14:140169076341272 |                235293 |        50 |       48 | test_lock     | test        | NULL           | NULL              | PRIMARY    |       140169076341272 | RECORD    | X,GAP     | GRANTED     | &apos;m&apos;       |</span><br><span class="line">| INNODB | 140169161013840:1068:140169076338200   |                235288 |        47 |       32 | test_lock     | test        | NULL           | NULL              | NULL       |       140169076338200 | TABLE     | IX        | GRANTED     | NULL      |</span><br><span class="line">+--------+----------------------------------------+-----------------------+-----------+----------+---------------+-------------+----------------+-------------------+------------+-----------------------+-----------+-----------+-------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°<code>äº‹ç‰©äºŒ</code>ç¡®å®å·²ç»æ‰§è¡ŒæˆåŠŸäº†ï¼Œè€Œä¸”<code>äº‹ç‰©ä¸€</code>çš„æ’å…¥æ„å‘é”å¹¶æœªé˜»å¡äº‹ç‰©äºŒçš„æ’å…¥è¯­å¥<br>ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨Mysqlçš„<code>InnoDB</code>ä¸­ï¼Œå¹»è¯»çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨äº†ä¸€ä¸ªé—´éš™é”<code>GAP</code>é”æ¥å®ç°çš„</p>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mysqlä¸­çš„å¹»è¯»(ä¸€)</title>
      <link href="/2019/08/18/Mysql%E4%B8%AD%E7%9A%84%E5%B9%BB%E8%AF%BB-%E4%B8%80/"/>
      <url>/2019/08/18/Mysql%E4%B8%AD%E7%9A%84%E5%B9%BB%E8%AF%BB-%E4%B8%80/</url>
      <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å¹»è¯»"><a href="#ä»€ä¹ˆæ˜¯å¹»è¯»" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹»è¯»"></a>ä»€ä¹ˆæ˜¯å¹»è¯»</h2><p>å¹»è¯»è¡¨ç¤ºçš„æ˜¯åœ¨ä¸€ä¸ªäº‹ç‰©é‡Œé¢ åŒä¸€ä¸ª<code>select</code>è¯­å¥ï¼Œå‰åä¸¤æ¬¡æŸ¥è¯¢å‡ºæ¥çš„ç»“æœæ˜¯ä¸ç›¸åŒçš„ï¼Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨InnoDBé‡Œé¢ï¼Œå¹»è¯»è·Ÿäº‹ç‰©çš„éš”ç¦»çº§åˆ«æœ‰å…³ï¼Œæ›´åŠ å‡†ç¡®çš„è¯´æ˜¯è·Ÿä¸€ä¸ªäº‹ç‰©çš„å¿«ç…§å’Œå½“å‰è¯»æœ‰å…³</p><p>ä¸‹é¢æ˜¯åœ¨Mysql8.0.11ç‰ˆæœ¬ä¸‹è¿›è¡Œå¹»è¯»çš„å¤ç°ï¼š</p><ul><li>å¼•æ“ï¼šInnoDB</li><li>äº‹ç‰©éš”ç¦»çº§åˆ«ï¼šRead Commited</li></ul><h3 id="MVCCå’Œå¿«ç…§è¯»ä»¥åŠå½“å‰è¯»"><a href="#MVCCå’Œå¿«ç…§è¯»ä»¥åŠå½“å‰è¯»" class="headerlink" title="MVCCå’Œå¿«ç…§è¯»ä»¥åŠå½“å‰è¯»"></a>MVCCå’Œå¿«ç…§è¯»ä»¥åŠå½“å‰è¯»</h3><h4 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h4><p>åœ¨ä»‹ç»MVCCä¹‹å‰å…ˆæ¥ä»‹ç»ä¸‹MVCCä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Œé¦–å…ˆæ•°æ®åº“ä½œä¸ºä¸€ä¸ªæ•°æ®å­˜å‚¨å·¥å…·ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å­˜åœ¨å¹¶å‘çš„æƒ…å†µï¼Œ<br>åœ¨Mysqlçš„InnoDBé‡Œé¢æœ€å¸¸è§çš„å°±æ˜¯<code>x</code>é”ï¼Œè¿™æ˜¯ä¸€ç§å†™é”ï¼Œåœ¨å¹¶å‘çš„æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªäº‹åŠ¡ä¼šè·å–è¯¥é”ï¼Œå…¶ä»–äº‹åŠ¡åˆ™ä¼šä¸€ç›´ç­‰å¾…ç›´è‡³è·å–åˆ°è¯¥é”ã€‚</p><p>é‚£ä¹ˆåœ¨è¯»å–çš„æ—¶å€™å¦‚ä½•ä¿è¯å¹¶å‘çš„äº‹ç‰©éƒ½èƒ½æ­£ç¡®çš„è¯»å–åˆ°è‡ªå·±æ­£ç¡®çš„æ•°æ®å‘¢ï¼Ÿ</p><p>åœ¨MVCCçš„æ¦‚å¿µé‡Œé¢ï¼Œå¦‚æœäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æ˜¯<code>Read Commited</code>çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸€æ¬¡çš„å¿«ç…§éƒ½éƒ½ä¼šè¯»å–è¯¥è¡Œçš„æœ€è¿‘ä¸€æ¬¡<code>commited</code>æ•°æ®ï¼Œè€Œå¦‚æœæ˜¯<code>Repeatable Read</code>çš„è¯ï¼Œåˆ™æ˜¯ä¼šè¯»å–å½“å‰äº‹åŠ¡IDå¼€å§‹ä¹‹å‰çš„ä¸€æ¬¡<code>commited</code>æ•°æ®ã€‚</p><p>æ‰€ä»¥MVCCä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªä¿è¯æ•°æ®åº“å¹¶å‘è¯»æƒ…å†µä¸‹çš„ä¸€ä¸ªæ•°æ®æ­£ç¡®çš„æ‰‹æ®µè€Œå·²ï¼Œåœ¨ä¸åŒçš„æ•°æ®åº“é‡Œé¢ï¼Œæœ‰ä¸åŒçš„å®ç°ï¼Œä¾‹å¦‚åœ¨<code>OceanBase</code>é‡Œé¢ï¼Œæ˜¯é€šè¿‡æ“ä½œé“¾æ¥è§£å†³å¹¶å‘è¯»çš„é—®é¢˜</p><h4 id="å¿«ç…§è¯»"><a href="#å¿«ç…§è¯»" class="headerlink" title="å¿«ç…§è¯»"></a>å¿«ç…§è¯»</h4><p>å¿«ç…§è¯»æ˜¯åˆ©ç”¨MVCCå’Œ <code>undo log</code> æ¥å®ç°çš„ï¼Œå…¶ä¸»è¦ä½œç”¨å°±æ˜¯å½“æˆ‘ä»¬å¯¹æŸè¡Œæ•°æ®ä¿®æ”¹ä¹‹åï¼Œå¹¶ä¸ä¼šå°†åŸå€¼ä¿®æ”¹ï¼Œè€Œæ˜¯åœ¨ä¸Šä¸€ä¸ªç‰ˆæœ¬ä¸Šé¢å†æ–°å»ºä¸€ä¸ªç‰ˆæœ¬(ä¿®æ”¹InnoDBçš„éšè—ä¸¤åˆ—)ã€‚<br>æ‰€ä»¥åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„<code>äº‹ç‰©ID</code>æ¥è·å–è‡ªå·±æ‰€éœ€è¦çš„æ•°æ®ã€‚å½“ç¬¬ä¸€æ¡ä¸æ»¡è¶³çš„æ—¶å€™ï¼Œä¼šæ²¿ç€<code>undo log</code>ä¸€ç›´å¯»æ‰¾ï¼Œåœ¨<code>Read Commited</code>éš”ç¦»çº§åˆ«ä¸‹å°±æ˜¯ç›´æ¥æ‰¾å‡ºè¯¥è¡Œæ•°æ®æœ€åä¸€æ¬¡æäº¤çš„ç‰ˆæœ¬</p><h4 id="å½“å‰è¯»"><a href="#å½“å‰è¯»" class="headerlink" title="å½“å‰è¯»"></a>å½“å‰è¯»</h4><p>å½“å‰è¯»æ˜¯å¯¹æ•°æ®çš„åŠ é”è¯»å–ï¼Œè¯»å–çš„éƒ½æ˜¯æœ€æ–°çš„æ•°æ®ï¼Œä¾‹å¦‚å¦‚ä¸‹SQLï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select ... for update</span><br><span class="line">select ... in share mode</span><br><span class="line">insert</span><br><span class="line">update</span><br><span class="line">delete</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶ä¹Ÿéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå½“å‰è¯»ä¼šå¯¹æ¶‰åŠåˆ°çš„è¡Œéƒ½è¿›è¡ŒåŠ é”</p><h4 id="ä¸ºä»€ä¹ˆä¼šæœ‰å½“å‰è¯»å’Œå¿«æ‰¾è¯»"><a href="#ä¸ºä»€ä¹ˆä¼šæœ‰å½“å‰è¯»å’Œå¿«æ‰¾è¯»" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šæœ‰å½“å‰è¯»å’Œå¿«æ‰¾è¯»"></a>ä¸ºä»€ä¹ˆä¼šæœ‰å½“å‰è¯»å’Œå¿«æ‰¾è¯»</h4><p>æŒ‰ç…§Mysqlå®˜æ–¹çš„è§£é‡Šï¼Œå½“å‰è¯»æ˜¯ä¸ºäº†é˜²æ­¢å…¶ä»–äº‹ç‰©ä¿®æ”¹ä½ å³å°†è¿›è¡Œçš„æ“ä½œ</p><blockquote><p>If you query data and then insert or update related data within the same transaction, the regular SELECT statement does not give enough protection. Other transactions can update or delete the same rows you just queried. InnoDB supports two types of locking reads that offer extra safety</p></blockquote><h3 id="å¹»è¯»å‘ç”Ÿçš„æ¡ä»¶"><a href="#å¹»è¯»å‘ç”Ÿçš„æ¡ä»¶" class="headerlink" title="å¹»è¯»å‘ç”Ÿçš„æ¡ä»¶"></a>å¹»è¯»å‘ç”Ÿçš„æ¡ä»¶</h3><p>é¦–å…ˆè§£é‡Šä¸‹Mysqlå®˜æ–¹å¯¹äºå¹»è¯»çš„è§£é‡Šï¼š</p><blockquote><p>The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a â€œphantomâ€ row.</p></blockquote><p>è¿™é‡ŒMysqlå®˜æ–¹è™½ç„¶åªæ˜¯ç»™å‡ºäº†å¯¹äº<code>å¹»è¡Œ</code>çš„å®šä¹‰ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ç®€å•è§£é‡Šä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤æ¬¡çš„<code>select</code>å‰åå¾—åˆ°çš„ç»“æœé›†æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆæ–°å¤šå‡ºæ¥çš„ä¸€è¡Œå°±å¯ä»¥ç§°ä¹‹ä¸º<code>å¹»è¡Œ</code></p><p><strong>åœ¨è¿™é‡Œç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨PRéš”ç¦»ç•Œåˆ«ä¸‹ï¼Œåªæœ‰å½“å‰è¯»æ‰ä¼šå‡ºç°å¹»è¯»</strong></p><h4 id="Read-Commited"><a href="#Read-Commited" class="headerlink" title="Read Commited"></a>Read Commited</h4><p>åœ¨<code>Read Commited</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€æ¬¡çš„<code>select</code> éƒ½æ˜¯ä¸€æ¬¡å¿«ç…§è¯»ï¼Œæ‰€ä»¥åœ¨è¯¥éš”ç¦»çº§åˆ«ä¸‹ï¼Œå¹»è¯»å¯ä»¥åœ¨å¿«ç…§è¯»å’Œå½“å‰è¯»å‘ç”Ÿã€‚</p><blockquote><p>äº‹åŠ¡ä¸€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set session transaction isolation level read committed;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; START TRANSACTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from szh.t1</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| area_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from `szh`.`t1`;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| area_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>äº‹åŠ¡äºŒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `szh`.`t1`(`area_id`, `order_num`) VALUES (3, 22);</span><br></pre></td></tr></table></figure></p></blockquote><p>æ­¤æ—¶<code>äº‹åŠ¡ä¸€</code>å†è¿›è¡Œselect<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from `szh`.`t1`;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| area_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">|       3 |        22 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>äºæ˜¯å¹»è¯»å‘ç”Ÿäº†</p><h4 id="Repeatable-Read"><a href="#Repeatable-Read" class="headerlink" title="Repeatable Read"></a>Repeatable Read</h4><p>é‚£ä¹ˆå¦‚æœåœ¨<code>Repeatable Read</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸Šé¢çš„SQLåœ¨æ‰§è¡Œä¸€éä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ</p><blockquote><p>äº‹åŠ¡ä¸€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START TRANSACTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; begin;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM `t1`</span><br><span class="line">    -&gt; ;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| area_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">|       3 |        22 |</span><br><span class="line">|       4 |        33 |</span><br><span class="line">|       5 |        55 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>äº‹åŠ¡äºŒ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO `szh`.`t1`(`area_id`, `order_num`) VALUES (6, 66);</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>äº‹åŠ¡ä¸€å†æ¬¡select<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM `t1`;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| area_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">|       3 |        22 |</span><br><span class="line">|       4 |        33 |</span><br><span class="line">|       5 |        55 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p></blockquote><p>å¯ä»¥çœ‹åˆ°çš„æ˜¯åœ¨å¿«ç…§è¯»ä¸‹é¢ï¼Œæ˜¯æ²¡æœ‰å¹»è¯»å‡ºç°çš„ï¼Œé‚£ä¹ˆä¿®æ”¹selectä¸ºå½“å‰è¯»å‘¢ï¼Ÿ<br>åœ¨äº‹åŠ¡ä¸€é‡Œé¢å†æ¬¡æ‰§è¡Œä»¥ä¸‹SQL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM `t1` for update;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| area_id | order_num |</span><br><span class="line">+---------+-----------+</span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">|       3 |        22 |</span><br><span class="line">|       4 |        33 |</span><br><span class="line">|       5 |        55 |</span><br><span class="line">|       6 |        66 |</span><br><span class="line">+---------+-----------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ç¡®å®å‡ºç°äº†ä¸¤æ¬¡çš„selectä¸åŒçš„æƒ…å†µã€‚<br>æ‰€ä»¥éœ€è¦å¼ºè°ƒä¸€ç‚¹çš„æ˜¯ï¼Œåœ¨<code>Repeatable Read</code>éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªæœ‰å½“å‰è¯»æ‰ä¼šå‡ºç°å¹»è¯»ï¼Œå› ä¸ºåœ¨è¯¥çº§åˆ«ä¸‹ï¼Œå¿«ç…§è¯»æ˜¯ä»<code>begin</code>å¼€å§‹çš„ç¬¬ä¸€ä¸ªæ™®é€š<code>select</code>å»ºç«‹çš„<code>Read View</code>ï¼Œä»¥åçš„æ™®é€š<code>select</code>éƒ½æ˜¯åŸºäºç¬¬ä¸€æ¬¡çš„<code>select</code>ï¼Œè‡ªç„¶è€Œç„¶ä¸ä¼šå‡ºç°å¹»è¯»äº† </p>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mysqlæ•°æ®åº“å‡ºç°æ­»é”çš„æƒ…å†µ(ä¸€)</title>
      <link href="/2019/08/04/Mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%BA%E7%8E%B0%E6%AD%BB%E9%94%81%E7%9A%84%E6%83%85%E5%86%B5-%E4%B8%80/"/>
      <url>/2019/08/04/Mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%BA%E7%8E%B0%E6%AD%BB%E9%94%81%E7%9A%84%E6%83%85%E5%86%B5-%E4%B8%80/</url>
      <content type="html"><![CDATA[<p>åœ¨ä¸´è¿‘ä¸Šçº¿ä¹‹å‰ï¼Œæˆ‘ä»¬ç³»ç»Ÿåšäº†ä¸€æ¬¡å‹åŠ›æµ‹è¯•ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ¥å£åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ä¼šå‡ºç°ä¸€ä¸ªæ­»é”çš„æƒ…å†µã€‚ã€‚é¦–å…ˆç”³æ˜â€¦ä¸æ˜¯æˆ‘å†™çš„ï¼Œæˆ‘åªæ˜¯å¸®å¿™æ’æŸ¥ä¸‹ã€‚</p><p>éšç€å¯¹Mysqlé”çš„æ·±å…¥äº†è§£ï¼Œäºæ˜¯å°±å‡†å¤‡å†™å‡ ç¯‡æ–‡ç« æ¥è®°å½•ä¸‹Mysqlå„ç§äº‹ç‰©å’Œç´¢å¼•çš„æƒ…å†µä¸‹å‡ºç°æ­»é”çš„æƒ…å†µã€‚</p><p>ä»Šå¤©å°±ä»‹ç»ä¸‹åœ¨å¹¶å‘æ’å…¥çš„æƒ…å†µä¸‹ï¼Œå“ªå‡ ç§æƒ…å†µä¼šå‡ºç°æ­»é”ï¼š</p><h2 id="INNODBä¸‹çš„å„ç§é”"><a href="#INNODBä¸‹çš„å„ç§é”" class="headerlink" title="INNODBä¸‹çš„å„ç§é”"></a>INNODBä¸‹çš„å„ç§é”</h2><p>åœ¨ä»‹ç»é”çš„æ—¶å€™åªä¼šä»‹ç»è·Ÿæœ¬èŠ‚ç›¸å…³çš„é”ï¼Œè€Œä¸”åªä¼šè®²è¿°å¤§æ¦‚æ˜¯ä»€ä¹ˆï¼Œè‡³äºé”çš„æ›´åŠ è¯¦ç»†çš„è®²è§£å¯èƒ½ä¼šåˆ°ä»¥åå†è¯¦ç»†ä»‹ç»ã€‚</p><h3 id="è¡Œé”"><a href="#è¡Œé”" class="headerlink" title="è¡Œé”"></a>è¡Œé”</h3><p>è¡Œé”åˆ†ä¸ºå†™é”å’Œè¯»å–é”ï¼Œ</p><blockquote><p>è¯»é”ï¼ˆSé”ï¼‰ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸º <code>å…±äº«é”</code> ï¼Œ å®ƒè¡¨ç¤ºçš„æ˜¯ä»»ä½•ä¸€ä¸ªäº‹ç‰©éƒ½å¯ä»¥è¯»å–è¯¥è¡Œæ•°æ®(å¯ä»¥è¢«å¤šä¸ªäº‹ç‰©è·å–åˆ°)ã€‚</p></blockquote><blockquote><p>å†™é”ï¼ˆXé”ï¼‰ä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºæ’å®ƒé”ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯è¯¥è¡Œæ•°æ®ä¸å…è®¸ä»»ä½•äººè¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¹Ÿä¸å…è®¸ä»»ä½•äº‹ç‰©è·å–è¯¥è¡Œäº‹ç‰©çš„Sé”ï¼Œä½†æ˜¯æ™®é€šçš„ <code>select</code> è¯­å¥æ˜¯å¯ä»¥çš„ã€‚</p></blockquote><h2 id="èƒŒæ™¯ä¿¡æ¯ä¸€"><a href="#èƒŒæ™¯ä¿¡æ¯ä¸€" class="headerlink" title="èƒŒæ™¯ä¿¡æ¯ä¸€"></a>èƒŒæ™¯ä¿¡æ¯ä¸€</h2><h3 id="æ³¨æ„ï¼šä»¥ä¸‹æµ‹è¯•éƒ½æ˜¯åŸºäºè¯¥äº‹ç‰©éš”ç¦»çº§åˆ«å’Œæ•°æ®åº“ç‰ˆæœ¬"><a href="#æ³¨æ„ï¼šä»¥ä¸‹æµ‹è¯•éƒ½æ˜¯åŸºäºè¯¥äº‹ç‰©éš”ç¦»çº§åˆ«å’Œæ•°æ®åº“ç‰ˆæœ¬" class="headerlink" title="æ³¨æ„ï¼šä»¥ä¸‹æµ‹è¯•éƒ½æ˜¯åŸºäºè¯¥äº‹ç‰©éš”ç¦»çº§åˆ«å’Œæ•°æ®åº“ç‰ˆæœ¬"></a>æ³¨æ„ï¼šä»¥ä¸‹æµ‹è¯•éƒ½æ˜¯åŸºäºè¯¥äº‹ç‰©éš”ç¦»çº§åˆ«å’Œæ•°æ®åº“ç‰ˆæœ¬</h3><p>æ•°æ®åº“ç‰ˆæœ¬ï¼š8.0.11</p><p>äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼šREPEATABLE-READ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE 'transaction_isolation';</span><br><span class="line">+<span class="comment">-----------------------+-----------------+</span></span><br><span class="line">| Variable_name         | Value           |</span><br><span class="line">+<span class="comment">-----------------------+-----------------+</span></span><br><span class="line">| transaction_isolation | REPEATABLE-READ |</span><br><span class="line">+<span class="comment">-----------------------+-----------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><h2 id="SQLå‡†å¤‡"><a href="#SQLå‡†å¤‡" class="headerlink" title="SQLå‡†å¤‡:"></a>SQLå‡†å¤‡:</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> test_lock  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_0900_ai_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_lock.<span class="string">`test`</span> (</span><br><span class="line">    <span class="string">`user_id`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`user_name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`user_password`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`is_deleted`</span> <span class="built_in">int</span>(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`user_id`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`t1_god`</span> (<span class="string">`user_name`</span>,<span class="string">`user_password`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 <span class="keyword">COLLATE</span>=utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure><p>å‡†å¤‡æ•°æ®ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'a'</span>,<span class="string">'zhangsan'</span>,<span class="string">'123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'b'</span>,<span class="string">'lisi'</span>,<span class="string">'lisi123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'c'</span>,<span class="string">'wangwu'</span>,<span class="string">'wangwu123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'d'</span>,<span class="string">'caocao'</span>,<span class="string">'caocao123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'e'</span>,<span class="string">'liubei'</span>,<span class="string">'liubei123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'f'</span>,<span class="string">'zhangfei'</span>,<span class="string">'zhangfei123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'g'</span>,<span class="string">'guanyu'</span>,<span class="string">'guanyu123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'h'</span>,<span class="string">'xiaoqiao'</span>,<span class="string">'xiaoqiao123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br></pre></td></tr></table></figure><h3 id="æƒ…å†µä¸€ï¼š"><a href="#æƒ…å†µä¸€ï¼š" class="headerlink" title="æƒ…å†µä¸€ï¼š"></a>æƒ…å†µä¸€ï¼š</h3><blockquote><p> ä¸‰ä¸ªäº‹ç‰©éƒ½æ‰§è¡ŒåŒä¸€ä¸ªInsertè¯­å¥ï¼Œç¬¬ä¸€ä¸ªäº‹ç‰©ç„¶åå›æ»š</p></blockquote><p>æ­¤æ—¶ç¬¬ä¸‰ä¸ªäº‹ç‰©ä¼šæç¤ºæ­»é”ï¼Œç¬¬äºŒä¸ªäº‹ç‰©æ­£å¸¸æ’å…¥ã€‚</p><h4 id="å¤ç°æ­¥éª¤ï¼š"><a href="#å¤ç°æ­¥éª¤ï¼š" class="headerlink" title="å¤ç°æ­¥éª¤ï¼š"></a>å¤ç°æ­¥éª¤ï¼š</h4><p>å¼€å¯ä¸‰ä¸ªäº‹ç‰©ï¼Œæ¯ä¸€ä¸ªäº‹ç‰©åˆ†åˆ«æ‰§è¡Œå¦‚ä¸‹SQLï¼Œç„¶åå†å°†ç¬¬ä¸€ä¸ªäº‹ç‰©è¿›è¡Œå›æ»šæˆ–è€…æäº¤ï¼Œç„¶åä½ å°±ä¼šå‘ç°ç¬¬ä¸‰ä¸ªäº‹ç‰©å‘ç”Ÿäº†æ­»é”ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## DeadLock</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span> ;</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'i'</span>,<span class="string">'daqiao'</span>,<span class="string">'daqiao123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br></pre></td></tr></table></figure><p>Mysqlæç¤ºå¦‚ä¸‹ï¼š</p><blockquote><p>[2019-08-04 14:33:48] Connected<br>sql&gt; start transaction<br>[2019-08-04 14:33:49] completed in 4 ms<br>sql&gt; begin<br>[2019-08-04 14:33:49] completed in 6 ms<br>sql&gt; insert into test_lock.<code>test</code> values(â€˜iâ€™,â€™daqiaoâ€™,â€™daqiao123456â€™,0,â€™15112345678â€™)<br>[2019-08-04 14:34:00] [40001][1213] Deadlock found when trying to get lock; try restarting transaction<br>[2019-08-04 14:34:00] [40001][1213] Deadlock found when trying to get lock; try restarting transaction</p></blockquote><p>é‚£ä¹ˆæ‰“å°å‡ºMysqlå‡ºç°æ­»é”çš„æ—¥å¿—ï¼šé‡ç‚¹æ—¥å¿—å¦‚ä¸‹</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">LATEST DETECTED DEADLOCK</span><br><span class="line">------------------------</span><br><span class="line"><span class="number">2019</span>-<span class="number">08</span>-<span class="number">04</span> <span class="number">06</span>:<span class="number">33</span>:<span class="number">59</span> <span class="number">0</span>x7f1818599700</span><br><span class="line">*** (<span class="number">1</span>) TRANSACTION:</span><br><span class="line">TRANSACTION <span class="number">231690</span>, ACTIVE <span class="number">34</span> sec inserting</span><br><span class="line">mysql tables in <span class="keyword">use</span> <span class="number">1</span>, locked <span class="number">1</span></span><br><span class="line">LOCK WAIT <span class="number">4</span> lock <span class="keyword">struct</span>(s), heap size <span class="number">1136</span>, <span class="number">2</span> row lock(s)</span><br><span class="line">MySQL thread id <span class="number">9</span>, OS thread handle <span class="number">139741464762112</span>, query id <span class="number">95</span> <span class="number">172</span><span class="variable">.17</span><span class="variable">.0</span><span class="variable">.1</span> root update</span><br><span class="line"><span class="comment">/* ApplicationName=IntelliJ IDEA 2019.1.3 */</span> insert into test_lock.<span class="meta">`test` values('i','daqiao','daqiao123456',0,'15112345678')</span></span><br><span class="line">*** (<span class="number">1</span>) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id <span class="number">7</span> page no <span class="number">4</span> n bits <span class="number">80</span> index PRIMARY of <span class="keyword">table</span> <span class="meta">`test_lock`.`test` trx id 231690 lock_mode X insert intention waiting</span></span><br><span class="line">Record lock, heap no <span class="number">1</span> PHYSICAL RECORD: n_fields <span class="number">1</span>; compact format; info bits <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>: len <span class="number">8</span>; hex <span class="number">73757072656</span>d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">*** (<span class="number">2</span>) TRANSACTION:</span><br><span class="line">TRANSACTION <span class="number">231691</span>, ACTIVE <span class="number">10</span> sec inserting</span><br><span class="line">mysql tables in <span class="keyword">use</span> <span class="number">1</span>, locked <span class="number">1</span></span><br><span class="line"><span class="number">4</span> lock <span class="keyword">struct</span>(s), heap size <span class="number">1136</span>, <span class="number">2</span> row lock(s)</span><br><span class="line">MySQL thread id <span class="number">10</span>, OS thread handle <span class="number">139741464467200</span>, query id <span class="number">139</span> <span class="number">172</span><span class="variable">.17</span><span class="variable">.0</span><span class="variable">.1</span> root update</span><br><span class="line"><span class="comment">/* ApplicationName=IntelliJ IDEA 2019.1.3 */</span> insert into test_lock.<span class="meta">`test` values('i','daqiao','daqiao123456',0,'15112345678')</span></span><br><span class="line">*** (<span class="number">2</span>) HOLDS THE LOCK(S):</span><br><span class="line">RECORD LOCKS space id <span class="number">7</span> page no <span class="number">4</span> n bits <span class="number">80</span> index PRIMARY of <span class="keyword">table</span> <span class="meta">`test_lock`.`test` trx id 231691 lock mode S</span></span><br><span class="line">Record lock, heap no <span class="number">1</span> PHYSICAL RECORD: n_fields <span class="number">1</span>; compact format; info bits <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>: len <span class="number">8</span>; hex <span class="number">73757072656</span>d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">*** (<span class="number">2</span>) WAITING FOR THIS LOCK TO BE GRANTED:</span><br><span class="line">RECORD LOCKS space id <span class="number">7</span> page no <span class="number">4</span> n bits <span class="number">80</span> index PRIMARY of <span class="keyword">table</span> <span class="meta">`test_lock`.`test` trx id 231691 lock_mode X insert intention waiting</span></span><br><span class="line">Record lock, heap no <span class="number">1</span> PHYSICAL RECORD: n_fields <span class="number">1</span>; compact format; info bits <span class="number">0</span></span><br><span class="line"> <span class="number">0</span>: len <span class="number">8</span>; hex <span class="number">73757072656</span>d756d; asc supremum;;</span><br><span class="line"></span><br><span class="line">*** WE ROLL BACK TRANSACTION (<span class="number">2</span>)</span><br><span class="line">------------</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸Šæ—¥å¿—æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œäº‹ç‰©ä¸€æ­£åœ¨è¯·æ±‚è¯¥è¡Œè®°å½•çš„ <code>Xé”</code> ï¼Œäº‹ç‰©äºŒæŒæœ‰è¯¥è¡Œçš„<code>Sé”</code>ï¼Œä½†æ˜¯ä¹Ÿåœ¨ç­‰å¾…è·å–è¯¥è¡Œçš„<code>Xé”</code>ã€‚</p><p>å…³äºMysqlçš„ <code>insert</code> é€»è¾‘ï¼Œå¯ä»¥å¤§è‡´ç†è§£ä¸ºå¦‚æœä¸€ä¸ªäº‹ç‰©æ­£åœ¨å¯¹ä¸€ä¸ªè®°å½•è¿›è¡Œ <code>insert</code>ï¼Œæ­¤æ—¶ InnoDB å¹¶ä¸ä¼šä¸»åŠ¨çš„å°†å…¶åŠ ä¸€ä¸ªé”ï¼Œè€Œæ˜¯åœ¨ä¸»é”®ç´¢å¼•ä¸ŠåŠ ä¸€ä¸ª <code>trx_id</code>ï¼Œ</p><p>å½“ç¬¬äºŒä¸ªäº‹ç‰©æ£€æµ‹åˆ°è¯¥è¡Œè®°å½•æ­£åœ¨è¢«ä¸€ä¸ªæ´»è·ƒçš„äº‹ç‰©æŒæœ‰çš„æ—¶å€™ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªäº‹ç‰©ä¼šå¸®ç¬¬ä¸€ä¸ªäº‹ç‰©çš„éšå¼é”ä½è½¬ä¸ºæ˜¾å¼é”ã€‚å¦‚ä¸‹ä¾‹å­ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## DeadLock</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span> ;</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'i'</span>,<span class="string">'daqiao'</span>,<span class="string">'daqiao123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æŸ¥çœ‹Mysqlä¸­é”çš„æƒ…å†µï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/insert%E6%AD%BB%E9%94%81%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%BA%8B%E7%89%A9.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶Mysqlä»…ä»…æ˜¯åœ¨è¡¨ä¸ŠåŠ å…¥äº†ä¸€ä¸ªæ’å…¥æ„å‘é”ï¼ˆIXé”ï¼‰ï¼ŒæŒæœ‰è¯¥é”è¡¨ç¤ºè¯¥äº‹ç‰©åœ¨æ¥ä¸‹æ¥æœ‰å¯èƒ½ä¼šå¯¹è‡ªå·±è®¾è®¡åˆ°çš„è¡ŒåŠ å…¥æ’å®ƒé”ï¼ˆXé”ï¼‰</p><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html" target="_blank" rel="noopener">Mysqlå…³äºæ„å‘é”çš„ä»‹ç»</a></p><blockquote><p>The intention locking protocol is as follows:</p><ul><li>Before a transaction can acquire a shared lock on a row in a table, it must first acquire an <code>IS</code> lock or stronger on the table.</li><li>Before a transaction can acquire an exclusive lock on a row in a table, it must first acquire an <code>IX</code> lock on the table.</li></ul></blockquote><p>å¤§æ„å°±æ˜¯å¦‚æœä½ æƒ³è·å¾—ä¸€ä¸ªè¡Œçš„ <code>Xé”</code>ï¼Œé‚£ä¹ˆä½ å°±å¿…é¡»å…ˆè·å–è¡¨çš„ <code>IXé”</code></p><p>é‚£ä¹ˆæ­¤æ—¶å†è¿›è¡Œç¬¬äºŒä¸ªäº‹ç‰©çš„æ’å…¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## DeadLock</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span> ;</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> test_lock.<span class="string">`test`</span> <span class="keyword">values</span>(<span class="string">'i'</span>,<span class="string">'daqiao'</span>,<span class="string">'daqiao123456'</span>,<span class="number">0</span>,<span class="string">'15112345678'</span>);</span><br></pre></td></tr></table></figure><p>å†æ¬¡æŸ¥çœ‹æ•°æ®åº“ä¸­çš„é”ï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Mysql%E7%AC%AC%E4%BA%8C%E4%B8%AA%E4%BA%8B%E7%89%A9.png" alt=""></p><p>æ­¤æ—¶ä¼šå‘ç°ç¬¬ä¸€ä¸ªäº‹ç‰©å·²ç»è·å–åˆ°äº†è¡Œçº§åˆ«çš„<code>Xé”</code>ï¼Œç¬¬äºŒä¸ªäº‹ç‰©è·å–åˆ°äº† <code>IX</code> é”ä»¥åŠ <code>Sé”</code> ã€‚</p><p>é‚£ä¹ˆæ­¤æ—¶ç¬¬ä¸‰ä¸ªäº‹ç‰©å¼€å¯ä¹‹åæ•°æ®åº“ä¸­çš„é”åˆä¼šæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢ï¼Ÿ</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Mysql%E7%AC%AC%E4%B8%89%E4%B8%AA%E4%BA%8B%E7%89%A9.png" alt=""></p><p>å¯ä»¥å‘ç°å¦å¤–ä¸¤ä¸ªäº‹ç‰©éƒ½åœ¨ç­‰å¾…è·å–è¯¥è¡Œçš„<code>Sé”</code>ã€‚ç„¶åæ­¤æ—¶ç¬¬ä¸€ä¸ªäº‹ç‰©è¿›è¡Œå›æ»šï¼Œæ­¤æ—¶ç¬¬ä¸‰ä¸ªäº‹ç‰©å°±ä¼šæç¤ºæ­»é”ã€‚</p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><h4 id="å‰æç»“è®º"><a href="#å‰æç»“è®º" class="headerlink" title="å‰æç»“è®º"></a>å‰æç»“è®º</h4><ol><li><code>Sé”</code>æ˜¯å¯ä»¥å‡çº§åˆ°<code>Xé”</code>çš„</li><li>ä¸€ä¸ª<code>Sé”</code>éœ€è¦å‡çº§åˆ°<code>X</code>é”å¿…é¡»ä¿è¯åªæœ‰å½“å‰äº‹ç‰©æŒæœ‰<code>Sé”</code></li></ol><h4 id="æ­»é”åŸå› "><a href="#æ­»é”åŸå› " class="headerlink" title="æ­»é”åŸå› "></a>æ­»é”åŸå› </h4><p>å½“ç¬¬ä¸€ä¸ªäº‹ç‰©å›æ»šä¹‹åï¼Œç¬¬äºŒä¸ªäº‹ç‰©å’Œç¬¬ä¸‰ä¸ªäº‹ç‰©éƒ½ä¼šè·å¾—åˆ°è¯¥è¡Œçš„<code>Sé”</code>ï¼Œä½†æ˜¯æ­¤æ—¶ç¬¬äºŒä¸ªäº‹ç‰©å°†è¦æ‰§è¡Œ insert è¯­å¥ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªäº‹ç‰©æ­£åœ¨ç­‰å¾…è·å–è¯¥è¡Œçš„<code>Xé”</code>ï¼Œä½†æ˜¯æ­¤æ—¶ç¬¬ä¸‰ä¸ªäº‹ç‰©ä¹Ÿæ­£åœ¨å‡†å¤‡ insertï¼Œå®ƒä¹Ÿåœ¨å‡†å¤‡è·å– <code>Xé”</code>ï¼Œç›®å‰è¿™ä¸¤ä¸ªäº‹ç‰©éƒ½æŒæœ‰è¯¥è¡Œçš„ <code>Sé”</code> ï¼Œè€Œå¦‚æœéœ€è¦è·å– <code>Xé”</code>ï¼Œåˆ™æ˜¯éœ€è¦å¯¹æ–¹é‡Šæ”¾<code>S</code>é”ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/TwoTrxLock.png" alt=""></p><h3 id="ç®€å•å¤ç°æ­¥éª¤ï¼š"><a href="#ç®€å•å¤ç°æ­¥éª¤ï¼š" class="headerlink" title="ç®€å•å¤ç°æ­¥éª¤ï¼š"></a>ç®€å•å¤ç°æ­¥éª¤ï¼š</h3><p>ä¸ºäº†éªŒè¯ä¸Šé¢çš„æƒ…å†µï¼Œæˆ‘å‡†å¤‡å¦‚ä¸‹å‡ ä¸ªSQLï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">## äº‹ç‰©ä¸€</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span> ;</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test_lock.test <span class="keyword">where</span> user_id=<span class="string">'h'</span>  <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## äº‹ç‰©äºŒ</span><br><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span> ;</span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> test_lock.test <span class="keyword">where</span> user_id=<span class="string">'h'</span>  <span class="keyword">lock</span> <span class="keyword">in</span> <span class="keyword">share</span> <span class="keyword">mode</span>;</span><br><span class="line"></span><br><span class="line">## äº‹ç‰©ä¸€å†æ‰§è¡Œ</span><br><span class="line"><span class="keyword">update</span> test_lock.<span class="string">`test`</span> <span class="keyword">set</span> user_name=<span class="string">'abc'</span>  <span class="keyword">where</span>  user_id = <span class="string">'h'</span>;</span><br><span class="line"></span><br><span class="line">## äº‹ç‰©äºŒå†æ‰§è¡Œ</span><br><span class="line"><span class="keyword">update</span> test_lock.<span class="string">`test`</span> <span class="keyword">set</span> user_name=<span class="string">'abc'</span>  <span class="keyword">where</span>  user_id = <span class="string">'h'</span>;</span><br><span class="line"></span><br><span class="line">## æ­¤æ—¶äº‹ç‰©äºŒå°±ä¼šæç¤ºæ­»é”</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å› ä¸ºäº‹ç‰©ä¸€å’Œäº‹ç‰©äºŒéƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾<code>Sé”</code>ï¼Œä½†æ˜¯éƒ½ä¸è‚¯é‡Šæ”¾ï¼Œäºæ˜¯æ­»é”å‘ç”Ÿäº†ã€‚</p><h3 id="æƒ…å†µäºŒ"><a href="#æƒ…å†µäºŒ" class="headerlink" title="æƒ…å†µäºŒ"></a>æƒ…å†µäºŒ</h3><blockquote><p> ä¸‰ä¸ªäº‹ç‰©éƒ½æ‰§è¡ŒåŒä¸€ä¸ªInsertè¯­å¥ï¼Œç¬¬ä¸€ä¸ªäº‹ç‰©ç„¶åæäº¤</p></blockquote><p>æ­¤æ—¶ç¬¬äºŒä¸ªäº‹ç‰©å’Œç¬¬ä¸‰ä¸ªäº‹ç‰©éƒ½ä¼šæç¤ºä¸»é”®å†²çªï¼Œå¹¶æ— æ­»é”å‡ºç°ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ç§æƒ…å†µä¸‹çš„æ­»é”æ˜¯ç”±äº <code>Sé”</code> å‡çº§åˆ° <code>Xé”</code>å¯¼è‡´çš„ä¸€ç§æ­»é”ï¼Œåœ¨å¹³å¸¸çš„ä¸šåŠ¡ä»£ç ä¸­åº”è¯¥å°½é‡é¿å…å¹¶å‘æ’å…¥ä¸€ä¸ªä¸»é”®ã€‚</p>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Vueé‡Œé¢ç›¸åŒé¡µé¢ä¸åŒURLçš„åˆ·æ–°è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2019/07/24/Vue%E9%87%8C%E9%9D%A2%E7%9B%B8%E5%90%8C%E9%A1%B5%E9%9D%A2%E4%B8%8D%E5%90%8CURL%E7%9A%84%E5%88%B7%E6%96%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/2019/07/24/Vue%E9%87%8C%E9%9D%A2%E7%9B%B8%E5%90%8C%E9%A1%B5%E9%9D%A2%E4%B8%8D%E5%90%8CURL%E7%9A%84%E5%88%B7%E6%96%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[<p>éšç€é¡¹ç›®çš„æ”¶å°¾ï¼Œä½¿ç”¨<code>Vue</code>ä¹Ÿæœ‰å¤§æ¦‚ä¸¤ä¸ªæœˆæ—¶é—´äº†ï¼Œåœ¨è¿™æœŸé—´ä¹Ÿæ‰é‡åˆ°è¿‡äº†ä¸å°‘çš„é—®é¢˜ï¼Œä»Šå¤©å°±æ¥è¯´ä¸‹ <code>Vue</code> ä¸­URLä¸åŒä½†æ˜¯é¡µé¢ç›¸åŒçš„è§£å†³åŠæ³•ã€‚</p><h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><p>å‡è®¾æœ‰ä¸¤ä¸ªURLï¼Œéƒ½å¯¹åº”çš„æ˜¯ä¸€ä¸ªç›¸åŒçš„ Vue é¡µé¢ï¼ŒURLåˆ†åˆ«æ˜¯ <code>view/account/1</code> å’Œ <code>edit/account/1</code>ï¼Œæ­¤æ—¶å¦‚æœç”± <code>view/account/1</code> è·³è½¬è‡³ <code>edit/account/1</code>ï¼Œä½ ä¼šå‘ç°é¡µé¢æ˜¯ä¸ä¼šåˆ·æ–°çš„ï¼Œ ä»è€Œç›´æ¥å½±å“äº†æ•´ä½“çš„åŠŸèƒ½ã€‚</p><p>äºæ˜¯å»ç½‘ä¸Šå¯»æ‰¾è§£å†³æ–¹æ¡ˆï¼Œåœ¨ä¸€ä¸ª github çš„ issue é‡Œé¢ï¼Œçœ‹åˆ°ä¹Ÿæœ‰äººåæ˜ è¿‡è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿‡ä½œè€…çš„å›å¤æ˜¯é‡‡ç”¨</p><p><code>reload</code> æ–¹å¼è¿›è¡Œå¼ºåˆ¶åˆ·æ–°ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äº F5 é‚£æ ·ï¼Œé¡µé¢é¦–å…ˆä¼šç™½ä¸€ä¸‹ï¼Œç„¶åå°±å†å‡ºç°å…ƒç´ ã€‚è¿™æ ·è™½ç„¶å¯ä»¥å®ç°é¡µé¢ä¸Šå…ƒç´ çš„ä¸€äº›åŠ è½½ï¼Œä½†æ˜¯åŒæ—¶å®ƒçš„å¼Šç«¯ä¹Ÿä½“ç°å‡ºæ¥äº†ï¼Œå°±æ˜¯å¯¹ç”¨æˆ·æåº¦çš„ä¸å‹å¥½ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬æ‰ç”¨äº†ä¸€ç§Reloadçš„æ–¹å¼æ¥è¿›è¡Œåˆ·æ–°çš„ã€‚</p><p>é¦–å…ˆæ˜¯åœ¨<code>App.vue</code>é‡Œé¢æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">    &lt;router-view v-<span class="keyword">if</span>=<span class="string">'isAlive'</span>/&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  name: <span class="string">'App'</span>,</span><br><span class="line">  provide () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      reload: <span class="keyword">this</span>.reload</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      isAlive: <span class="literal">true</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    reload () &#123;</span><br><span class="line">      <span class="keyword">this</span>.isAlive = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isAlive = <span class="literal">true</span>;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;style&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>style&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå†éœ€è¦åˆ·æ–°çš„ Vue é¡µé¢ç›´æ¥é€šè¿‡ <code>inject</code> æ¥è¿›è¡Œä½¿ç”¨å³å¯ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> &lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;el-form :model=<span class="string">"account"</span>&gt;</span><br><span class="line">        &lt;el-form-item label=<span class="string">"å§“å"</span> prop=<span class="string">"name"</span> &gt;</span><br><span class="line">          &lt;el-input v-model=<span class="string">"account.name"</span> placeholder=<span class="string">"è¯·è¾“å…¥"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span></span><br><span class="line">          &lt;el-form-item label="å¹´é¾„" prop="age" &gt;</span><br><span class="line">          &lt;el-input v-model="account.age" placeholder="è¯·è¾“å…¥"&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">          &lt;el-form-item label="æ€§åˆ«" prop="gender" &gt;</span><br><span class="line">          &lt;el-input v-model="account.gender" placeholder="è¯·è¾“å…¥"&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  inject: ['reload'],</span><br><span class="line">  data () &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      account: &#123;</span><br><span class="line">        name: null,</span><br><span class="line">        age: null,</span><br><span class="line">        gender: null</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    '$route' (to, from) &#123;</span><br><span class="line">      this.reload();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>æœ€åä¾¿å¯ä»¥å®ç°é¡µé¢çŠ¶æ€çš„é‡æ–°åŠ è½½ã€‚</p>]]></content>
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸ºä»€ä¹ˆSpringå®˜æ–¹æ¨èé€šè¿‡æ„é€ å™¨æ³¨å…¥</title>
      <link href="/2019/07/22/%E4%B8%BA%E4%BB%80%E4%B9%88Spring%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90%E9%80%9A%E8%BF%87%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5/"/>
      <url>/2019/07/22/%E4%B8%BA%E4%BB%80%E4%B9%88Spring%E5%AE%98%E6%96%B9%E6%8E%A8%E8%8D%90%E9%80%9A%E8%BF%87%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E5%85%A5/</url>
      <content type="html"><![CDATA[<h2 id="ä¸€"><a href="#ä¸€" class="headerlink" title="ä¸€"></a>ä¸€</h2><p>æˆ‘ä»¬åœ¨ä½¿ç”¨Springçš„æ—¶å€™ï¼Œæœ€æ–¹ä¾¿çš„å°±æ˜¯å®ƒçš„IOCï¼ˆæ§åˆ¶åè½¬ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„Beanéƒ½äº¤ç”±</p><p>Springè¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨çœ‹ç½‘ä¸Šçš„æ–‡ç« æˆ–è€…è‡ªå·±åœ¨å†™ä»£ç çš„æ—¶å€™ç»å¸¸ä¼šåƒè¿™æ ·å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   TestDao TestDao;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> TestDao TestDao;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TestService</span><span class="params">(TestDao TestDao)</span></span>&#123;</span><br><span class="line">     <span class="keyword">this</span>.TestDao = TestDao;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getInfo</span><span class="params">()</span></span>&#123;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è²Œä¼¼è®¸å¤šäººéƒ½ä¼šä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºè¿™æ ·ç®€å•æ–¹ä¾¿ï¼Œå¦‚æœæ˜¯é‡‡ç”¨ç¬¬äºŒç§çš„è¯ï¼Œæ¯ä¸€æ¬¡æ–°å¢åŠ ä¸€ä¸ªbeanï¼Œéƒ½éœ€è¦åœ¨æ„é€ å™¨çš„å…¥å‚ä¸Šé¢åŠ ä¸€ä¸ªå‚æ•°ï¼Œå°±ä¼šæ˜¾å¾—æœ‰ç‚¹éº»çƒ¦ã€‚</p><p>ä½†æ˜¯å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªå†™æ³•ï¼Œå°±ä¼šåœ¨IDEAé‡Œé¢å‡ºç°ä¸€ä¸ªæç¤ºï¼š</p><blockquote><p> springå®˜æ–¹å»ºè®®é€šè¿‡æ„é€ å™¨çš„æ–¹å¼è¿›è¡Œæ³¨å…¥</p></blockquote><p>è¿™åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p><a href="https://spring.io/blog/2007/07/11/setter-injection-versus-constructor-injection-and-the-use-of-required/" target="_blank" rel="noopener">Springå®˜æ–¹å¯¹äºSetteræ³¨å…¥å’Œæ„é€ å™¨æ³¨å…¥çš„çœ‹æ³•</a></p><h2 id="äºŒ"><a href="#äºŒ" class="headerlink" title="äºŒ"></a>äºŒ</h2><p>åœ¨springbooté‡Œé¢ï¼Œæœ€å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯æ„é€ å™¨æ³¨å…¥ï¼Œä¸€ç§æ˜¯fieldæ³¨å…¥</p><p>åœ¨ä¸Šä¸€éƒ¨åˆ†çš„ä»£ç é‡Œé¢ï¼Œç¬¬ä¸€ä¸ªæ˜¯ Field æ³¨å…¥ï¼Œç¬¬äºŒä¸ªæ˜¯æ„é€ å™¨æ³¨å…¥ï¼Œæ—¢ç„¶è¿™ä¸¤ç§æ–¹å¼Springéƒ½æ”¯æŒï¼Œé‚£ä¹ˆåˆ°åº•è¿™ä¸¤ç§æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><h3 id="Fieldæ³¨å…¥"><a href="#Fieldæ³¨å…¥" class="headerlink" title="Fieldæ³¨å…¥"></a>Fieldæ³¨å…¥</h3><p>è¿™è¾¹æ–°å»ºä¸¤ä¸ªæµ‹è¯•ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"A"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    A a;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">B</span><span class="params">()</span></span>&#123;</span><br><span class="line">        a.sayA();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä½ å¯åŠ¨Springçš„è¯ï¼Œå°±ä¼šå‡ºç°ä¸€ä¸ªç©ºæŒ‡é’ˆçš„å¼‚å¸¸ï¼Œå¦‚æœéœ€è¦é¿å…çš„è¯ï¼Œåˆ™å¿…é¡»æ˜¯ç±» <code>A</code> å…ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶åå†åˆå§‹åŒ– <code>B</code> ã€‚ï¼ˆå½“ç„¶Springå®˜æ–¹ä¹Ÿæä¾›äº†å¾ˆå¤šæ–¹å¼æ¥æ§åˆ¶ Bean çš„åˆå§‹åŒ–é¡ºåºï¼Œä½†æ˜¯å’Œæœ¬ç¯‡æ–‡ç« æ— å…³ï¼‰</p><h3 id="æ„é€ å™¨æ³¨å…¥"><a href="#æ„é€ å™¨æ³¨å…¥" class="headerlink" title="æ„é€ å™¨æ³¨å…¥"></a>æ„é€ å™¨æ³¨å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> A a;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">B</span><span class="params">(A a)</span></span>&#123;</span><br><span class="line">        a.sayA();</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶Springçš„é¡¹ç›®å°±ä¼šæ­£å¸¸çš„å¯åŠ¨ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆåŒæ ·çš„ä»£ç ï¼Œä¸€ä¸ªé€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼Œä¸€ä¸ªé€šè¿‡Fieldæ³¨å…¥ï¼Œä¸¤è€…çš„ç»“æœç›¸å·®è¿™ä¹ˆå¤§å‘¢ï¼Ÿ</p><h2 id="ä¸‰"><a href="#ä¸‰" class="headerlink" title="ä¸‰"></a>ä¸‰</h2><p>å®˜æ–¹ä¹‹æ‰€ä»¥ç°åœ¨æ¨èä½¿ç”¨æ„é€ å™¨æ³¨å…¥ï¼Œæ˜¯å› ä¸ºé€šè¿‡æ„é€ å™¨æ³¨å…¥æ˜¯å¯ä»¥é˜²æ­¢ <code>ç©ºæŒ‡é’ˆå¼‚å¸¸</code>ï¼ŒåŒæ—¶å¯ä»¥ç¡®ä¿çš„æ˜¯è¢«å¼•ç”¨çš„ <code>Bean</code> ï¼Œå®ƒçš„å¼•ç”¨æ˜¯ä¸å¯ä»¥å˜çš„ï¼Œæ‰€ä»¥è¿™å¯èƒ½æ˜¯Springå®˜æ–¹å›¢é˜Ÿçš„ä¸€äº›æƒè¡¡ç‚¹å§<br>å½“ç„¶æ—©æœŸçš„æ—¶å€™ï¼ŒSpringæ›¾æ¨èè¿‡ä½¿ç”¨Setteræ³¨å…¥ï¼Œä¸å¤Ÿç°åœ¨å¯èƒ½Springå¯èƒ½è§‰å¾—æ„é€ å™¨æ³¨å…¥æ¯”è¾ƒå¥½ã€‚</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>2019å¹´07æœˆç¬¬ä¸€å‘¨æ€»ç»“</title>
      <link href="/2019/07/07/2019%E5%B9%B407%E6%9C%88%E7%AC%AC%E4%B8%80%E5%91%A8%E6%80%BB%E7%BB%93/"/>
      <url>/2019/07/07/2019%E5%B9%B407%E6%9C%88%E7%AC%AC%E4%B8%80%E5%91%A8%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>è¿™ä¸€å‘¨ä¸»è¦å­¦ä¹ å¦‚ä¸‹ï¼š</p><h2 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h2><p>åœ¨ä½¿ç”¨ElementUIçš„æ—¶å€™æœ‰ä¸€ä¸ª<code>el-select</code>æ ‡ç­¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚å°±æ˜¯éœ€è¦åœ¨ä¸‹æ‹‰åˆ—è¡¨çš„æ—¶å€™è¿˜éœ€è¦è¿‡æ»¤å‡ºç‰¹å®šçš„é€‰é¡¹ï¼Œä½†æ˜¯<code>ElementUI</code>å®˜æ–¹é»˜è®¤çš„è¿‡æ»¤å´åªèƒ½æ”¯æŒ label çš„ç­›é€‰ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±éœ€è¦é‡æ–°<code>filter-method</code>æ–¹æ³•æ¥è¿‡æ»¤å‡ºæ‰€éœ€è¦çš„é€‰é¡¹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">v-model</span>=<span class="string">"selectData"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">"selectData.value"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·é€‰æ‹©"</span> <span class="attr">filterable</span> <span class="attr">:filter-method</span>=<span class="string">"search"</span> <span class="attr">prop</span>=<span class="string">"value"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-option</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-for</span>=<span class="string">"item in options"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:key</span>=<span class="string">"item.value"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:label</span>=<span class="string">"item.label"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:value</span>=<span class="string">"item.value"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"float: left"</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"float: right; font-size: 15px"</span>&gt;</span>&#123;&#123; item.value &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-option</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-select</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">export default &#123;</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="undefined">    return &#123;</span></span><br><span class="line"><span class="undefined">      options: [&#123;</span></span><br><span class="line"><span class="undefined">        value: 'é€‰é¡¹1',</span></span><br><span class="line"><span class="undefined">        label: 'é»„é‡‘ç³•'</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="undefined">        value: 'é€‰é¡¹2',</span></span><br><span class="line"><span class="undefined">        label: 'åŒçš®å¥¶'</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="undefined">        value: 'é€‰é¡¹3',</span></span><br><span class="line"><span class="undefined">        label: 'èšµä»”ç…'</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="undefined">        value: 'é€‰é¡¹4',</span></span><br><span class="line"><span class="undefined">        label: 'é¾™é¡»é¢'</span></span><br><span class="line"><span class="undefined">      &#125;, &#123;</span></span><br><span class="line"><span class="undefined">        value: 'é€‰é¡¹5',</span></span><br><span class="line"><span class="undefined">        label: 'åŒ—äº¬çƒ¤é¸­'</span></span><br><span class="line"><span class="undefined">      &#125;],</span></span><br><span class="line"><span class="undefined">      selectData: &#123;</span></span><br><span class="line"><span class="undefined">        value: ''</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    search (val) &#123;</span></span><br><span class="line"><span class="undefined">      let copyObj2 = JSON.parse(JSON.stringify(this.options));</span></span><br><span class="line"><span class="undefined">      if (val != null &amp;&amp; val !== '') &#123;</span></span><br><span class="line"><span class="undefined">        this.options = copyObj2.filter((item) =&gt; &#123;</span></span><br><span class="line"><span class="undefined">          if (item.value.indexOf(val) &gt; -1) &#123;</span></span><br><span class="line"><span class="undefined">            debugger;</span></span><br><span class="line"><span class="undefined">            return true;</span></span><br><span class="line"><span class="undefined">          &#125; else &#123;</span></span><br><span class="line"><span class="undefined">            return false;</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">      &#125; else &#123;</span></span><br><span class="line"><span class="undefined">        this.options = copyObj2;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åæ¥åˆè¯´è¦æŠŠé€‰æ‹©çš„å€¼ç»™å¦ä¸€ä¸ªå­—æ®µâ€¦äºæ˜¯æˆ‘å°±åœ¨searchæ–¹æ³•ä¸‹é¢åŠ äº†ä¸€è¡Œ<code>this.otherField = val</code>ã€‚ã€‚åæ¥å‰ç«¯æŠŠé‚£ä¸€è¡Œç»™å»é™¤äº†ã€‚ã€‚ã€‚ç„¶åä¿®æ”¹ä¸ºå¦‚ä¸‹ä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-select</span> <span class="attr">v-model</span>=<span class="string">"selectData.value"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·é€‰æ‹©"</span> <span class="attr">filterable</span> <span class="attr">:filter-method</span>=<span class="string">"(val)=&gt;search(val,()=&gt;&#123;this.otherField=val&#125;)"</span> <span class="attr">prop</span>=<span class="string">"value"</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"> search (val, callback) &#123;</span><br><span class="line">      callback();</span><br><span class="line">  // ä¸€æ ·çš„ä»£ç </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>åæ¥å°±æ²¡ç®¡äº†ï¼Œä¸è¿‡ç°åœ¨è§‰å¾—è¿™æ ·å†™çš„è¯æœ‰å¥½å¤„ä¹Ÿæœ‰åå¤„ã€‚å¥½å¤„å°±æ˜¯å¯¹äºå¦‚æœåªæœ‰å¾ˆå°‘çš„å­—æ®µå˜åŠ¨çš„è¯ï¼Œè¿™æ ·æ”¹æ— ç–‘çš„å¥½çš„ï¼Œå› ä¸ºå¯ä»¥é¿å…åœ¨æ–¹æ³•é‡Œé¢å†™å¤ªå¤šçš„å­—æ®µï¼Œä½†æ˜¯ä¸€æ—¦é‡å¤çš„å¤šèµ·æ¥ï¼Œæˆ‘è§‰å¾—åœ¨æ–¹æ³•é‡Œé¢å†™èµ·æ¥æ¯”è¾ƒå¥½ã€‚</p><h2 id="ElasticSearchçš„ä¹è§‚é”æœºåˆ¶ï¼ˆåŒæ­¥çš„å‘ï¼‰"><a href="#ElasticSearchçš„ä¹è§‚é”æœºåˆ¶ï¼ˆåŒæ­¥çš„å‘ï¼‰" class="headerlink" title="ElasticSearchçš„ä¹è§‚é”æœºåˆ¶ï¼ˆåŒæ­¥çš„å‘ï¼‰"></a>ElasticSearchçš„ä¹è§‚é”æœºåˆ¶ï¼ˆåŒæ­¥çš„å‘ï¼‰</h2><p>ä¸Šå‘¨ç”±äºåœ¨åšè¡¥å¿æœºåˆ¶çš„æ—¶å€™ï¼Œéœ€è¦å¯¹Esä¸€äº›æ•°æ®è¿›è¡Œé¢‘ç¹çš„æ›´æ–°ï¼Œä½†æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™ ES ç»å¸¸ä¼šè¿”å›<code>version conflict</code> ï¼Œåæ¥æœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç° ES å¯¹äºæ¯ä¸€ä¸ªæ•°æ®éƒ½æœ‰ä¸€ä¸ª<code>_version</code>å­—æ®µ</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-07-07%20%E4%B8%8B%E5%8D%888.57.25.png" alt=""></p><p>è€Œæˆ‘ä»¬å¯¹ä¸€ä¸ªæ•°æ®å¦‚æœé¢‘ç¹æ›´æ–°çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ESçš„ä¹è§‚é”ç”Ÿæ•ˆï¼Œä»è€Œæ›´æ–°å¤±è´¥ã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-07-07%20%E4%B8%8B%E5%8D%889.13.03.png" alt=""></p><p>ç”±äºæˆ‘ä½¿ç”¨çš„ESç‰ˆæœ¬æ˜¯ES6.7.1ï¼Œè¿™æ—¶å€™åªèƒ½é€šè¿‡<code>if_seq_no</code>æ¥è§£å†³äº†ï¼Œå› ä¸ºå½“æˆ‘å°è¯•ä½¿ç”¨å¤–éƒ¨ç‰ˆæœ¬å·æ§åˆ¶çš„æ—¶å€™ï¼Œçªç„¶å‘ç°ã€‚ã€‚ã€‚ESå®˜æ–¹ç«Ÿç„¶ä¸æ¨èäº†</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-07-07%20%E4%B8%8B%E5%8D%889.27.26.png" alt=""></p><p>è¿™éƒ¨åˆ†åç»­å†™æ–‡ç« ç»§ç»­åˆ†æäº†ã€‚ã€‚ã€‚</p><h2 id="ESçš„å‡çº§ä»¥åŠåŸºç¡€æ’åºæ–¹æ³•"><a href="#ESçš„å‡çº§ä»¥åŠåŸºç¡€æ’åºæ–¹æ³•" class="headerlink" title="ESçš„å‡çº§ä»¥åŠåŸºç¡€æ’åºæ–¹æ³•"></a>ESçš„å‡çº§ä»¥åŠåŸºç¡€æ’åºæ–¹æ³•</h2><p>ç”±äºéœ€è¦åˆ—è¡¨çš„æ•°æ®è¿›è¡Œç»¼åˆæŸ¥è¯¢ç„¶åæ’åºï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½æ‰‹å†™æ’åºæ–¹æ³•äº†ï¼Œå¥½åœ¨ESçš„å®˜æ–¹æ–‡æ¡£å€’ä¹Ÿè¯¦ç»†ï¼Œæ‰€ä»¥å‚ç…§å®˜æ–¹çš„æ–‡æ¡£ï¼Œè‡ªå·±æ‘¸ç´¢äº†ä¸¤ä¸ªå°æ—¶å€’ä¹Ÿå†™å‡ºæ¥äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String script = <span class="string">"ä½ çš„æ’åºè„šæœ¬"</span>;</span><br><span class="line">Script inline = <span class="keyword">new</span> Script(script);</span><br><span class="line">SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">"ä½ çš„ç´¢å¼•"</span>);</span><br><span class="line">SearchSourceBuilder sourceBuilder = <span class="keyword">new</span> SearchSourceBuilder();</span><br><span class="line">sourceBuilder.sort(<span class="keyword">new</span> ScriptSortBuilder(inline,ScriptSortBuilder.ScriptSortType.NUMBER).order(SortOrder.DESC));</span><br></pre></td></tr></table></figure><h2 id="Rabbitmq"><a href="#Rabbitmq" class="headerlink" title="Rabbitmq"></a>Rabbitmq</h2><p>ç”±äºMqç¯å¢ƒéœ€è¦ç»Ÿä¸€ä¸‹ï¼Œæ‰€ä»¥è¿™æ®µæ—¶é—´ä¹ŸæŠŠè‡ªå·±è´Ÿè´£çš„Mqåˆ<code>fanout</code>æ”¹ä¸º<code>direct</code>äº†ã€‚æ”¹åŠ¨èµ·æ¥åˆ°ä¹Ÿæ²¡å•¥éš¾åº¦ï¼Œå°±æ˜¯åœ¨<code>convertAndSend</code>æ–¹æ³•é‡Œé¢å¤šåŠ äº†ä¸€ä¸ª<code>routeKey</code>å‚æ•°è€Œå·²</p><h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><p>è¿™å‘¨ä¸»è¦æ˜¯åœ¨ Leetcode ä¸Šå†™äº†ç‚¹<code>Array</code>çš„ä¸€äº›ç®—æ³•é¢˜ï¼Œå› ä¸ºéƒ½æ˜¯ç®€å•çš„é¢˜ç›®ï¼Œæš‚æ—¶è¿˜æœªé‡åˆ°ä¸€äº›æ¯”è¾ƒç»å…¸çš„é¢˜ç›®</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å‘¨ä¸‰æ‰æƒ³èµ·æ¥è¯•è¯•è®°å½•ä¸‹ï¼Œä¸‹å‘¨ä¼°è®¡ä¼šè¯¦ç»†ç‚¹</p>]]></content>
      
      <categories>
          
          <category> å‘¨è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‘¨è®° </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Es6.Xå‡çº§åˆ°Es7.xçš„å˜åŒ–</title>
      <link href="/2019/07/07/Es6-X%E5%8D%87%E7%BA%A7%E5%88%B0Es7-x%E7%9A%84%E5%8F%98%E5%8C%96/"/>
      <url>/2019/07/07/Es6-X%E5%8D%87%E7%BA%A7%E5%88%B0Es7-x%E7%9A%84%E5%8F%98%E5%8C%96/</url>
      <content type="html"><![CDATA[<p>ElasticSearch6.å‡çº§è‡³ElasticSearch7.xçš„ä¸€äº›å˜åŒ–</p><p>ç”±äºæœ€è¿‘éœ€è¦å°†<code>Es6.x</code>å‡çº§è‡³<code>Es7</code>ï¼Œæ‰€ä»¥æ­£å¥½è®°å½•ä¸‹åœ¨å‡çº§è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œä»¥ä¾¿ä»¥åç¿»é˜…ã€‚</p><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><h3 id="Es7-xç³»åˆ—ä¸­å–æ¶ˆäº†Type"><a href="#Es7-xç³»åˆ—ä¸­å–æ¶ˆäº†Type" class="headerlink" title="Es7.xç³»åˆ—ä¸­å–æ¶ˆäº†Type"></a>Es7.xç³»åˆ—ä¸­å–æ¶ˆäº†Type</h3><p>åœ¨<code>Es6</code>ç³»åˆ—ä¹‹å‰ï¼Œåˆ›å»ºä¸€ä¸ªç´¢å¼•æ˜¯éœ€è¦<code>index,type</code>è¿™ä¸¤ä¸ªç¼ºä¸€ä¸å¯çš„ï¼Œä¾‹å¦‚å¦‚ä¸‹è¯·æ±‚ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> PUT localhost:9200/es_6     </span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">        <span class="attr">"index_type"</span>:&#123;</span><br><span class="line">            <span class="attr">"properties"</span>:&#123;</span><br><span class="line">                <span class="attr">"message"</span>:&#123;</span><br><span class="line">                    <span class="attr">"type"</span>:<span class="string">"text"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">response:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"acknowledged"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"shards_acknowledged"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"index"</span>: <span class="string">"es_6"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨ <code>ES7</code> ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœå†ä½¿ç”¨è¿™ä¸ª Json ä¸²çš„è¯æ˜¯ä¼šè·‘å‡ºä¸€ä¸ªå¼‚å¸¸çš„ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"error"</span>: &#123;</span><br><span class="line">        <span class="attr">"root_cause"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"mapper_parsing_exception"</span>,</span><br><span class="line">                <span class="attr">"reason"</span>: <span class="string">"Root mapping definition has unsupported parameters:  [index_type : &#123;properties=&#123;message=&#123;type=text&#125;&#125;&#125;]"</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"mapper_parsing_exception"</span>,</span><br><span class="line">        <span class="attr">"reason"</span>: <span class="string">"Failed to parse mapping [_doc]: Root mapping definition has unsupported parameters:  [index_type : &#123;properties=&#123;message=&#123;type=text&#125;&#125;&#125;]"</span>,</span><br><span class="line">        <span class="attr">"caused_by"</span>: &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"mapper_parsing_exception"</span>,</span><br><span class="line">            <span class="attr">"reason"</span>: <span class="string">"Root mapping definition has unsupported parameters:  [index_type : &#123;properties=&#123;message=&#123;type=text&#125;&#125;&#125;]"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">400</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ­¤æ—¶åœ¨<code>ES7</code>ç‰ˆæœ¬ä¸­ï¼Œå»ºç«‹ mapping æ˜¯ä¸éœ€è¦ Type çš„ï¼Œæ‰€ä»¥å…¶ç´¢å¼•ä¿®æ”¹ä¸ºä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT localhost:9201/es_7</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"mappings"</span>:&#123;</span><br><span class="line">        <span class="attr">"properties"</span>:&#123;</span><br><span class="line">            <span class="attr">"message"</span>:&#123;</span><br><span class="line">                <span class="attr">"type"</span>:<span class="string">"text"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"acknowledged"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"shards_acknowledged"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"index"</span>: <span class="string">"es_7"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ES7-xä¸­æ–°å»ºæ•°æ®"><a href="#ES7-xä¸­æ–°å»ºæ•°æ®" class="headerlink" title="ES7.xä¸­æ–°å»ºæ•°æ®"></a>ES7.xä¸­æ–°å»ºæ•°æ®</h3><p>åœ¨ ES6 ä¸­ç”±äºæœ‰ä¸€ä¸ª Type ç±»å‹ï¼Œå› æ­¤åœ¨æ–°å»ºæ•°æ®çš„æ—¶å€™éƒ½éœ€è¦ç©¿å…¥ä¸€ä¸ªTypeï¼Œé‚£ä¹ˆåœ¨ Es7 é‡Œé¢ï¼Œç”±äº Type è¢«å–æ¶ˆäº†ï¼Œæ‰€ä»¥åœ¨ ES7 é‡Œé¢çš„æ–°å¢å°±éœ€è¦ç¨å¾®ä¿®æ”¹ä¸‹äº†ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">POST localhost:9201/es_7/_create/1</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="attr">"message"</span>:<span class="string">"a"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_index"</span>: <span class="string">"es_7"</span>,</span><br><span class="line">    <span class="attr">"_type"</span>: <span class="string">"_doc"</span>,</span><br><span class="line">    <span class="attr">"_id"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"_version"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">"result"</span>: <span class="string">"created"</span>,</span><br><span class="line">    <span class="attr">"_shards"</span>: &#123;</span><br><span class="line">        <span class="attr">"total"</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">"successful"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"failed"</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_seq_no"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"_primary_term"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®è¿˜æœ‰å¦ä¸€ç§å†™æ³•ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST localhost:9201/es_7/_doc/2?op_type=create</span><br></pre></td></tr></table></figure><p>å‰©ä¸‹çš„ä¸€äº›æ”¹åŠ¨å¯èƒ½å°±æ˜¯æ–°çš„ä¸šåŠ¡ä¸Šçº¿éœ€è¦å¯¹æŸäº›æ•°æ®è¿›è¡Œé¢‘ç¹çš„æ”¹åŠ¨ï¼Œè€ŒESçš„ä¹è§‚é”æœºåˆ¶å¯¼è‡´ç»å¸¸å¤±è´¥ï¼Œè¿™ä¸ªé—®é¢˜å¾—éœ€è¦å•ç‹¬å¤„ç†ä¸‹</p>]]></content>
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>vueé‡Œé¢å†’å·å’Œéå†’å·åŒºåˆ«</title>
      <link href="/2019/06/27/vue%E9%87%8C%E9%9D%A2%E5%86%92%E5%8F%B7%E5%92%8C%E9%9D%9E%E5%86%92%E5%8F%B7%E5%8C%BA%E5%88%AB/"/>
      <url>/2019/06/27/vue%E9%87%8C%E9%9D%A2%E5%86%92%E5%8F%B7%E5%92%8C%E9%9D%9E%E5%86%92%E5%8F%B7%E5%8C%BA%E5%88%AB/</url>
      <content type="html"><![CDATA[<h2 id="vueé‡Œé¢å†’å·å’Œéå†’å·çš„å´åˆ«"><a href="#vueé‡Œé¢å†’å·å’Œéå†’å·çš„å´åˆ«" class="headerlink" title="vueé‡Œé¢å†’å·å’Œéå†’å·çš„å´åˆ«"></a>vueé‡Œé¢å†’å·å’Œéå†’å·çš„å´åˆ«</h2><p>ä»Šå¤©åœ¨ä½¿ç”¨Vueçš„æ—¶å€™ï¼Œçªç„¶å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨åç«¯ä¼ è¿‡æ¥çš„å€¼å› ä¸ºæ˜¯ä¸€ä¸ª<code>boolean</code>ç±»å‹çš„ï¼Œä½†æ˜¯å‰ç«¯åˆéœ€è¦è¿›è¡Œå±•ç¤ºï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>ElementUI</code>çš„è¯ï¼Œäºæ˜¯å‚ç…§å®˜ç½‘ä¸Šå°±æ˜¯è¿™æ ·å†™çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select v-model=&quot;option_boolean&quot;&gt;</span><br><span class="line">        &lt;el-option label=&quot;1&quot; value=&quot;true&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;el-option label=&quot;2&quot; value=&quot;false&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">&lt;/el-select&gt;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ­¤æ—¶é¡µé¢ä¸Šå±•ç¤ºå¹¶éæ˜¯ 1 å’Œ 2 ï¼Œè€Œæ˜¯ true å’Œ falseã€‚å¦‚ä¸‹ï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%9C%89%E9%81%93%E4%BA%91%E7%AC%94%E8%AE%B0/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-06-26%20%E4%B8%8B%E5%8D%8810.20.15.png" alt=""></p><p>æŒ‰ç…§æ­£å¸¸çš„é€»è¾‘ï¼Œæ­¤æ—¶è¿™ä¸ªä¸‹æ‹‰æ¡†é‡Œé¢çš„å€¼åº”è¯¥æ˜¯1ï¼Œè€Œä¸æ˜¯trueã€‚å¦‚æœæ­¤æ—¶ä¿®æ”¹ä¸ºå¦‚ä¸‹å†™æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-select v-model=&quot;option_boolean&quot;&gt;</span><br><span class="line">        &lt;el-option label=&quot;1&quot; :value=&quot;true&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">        &lt;el-option label=&quot;2&quot; :value=&quot;false&quot;&gt;&lt;/el-option&gt;</span><br><span class="line">    &lt;/el-select&gt;</span><br></pre></td></tr></table></figure><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-06-26%20%E4%B8%8B%E5%8D%8810.22.58.png" alt=""></p><p>æ­¤æ—¶çš„é¡µé¢å°±ä¼šæ˜¾ç¤ºæ­£å¸¸äº†ã€‚</p><h2 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h2><p>åœ¨ Vue é‡Œé¢ï¼Œå†’å·<code>:</code>ä»£è¡¨çš„æ˜¯ä¸€ä¸ªåŒå‘ç»‘å®šï¼Œå…¶å€¼è¦ä¹ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ­¤ Demo é‡Œé¢ï¼Œç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œvalueä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªå±æ€§ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ˜¯æ¥å—å­—ç¬¦ä¸²ç±»å‹ç­‰</p><p>ä½†æ˜¯åœ¨ç¬¬äºŒä¸ªä¾‹å­é‡Œé¢ï¼Œç”±äºä½¿ç”¨äº† Vue çš„ä¸€ä¸ªåŒå‘ç»‘å®šæ¨¡å¼ï¼Œæ‰€ä»¥æ­¤æ—¶ä¾¿å¯ä»¥æ­£ç¡®çš„è¯†åˆ«å‡º boolean ç±»å‹çš„å€¼äº†</p>]]></content>
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¦‚ä½•å¯¹å¤šä¸ªIFè¿›è¡Œä¼˜åŒ–å‘¢?</title>
      <link href="/2019/06/11/%E5%A6%82%E4%BD%95%E5%AF%B9%E5%A4%9A%E4%B8%AAIF%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96%E5%91%A2/"/>
      <url>/2019/06/11/%E5%A6%82%E4%BD%95%E5%AF%B9%E5%A4%9A%E4%B8%AAIF%E8%BF%9B%E8%A1%8C%E4%BC%98%E5%8C%96%E5%91%A2/</url>
      <content type="html"><![CDATA[<p>åœ¨é¡¹ç›®ä¸­ï¼Œä¸å¯é¿å…çš„ä¼šä½¿ç”¨åˆ°<code>IF</code>æ¡ä»¶ï¼Œå¦‚æœä»…ä»…æ˜¯å¶å°”è¯•ä½¿ç”¨ä»¥ä¸‹ï¼Œå€’ä¹Ÿæ— å¦¨ï¼Œä½†æ˜¯å¦‚æœåœ¨é¡¹ç›®ä¸­å¤§é‡çš„ä½¿ç”¨<code>IF</code>åˆ¤æ–­ï¼Œé‚£ä¹ˆä¼šé€ æˆé¡¹ç›®çš„æ‚ä¹±æ— ç« ã€‚</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>æ•°æ®åº“è°ƒä¼˜(ä¸€)</title>
      <link href="/2019/06/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E4%BC%98-%E4%B8%80/"/>
      <url>/2019/06/09/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B0%83%E4%BC%98-%E4%B8%80/</url>
      <content type="html"><![CDATA[<h2 id="å¼€ç¯‡"><a href="#å¼€ç¯‡" class="headerlink" title="å¼€ç¯‡"></a>å¼€ç¯‡</h2><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªè¡¨ï¼Œé‡Œé¢çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from org_copy;</span><br><span class="line">+<span class="comment">--------+-----------------+---------------+----------+</span></span><br><span class="line">| org_id | org_name        | org_parent_id | org_copy |</span><br><span class="line">+<span class="comment">--------+-----------------+---------------+----------+</span></span><br><span class="line">|      1 | ä¸€çº§éƒ¨é—¨        |             0 | 1        |</span><br><span class="line">|      2 | ä¸€ä¸€çº§éƒ¨é—¨      |             0 | 2        |</span><br><span class="line">|      3 | 1.1çº§éƒ¨é—¨       |             1 | 3        |</span><br><span class="line">|      4 | 1.2çº§éƒ¨é—¨       |             1 | 4        |</span><br><span class="line">|      5 | 1.1.1éƒ¨é—¨       |             3 | 5        |</span><br><span class="line">|      6 | 1.1.2éƒ¨é—¨       |             3 | 6        |</span><br><span class="line">|      7 | 1.1.1.1éƒ¨é—¨     |             5 | 7        |</span><br><span class="line">|      8 | 1.3éƒ¨é—¨         |             1 | 8        |</span><br><span class="line">|      9 | 1.2.1éƒ¨é—¨       |             4 | 9        |</span><br><span class="line">+<span class="comment">--------+-----------------+---------------+----------+</span></span><br><span class="line">9 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>è¿™åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆåŸºæœ¬çš„ä¸€ä¸ªmysqlè¡¨ï¼ŒåŒæ—¶æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œä¹Ÿæ‰§è¡Œäº†å¦‚ä¸‹SQLã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org_copy WHERE org_name&gt;'ä¸€çº§éƒ¨é—¨' and  org_parent_id=1;</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table    | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | org_copy | NULL       | range | index_name    | index_name | 768     | NULL |    1 |    11.11 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå¦‚æœæ­¤æ—¶æˆ‘ä»¬æ¢ä¸€ä¸ªSQLæ¥è¿›è¡ŒæŸ¥è¯¢å‘¢?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org_copy WHERE org_name&gt;'1' and  org_parent_id=1;</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | org_copy | NULL       | ALL  | index_name    | NULL | NULL    | NULL |    9 |    11.11 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ˜¯ä¸æ˜¯ä¼šä¸€è„¸ç–‘æƒ‘â€¦ä¸ºå•¥æˆ‘çš„è¿™ä¸ªSQLï¼Œæ˜æ˜ä¸€æ ·å‘€ï¼Œä½†æ˜¯ä¸ºå•¥ç¬¬ä¸€ä¸ªå°±å¯ä»¥èµ°ç´¢å¼•å‘¢???<br>å› ä¸ºåœ¨mysqlé‡Œé¢ï¼Œä¼šåˆ¤æ–­<code>å½“å‰whereæ¡ä»¶æŸ¥è¯¢çš„æ•°æ®é‡</code>ï¼Œç”±äºç´¢å¼•æ˜¯ç”±ä¸€ä¸ª<code>B+</code>æ ‘çš„å½¢å¼å­˜åœ¨ï¼Œæ‰€ä»¥å½“é€šè¿‡<code>org_name</code>æ¥è¿›è¡Œæ¯”è¾ƒç­›é€‰çš„æ—¶å€™ï¼Œæ˜¯å¯ä»¥å¾ˆå¿«çš„å®šä½å‡ºå¤§è‡´éœ€è¦æŸ¥è¯¢çš„æ•°æ®é‡ã€‚</p><p>è€Œå½“æ•°æ®é‡å¤§äº30%çš„æ—¶å€™ï¼Œmysqlå°±ä¼šé‡‡ç”¨ä¸€ç§å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸å»ºè®®åœ¨åŒºåˆ†åº¦ä½çš„å­—æ®µä¸Šå»ºç«‹ç´¢å¼•äº†ï¼Œå‡è®¾ä¸€ä¸ªå­—æ®µåªæœ‰ä¸‰ä¸ªå€¼æˆ–è€…ä¸¤ä¸ªå€¼ï¼Œé‚£ä¹ˆææœ‰å¯èƒ½mysqlä¼šç›´æ¥é€šè¿‡å…¨è¡¨æ‰«æçš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ã€‚</p><h3 id="ç´¢å¼•è¦†ç›–"><a href="#ç´¢å¼•è¦†ç›–" class="headerlink" title="ç´¢å¼•è¦†ç›–"></a>ç´¢å¼•è¦†ç›–</h3><p>è¿™ä¸ªæ˜¯mysqlè°ƒä¼˜ä¸­ç»å¸¸å¿½ç•¥çš„ä¸€ç‚¹ï¼Œç”±äºmysqlåœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™ä¼šä¸€æ¬¡æ€§å°†ç´¢å¼•å­—æ®µå­˜å…¥åˆ°ç´¢å¼•æ ‘ä¸­ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬çš„<code>where</code>æ¡ä»¶ä¸­æ‰€åŒ…å«çš„å­—æ®µå‡å¯ä»¥åœ¨ç´¢å¼•ä¸­æ‰¾åˆ°çš„è¯ï¼Œé‚£ä¹ˆmysqlå°±ä¼šç›´æ¥ä»ç´¢å¼•ä¸­å»å–æ•°æ®ï¼Œè€Œä¸ä¼šè¿›è¡Œå›è¡¨ã€‚ä¾‹å¦‚å¦‚ä¸‹SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain  SELECT org_parent_id FROM org_copy WHERE org_copy=1;</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | org_copy | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 4325 |    10.00 | Using where |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+------+---------------+------+---------+------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ç”±äº<code>org_copy</code>å­—æ®µéç´¢å¼•ï¼Œæ‰€ä»¥æ­¤æ—¶åªèƒ½æ˜¯é€šè¿‡å›è¡¨çš„æ–¹å¼è¿›è¡ŒæŸ¥è¯¢ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>ç”±äºmysqlä¼šåœ¨æ•°æ®é‡å¤§äº<code>30%</code>çš„æ—¶å€™è¿›è¡Œå…¨è¡¨æ‰«æï¼Œæ‰€ä»¥æœ€å¥½å°±æ˜¯ä¸è¦åœ¨åŒºåˆ†åº¦ä½çš„å­—æ®µä¸Šå»ºç«‹ç´¢å¼•ï¼Œé¿å…è¿›è¡Œäº†å…¨è¡¨æ‰«æã€‚</li><li>å¯¹äºè¿‡æ»¤å­—æ®µçš„ä½¿ç”¨ï¼Œåº”è¯¥æ˜¯å°½æœ€å¤§çš„åŠªåŠ›è®©<code>SQL</code>é‡‡ç”¨ç´¢å¼•è¦†ç›–ï¼Œå¦‚æœæ— æ³•é¿å…çš„è¯å°±å°½é‡è®©æœ€å·¦åŸåˆ™ç”Ÿæ•ˆã€‚è¿›è€ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ã€‚</li></ol>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ•°æ®åº“æœ€å·¦åŸåˆ™ä»¥åŠç†è§£</title>
      <link href="/2019/06/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%80%E5%B7%A6%E5%8E%9F%E5%88%99%E4%BB%A5%E5%8F%8A%E7%90%86%E8%A7%A3/"/>
      <url>/2019/06/04/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%80%E5%B7%A6%E5%8E%9F%E5%88%99%E4%BB%A5%E5%8F%8A%E7%90%86%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>æœ¬æ¬¡çš„å®éªŒæ˜¯åŸºäº<code>Mysql8</code>ç‰ˆæœ¬ã€‚é¦–å…ˆåœ¨æ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªè¡¨ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table org;</span><br><span class="line">+<span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                   |</span><br><span class="line">+<span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| org   | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`org`</span> (</span><br><span class="line">  <span class="string">`org_id`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`org_name`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`org_parent_id`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`org_id`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`index_name`</span> (<span class="string">`org_name`</span>,<span class="string">`org_parent_id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">-------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œæœ‰ä¸€ä¸ªä¸»é”®<code>org_id</code>ä»¥åŠä¸€ä¸ªè”åˆç´¢å¼•<code>index_name</code>ã€‚å…¶ä»–çš„å¹¶æ— ç‰¹åˆ«ä¹‹å¤„ã€‚</p><h3 id="æœ€å·¦åŸåˆ™"><a href="#æœ€å·¦åŸåˆ™" class="headerlink" title="æœ€å·¦åŸåˆ™"></a>æœ€å·¦åŸåˆ™</h3><p>åœ¨Mysqlé‡Œé¢ï¼Œæœ‰ä¸€ä¸ªæœ€å·¦åŸåˆ™ï¼Œå®˜ç½‘çš„ä»‹ç»å¦‚ä¸‹ï¼š</p><blockquote><p>The name index is an index over the last_name and first_name columns. The index can be used for lookups in queries that specify       values in a known range for combinations of last_name and first_name values. It can also be used for queries that specify just a      last_name value because that column is a leftmost prefix of the index (as described later in this section). Therefore, the name       index is used for lookups in the following queriesã€‚</p></blockquote><p>æ—¢ç„¶æ˜¯æœ€å·¦åŸåˆ™ï¼Œé‚£ä¹ˆå°è¯•ç€å†™ä¸€æ¡SQLå¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org WHERE org_name='1' and  org_parent_id=1;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key        | key_len | ref         | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | org   | NULL       | ref  | index_name    | index_name | 773     | const,const |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°å…¶<code>type</code>æ˜¯ ref ç±»å‹çš„ï¼Œäºæ˜¯å»<code>mysql</code>å®˜ç½‘å¯»æ‰¾<code>ref</code>ç±»å‹çš„ç´¢å¼•æ˜¯ä»€ä¹ˆï¼š</p><blockquote><p> All rows with matching index values are read from this table for each combination of rows from the previous tables. ref is used if    the join uses only a leftmost prefix of the key or if the key is not a PRIMARY KEY or UNIQUE index (in other words, if the join       cannot select a single row based on the key value). If the key that is used matches only a few rows, this is a good join type.</p></blockquote><p>å•¥æ„æ€å‘¢ï¼Œå°±æ˜¯å½“ä½¿ç”¨çš„ç´¢å¼•ç¬¦åˆæœ€å·¦åŸåˆ™çš„æ—¶å€™ï¼Œä¸”ç´¢å¼•å³ä¸æ˜¯<code>ä¸»é”®</code>ä¹Ÿä¸æ˜¯<code>å”¯ä¸€ç´¢å¼•</code>ã€‚é‚£ä¹ˆå®ƒæ‰€ä½¿ç”¨çš„ç±»å‹å°±æ˜¯<code>ref</code>ã€‚</p><p>é‚£å¦‚æœå°†<code>org_name</code>å’Œ<code>org_parant_id</code>åç€å‘¢?<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org WHERE org_parent_id =1  and org_name='1';</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------+------+----------+-------------+</span></span><br><span class="line">| id | select_type | table | partitions | type | possible_keys | key        | key_len | ref         | rows | filtered | Extra       |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------+------+----------+-------------+</span></span><br><span class="line">|  1 | SIMPLE      | org   | NULL       | ref  | index_name    | index_name | 773     | const,const |    1 |   100.00 | Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+------+---------------+------------+---------+-------------+------+----------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>è¯´å¥½çš„æœ€å·¦åŸåˆ™å‘¢ã€‚ã€‚ã€‚ç´¢å¼•çš„org_parent_idä¸æ˜¯åœ¨å³è¾¹çš„å˜›ã€‚</p><p>å…¶å®åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®º<code>org_parent_id</code>åœ¨å·¦è¾¹è¿˜æ˜¯åœ¨å³è¾¹ï¼Œå¯¹äºæŸ¥è¯¢ç»“æœæ¥è¯´ï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚æ—¢ç„¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆ<code>Mysql</code>çš„ä¼˜åŒ–å™¨å°±ç›´æ¥æŠŠè¯¥æ¡è¯­å¥ç»™ä¼˜åŒ–æ‰äº†ï¼Œæ‰€ä»¥ä½ ä¼šå‘ç°æ— è®ºæ˜¯<code>org_name</code>åœ¨å·¦è¿˜æ˜¯åœ¨å³è¾¹éƒ½æ˜¯ä¼šä½¿ç”¨åˆ°ç´¢å¼•ã€‚</p><p>é‚£å†æ¢ä¸€æ¡SQLå‘¢ï¼Ÿ<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org WHERE org_name&gt;'1' and  org_parent_id=1;</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">| id | select_type | table | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                    |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">|  1 | SIMPLE      | org   | NULL       | index | index_name    | index_name | 773     | NULL |    9 |    11.11 | Using where; Using index |</span><br><span class="line">+<span class="comment">----+-------------+-------+------------+-------+---------------+------------+---------+------+------+----------+--------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>è¿™å°±å°´å°¬äº†â€¦ç”±äºåœ¨<code>æœ€å·¦åŸåˆ™</code>é‡Œé¢ï¼Œè‹¥å‰ä¸€ä¸ªç´¢å¼•ä½¿ç”¨äº†<code>&gt;</code>ã€<code>&lt;</code>ç­‰æ¯”è¾ƒç¬¦çš„æ—¶å€™ï¼Œåé¢ä¸€ä¸ªæ˜¯ä¸ä¼šè¿›è¡Œç´¢å¼•æŸ¥è¯¢çš„ï¼Œè¿™ä¸ªè·Ÿ<code>Mysql</code>çš„ç´¢å¼•ç»“æ„æœ‰å…³ç³»(æ–‡ç« åé¢ä¼šä»‹ç»)ï¼Œä½†æ˜¯ä¸ºå•¥è¿™é‡Œåˆä¼šèµ°ç´¢å¼•å‘¢? è¿™ä¸ªæ—¶å€™ç”±äºåœ¨<code>Extra</code>é‡Œé¢çœ‹åˆ°äº†<code>Using index</code>ï¼ŒçŒœæµ‹éš¾é“æ˜¯å‘ç”Ÿäº†ç´¢å¼•è¦†ç›–? äºæ˜¯æˆ‘åˆå»ºç«‹äº†ä¸€ä¸ªè¡¨ã€‚<br>äºæ˜¯ç«‹å³åˆæ–°å»ºäº†ä¸€å¼ è¡¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table org_copy;</span><br><span class="line">+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Table    | Create Table                                                                                                                                                                                                                                                                                |</span><br><span class="line">+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| org_copy | CREATE TABLE `org_copy` (</span><br><span class="line">  `org_id` int(5) NOT NULL,</span><br><span class="line">  `org_name` varchar(255) DEFAULT NULL,</span><br><span class="line">  `org_parent_id` int(5) DEFAULT NULL,</span><br><span class="line">  `org_copy` varchar(255) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (`org_id`),</span><br><span class="line">  KEY `index_name` (`org_name`,`org_parent_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 |</span><br><span class="line">+----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>è¿™æ—¶ï¼Œæˆ‘å†æ¬¡æ‰§è¡Œåˆšæ‰çš„<code>sql</code>ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org_copy WHERE org_name&gt;'ä¸€çº§éƒ¨é—¨' and  org_parent_id=1;</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table    | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | org_copy | NULL       | range | index_name    | index_name | 768     | NULL |    1 |    11.11 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>çœ‹èµ·æ¥çš„ç¡®æ˜¯ç”±äºå‘ç”Ÿäº†<code>ç´¢å¼•è¦†ç›–</code>ï¼Œå¯¼è‡´äº†è™½ç„¶ä¸ç¬¦åˆ<code>æœ€å·¦åŸåˆ™</code>ï¼Œä½†æ˜¯è¿˜æ˜¯èµ°äº†ä¸€ä¸ªç´¢å¼•ã€‚</p><h3 id="ç´¢å¼•è¦†ç›–"><a href="#ç´¢å¼•è¦†ç›–" class="headerlink" title="ç´¢å¼•è¦†ç›–"></a>ç´¢å¼•è¦†ç›–</h3><p>ä»€ä¹ˆæ˜¯ç´¢å¼•è¦†ç›–å‘¢?<br>åœ¨<code>org</code>è¿™ä¸ªè¡¨é‡Œé¢ï¼Œæœ‰ä¸‰ä¸ªå­—æ®µï¼Œä½†æ˜¯è¿™ä¸‰ä¸ªå­—æ®µåˆ†åˆ«æ˜¯ä¸€ä¸ª<code>ä¸»é”®ç´¢å¼•</code>å’Œä¸€ä¸ª<code>è”åˆç´¢å¼•</code>ï¼Œç”±äºæˆ‘æŸ¥è¯¢çš„å­—æ®µå°±åŒ…å«åœ¨ç´¢å¼•é‡Œé¢ï¼Œé‚£ä¹ˆ<br>è€Œæ°å¥½è¿™ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨ç´¢å¼•é‡Œé¢ï¼Œè¿™å°±å¯¼è‡´äº†<code>mysql</code>å¯ä»¥ç›´æ¥ä»ç´¢å¼•é‡Œé¢è·å–åˆ°æ‰€éœ€è¦çš„æ•°æ®ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¸å¿…è¦å†å»é€šè¿‡<code>ç£ç›˜IO</code>å»æŸ¥è¯¢é¢å¤–çš„å­—æ®µæ•°æ®äº†ã€‚ä¹Ÿå°±ä¸éœ€è¦è¿›è¡Œ</p><p>ç»§ç»­å›åˆ°<code>æœ€å·¦åŸåˆ™</code>ï¼Œç”±äº<code>æœ€å·¦åŸåˆ™</code>è¦æ±‚åœ¨èšåˆç´¢å¼•é‡Œé¢ï¼Œæ¯ä¸€ä¸ªåˆ—æ˜¯è¦ä¸ºä¸€ä¸ªç­‰å€¼è¿æ¥ã€‚å³ï¼Œå¦‚æœ<code>org_name</code>ä½¿ç”¨äº†éç­‰å€¼è¿æ¥ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´<code>org_parent_id</code>æ— æ³•ä½¿ç”¨æœ€å·¦åŸåˆ™ã€‚ä¾‹å­å¦‚ä¸‹ï¼šè‹¥<code>org_parent_id</code>ä½¿ç”¨éç­‰å€¼è¿æ¥ï¼Œä¸ºäº†é¿å…<code>ç´¢å¼•è¦†ç›–</code>å¯¹<code>SQL</code>çš„å½±å“ï¼Œæ‰€ä»¥æ­¤æ¬¡çš„<code>SQL</code>åœ¨ copyè¡¨é‡Œé¢æ‰§è¡Œã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain SELECT * FROM org_copy WHERE org_name='1' and  org_parent_id&gt;1;</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table    | partitions | type  | possible_keys | key        | key_len | ref  | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | org_copy | NULL       | range | index_name    | index_name | 773     | NULL |    1 |   100.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+----------+------------+-------+---------------+------------+---------+------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯ä½¿ç”¨äº†<code>èšåˆç´¢å¼•</code>ï¼ŒåŒæ—¶æœ€åä¸€åˆ—çš„<code>Using index condition</code>ä¹Ÿè¡¨æ˜ï¼Œè¿™æ¡æŸ¥è¯¢è¯­å¥ä¼šå…ˆé€šè¿‡ç´¢å¼•æ¥è¿‡æ»¤å‡ºç¬¦åˆçš„æ•°æ®ï¼Œç„¶åä»è¿‡æ»¤å‡ºæ¥çš„æ•°æ®é‡Œé¢åœ¨ä½¿ç”¨æˆ‘ä»¬çš„<code>where</code>æ¡ä»¶è¿›è¡ŒäºŒæ¬¡è¿‡æ»¤ï¼Œæœ€ç»ˆæ‰¾å‡ºç¬¦åˆçš„æ•°æ®ã€‚</p><h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><p>åœ¨Mysqlé‡Œé¢ï¼Œç´¢å¼•æ˜¯ä»¥<code>B+æ ‘</code>çš„å½¢å¼å®ç°çš„ï¼Œè€Œç´¢å¼•åˆåˆ†ä¸ºä¸€çº§ç´¢å¼•(ä¸»é”®)å’ŒäºŒçº§ç´¢å¼•(è¯¥æ–‡ç« ä¸­çš„<code>index_name</code>)ï¼Œå…¶å®åœ¨<code>InnoDB</code>é‡Œé¢ï¼ŒäºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹æ‰€å­˜æ”¾çš„æ•°æ®å°±æ˜¯ä¸»é”®ç´¢å¼•æ‰€å¯¹åº”çš„åœ°å€ï¼Œè¿™ä¹Ÿç§°ä¹‹ä¸º<code>å›è¡¨</code>ã€‚<br>å›åˆ°æ–‡ç« ä¸­æ¥ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„<code>index_name</code>ç´¢å¼•é‡Œé¢ï¼Œmysqlæ˜¯æ ¹æ®ç´¢å¼•åˆ—çš„é¡ºåºï¼Œä¸€ä¸ªä¸€ä¸ªåœ¨ç´¢å¼•é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾è¿‡æ»¤ï¼Œå¦‚æœè¯¥ç´¢å¼•åœ¨æŸä¸€åˆ—æ–­å¼€äº†ï¼Œä¾‹å¦‚ç´¢å¼•<code>A</code>çš„åˆ—æ˜¯(Aã€Bã€C)ï¼Œä½†æ˜¯åœ¨<code>SQL</code>é‡Œé¢å´æ˜¯<code>where A =&#39;a&#39; and C=&#39;c&#39;</code>ï¼Œæ­¤æ—¶å°±ä¼šåªä½¿ç”¨è¯¥ç´¢å¼•<code>A</code>çš„<code>A</code>åˆ—ï¼Œè¿™ä¸ªè·Ÿ<code>B+</code>æ ‘çš„ç‰¹ç‚¹æœ‰å…³ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table index_test;</span><br><span class="line">+<span class="comment">------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table      | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                |</span><br><span class="line">+<span class="comment">------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| index_test | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`index_test`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`b`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`c`</span> <span class="built_in">int</span>(<span class="number">5</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`d`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`f`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`a`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`index_name`</span> (<span class="string">`b`</span>,<span class="string">`c`</span>,<span class="string">`d`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">`index_test`</span> <span class="keyword">WHERE</span> b=<span class="string">'b'</span> <span class="keyword">and</span> d=<span class="string">'d'</span>;</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">| id | select_type | table      | partitions | type | possible_keys | key        | key_len | ref   | rows | filtered | Extra                 |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">|  1 | SIMPLE      | index_test | NULL       | ref  | index_name    | index_name | 768     | const |    1 |    50.00 | Using index condition |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+------------+---------+-------+------+----------+-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°<code>ref</code>å°±ä¸€ä¸ª<code>const</code>ï¼Œæ‰€ä»¥åŸºæœ¬å¯ä»¥æ¨æµ‹ç›®å‰åªç”¨äº†<code>b</code>åˆ—ï¼Œé‚£ä¹ˆæ¢æˆ<code>WHERE b=&#39;b&#39; and c=&#39;c&#39;</code>å‘¢?<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; EXPLAIN SELECT * FROM `index_test` WHERE b='b' and c='c';</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+------------+---------+-------------+------+----------+-------+</span></span><br><span class="line">| id | select_type | table      | partitions | type | possible_keys | key        | key_len | ref         | rows | filtered | Extra |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+------------+---------+-------------+------+----------+-------+</span></span><br><span class="line">|  1 | SIMPLE      | index_test | NULL       | ref  | index_name    | index_name | 773     | const,const |    1 |   100.00 | NULL  |</span><br><span class="line">+<span class="comment">----+-------------+------------+------------+------+---------------+------------+---------+-------------+------+----------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>æ‰€æœ‰å¯¹äºä½¿ç”¨<code>æœ€å·¦åŸåˆ™</code>æ¥è¿›è¡Œè°ƒä¼˜çš„è¯ï¼Œé¦–å…ˆåº”è¯¥æ³¨æ„çš„æ˜¯ç´¢å¼•åˆ—æœ€å¥½éƒ½æ˜¯<code>ç­‰å€¼è¿æ¥</code>ï¼Œå¹¶ä¸”ä¸­é€”æœ€å¥½ä¸è¦æœ‰ä»»ä½•çš„æ–­è£‚ã€‚è¿™æ ·æ‰èƒ½å‘æŒ¥å‡ºè”åˆç´¢å¼•çš„ä¼˜åŠ¿</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>ElementUIä½¿ç”¨rulesé‡åˆ°çš„ä¸€äº›é—®é¢˜</title>
      <link href="/2019/05/30/ElementUi%E4%BD%BF%E7%94%A8rules%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>/2019/05/30/ElementUi%E4%BD%BF%E7%94%A8rules%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>è¿™äº›å¤©ä¸€ç›´åœ¨è¸©<code>Vue</code>çš„å‘â€¦ä»Šå¤©é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜æ˜¯åœ¨ä¸€ä¸ªçˆ¶ç»„ä»¶ä¸­ï¼Œå°†æŸäº›æ•°æ®é€šè¿‡<code>props</code>ä¼ é€’ç»™å­ç»„ä»¶ï¼ŒåŒæ—¶åœ¨å­ç»„ä»¶é‡Œé¢ä¹Ÿæœ‰ç›¸åº”çš„ä¸€äº›<code>rules</code>è§„åˆ™ï¼Œä½†æ˜¯åœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œå´å‘ç°å­ç»„ä»¶çš„<code>rules</code>å¹¶æœªç”Ÿæ•ˆâ€¦åè€Œä¸€ç›´æç¤ºå¯¹åº”çš„ messageï¼Œåæ¥æ‰å‘ç°æ˜¯è·Ÿ ElementUI çš„<code>prop</code>æœ‰å…³ã€‚</p><p>é¦–å…ˆçœ‹ä¸€æ®µä»£ç :<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>è¯¥Demoæ˜¯ä¸ºäº†æµ‹è¯•Vueä¸­ruleå’Œpropçš„ä¸åŒ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">"vehicles"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å…¬å…±æ±½è½¦è½¦è½®ä¸ªæ•°"</span> <span class="attr">prop</span>=<span class="string">"bus.wheel"</span> <span class="attr">:rules</span>=<span class="string">"&#123;required: true,message: 'è¯·è¾“å…¥å…¬å…±æ±½è½¦è½¦è½®ä¸ªæ•°'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"vehicles.bus.wheel"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å…¬å…±æ±½è½¦å¸æœºé©¾ç…§"</span> <span class="attr">prop</span>=<span class="string">"bus.driver.license"</span> <span class="attr">:rules</span>=<span class="string">"&#123;validator: licenseCheck ,trigger:'blur'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"vehicles.bus.driver.license"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å…¬å…±æ±½è½¦è½¦è½®ä¸ªæ•°"</span> <span class="attr">prop</span>=<span class="string">"bus.driver.years"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"vehicles.bus.driver.years"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">car</span> <span class="attr">:car</span>=<span class="string">"vehicles.car"</span>&gt;</span><span class="tag">&lt;/<span class="name">car</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">import Car from './Car';</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">export default &#123;</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    Car</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="undefined">    return &#123;</span></span><br><span class="line"><span class="undefined">      vehicles: &#123;</span></span><br><span class="line"><span class="undefined">        bus: &#123;</span></span><br><span class="line"><span class="undefined">          wheel: null,</span></span><br><span class="line"><span class="undefined">          driver: &#123;</span></span><br><span class="line"><span class="undefined">            license: null,</span></span><br><span class="line"><span class="undefined">            years: null</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        car: &#123;</span></span><br><span class="line"><span class="undefined">          wheel: null,</span></span><br><span class="line"><span class="undefined">          driver: &#123;</span></span><br><span class="line"><span class="undefined">            license: null,</span></span><br><span class="line"><span class="undefined">            years: null</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        train: &#123;</span></span><br><span class="line"><span class="undefined">          wheel: null,</span></span><br><span class="line"><span class="undefined">          driver: &#123;</span></span><br><span class="line"><span class="undefined">            license: null,</span></span><br><span class="line"><span class="undefined">            years: null</span></span><br><span class="line"><span class="undefined">          &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">      person: &#123;</span></span><br><span class="line"><span class="undefined">        child: &#123;</span></span><br><span class="line"><span class="undefined">          year: null</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    licenseCheck (rule, value, callback) &#123;</span></span><br><span class="line"><span class="undefined">      let m = this.car;</span></span><br><span class="line"><span class="undefined">      console.log(m);</span></span><br><span class="line"><span class="undefined">      debugger;</span></span><br><span class="line"><span class="undefined">      if (value != null) &#123;</span></span><br><span class="line"><span class="undefined">        if (value != 'A') &#123;</span></span><br><span class="line"><span class="undefined">          callback(new Error('å¿…é¡»Aç…§'));</span></span><br><span class="line"><span class="undefined">        &#125; else &#123;</span></span><br><span class="line"><span class="undefined">          callback();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    init () &#123;</span></span><br><span class="line"><span class="undefined">      console.log(this.car);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶åœ¨è¿™ä¸ªç»„ä»¶ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œä½†æ˜¯ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®é‡Œé¢ï¼Œæ˜¯ä¸å¯èƒ½å°†æ‰€æœ‰çš„å…ƒç´ éƒ½å †ç§¯åœ¨ä¸€ä¸ªé¡µé¢ä¸­ï¼Œé‚£æ ·çš„è¯ä»¥åçš„ç»´æŠ¤å°±ä¼šéå¸¸çš„éº»çƒ¦ã€‚æ‰€ä»¥æ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªå­ç»„ä»¶ï¼Œç„¶åå°†çˆ¶ç»„ä»¶ä¸­ä¸€äº›æ•°æ®ä¼ é€’è‡³å­ç»„ä»¶ã€‚<br>ä»£ç å¦‚ä¸‹:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>å°æ±½è½¦å­ç»„ä»¶<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å°æ±½è½¦è½¦è½®ä¸ªæ•°"</span> <span class="attr">prop</span>=<span class="string">"wheel"</span> <span class="attr">:rules</span>=<span class="string">"&#123;required: true,message: 'è¯·è¾“å…¥å…¬å…±æ±½è½¦è½¦è½®ä¸ªæ•°'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"car.wheel"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å°æ±½è½¦å¸æœºé©¾ç…§"</span> <span class="attr">prop</span>=<span class="string">"driver.license"</span> <span class="attr">:rules</span>=<span class="string">"&#123;validator: licenseCheck ,trigger:'blur'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"car.driver.license"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å°æ±½è½¦è½¦è½®ä¸ªæ•°"</span> <span class="attr">prop</span>=<span class="string">"driver.years"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"car.driver.years"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">export default &#123;</span></span><br><span class="line"><span class="undefined">  props: &#123;</span></span><br><span class="line"><span class="undefined">    car: &#123;</span></span><br><span class="line"><span class="undefined">      type: Object,</span></span><br><span class="line"><span class="undefined">      default: function () &#123;</span></span><br><span class="line"><span class="undefined">        return &#123;&#125;;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    licenseCheck (rule, value, callback) &#123;</span></span><br><span class="line"><span class="undefined">      let m = this.car;</span></span><br><span class="line"><span class="undefined">      console.log(m);</span></span><br><span class="line"><span class="undefined">      debugger;</span></span><br><span class="line"><span class="undefined">      if (value != null) &#123;</span></span><br><span class="line"><span class="undefined">        if (value &lt;= 'D') &#123;</span></span><br><span class="line"><span class="undefined">          callback(new Error('å¿…é¡»Cç…§ä»¥ä¸Š'));</span></span><br><span class="line"><span class="undefined">        &#125; else &#123;</span></span><br><span class="line"><span class="undefined">          callback();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    init () &#123;</span></span><br><span class="line"><span class="undefined">      console.log(this.car);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  mounted () &#123;</span></span><br><span class="line"><span class="undefined">    this.init();</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>å½“ç„¶åœ¨è¿™ä¸ªé¡µé¢é‡Œé¢ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯ä»¥æ­£å¸¸è¾“å…¥çš„â€¦å°±æ˜¯<code>rules</code>æ— æ³•ä½¿ç”¨ã€‚ç”±äºè‡ªå·±æ‰æ˜¯åˆšåˆšå¼€å§‹æ¥è§¦<code>vue</code>å’Œ<code>ElementUI</code>ï¼Œæ‰€ä»¥å¯¹<code>vue</code>é‡Œé¢çš„ä¸€äº›ä½¿ç”¨æŠ€å·§è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œè¿™ä¸ªæ—¶å€™çœ‹äº†ä¸‹çˆ¶ç»„ä»¶é‡Œé¢çš„<code>prop</code>å’Œ<code>v-model</code>ï¼Œå‘ç°<code>prop</code>éƒ½æ˜¯æ¯”<code>v-model</code>å°‘ä¸€ä¸ªå‰ç¼€â€¦æ‰€ä»¥ä»¥ä¸ºåœ¨å­ç»„ä»¶é‡Œé¢ä¹Ÿæ˜¯è¿™æ ·..å…¶å®åæ¥æ‰å‘æ–°è¿™ä¸ªã€‚</p><p>ç„¶åå†å»æŸ¥çœ‹<code>ElementUI</code>çš„å®˜ç½‘ï¼Œå‘ç°</p><blockquote><p>prop    è¡¨å•åŸŸ model å­—æ®µï¼Œåœ¨ä½¿ç”¨ validateã€resetFields æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§æ˜¯å¿…å¡«çš„    string    ä¼ å…¥ Form ç»„ä»¶çš„ model ä¸­çš„å­—æ®µ</p></blockquote><p>äºæ—¶å€’çˆ¶ç»„ä»¶ä¸­çœ‹äº†ä¸‹ï¼Œå‘ç°<code>el-form</code>ç¡®å®æœ‰<code>:model</code>ï¼Œç„¶åå‚ç…§äº†ä¸‹<code>ElementUI</code>çš„ä»‹ç»â€¦çªç„¶æƒ³åˆ°æ˜¯ä¸æ˜¯<code>prop</code>å·²ç»è‡ªåŠ¨çš„å°†<code>:model</code>çš„å¯¹è±¡å¸¦è¿‡æ¥äº†â€¦åæ¥åœ¨å­ç»„ä»¶ä¸­è¿›è¡Œäº†æµ‹è¯•ï¼Œä¿®æ”¹åå¦‚ä¸‹:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>å°æ±½è½¦å­ç»„ä»¶<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å°æ±½è½¦è½¦è½®ä¸ªæ•°"</span> <span class="attr">prop</span>=<span class="string">"car.wheel"</span> <span class="attr">:rules</span>=<span class="string">"&#123;required: true,message: 'è¯·è¾“å…¥å…¬å…±æ±½è½¦è½¦è½®ä¸ªæ•°'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"car.wheel"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å°æ±½è½¦å¸æœºé©¾ç…§"</span> <span class="attr">prop</span>=<span class="string">"car.driver.license"</span> <span class="attr">:rules</span>=<span class="string">"&#123;validator: licenseCheck ,trigger:'blur'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"car.driver.license"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"å°æ±½è½¦è½¦è½®ä¸ªæ•°"</span> <span class="attr">prop</span>=<span class="string">"car.driver.years"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"car.driver.years"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">export default &#123;</span></span><br><span class="line"><span class="undefined">  props: &#123;</span></span><br><span class="line"><span class="undefined">    car: &#123;</span></span><br><span class="line"><span class="undefined">      type: Object,</span></span><br><span class="line"><span class="undefined">      default: function () &#123;</span></span><br><span class="line"><span class="undefined">        return &#123;&#125;;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    licenseCheck (rule, value, callback) &#123;</span></span><br><span class="line"><span class="undefined">      let m = this.car;</span></span><br><span class="line"><span class="undefined">      console.log(m);</span></span><br><span class="line"><span class="undefined">      debugger;</span></span><br><span class="line"><span class="undefined">      if (value != null) &#123;</span></span><br><span class="line"><span class="undefined">        if (value === 'A') &#123;</span></span><br><span class="line"><span class="undefined">          callback(new Error('å¿…é¡»Aç…§'));</span></span><br><span class="line"><span class="undefined">        &#125; else &#123;</span></span><br><span class="line"><span class="undefined">          callback();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    init () &#123;</span></span><br><span class="line"><span class="undefined">      console.log(this.car);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  mounted () &#123;</span></span><br><span class="line"><span class="undefined">    this.init();</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>äºæ˜¯ä¸€åˆ‡éƒ½æ­£å¸¸äº†ï¼Œåæ¥ä¸ºäº†æµ‹è¯•æ˜¯ä¸æ˜¯éè¦åœ¨<code>el-form</code>ä¸ŠåŠ ä¸€ä¸ª<code>:model</code>æ‰èƒ½æ­£å¸¸ä½¿ç”¨<code>rules</code>ï¼Œæ‰€ä»¥å°±å†™äº†ä¸€ä¸ª<code>el-form</code>æµ‹è¯•ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">""</span> <span class="attr">prop</span>=<span class="string">"person.child.year"</span> <span class="attr">:rules</span>=<span class="string">"&#123;validator: childCheck ,trigger:'blur'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"person.child.year"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥å°å­©çš„å¹´é¾„"</span> &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">import Car from './Car';</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">export default &#123;</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    Car</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="undefined">    return &#123;</span></span><br><span class="line"><span class="undefined">      person: &#123;</span></span><br><span class="line"><span class="undefined">        child: &#123;</span></span><br><span class="line"><span class="undefined">          year: null</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    childCheck (rule, value, callback) &#123;</span></span><br><span class="line"><span class="undefined">      debugger;</span></span><br><span class="line"><span class="undefined">      if (parseInt(value) &gt; 16) &#123;</span></span><br><span class="line"><span class="undefined">        callback(new Error('è¯·è¾“å…¥16ä»¥ä¸‹'));</span></span><br><span class="line"><span class="undefined">      &#125; else &#123;</span></span><br><span class="line"><span class="undefined">        callback();</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    init () &#123;</span></span><br><span class="line"><span class="undefined">      console.log(this.car);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åå‘ç°åœ¨<code>childCheck</code>é‡Œé¢<code>value</code>æ€»æ˜¯è·å–ä¸åˆ°å€¼â€¦ä¸€ç›´æ˜¯ undefinded ,ç„¶åå†åœ¨<code>el-form</code>é‡Œé¢åŠ ä¸Šä¸€ä¸ª<code>:modele</code>â€¦ä¿®æ”¹å¦‚ä¸‹:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">"person"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">""</span> <span class="attr">prop</span>=<span class="string">"child.year"</span> <span class="attr">:rules</span>=<span class="string">"&#123;validator: childCheck ,trigger:'blur'&#125;"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">v-model</span>=<span class="string">"person.child.year"</span> <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥å°å­©çš„å¹´é¾„"</span> &gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">import Car from './Car';</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">export default &#123;</span></span><br><span class="line"><span class="undefined">  components: &#123;</span></span><br><span class="line"><span class="undefined">    Car</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="undefined">    return &#123;</span></span><br><span class="line"><span class="undefined">      person: &#123;</span></span><br><span class="line"><span class="undefined">        child: &#123;</span></span><br><span class="line"><span class="undefined">          year: null</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    childCheck (rule, value, callback) &#123;</span></span><br><span class="line"><span class="undefined">      debugger;</span></span><br><span class="line"><span class="undefined">      if (parseInt(value) &gt; 16) &#123;</span></span><br><span class="line"><span class="undefined">        callback(new Error('è¯·è¾“å…¥16ä»¥ä¸‹'));</span></span><br><span class="line"><span class="undefined">      &#125; else &#123;</span></span><br><span class="line"><span class="undefined">        callback();</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    init () &#123;</span></span><br><span class="line"><span class="undefined">      console.log(this.car);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åå°±éƒ½å¥½äº†â€¦</p><p>æ‰€ä»¥ä»¥åè¿˜æ˜¯å¾—å¤šçœ‹çœ‹å®˜æ–¹æ–‡æ¡£â€¦</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>åœ¨Vueä¸­ä½¿ç”¨filtersæ¥è¿›è¡Œå­—å…¸å€¼çš„è½¬æ¢</title>
      <link href="/2019/05/27/%E5%9C%A8Vue%E4%B8%AD%E4%BD%BF%E7%94%A8filters%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%AD%97%E5%85%B8%E5%80%BC%E7%9A%84%E8%BD%AC%E6%8D%A2/"/>
      <url>/2019/05/27/%E5%9C%A8Vue%E4%B8%AD%E4%BD%BF%E7%94%A8filters%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%AD%97%E5%85%B8%E5%80%BC%E7%9A%84%E8%BD%AC%E6%8D%A2/</url>
      <content type="html"><![CDATA[<p>åœ¨Vueé‡Œé¢ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€äº›å­—å…¸å€¼çš„è½¬æ¢ï¼Œè€Œè¿™äº›å­—å…¸å€¼ç”±äºå’Œåç«¯è¿›è¡Œäº†çº¦å®šçš„ï¼Œä¸€èˆ¬ä¸ä¼šè½»æ˜“çš„æ”¹å˜ï¼Œæ‰€ä»¥åœ¨å‰åç«¯å¼€å‘çš„é¡¹ç›®ä¸­ï¼Œè¿™ç§å­—å…¸å€¼æœ€å¥½çš„åšæ³•æ˜¯å‰ç«¯ç‹¬ç«‹çš„ä¿å­˜ä¸€ä»½ï¼Œè‡ªå·±åœ¨å‰ç«¯è‡ªè¡Œè¿›è¡Œå¤„ç†ã€‚</p><p>æˆ‘ä»¬çš„åšæ³•æ˜¯ä½¿ç”¨<code>Vuex</code>çš„<code>store</code>é…åˆ<code>filters</code>æ¥è¿›è¡Œå‰ç«¯çš„å­—å…¸å€¼è½¬åŒ–ï¼Œé¦–å…ˆæ˜¯åœ¨<code>store</code>é‡Œé¢å°†å­—å…¸å€¼è¿›è¡Œå›ºå®šï¼Œç„¶åé€šè¿‡<code>filters</code>åœ¨é¡µé¢ä¸­è¿›è¡Œä¸€ä¸ªè½¬æ¢ã€‚</p><h2 id="ä½¿ç”¨Store"><a href="#ä½¿ç”¨Store" class="headerlink" title="ä½¿ç”¨Store"></a>ä½¿ç”¨Store</h2><p>åœ¨<code>Vue</code>é‡Œé¢ä½¿ç”¨<code>store</code>é¦–å…ˆéœ€è¦å®‰è£…<code>vuex</code>ï¼Œå®‰è£…å®Œæ¯•ä¹‹åå°±å¯ä»¥ç›´æ¥åœ¨<code>main.js</code>é‡Œé¢ç›´æ¥å¼•ç”¨äº†ï¼Œä½†æ˜¯ä¸ºäº†ç»Ÿä¸€ç®¡ç†è¿˜æ˜¯å†³å®šæ–°å»ºä¸€ä¸ª<code>store</code>æ–‡ä»¶å¤¹ï¼Œç„¶åå°†<code>store</code>ç›¸å…³çš„æ–‡ä»¶å…¨éƒ¨ç»Ÿä¸€å­˜æ”¾ï¼Œæ–°å»ºå®Œæ¯•ä¹‹åé¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---App.vue</span><br><span class="line">---main.js</span><br><span class="line">---store</span><br><span class="line">-----index.js</span><br></pre></td></tr></table></figure></p><p>åœ¨æ–°å»ºçš„<code>index.js</code>é‡Œé¢å°†<code>Vuex</code>å®ä¾‹æ³¨å…¥åˆ°<code>Vue</code>ä¸­ï¼Œå¦‚ä¸‹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span>;</span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    score: [</span><br><span class="line">      <span class="number">60</span>,</span><br><span class="line">      <span class="number">80</span>,</span><br><span class="line">      <span class="number">100</span></span><br><span class="line">    ],</span><br><span class="line">    enum: &#123;</span><br><span class="line">      <span class="number">60</span>: <span class="string">'åŠæ ¼'</span>,</span><br><span class="line">      <span class="number">80</span>: <span class="string">'è‰¯å¥½'</span>,</span><br><span class="line">      <span class="number">100</span>: <span class="string">'ä¼˜ç§€'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> store;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæˆ‘å®šä¹‰äº†ä¸¤ä¸ªå˜é‡ï¼Œä¸€ä¸ªæ˜¯<code>score</code>ï¼Œä¸€ä¸ªæ˜¯<code>enum</code>ï¼Œ<code>score</code>ä¸»è¦æ˜¯ä¸ºäº†å±•ç¤ºä¸€äº›å›ºå®šçš„å€¼åœ¨å‰ç«¯çš„å±•ç¤ºï¼Œè€Œ<code>enum</code>åˆ™æ˜¯å‡†å¤‡ä»‹ç»<code>filter</code>çš„ä½¿ç”¨</p><h3 id="æ–°å»ºä¸€ä¸ªVueé¡µé¢"><a href="#æ–°å»ºä¸€ä¸ªVueé¡µé¢" class="headerlink" title="æ–°å»ºä¸€ä¸ªVueé¡µé¢"></a>æ–°å»ºä¸€ä¸ªVueé¡µé¢</h3><p>åœ¨è¿™ä¸ªé¡µé¢é‡Œé¢ï¼Œä¸»è¦æ˜¯ä»‹ç»<code>store</code>çš„ç›´æ¥ä½¿ç”¨</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(item, index) of score"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">    &#123;&#123;item&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  computed: &#123;</span></span><br><span class="line"><span class="javascript">    ...mapState([<span class="string">'score'</span>])</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæŸ¥çœ‹é¡µé¢ï¼Œå°±ä¼šå‘ç°é¡µé¢ä¸Šå·²ç»å‡ºç°äº†ä¸‰ä¸ªåˆ†æ•°ï¼Œåˆ†åˆ«æ˜¯åœ¨<code>store</code>é‡Œé¢å®šä¹‰çš„60ï¼Œ80ï¼Œ100ã€‚è¿™ç§æ–¹å¼æ˜¯é€šè¿‡<code>...mapState</code>æ¥è·å–çš„<code>state</code>é‡Œé¢å®šä¹‰çš„ä¸€äº›å€¼ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼æœ‰å‡ ç§å¥½å¤„ï¼Œç¬¬ä¸€å°±æ˜¯å½“éœ€è¦æ”¹å˜å‰ç«¯æŸä¸€ä¸ªå­—æ®µçš„å€¼çš„æ—¶å€™ï¼Œåˆ™å¯ä»¥ç›´æ¥é€šè¿‡<code>store</code>ä»è€Œå‡å°‘å¯¹é¡¹ç›®çš„æ”¹åŠ¨ï¼Œå…¶äºŒå°±æ˜¯å¯ä»¥è®©å‰ç«¯é¡¹ç›®æ›´åŠ è§„èŒƒã€å¯æ‰©å±•ã€‚</p><h2 id="ä½¿ç”¨filteræ¥è¿›è¡Œä¸€äº›å€¼çš„å¤„ç†"><a href="#ä½¿ç”¨filteræ¥è¿›è¡Œä¸€äº›å€¼çš„å¤„ç†" class="headerlink" title="ä½¿ç”¨filteræ¥è¿›è¡Œä¸€äº›å€¼çš„å¤„ç†"></a>ä½¿ç”¨filteræ¥è¿›è¡Œä¸€äº›å€¼çš„å¤„ç†</h2><p>ä¸ºäº†å¤§å¤§æé«˜å‰ç«¯çš„å¯æ‰©å±•æ€§ï¼Œé€šè¿‡ä¼šå¯¹ä¸€äº›å›ºå®šçš„å€¼è¿›è¡Œè½¬æ¢ã€‚ä¾‹å¦‚æ€§åˆ«ï¼Œåç«¯å¯èƒ½ä¼šè¿”å› 0 æˆ–è€… 1ï¼Œè‹¥å‰ç«¯åœ¨æŸäº›é¡µé¢ä¸Šéœ€è¦æ˜¾ç¤ºä¸º<code>ç”·|å¥³</code>ï¼Œè€Œåœ¨æŸä¸€äº›é¡µé¢ä¸Šéœ€è¦æ˜¾ç¤º<code>å…ˆç”Ÿ|å¥³å£«</code>ï¼Œæ­¤æ—¶é€šè¿‡<code>filter</code>æ¥è¿›è¡Œå¤„ç†ï¼Œåˆ™æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><h3 id="æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å’Œjsæ–‡ä»¶"><a href="#æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å’Œjsæ–‡ä»¶" class="headerlink" title="æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å’Œjsæ–‡ä»¶"></a>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å’Œjsæ–‡ä»¶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---App.vue</span><br><span class="line">---main.js</span><br><span class="line">---store</span><br><span class="line">-----index.js</span><br><span class="line">---utils</span><br><span class="line">-----filter.js</span><br></pre></td></tr></table></figure><p>filter.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'../store/index'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">enumConvert</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> store.state.enum[val];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>main.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> filters <span class="keyword">from</span> <span class="string">'./utils/filter'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(filters).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">  Vue.filter(key, filters[key]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œé€šè¿‡<code>Vue.filter</code>å°†filteræ–¹æ³•è¿›è¡Œå…¨å±€æ³¨å†Œï¼Œç„¶ååœ¨<code>Vue</code>é¡µé¢è¿›è¡Œä½¿ç”¨<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"(item, index) of score"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">    &#123;&#123;item | convert&#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  computed: &#123;</span></span><br><span class="line"><span class="javascript">    ...mapState([<span class="string">'score'</span>])</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  filters: &#123;</span></span><br><span class="line"><span class="undefined">    convert (val) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> Vue.filter(<span class="string">'enumConvert'</span>)(val);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶é¡µé¢ä¸Šå°±ä¼šå±•ç¤º<code>åŠæ ¼</code>ï¼Œ<code>è‰¯å¥½</code>ï¼Œ<code>ä¼˜ç§€</code>äº†</p>]]></content>
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Vueä¸­nextTickçš„ä½¿ç”¨</title>
      <link href="/2019/05/20/Vue%E4%B8%ADnextTick%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2019/05/20/Vue%E4%B8%ADnextTick%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<p>è¿™æ®µæ—¶é—´ä¸€ç›´åœ¨è´Ÿè´£ä¸€ä¸ªå‰åç«¯é¡¹ç›®ï¼Œå‰ç«¯æ˜¯<code>Vue</code>+<code>ElemeUI</code>ï¼Œç”±äºè‡ªå·±ä¹‹å‰åªæ˜¯ä¼šç®€å•çš„ä½¿ç”¨ Vue çš„ä¸€äº›åˆçº§å‘½ä»¤ï¼Œè‡ªç„¶åªèƒ½æ…¢æ…¢çš„è¸©å‘ï¼Œç„¶åå†å‡ºå‘â€¦.ã€‚ä¾‹å¦‚<code>æ•°ç»„æ— æ³•è§¦å‘Vueçš„è§†å›¾æ›´æ–°</code></p><p>åˆšå¼€å§‹åœ¨ä½¿ç”¨ Vue çš„æ—¶å€™ï¼Œä¸€ç›´éƒ½æ˜¯åœ¨ <code>created</code> æ–¹æ³•é‡Œé¢è·å–åç«¯æ•°æ®è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ ·ç”¨èµ·æ¥å€’ä¹Ÿæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œåªä¸è¿‡ä»Šå¤©çªç„¶çœ‹åˆ°äº† Vue çš„<code>nextTick</code> æ–¹æ³•ï¼Œæ„Ÿè§‰æ¯”ä¹‹å‰åœ¨<code>created</code>é‡Œé¢è¯·æ±‚åç«¯æ›´åŠ é«˜çº§ã€‚æ‰€ä»¥é¡ºä¾¿ç ”ç©¶äº†ä¸€æ³¢ã€‚</p><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><p><code>nextTick</code>å¸¸ç”¨äºæ•°æ®æ›´æ–°åï¼Œä½†æ˜¯domå…ƒç´ è¿˜æœªå®Œæˆåˆ·æ–°ï¼Œå¦‚ä½•ç†è§£å‘¢? åœ¨ Vue é‡Œé¢ï¼Œæ›´æ–° DOM å…ƒç´ æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ä¿®æ”¹äº†æ•°æ®ä¹‹åï¼ŒDOMå…ƒç´ å¹¶ä¸ä¼šç«‹å³è¢«åˆ·æ–°ã€‚å‚è€ƒ<a href="https://cn.vuejs.org/v2/guide/reactivity.html#%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E9%98%9F%E5%88%97" target="_blank" rel="noopener">æ·±å…¥å“åº”å¼åŸç†</a></p><p>å¦‚ä¸‹Demo<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:id</span>=<span class="string">'id'</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"button"</span> @<span class="attr">click</span>=<span class="string">"nextClick"</span>&gt;</span>ç‚¹å‡»æµ‹è¯•<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="undefined">  data () &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      id: <span class="string">'q'</span></span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  mounted () &#123;</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  methods: &#123;</span></span><br><span class="line"><span class="undefined">    nextClick () &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.id = <span class="string">'m'</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> obj = <span class="built_in">document</span>.getElementById(<span class="keyword">this</span>.id);</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> one = <span class="built_in">document</span>.getElementById(_this.id);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(one);</span></span><br><span class="line"><span class="undefined">      &#125;);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(obj);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶ä½ åœ¨æ§åˆ¶å°ä¼šçœ‹åˆ°<code>obj</code>è·å–çš„æ˜¯nullï¼Œ<code>one</code>è·å–çš„domèŠ‚ç‚¹æ‰æ˜¯æ­£ç¡®çš„ã€‚</p><p><a href="https://stackoverflow.com/questions/47634258/what-is-nexttick-or-what-does-it-do-in-vuejs" target="_blank" rel="noopener">StackOverFlowå…³äºè¿™ä¸ªçš„å¦ä¸€ä¸ªè§£é‡Š</a></p>]]></content>
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JDK1.8ä¸‹ConcurrentHashMapçš„ä¸€äº›ç†è§£(ä¸€)</title>
      <link href="/2019/05/13/JDK1.8%E4%B8%8BConcurrentHashMap%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3(%E4%B8%80)/"/>
      <url>/2019/05/13/JDK1.8%E4%B8%8BConcurrentHashMap%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3(%E4%B8%80)/</url>
      <content type="html"><![CDATA[<p>åœ¨JDK1.8é‡Œé¢ï¼Œ<code>ConcurrentHashMap</code>åœ¨putæ–¹æ³•é‡Œé¢å·²ç»å°†åˆ†æ®µé”ç§»é™¤äº†ï¼Œè½¬è€Œæ˜¯CASé”å’Œsynchronized</p><p><code>ConcurrentHashMap</code>æ˜¯Javaé‡Œé¢åŒæ—¶å…¼é¡¾æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨çš„ä¸€ä¸ªé”®å€¼å¯¹é›†åˆï¼ŒåŒå±äºé”®å€¼å¯¹çš„é›†åˆè¿˜æœ‰<code>HashTable</code>ä»¥åŠ<code>HashMap</code>ï¼Œ<br><code>HashTable</code>æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œå› ä¸ºå®ƒçš„æ‰€æœ‰<code>public</code>æ–¹æ³•éƒ½è¢«<code>synchronized</code>ä¿®é¥°ï¼Œè¿™æ ·å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æ•ˆç‡å¤ªä½ã€‚</p><p>è™½ç„¶<code>HashMap</code>åœ¨<code>JDK1.8</code>çš„å¹¶å‘åœºæ™¯ä¸‹è§¦å‘æ‰©å®¹æ—¶ä¸ä¼šå‡ºç°æˆç¯äº†ï¼Œä½†æ˜¯ä¼šå‡ºç°æ•°æ®ä¸¢å¤±çš„æƒ…å†µã€‚<br>æ‰€ä»¥å¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹(å¤šè¯»å°‘å†™))ä½¿ç”¨Mapé›†åˆçš„è¯ï¼Œ<code>ConcurrentHashMap</code>æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p><p><code>ConcurrentHashMap</code>åœ¨JDK1.8çš„æ—¶å€™å°†put()æ–¹æ³•ä¸­çš„åˆ†æ®µé”<code>Segment</code>ç§»é™¤ï¼Œè½¬è€Œé‡‡ç”¨ä¸€ç§<code>CAS</code>é”å’Œ<code>synchronized</code>æ¥å®ç°æ’å…¥æ–¹æ³•çš„çº¿ç¨‹å®‰å…¨ã€‚<br>å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Implementation for put and putIfAbsent */</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//çœç•¥ç›¸å…³ä»£ç </span></span><br><span class="line">        <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">            Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh;</span><br><span class="line">            <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">                tab = initTable();</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,</span><br><span class="line">                             <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))</span><br><span class="line">                    <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">                tab = helpTransfer(tab, f);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                V oldVal = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                    <span class="comment">//çœç•¥ç›¸å…³ä»£ç </span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                        treeifyBin(tab, i);</span><br><span class="line">                    <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">                        <span class="keyword">return</span> oldVal;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨<code>JDK1.8</code>é‡Œé¢ï¼Œ<code>ConcurrentHashMap</code>æ˜¯ç›´æ¥é‡‡ç”¨<code>æ•°ç»„</code>+<code>é“¾è¡¨</code>+<code>çº¢é»‘æ ‘</code>æ¥å®ç°ï¼Œæ—¶é—´å¤æ‚åº¦åœ¨O(1)å’ŒO(n)ä¹‹é—´ï¼Œå¦‚æœé“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘äº†ï¼Œé‚£ä¹ˆå°±æ˜¯O(1)åˆ°O(nlogn)ã€‚<br>åœ¨è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œ<code>ConcurrentHashMap</code>ä¼šåˆ¤æ–­<code>tabAt(tab, i = (n - 1) &amp; hash)</code>æ˜¯ä¸æ˜¯ nullï¼Œæ˜¯çš„è¯å°±ç›´æ¥é‡‡ç”¨<code>CAS</code>è¿›è¡Œæ’å…¥ï¼Œè€Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™æ˜¯<code>synchronized</code>é”ä½å½“å‰<code>Node</code>çš„é¦–èŠ‚ç‚¹ï¼Œè¿™æ˜¯å› ä¸ºå½“è¯¥<code>Node</code>ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œè¯æ˜äº†æ­¤æ—¶å‡ºç°äº†<code>Hash</code>ç¢°æ’ï¼Œå°±ä¼šæ¶‰åŠåˆ°<code>é“¾è¡¨</code>çš„å°¾èŠ‚ç‚¹æ–°å¢æˆ–è€…<code>çº¢é»‘æ ‘</code>çš„èŠ‚ç‚¹æ–°å¢ä»¥åŠ<code>çº¢é»‘æ ‘</code>çš„å¹³è¡¡ï¼Œè¿™äº›æ“ä½œè‡ªç„¶éƒ½æ˜¯éåŸå­æ€§çš„ã€‚</p><p>ä»è€Œå¯¼è‡´æ— æ³•ä½¿ç”¨<code>CAS</code>ï¼Œå½“<code>Node</code>çš„å½“å‰ä¸‹æ ‡ä¸ºnullçš„æ—¶å€™ï¼Œç”±äºåªæ˜¯æ¶‰åŠæ•°ç»„çš„æ–°å¢ï¼Œæ‰€ä»¥ç”¨<code>CAS</code>å³å¯ã€‚</p><blockquote><p>å› ä¸ºCASæ˜¯ä¸€ç§åŸºäºç‰ˆæœ¬æ§åˆ¶çš„æ–¹å¼æ¥å®ç°ï¼Œè€Œç¢°æ’ä¹‹åçš„æ“ä½œå¤ªå¤šï¼Œæ‰€ä»¥ç›´æ¥ç”¨<code>synchronized</code>æ¯”è¾ƒåˆé€‚ã€‚</p></blockquote><h3 id="ConcurrentHashMapåœ¨è¿­ä»£æ—¶å’ŒHashMapçš„åŒºåˆ«"><a href="#ConcurrentHashMapåœ¨è¿­ä»£æ—¶å’ŒHashMapçš„åŒºåˆ«" class="headerlink" title="ConcurrentHashMapåœ¨è¿­ä»£æ—¶å’ŒHashMapçš„åŒºåˆ«"></a>ConcurrentHashMapåœ¨è¿­ä»£æ—¶å’ŒHashMapçš„åŒºåˆ«</h3><p>å½“ä¸€ä¸ªé›†åˆåœ¨è¿­ä»£çš„æ—¶å€™å¦‚æœåŠ¨æ€çš„æ·»åŠ æˆ–è€…åˆ é™¤å…ƒç´ ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡º<code>Concurrentmodificationexception</code>ï¼Œä½†æ˜¯åœ¨<code>ConcurrentHashMap</code>é‡Œé¢å´ä¸ä¼šï¼Œä¾‹å¦‚å¦‚ä¸‹ä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Map&lt;String,String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;String, String&gt;();</span><br><span class="line">    map.put(<span class="string">"a"</span>,<span class="string">"a1"</span>);</span><br><span class="line">    map.put(<span class="string">"b"</span>,<span class="string">"b1"</span>);</span><br><span class="line">    map.put(<span class="string">"c"</span>,<span class="string">"c1"</span>);</span><br><span class="line">    map.put(<span class="string">"d"</span>,<span class="string">"d1"</span>);</span><br><span class="line">    map.put(<span class="string">"e"</span>,<span class="string">"e1"</span>);</span><br><span class="line">    Iterator&lt;String&gt; iterator = map.keySet().iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">        String it = iterator.next();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"b"</span>.equals(it))&#123;</span><br><span class="line">            map.remove(<span class="string">"d"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(it);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">æ§åˆ¶å°æ‰“å°å¦‚ä¸‹ï¼š</span><br><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">e</span><br></pre></td></tr></table></figure></p><p>è€Œå½“ä½ æŠŠ<code>ConcurrentHashMap</code>æ¢æˆ<code>HashMap</code>çš„æ—¶å€™ï¼Œæ§åˆ¶å°å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> a</span><br><span class="line">b</span><br><span class="line">java.util.ConcurrentModificationException</span><br><span class="line">at java.util.HashMap$HashIterator.nextNode(HashMap.java:<span class="number">1442</span>)</span><br><span class="line">at java.util.HashMap$KeyIterator.next(HashMap.java:<span class="number">1466</span>)</span><br><span class="line">at xyz.somersames.ListTest.main(ListTest.java:<span class="number">22</span>)</span><br></pre></td></tr></table></figure></p><p>åŸå› åœ¨äº<code>ConcurrentHashMap</code>çš„<code>next</code>æ–¹æ³•å¹¶ä¸ä¼šå»æ£€æŸ¥<code>modCount</code>å’Œ<code>expectedModCount</code>ï¼Œä½†æ˜¯ä¼šæ£€æŸ¥ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ä¸ºç©º<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((p = next) == <span class="keyword">null</span>)</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br></pre></td></tr></table></figure></p><p>å½“æˆ‘ä»¬è¿›è¡Œremoveçš„æ—¶å€™ï¼Œ<code>ConcurrentHashMap</code>ä¼šç›´æ¥é€šè¿‡ä¿®æ”¹æŒ‡é’ˆçš„æ–¹å¼æ¥è¿›è¡Œç§»é™¤æ“ä½œï¼ŒåŒæ ·çš„ï¼Œä¹Ÿä¼šé”ä½<code>æ•°ç»„</code>çš„å¤´èŠ‚ç‚¹ç›´è‡³ç§»é™¤ç»“æŸï¼Œæ‰€ä»¥åœ¨åŒä¸€ä¸ªæ—¶åˆ»ï¼Œåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹<code>å½“å‰æ•°ç»„ä¸‹æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹</code>è¿›è¡Œæ“ä½œã€‚</p><p>ä½†æ˜¯åœ¨<code>HashMap</code>é‡Œé¢ï¼Œ<code>next</code>æ–¹æ³•ä¼šè¿›è¡Œä¸€ä¸ªcheckï¼Œè€Œremoveæ“ä½œä¼šä¿®æ”¹<code>modCount</code>ï¼Œå¯¼è‡´<code>modCount</code>å’Œ<code>expectedModCount</code>ä¸ç›¸ç­‰ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´<br><code>ConcurrentModificationException</code></p><p>ç¨å¾®ä¿®æ”¹ä¸‹ä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Map&lt;String,String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;String, String&gt;();</span><br><span class="line">    map.put(<span class="string">"a"</span>,<span class="string">"a1"</span>);</span><br><span class="line">    map.put(<span class="string">"b"</span>,<span class="string">"b1"</span>);</span><br><span class="line">    map.put(<span class="string">"c"</span>,<span class="string">"c1"</span>);</span><br><span class="line">    map.put(<span class="string">"d"</span>,<span class="string">"d1"</span>);</span><br><span class="line">    map.put(<span class="string">"e"</span>,<span class="string">"e1"</span>);</span><br><span class="line">    Iterator&lt;String&gt; iterator = map.keySet().iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"b"</span>.equals(iterator.next()))&#123;</span><br><span class="line">            map.remove(<span class="string">"d"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(iterator.next());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">æ§åˆ¶å°æ‰“å°å¦‚ä¸‹:</span><br><span class="line">b</span><br><span class="line">d</span><br><span class="line">Exception in thread <span class="string">"main"</span> java.util.NoSuchElementException</span><br><span class="line">at java.util.concurrent.ConcurrentHashMap$KeyIterator.next(ConcurrentHashMap.java:<span class="number">3416</span>)</span><br><span class="line">at com.xzh.ssmtest.ListTest.main(ListTest.java:<span class="number">25</span>)</span><br></pre></td></tr></table></figure></p><h3 id="å¹¶å‘ä¸‹çš„å¤„ç†"><a href="#å¹¶å‘ä¸‹çš„å¤„ç†" class="headerlink" title="å¹¶å‘ä¸‹çš„å¤„ç†"></a>å¹¶å‘ä¸‹çš„å¤„ç†</h3><p>ç”±äºæ¯ä¸€ä¸ª<code>Node</code>çš„é¦–èŠ‚ç‚¹éƒ½ä¼šè¢«<code>synchronized</code>ä¿®é¥°ï¼Œä»è€Œå°†ä¸€ä¸ªå…ƒç´ çš„æ–°å¢è½¬åŒ–ä¸ºä¸€ä¸ªåŸå­æ“ä½œï¼ŒåŒæ—¶<code>Node</code>çš„<code>value</code>å’Œ<code>next</code>éƒ½æ˜¯ç”±<code>volatile</code>å…³é”®å­—è¿›è¡Œä¿®é¥°ï¼Œä»è€Œå¯ä»¥ä¿è¯å¯è§æ€§ã€‚</p>]]></content>
      
      <categories>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å•ä¾‹æ¨¡å¼å¼•èµ·çš„ä¸€äº›æ€è€ƒ</title>
      <link href="/2019/05/04/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%BC%95%E8%B5%B7%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
      <url>/2019/05/04/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%BC%95%E8%B5%B7%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<p>å•ä¾‹æ¨¡å¼é€šå¸¸æœ‰é¥¿æ±‰å¼å’Œæ‡’æ±‰å¼ï¼Œæ‡’æ±‰å¼</p><h3 id="é¥¿æ±‰å¼"><a href="#é¥¿æ±‰å¼" class="headerlink" title="é¥¿æ±‰å¼"></a>é¥¿æ±‰å¼</h3><p>æ— çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleHungryStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleHungryStyle instince = <span class="keyword">new</span> SingleHungryStyle();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleHungryStyle <span class="title">getInstince</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instince;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h3><h4 id="å•çº¿ç¨‹ä¸‹"><a href="#å•çº¿ç¨‹ä¸‹" class="headerlink" title="å•çº¿ç¨‹ä¸‹"></a>å•çº¿ç¨‹ä¸‹</h4><blockquote><p>demo1</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLazyStyle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleLazyStyle instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleLazyStyle <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">            instance = <span class="keyword">new</span> SingleLazyStyle();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä¼šå‡ºç°å¤šä¸ªå®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¸€ä¸ªåŠ é”åˆ¤æ–­ã€‚</p><h4 id="å¤šçº¿ç¨‹ä¸‹"><a href="#å¤šçº¿ç¨‹ä¸‹" class="headerlink" title="å¤šçº¿ç¨‹ä¸‹"></a>å¤šçº¿ç¨‹ä¸‹</h4><blockquote><p>demo2</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLazy1Style</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingleLazy1Style instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleLazy1Style <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (SingleLazy1Style.class)&#123;</span><br><span class="line">            <span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">                instance = <span class="keyword">new</span> SingleLazy1Style();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹è¿è¡Œå¤šæ¬¡å¶å°”ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯CPUçš„é‡æ’åºä¼šå¯¼è‡´<code>instance</code>è¿˜æœªå®Œå…¨åˆå§‹åŒ–å°±è¢«ä½¿ç”¨äº†ã€‚</p><p>ä¾‹å¦‚:</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F.png" alt=""></p><p>æ­¤æ—¶<code>çº¿ç¨‹äºŒ</code>å°±æœ‰å¯èƒ½æŠ¥é”™ï¼Œå› ä¸ºJVMåœ¨è¿›è¡Œä¸€ä¸ªç±»çš„åˆå§‹åŒ–çš„æ—¶å€™æ˜¯åˆ†ä¸ºä¸‰æ­¥çš„ã€‚</p><p><code>Java SE 8</code>çš„JVMè§„èŒƒé‡Œé¢å¯¹ä¸€ä¸ªç±»çš„åŠ è½½è¿›è¡Œäº†è¯¦ç»†çš„æè¿°ï¼š<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html#jvms-5.2" target="_blank" rel="noopener">Java SE 8çš„JVMè§„èŒƒ</a>ã€‚<br>å…·ä½“æ¥è¯´å°±æ˜¯åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>Loading</li><li>Linking</li><li>Initializing</li></ul><h5 id="Creation-and-Loading"><a href="#Creation-and-Loading" class="headerlink" title="Creation and Loading"></a>Creation and Loading</h5><p>åœ¨è¿™ä¸€æ­¥ï¼ŒJVMéœ€è¦åˆ¤æ–­éœ€è¦åˆå§‹åŒ–çš„ç±»æ˜¯<code>æ•°ç»„</code>è¿˜æ˜¯ä¸€ä¸ª<code>æ™®é€šç±»</code>ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ™®é€šç±»çš„è¯ï¼Œå°±å†è¿›è¡Œåˆ¤æ–­æ˜¯éœ€è¦ä½¿ç”¨<code>bootstrap class loader</code>æ¥è¿›è¡ŒåŠ è½½è¿˜æ˜¯è¯´ç”¨<code>user-defined class loader</code>è¿›è¡ŒåŠ è½½ã€‚</p><h5 id="Linking"><a href="#Linking" class="headerlink" title="Linking"></a>Linking</h5><p>åœ¨è¿™ä¸€æ­¥ä¸»è¦æ˜¯<code>éªŒè¯</code>å’Œ<code>å‡†å¤‡</code></p><ul><li>Verification</li><li>Preparation</li><li>Resolution</li></ul><p>è€Œå°†æœªåˆå§‹åŒ–çš„å¼•ç”¨ç»‘å®šåˆ°å®ä¾‹ä¸Šå°±æ˜¯<code>Resolution</code>ã€‚å…·ä½“å¯ä»¥å‚è€ƒ:<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html" target="_blank" rel="noopener"> Java SE 8çš„JVMè§„èŒƒ 5.4.3</a></p><h5 id="Initializing"><a href="#Initializing" class="headerlink" title="Initializing"></a>Initializing</h5><p>åˆå§‹åŒ–ï¼Œå³å°†å­—æ®µè¿›è¡Œä¸€ä¸ªé»˜è®¤å€¼åˆå§‹åŒ–ã€‚</p><p>ä½†æ˜¯è¿™é‡Œå› ä¸º<code>Linking</code>å’Œ<code>Initializing</code>ä¹‹é—´å¹¶æ— ä»»ä½•çš„å…³è”æ€§ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´å…ˆè¿›è¡Œäº†ä¸€ä¸ªåˆå§‹åŒ–ï¼Œä½†æ˜¯å¹¶æœªå°†è¯¥å¼•ç”¨ç»‘å®šåˆ°å †çš„ä¸€ä¸ªå®ä¾‹ä¸Šï¼Œè€Œæ­¤æ—¶ç”±è½®åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚æ‰€ä»¥å°±ä¼šå¯¼è‡´å¦ä¸€ä¸ªçº¿ç¨‹è·å–çš„æ˜¯ç©ºå¯¹è±¡ã€‚</p><h4 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h4><p>ä½†æ˜¯åœ¨è¿™ä¸ªåˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œ<code>Linking</code>å’Œ<code>Initializing</code>ä¹‹é—´ç”±äºäº’ç›¸ä¸ä¾èµ–ï¼Œæ‰€ä»¥<code>CPU</code>å¯èƒ½ä¼šå…ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œä½†æ˜¯å¹¶æœªè¿›è¡Œ<code>å…³è”</code>ï¼Œå³å°†å¼•ç”¨å…³è”åˆ°JVMé‡Œé¢çš„ä¸€ä¸ªå®ä¾‹ã€‚è€Œç›´æ¥è¿”å›äº†ã€‚æ­¤æ—¶ç”±äº<code>happens-beforeåŸåˆ™</code>å¹¶ä¸èƒ½è·¨çº¿ç¨‹ï¼Œæ‰€ä»¥ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœçº¿ç¨‹ä¸€åœ¨çº¿ç¨‹äºŒä¹‹å‰ä½¿ç”¨äº†<code>instance</code>ï¼Œæ­¤æ—¶çº¿ç¨‹äºŒä½¿ç”¨<code>instance</code>ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜</li><li>å¦‚æœçº¿ç¨‹ä¸€åœ¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åé‡Šæ”¾äº†é”èµ„æºï¼Œç„¶åçº¿ç¨‹äºŒæ‰§è¡Œï¼Œå› ä¸ºçº¿ç¨‹äºŒåˆ¤æ–­<code>instance</code>å·²ç»è¢«åˆå§‹åŒ–äº†ï¼ˆä½†æ­¤æ—¶å®é™…ä¸Šå¹¶æœªLinkingï¼‰ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šæŠ¥é”™ã€‚</li></ul><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œç”±äº<code>CPUçš„é‡æ’åº</code>ï¼Œå¯¼è‡´<code>çº¿ç¨‹äºŒ</code>è·å–çš„<code>instance</code>å¯èƒ½å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸;</p><p>æ‰€ä»¥ä¸€èˆ¬ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä¼šåŠ ä¸€ä¸ª<code>volatile</code>å…³é”®å­—æ¥ç¦æ­¢å†…å­˜é‡æ’åºã€‚</p><blockquote><p>demo3</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleLazy2Style</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> SingleLazy2Style instance = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleLazy2Style <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SingleLazy2Style.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> SingleLazy2Style();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p>åœ¨è¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨<code>volatile</code>çš„ç‰¹æ€§ä¹‹ä¸€ï¼šé˜²æ­¢å†…å­˜è¿›è¡Œé‡æ’åºï¼ˆåŒ…å«å†™å±éšœå’Œè¯»å±éšœï¼‰</p><h3 id="happens-beforeåŸåˆ™"><a href="#happens-beforeåŸåˆ™" class="headerlink" title="happens-beforeåŸåˆ™"></a>happens-beforeåŸåˆ™</h3><p><a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.4.5" target="_blank" rel="noopener">Java SE 8ä¸­Happens-beforeåŸåˆ™</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Two actions can be ordered by a happens-before relationship. If one action happens-before another, then the first is visible to and ordered before the second.</span><br><span class="line"></span><br><span class="line">If we have two actions x and y, <span class="function">we write <span class="title">hb</span><span class="params">(x, y)</span> to indicate that x happens-before y.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">If x and y are actions of the same thread and x comes before y in program order, then <span class="title">hb</span><span class="params">(x, y)</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">There is a happens-before edge from the end of a constructor of an object to the start of a <span class="title">finalizer</span> <span class="params">(Â§<span class="number">12.6</span>)</span> <span class="keyword">for</span> that object.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">If an action x synchronizes-with a following action y, then we also have <span class="title">hb</span><span class="params">(x, y)</span>.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">If <span class="title">hb</span><span class="params">(x, y)</span> and <span class="title">hb</span><span class="params">(y, z)</span>, then <span class="title">hb</span><span class="params">(x, z)</span></span></span><br></pre></td></tr></table></figure><p><code>happens-beforeåŸåˆ™</code>è¦æ±‚åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ï¼Œé‡æ’åºåæ‰§è¡Œçš„ç»“æœä¸æœªé‡æ’åºä¹‹å‰çš„æ‰§è¡Œç»“æœå¿…é¡»ä¸€è‡´ã€‚æ‰€ä»¥åœ¨<code>demo1</code>ä¸­å•çº¿ç¨‹é‡Œé¢ï¼Œæ˜¯ä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜çš„ï¼Œå› ä¸ºå³ä½¿å‘ç”Ÿé‡æ’åºï¼Œæœ€ååœ¨ä½¿ç”¨<code>instance</code>çš„æ—¶å€™ï¼Œinstanceä¹Ÿä¸€å®šä¼šå®Œæˆåˆå§‹åŒ–ï¼Œå¦åˆ™å°±æ˜¯ç¼–è¯‘å™¨bugäº†ã€‚</p><p>ä½†æ˜¯åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œ<code>happens-before</code>åŸåˆ™æ— æ³•ç”Ÿæ•ˆï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´å…¶ä»–çº¿ç¨‹åœ¨è·å–å®ä¾‹çš„æ—¶å€™ä¼šå‡ºç°å¼‚å¸¸ã€‚</p><p>æ‰€ä»¥åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨<code>volatile</code>å…³é”®å­—è¿›è¡Œä¿®é¥°ï¼Œä¸»è¦æ˜¯å› ä¸ºéœ€è¦ç¡®ä¿é¦–ä¸ªåˆå§‹åŒ–çš„çº¿ç¨‹å¿…é¡»å®Œæˆæ•´ä¸ªç±»çš„åˆå§‹åŒ–çš„æ“ä½œã€‚</p>]]></content>
      
      <categories>
          
          <category> è®¾è®¡æ¨¡å¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¾è®¡æ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>JDK1.7å’Œ1.8ä¸­çš„HashMapåŒºåˆ«</title>
      <link href="/2019/04/08/JDK1-7%E5%92%8C1-8%E4%B8%AD%E7%9A%84HashMap%E5%8C%BA%E5%88%AB/"/>
      <url>/2019/04/08/JDK1-7%E5%92%8C1-8%E4%B8%AD%E7%9A%84HashMap%E5%8C%BA%E5%88%AB/</url>
      <content type="html"><![CDATA[<p>Jdk1.7å’Œ1.8ä¸­ï¼ŒHashMapçš„ä¸€äº›å…³é”®ç‚¹å‡ ä¹é‡å†™äº†ã€‚</p><h2 id="ä¸»è¦å˜æ›´ç‚¹ï¼š"><a href="#ä¸»è¦å˜æ›´ç‚¹ï¼š" class="headerlink" title="ä¸»è¦å˜æ›´ç‚¹ï¼š"></a>ä¸»è¦å˜æ›´ç‚¹ï¼š</h2><h3 id="1-hashæ‰°åŠ¨ç®—æ³•"><a href="#1-hashæ‰°åŠ¨ç®—æ³•" class="headerlink" title="1. hashæ‰°åŠ¨ç®—æ³•"></a>1. hashæ‰°åŠ¨ç®—æ³•</h3><p>åœ¨jdk1.7çš„æ—¶å€™ï¼ŒHahMapçš„hashæ‰°åŠ¨ç®—æ³•å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">int</span> h)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// This function ensures that hashCodes that differ only by</span></span><br><span class="line">    <span class="comment">// constant multiples at each bit position have a bounded</span></span><br><span class="line">    <span class="comment">// number of collisions (approximately 8 at default load factor).</span></span><br><span class="line">    h ^= (h &gt;&gt;&gt; <span class="number">20</span>) ^ (h &gt;&gt;&gt; <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">return</span> h ^ (h &gt;&gt;&gt; <span class="number">7</span>) ^ (h &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è€Œåœ¨jdk1.8çš„æ—¶å€™ï¼Œå…¶hashç®—æ³•å·²ç»ä¿®æ”¹ä¸ºå¦‚ä¸‹äº†:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>HashMapåœ¨æ”¾å…¥ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè·å–å…¶<code>HashCode</code>ï¼Œç„¶åå°† key çš„ HashCode è¿›è¡Œæ‰°åŠ¨ï¼Œé¿å…åŒä¸€ä¸ªç¢°æ’æ¦‚ç‡å¤ªå¤§ã€‚<br>å¦‚ä¸‹ä¾‹å­ã€‚</p><p>å‡è®¾ä¸€ä¸ªkey <code>a</code> çš„ hashCode ä¸º <code>1010 1010 1110 1101 1110 1111 1000 0110</code>ï¼Œå¦‚æœä¸è¿›è¡Œæ‰°åŠ¨ï¼Œé‚£ä¹ˆç›´æ¥ä¸tableçš„é•¿åº¦ -1 è¿›è¡Œ<strong>ä¸</strong>è¿ï¼Œè‹¥tableçš„é•¿åº¦æ˜¯16ï¼Œåˆ™è®¡ç®—çš„è¿‡ç¨‹å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1010</span> <span class="number">1010</span> <span class="number">1110</span> <span class="number">1101</span> <span class="number">1110</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0110</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1111</span></span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0110</span></span><br></pre></td></tr></table></figure></p><p>è®¡ç®—ç»“æœå¾—å‡ºï¼š <code>a</code> çš„æ•°ç»„ä¸‹æ ‡å°±æ˜¯ 6</p><p>ä½†æ˜¯è¿™æ ·å°±ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå³æ¯ä¸€æ¬¡æ¯”è¾ƒçš„éƒ½æ˜¯æœ€ä½ä½ï¼Œå¦‚æœæŸä¸€ä¸ª key å’Œ<code>a</code>çš„é«˜ä½ä¸åŒï¼Œä½ä½å´ç›¸åŒã€‚æ¯ä¸€æ¬¡éƒ½æ˜¯å–æœ€ä½ä½çš„å‡ ä¸ªæ•°å€¼è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå¾ˆä¸¥é‡çš„<code>hashç¢°æ’</code>ï¼Œæ‰€ä»¥å°±éœ€è¦è¿›è¡Œ<code>hash</code>æ‰°åŠ¨ä»¥å‡å°‘<code>hashç¢°æ’</code>çš„æ¦‚ç‡ã€‚</p><h3 id="ä»¥-jdk1-8-çš„æ‰°åŠ¨ç®—æ³•ä¸ºä¾‹"><a href="#ä»¥-jdk1-8-çš„æ‰°åŠ¨ç®—æ³•ä¸ºä¾‹" class="headerlink" title="ä»¥ jdk1.8 çš„æ‰°åŠ¨ç®—æ³•ä¸ºä¾‹"></a>ä»¥ jdk1.8 çš„æ‰°åŠ¨ç®—æ³•ä¸ºä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1010</span> <span class="number">1010</span> <span class="number">1110</span> <span class="number">1101</span> <span class="number">1110</span> <span class="number">1111</span> <span class="number">1000</span> <span class="number">0110</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1010</span> <span class="number">1010</span> <span class="number">1110</span> <span class="number">1101</span>  ^ &gt;&gt;&gt;<span class="number">16</span></span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="number">1010</span> <span class="number">1010</span> <span class="number">1110</span> <span class="number">1101</span> <span class="number">0101</span> <span class="number">0101</span> <span class="number">0110</span> <span class="number">1000</span></span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1111</span>  &amp;</span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">1000</span>   <span class="number">8</span></span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆè¿›è¡Œæ‰°åŠ¨åï¼Œç¢°æ’çš„æ¦‚ç‡ä¼šé™ä½ã€‚å…·ä½“çš„åŸå› å¯ä»¥é˜…è¯»è¿™è¾¹æ–‡ç« <br><a href="http://vanillajava.blogspot.com/2015/09/an-introduction-to-optimising-hashing.html" target="_blank" rel="noopener">An introduction to optimising a hashing strategy</a></p><h3 id="2-HashMapçš„æ•°æ®ç»“æ„å‡ºç°äº†å˜åŒ–"><a href="#2-HashMapçš„æ•°æ®ç»“æ„å‡ºç°äº†å˜åŒ–" class="headerlink" title="2. HashMapçš„æ•°æ®ç»“æ„å‡ºç°äº†å˜åŒ–"></a>2. HashMapçš„æ•°æ®ç»“æ„å‡ºç°äº†å˜åŒ–</h3><p>åœ¨ jdk1.7çš„æ—¶å€™ï¼ŒHashMapæ˜¯ç”±ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªé“¾è¡¨æ„æˆçš„ã€‚<br>æ’å…¥è§„åˆ™å¦‚ä¸‹ï¼š</p><ol><li>è®¡ç®—æ–°æ’å…¥çš„ key çš„ hashCodeï¼Œç„¶åé€šè¿‡ hashCode è®¡ç®—ç´¢å¼•ï¼Œæ‰¾å‡ºè¯¥keyåœ¨<code>Entry</code>ä¸­çš„ä½ç½®ï¼Œç„¶ååˆ¤æ–­è¯¥ä¸‹æ ‡æ˜¯å¦æœ‰å…ƒç´ ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç›´æ¥è¿›è¡Œæ’å…¥ã€‚</li></ol><ol start="2"><li>å¦‚æœæœ‰çš„è¯å°±æŒ‰ç…§å¦‚ä¸‹è§„åˆ™æ‰¾å‡ºæ˜¯å¦æœ‰ç›¸åŒçš„ keyï¼š<blockquote><p>hashç›¸åŒä¸”keyç›¸åŒ<br>hashç›¸åŒä¸”equalsæ–¹æ³•è¿”å›ç›¸åŒ</p></blockquote></li></ol><p>è‹¥ç›¸åŒï¼Œåˆ™ç›´æ¥å°†å½“å‰çš„ value æ›¿æ¢åŸæ¥çš„ valueã€‚</p><ol start="3"><li>å¦‚æœæœ€åè¿˜æ˜¯æœªå‘ç°ç›¸åŒçš„ key ï¼Œåˆ™æ–°å»ºä¸€ä¸ª<code>Entry</code> ï¼Œå¹¶å°†å¤´èŠ‚ç‚¹è®¾ç½®ä¸ºè¯¥<code>Entry</code>ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment">    * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment">    * value is replaced.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment">    *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">    *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment">    *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">           <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">       <span class="keyword">int</span> hash = hash(key.hashCode());</span><br><span class="line">       <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">       <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">           Object k;</span><br><span class="line">           <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">               V oldValue = e.value;</span><br><span class="line">               e.value = value;</span><br><span class="line">               e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">               <span class="keyword">return</span> oldValue;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       modCount++;</span><br><span class="line">       addEntry(hash, key, value, i);</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">       Entry&lt;K,V&gt; e = table[bucketIndex]; <span class="comment">//æ‰¾å‡ºåŸæ¥tableä¸­çš„å…ƒç´ </span></span><br><span class="line">       table[bucketIndex] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">       <span class="keyword">if</span> (size++ &gt;= threshold)</span><br><span class="line">           resize(<span class="number">2</span> * table.length);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">//æ³¨æ„ï¼Œæ­¤æ—¶å°†è¯¥èŠ‚ç‚¹æ˜¯ä½œä¸ºç°åœ¨çš„tableçš„å¤´èŠ‚ç‚¹ï¼ŒåŸæ¥çš„eåˆ™æ˜¯æ–°èŠ‚ç‚¹çš„next</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Creates new entry.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       Entry(<span class="keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">           value = v;</span><br><span class="line">           next = n;</span><br><span class="line">           key = k;</span><br><span class="line">           hash = h;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></li></ol><p>ä»¥ä¸‹æ˜¯åœ¨ jdk1.7 çš„æ—¶å€™ç¬¬ä¸‰ç§æ–¹å¼æ’å…¥çš„æç®€ç‰ˆï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/HashMap1.7.png" alt=""></p><h4 id="è€Œåœ¨-jdk1-8-çš„æ—¶å€™ï¼Œåˆ™æ˜¯ç”±ä¸€ä¸ªæ•°ç»„åŠ ä¸€ä¸ªé“¾è¡¨ã€çº¢é»‘æ ‘ç»„æˆ"><a href="#è€Œåœ¨-jdk1-8-çš„æ—¶å€™ï¼Œåˆ™æ˜¯ç”±ä¸€ä¸ªæ•°ç»„åŠ ä¸€ä¸ªé“¾è¡¨ã€çº¢é»‘æ ‘ç»„æˆ" class="headerlink" title="è€Œåœ¨ jdk1.8 çš„æ—¶å€™ï¼Œåˆ™æ˜¯ç”±ä¸€ä¸ªæ•°ç»„åŠ ä¸€ä¸ªé“¾è¡¨ã€çº¢é»‘æ ‘ç»„æˆ"></a>è€Œåœ¨ jdk1.8 çš„æ—¶å€™ï¼Œåˆ™æ˜¯ç”±ä¸€ä¸ªæ•°ç»„åŠ ä¸€ä¸ªé“¾è¡¨ã€çº¢é»‘æ ‘ç»„æˆ</h4><p>ä¹‹æ‰€ä»¥è¿™æ ·æ”¹è¿›ï¼Œæ˜¯å› ä¸ºåœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ‰€æœ‰çš„å…ƒç´ éƒ½ hash åˆ°äº†ä¸€ä¸ªä¸‹æ ‡ï¼Œé‚£ä¹ˆè¿™æ ·çš„è¯ï¼ŒHashMapåœ¨æŸ¥æ‰¾å…ƒç´ çš„æ—¶å€™å°±ä¼šé€€åŒ–åˆ°ä¸€ä¸ªé“¾è¡¨ï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯<code>O(n)</code>ã€‚</p><p>ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒHashMapåœ¨1.8çš„æ—¶å€™ä¼šåˆ¤æ–­é“¾è¡¨ä¸Šçš„å…ƒç´ ï¼Œå¦‚æœè¶…è¿‡äº† <code>8</code> ä¸ªï¼Œå°±ä¼šå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ã€‚åŒæ—¶åœ¨ 1.8 çš„æ—¶å€™ï¼ŒHashMapå°†é“¾è¡¨çš„æ’å…¥æ–¹å¼ä¿®æ”¹ä¸ºå°¾æ’å…¥ã€‚</p><blockquote><p>æç¤ºï¼šä¿®æ”¹ä¸ºå°¾æ’å…¥æ˜¯ä¸ºäº†é¿å…åœ¨å¹¶å‘çš„æƒ…å†µä¸‹å‡ºç°é“¾è¡¨æˆç¯ï¼ˆåœ¨jdk1.7ä¹‹å‰ä¼šå‡ºç°ã€åŒæ—¶HashMapå¹¶ä¸é€‚ç”¨å¹¶å‘åœºæ™¯ä¸‹ï¼‰</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//......çœç•¥ç›¸å…³ä»£ç </span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                     <span class="comment">// åœ¨æœªèŠ‚ç‚¹è¿›è¡Œæ’å…¥</span></span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1stã€‚å¦‚æœå¤§äº8ï¼Œåˆ™ä¼šå°†é“¾è¡¨è½¬ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„å˜åŠ¨æœ€å¤§ç‚¹åœ¨äºè¿™ä¸¤è¡Œä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">    treeifyBin(tab, hash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¬¬ä¸€è¡Œæ˜¯è¿›è¡Œå°¾æ’å…¥(1.7æ˜¯å¤´æ’å…¥)</p><p>ç¬¬äºŒè¡Œæ˜¯å¤§äº8ä¼šè¿›è¡Œé“¾è¡¨åˆ°çº¢é»‘æ ‘çš„è½¬åŒ–</p><h3 id="jdk1-7é‡‡ç”¨å¤´èŠ‚ç‚¹æ’å…¥å¯¼è‡´çš„é“¾è¡¨æˆç¯"><a href="#jdk1-7é‡‡ç”¨å¤´èŠ‚ç‚¹æ’å…¥å¯¼è‡´çš„é“¾è¡¨æˆç¯" class="headerlink" title="jdk1.7é‡‡ç”¨å¤´èŠ‚ç‚¹æ’å…¥å¯¼è‡´çš„é“¾è¡¨æˆç¯"></a>jdk1.7é‡‡ç”¨å¤´èŠ‚ç‚¹æ’å…¥å¯¼è‡´çš„é“¾è¡¨æˆç¯</h3><p>è™½ç„¶<code>HashMap</code>æ˜¯ä¸€ä¸ªéçº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨ jdk1.7 ç‰ˆæœ¬ä¸­å°†HashMapç”¨äºå¹¶å‘ç¯å¢ƒä¸‹ä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">        Entry[] oldTable = table;</span><br><span class="line">        <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line">        <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];</span><br><span class="line">        transfer(newTable);</span><br><span class="line">        table = newTable;</span><br><span class="line">        threshold = (<span class="keyword">int</span>)(newCapacity * loadFactor);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// jdk1.7 æ‰©å®¹ä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable)</span> </span>&#123;</span><br><span class="line">        Entry[] src = table;</span><br><span class="line">        <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; src.length; j++) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; e = src[j];</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</span><br><span class="line">                src[j] = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">                    <span class="keyword">int</span> i = indexFor(e.hash, newCapacity);</span><br><span class="line">                    e.next = newTable[i];</span><br><span class="line">                    newTable[i] = e;</span><br><span class="line">                    e = next;</span><br><span class="line">                &#125; <span class="keyword">while</span> (e != <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h5 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h5><hr><p><strong>æ­¤æ—¶å‡è®¾çº¿ç¨‹äºŒå·²ç»å°†hashMapæ‰©å®¹å®Œæ¯•ï¼Œä½†æ˜¯çº¿ç¨‹ä¸€è¿˜åœ¨è¢«æŒ‚èµ·ã€‚</strong><br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/hashMap1.0.png" alt=""></p><p>çº¿ç¨‹ä¸€æ‰§è¡Œï¼Œæ­¤æ—¶ <code>e</code>æ˜¯ä¸º1ï¼Œnextå´æ˜¯2ã€‚</p><hr><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/HshMap%E7%BA%BF%E7%A8%8B%E4%B8%80%E7%AC%AC%E4%B8%80%E6%AC%A1transfer.png" alt=""></p><p>çº¿ç¨‹ä¸€ç¬¬ä¸€æ¬¡å¾ªç¯æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤æ—¶çš„<code>e</code>æ˜¯2ï¼Œç„¶å`e.nextæ˜¯3ã€‚</p><hr><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/HashMap%E7%BA%BF%E7%A8%8B%E4%B8%80%E7%AC%AC%E4%BA%8C%E6%AC%A1%E6%89%A7%E8%A1%8C.png" alt=""></p><p>çº¿ç¨‹ä¸€ç¬¬äºŒæ¬¡å¾ªç¯æ‰§è¡Œå®Œæ¯•ï¼Œæ­¤æ—¶çš„<code>e</code>æ˜¯3ï¼Œç„¶å<code>e.nextæ˜¯1</code>ï¼Œæ³¨æ„æ­¤æ—¶<strong>çº¿ç¨‹äºŒ</strong>ä¸­ï¼Œå·²ç»å°† <code>3</code> çš„nextæŒ‡å‘äº† <code>1</code> ï¼Œæ‰€ä»¥æ­¤æ—¶<code>e</code>æ˜¯3ï¼Œç„¶å <code>next</code> æ˜¯1ã€‚</p><hr><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/HashMap%E7%BA%BF%E7%A8%8B%E4%B8%80%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%BE%AA%E7%8E%AF.png" alt=""></p><p>æ­¤æ—¶ç¬¬ä¸‰æ¬¡å¾ªç¯å®Œæ¯•ï¼Œç”±äº<code>e</code>è¿˜ä¸ä¸ºç©ºï¼Œäºæ˜¯è¿›è¡Œç¬¬å››æ¬¡å¾ªç¯(<strong>ä¸»è¦åŸå› æ˜¯çº¿ç¨‹äºŒå·²ç»å°†<code>3</code>çš„nextæŒ‡å‘ä¸º<code>1</code></strong>)ã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/HashMap%E7%BA%BF%E7%A8%8B%E4%B8%80%E5%BE%AA%E7%8E%AF%E5%AE%8C%E6%AF%95.png" alt=""></p><p>ç”±äº<code>1</code>çš„ next æ˜¯ nullï¼Œæ‰€ä»¥å¾ªç¯ç»“æŸã€‚</p><h3 id="jdk1-8çš„å°¾èŠ‚ç‚¹æ’å…¥"><a href="#jdk1-8çš„å°¾èŠ‚ç‚¹æ’å…¥" class="headerlink" title="jdk1.8çš„å°¾èŠ‚ç‚¹æ’å…¥"></a>jdk1.8çš„å°¾èŠ‚ç‚¹æ’å…¥</h3><p>ç”±ä¸Šé¢çš„åˆ†æå¯ä»¥ä¸éš¾å‘ç°ï¼Œé€ æˆé“¾è¡¨æˆç¯çš„ä¸»è¦åŸå› ä¸ºï¼šå¤šçº¿ç¨‹ä¸‹ï¼Œå¤´èŠ‚ç‚¹æ’å…¥å¯¼è‡´åŸæ¥çš„é“¾è¡¨çš„å°¾èŠ‚ç‚¹æœ‰äº†<code>next</code>ï¼Œæ‰€ä»¥æœ€åä¼šå¤šå¾ªç¯ä¸€éï¼Œä»è€Œæˆç¯ã€‚</p><p>è€Œåœ¨jdk1.8é‡‡ç”¨çš„ä¸ºèŠ‚ç‚¹æ’å…¥åœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œé¡¶å¤šæ˜¯å¦ä¸€ä¸ªçº¿ç¨‹æŠŠå‰é¢ä¸€ä¸ªçº¿ç¨‹ resize çš„è¿‡ç¨‹å†é‡å¤ä¸€éï¼Œå´ä¸ä¼šå†å‡ºç°é“¾è¡¨æˆç¯ã€‚</p><h3 id="å¤šçº¿ç¨‹ä¸‹é€šç”¨çš„bug"><a href="#å¤šçº¿ç¨‹ä¸‹é€šç”¨çš„bug" class="headerlink" title="å¤šçº¿ç¨‹ä¸‹é€šç”¨çš„bug"></a>å¤šçº¿ç¨‹ä¸‹é€šç”¨çš„bug</h3><p>è™½ç„¶ jdk1.8 ä¿®å¤äº†é“¾è¡¨æˆç¯è¿™ä¸€ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å¯¼è‡´çš„<code>æ•°æ®ä¸¢å¤±</code>é—®é¢˜ç¡®å®ä¸€ç›´å­˜åœ¨çš„ã€‚</p><p>æ‰€ä»¥ä¸è¦å°è¯•åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä½¿ç”¨<code>HashMap</code>ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°<code>Map</code>ç»“æ„çš„è¯ï¼Œå¯ä»¥ç”¨<code>CurrentHashMap</code>æˆ–è€…<code>HashTable</code></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaé›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaé›†åˆå­¦ä¹ ä¹‹HashSet</title>
      <link href="/2019/04/04/Java%E9%9B%86%E5%90%88%E5%AD%A6%E4%B9%A0%E4%B9%8BHashSet/"/>
      <url>/2019/04/04/Java%E9%9B%86%E5%90%88%E5%AD%A6%E4%B9%A0%E4%B9%8BHashSet/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨ä¸€èˆ¬çš„ä½¿ç”¨ä¸­ï¼ŒHashSetç»å¸¸ç”¨äºæ•°æ®çš„å»é‡ï¼Œä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªListï¼Œè¿™ä¸ªListé‡Œé¢æœ‰ä¸€äº›é‡å¤çš„æ•°æ®ï¼Œäºæ˜¯æˆ‘ä»¬ä¾¿å¯ä»¥è¿™æ ·æ“ä½œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">list.add(<span class="string">"a"</span>);</span><br><span class="line">list.add(<span class="string">"b"</span>);</span><br><span class="line">list.add(<span class="string">"c"</span>);</span><br><span class="line">list.add(<span class="string">"a"</span>);</span><br><span class="line">Set&lt;String&gt; set =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">set.addAll(list);</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶ï¼Œåœ¨Seté‡Œé¢ï¼Œåªä¼šæœ‰ä¸€ä¸ª<code>a</code>å…ƒç´ ã€‚</p><h2 id="åº•å±‚"><a href="#åº•å±‚" class="headerlink" title="åº•å±‚"></a>åº•å±‚</h2><p>å…¶å®<code>HashSet</code>çš„åº•å±‚æ˜¯ä¸€ä¸ª<code>HashMap</code>ï¼Œ<code>HashSet</code>çš„å»é‡ä½¿ç”¨äº†<code>HashMap</code>çš„<code>Key</code>ã€‚<br>å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/HashSet%E5%BA%95%E5%B1%82.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Adds the specified element to this set if it is not already present.</span></span><br><span class="line"><span class="comment"> * More formally, adds the specified element &lt;tt&gt;e&lt;/tt&gt; to this set if</span></span><br><span class="line"><span class="comment"> * this set contains no element &lt;tt&gt;e2&lt;/tt&gt; such that</span></span><br><span class="line"><span class="comment"> * &lt;tt&gt;(e==null&amp;nbsp;?&amp;nbsp;e2==null&amp;nbsp;:&amp;nbsp;e.equals(e2))&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> * If this set already contains the element, the call leaves the set</span></span><br><span class="line"><span class="comment"> * unchanged and returns &lt;tt&gt;false&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> e element to be added to this set</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &lt;tt&gt;true&lt;/tt&gt; if this set did not already contain the specified</span></span><br><span class="line"><span class="comment"> * element</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>HashSetçš„<code>add</code>æ–¹æ³•æ˜¯å‘ä¸€ä¸ªmapé‡Œé¢æ”¾å…¥å…ƒç´ ï¼Œè€Œ<code>HashMap</code>åˆ™æ˜¯ä¸å…è®¸é”®é‡å¤ï¼Œæ‰€ä»¥å°±å¯ä»¥ç¡®ä¿åœ¨<code>HashMap</code>ä¸Šçš„é”®éƒ½æ˜¯ä¸é‡å¤çš„ã€‚</p><h2 id="HashMapæ˜¯å¦‚ä½•ç¡®ä¿æ¯ä¸€ä¸ªå¯¹è±¡éƒ½åªæœ‰ä¸€ä¸ªçš„å‘¢"><a href="#HashMapæ˜¯å¦‚ä½•ç¡®ä¿æ¯ä¸€ä¸ªå¯¹è±¡éƒ½åªæœ‰ä¸€ä¸ªçš„å‘¢" class="headerlink" title="HashMapæ˜¯å¦‚ä½•ç¡®ä¿æ¯ä¸€ä¸ªå¯¹è±¡éƒ½åªæœ‰ä¸€ä¸ªçš„å‘¢?"></a>HashMapæ˜¯å¦‚ä½•ç¡®ä¿æ¯ä¸€ä¸ªå¯¹è±¡éƒ½åªæœ‰ä¸€ä¸ªçš„å‘¢?</h2><p>é¦–å…ˆå½“è°ƒç”¨<code>HashSet</code>çš„addæ–¹æ³•çš„æ—¶å€™ï¼Œå…¶å®æ˜¯è°ƒç”¨HashMapçš„<code>put</code>æ–¹æ³•ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Associates the specified value with the specified key in this map.</span></span><br><span class="line"><span class="comment">    * If the map previously contained a mapping for the key, the old</span></span><br><span class="line"><span class="comment">    * value is replaced.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> value value to be associated with the specified key</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> the previous value associated with &lt;tt&gt;key&lt;/tt&gt;, or</span></span><br><span class="line"><span class="comment">    *         &lt;tt&gt;null&lt;/tt&gt; if there was no mapping for &lt;tt&gt;key&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">    *         (A &lt;tt&gt;null&lt;/tt&gt; return can also indicate that the map</span></span><br><span class="line"><span class="comment">    *         previously associated &lt;tt&gt;null&lt;/tt&gt; with &lt;tt&gt;key&lt;/tt&gt;.)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ–¹æ³•æ— éæ˜¯å…ˆå°†è¿™ä¸ªkeyè¿›è¡Œhashï¼Œç„¶åå†è°ƒç”¨<code>putVal</code>æ–¹æ³•è¿›è¡Œä¿å­˜ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ˜¯<code>HashMap</code>çš„åº•å±‚æ–¹æ³•ï¼Œå½“é¦–æ¬¡ä¼ å…¥å€¼çš„æ—¶å€™ï¼Œ</p><blockquote><p>   if ((tab = table) == null || (n = tab.length) == 0){<br>           n = (tab = resize()).length;}</p></blockquote><p>å¦‚æœtableæœªç©ºå°±è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æœä¸ä¸ºç©ºåˆ™æ‰§è¡Œä¸‹é¢çš„ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Node&lt;K,V&gt; e; K k;</span><br><span class="line"><span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">    ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">    e = p;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">    e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                treeifyBin(tab, hash);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">            ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        p = e;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨HashMapé‡Œé¢ï¼Œæœ‰ä¸€ä¸ªæ•°ç»„<code>table</code>å­˜æ”¾ç€æ‰€æœ‰çš„<code>key</code>ï¼Œè€Œ HashMap å®šä½ä¸‹æ ‡çš„æ–¹å¼å°±æ˜¯é€šè¿‡<code>(n - 1) &amp; hash</code>ã€‚</p><p>å½“HashMapå‘ç°è¯¥ä¸‹æ ‡çš„å€¼æ˜¯<code>null</code>ï¼Œå°±ä¼šç›´æ¥å°†å…¥å‚çš„<code>key</code>å’Œ<code>value</code>ç–¯è½¬æˆä¸€ä¸ªNodeä¿å­˜è¿›å»ï¼Œå¦‚æœå‘ç°ä¸æ˜¯<code>null</code>ï¼Œåˆ™<code>HashMap</code>è®¤ä¸ºå‘ç”Ÿäº†<code>HashMap</code>ç¢°æ’ï¼Œäºæ—¶è¿›è¡Œå¦‚ä¸‹åˆ¤æ–­:</p><p>å¦‚æœæ–°ä¼ å…¥çš„ä¸€ä¸ªkeyåœ¨<code>HashMap</code>ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™<code>HashMap</code>ä¼šç›´æ¥å°†æ—§çš„keyçš„valueæ›¿æ¢æ‰ã€‚å¦åˆ™å°±ä¼šè¿›è¡Œæ–°å¢<br>HashMapåœ¨åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦ç›¸ç­‰ä¼šé‡‡å–ä»¥ä¸‹æªæ–½ï¼š</p><p><strong>å¦‚æœä¸¤ä¸ªKeyçš„hashä¸åŒï¼Œåˆ™HashMapç›´æ¥ä¼šåˆ¤æ–­keyä¸ç­‰</strong></p><ol><li>Keyå’Œhashå®Œå…¨ç›¸åŒ<blockquote><p>ç¬¬ä¸€æ¬¡ä¼ å…¥key=aï¼ŒHashå€¼æ˜¯1ï¼Œvalueæ˜¯100;<br>ç¬¬äºŒæ¬¡ä¼ å…¥key=aï¼ŒHashå€¼æ˜¯1ï¼Œvalueæ˜¯101;</p></blockquote></li></ol><p>æ­¤æ—¶hashMapä¼šè®¤ä¸ºæ–°ä¼ å…¥çš„keyå·²ç»å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šå°†æ—§çš„valueæ›¿æ¢ä¸ºæ–°çš„value</p><p><strong>äº§ç”ŸHashç¢°æ’ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªkeyçš„hashéƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±ä¼šé€šè¿‡keyæ˜¯å¦ç›¸åŒæˆ–è€…equalsæ–¹æ³•åˆ¤æ–­å¯¹è±¡æ˜¯å¦ç›¸ç­‰äº†</strong></p><ol start="2"><li>Keyä¸åŒï¼Œhashç›¸åŒ </li></ol><p>HashMapä¼šåˆ¤æ–­ä¼ å…¥çš„keyã€ä»¥åŠkeyçš„hashå€¼ï¼Œå¦‚æœç›¸ç­‰åˆ™è®¤ä¸ºè¯¥é”®ä»¥ç›¸ç­‰ï¼Œä¾‹å¦‚:</p><blockquote><p>ç¬¬ä¸€æ¬¡ä¼ å…¥key:aï¼ŒHashå€¼æ˜¯1;<br>ç¬¬äºŒæ¬¡ä¼ å…¥key:bï¼ŒHashå€¼æ˜¯1;</p></blockquote><p>è¿™ä¸ªæ—¶å€™ç”±äºkeyä¸åŒï¼ŒhashMapè¿˜ä¼šé€šè¿‡equalsç»§ç»­åˆ¤æ–­ã€‚</p><ol start="3"><li>ç”±äºç¬¬äºŒæ¬¡ä¼ å…¥çš„keyæ˜¯<code>b</code>ï¼Œä½†æ˜¯ä»–ä»¬çš„Keyå¹¶ä¸ç›¸ç­‰ï¼Œæ­¤æ—¶<code>HashMap</code>å°±ä¼šè°ƒç”¨ä»–ä»¬çš„<code>equals</code>æ–¹æ³•ï¼Œå¦‚æœé€šè¿‡<code>equals</code>æ–¹æ³•åˆ¤æ–­çš„æ˜¯ç›¸åŒå¯¹è±¡ï¼Œåˆ™ä¹Ÿä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªkeyã€‚</li></ol><p>æ­¤æ—¶å¦‚æœåˆ¤æ–­æ–°å¢çš„keyç¡®å®ä¸å­˜åœ¨å°±ä¼šåœ¨å½“å‰çš„tableä½ç½®é€šè¿‡é“¾è¡¨åœ°å€æ–¹æ³•è¾›å¢ä¸€ä¸ªkeyäº†ã€‚</p><p>é‚£ä¹ˆåˆ°è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®<code>HashSet</code>å°±æ˜¯å®Œå…¨çš„åˆ©ç”¨äº†<code>HashMap</code>çš„é”®çš„ç‰¹æ€§æ¥è¿›è¡Œå»é‡ã€‚</p><h2 id="Iteratoræ–¹æ³•"><a href="#Iteratoræ–¹æ³•" class="headerlink" title="Iteratoræ–¹æ³•"></a>Iteratoræ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Returns an iterator over the elements in this set.  The elements</span></span><br><span class="line"><span class="comment">  * are returned in no particular order.</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> an Iterator over the elements in this set</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@see</span> ConcurrentModificationException</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> map.keySet().iterator();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>å…¶å®éƒ½æ˜¯åˆ©ç”¨äº†<code>hashMap</code>çš„ä¸€äº›æ–¹æ³•æ¥å®ç°</p><h2 id="çº¿ç¨‹ä¸å®‰å…¨"><a href="#çº¿ç¨‹ä¸å®‰å…¨" class="headerlink" title="çº¿ç¨‹ä¸å®‰å…¨"></a>çº¿ç¨‹ä¸å®‰å…¨</h2><p>ç”±äºHshMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œè‡ªç„¶HashSetä¹Ÿä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSetTest</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    Set&lt;Integer&gt; set =<span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;<span class="number">10000</span>;i++)&#123;</span><br><span class="line">            set.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashSetTestMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        HashSetTest hashSetTest =<span class="keyword">new</span> HashSetTest();</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(hashSetTest);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(hashSetTest);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br><span class="line">        System.out.println(hashSetTest.set.size());</span><br><span class="line">        Set&lt;Integer&gt; set =<span class="keyword">new</span> HashSet&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span>(Integer i :hashSetTest.set)&#123;</span><br><span class="line">            <span class="keyword">if</span>(set.contains(i))&#123;</span><br><span class="line">                System.out.println(i);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                set.add(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºæ¥çš„ç»“æœä¼šå¤šäº<code>10000</code>ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¸Šé¢ä¹Ÿè¯´åˆ°è¿‡çš„ï¼ŒHashMapåœ¨åˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦ç›¸åŒä»¥åŠåç»­æ–°å¢èŠ‚ç‚¹çš„æ—¶å€™å¹¶éæ˜¯ä¸€ä¸ªåŸå­æ€§çš„ï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½ä¼šå¯¼è‡´<code>t1</code>çº¿ç¨‹åˆšå¥½åˆ¤æ–­10ä¸åœ¨hashMapä¸­ï¼Œå‡†å¤‡æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ä¸º10ã€‚ç»“æœæ­¤æ—¶t1è¢«æŒ‚èµ·ï¼Œt2æ‰§è¡Œï¼Œä½†æ˜¯t2ä¹Ÿåˆ¤æ–­äº†10ä¸åœ¨hashMapä¸­ï¼Œä¹Ÿå‡†å¤‡æ–°å¢ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå‡ºç°æ–°å¢äº†ä¸¤ä¸ªä¸€æ‘¸ä¸€æ ·çš„Keyã€‚è¿™æ ·å°±ä¼šå¯¼è‡´<code>Set</code>é›†åˆä¸­å‡ºç°äº†é‡å¤çš„æ•°æ®ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaé›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Springä¸­AOPçš„æ¢ç´¢ä¸å®è·µ(äºŒ)ä¹‹Mongoå¤šæ•°æ®æºåˆ‡æ¢</title>
      <link href="/2019/03/13/Spring%E4%B8%ADAOP%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5(%E4%BA%8C)%E4%B9%8BMongo%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/"/>
      <url>/2019/03/13/Spring%E4%B8%ADAOP%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5(%E4%BA%8C)%E4%B9%8BMongo%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/</url>
      <content type="html"><![CDATA[<p>åœ¨ä¹‹å‰çš„ä¸€ç‰‡æ–‡ç« ä¸­ä»‹ç»äº†ä½¿ç”¨AOPçš„æ–¹å¼æ¥å®ç°Redisçš„å¤šæ•°æ®æºåˆ‡æ¢ã€‚è€Œä»Šå¤©è¿™ä¸€ç¯‡åˆ™æ˜¯ä¸»è¦è®²è¿°<code>Mongo</code>çš„å¤šæ•°æ®æºåˆ‡æ¢ã€‚</p><p>ä½¿ç”¨AOPæ¥å®ç°Mongoçš„æ•°æ®æºåˆ‡æ¢ä¸Redisçš„AOPåˆ‡æ¢ç›¸åŒï¼Œä¸åŒä¹‹å¤„æ˜¯éœ€è¦æ›¿æ¢<code>MongoRepository</code>é‡Œé¢çš„<code>MongoOperations</code>,ä»è€Œå®ç°å¤šæ•°æ®æºçš„åˆ‡æ¢</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>é…ç½®ç±»ï¼Œè¯»å–Mongoçš„é…ç½®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoMultiProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(MongoMultiProperties.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name=<span class="string">"mongodb1"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.data.mongodb.db1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MongoProperties <span class="title">db1Properties</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LOGGER.info(<span class="string">"æ­£åœ¨åˆå§‹åŒ–db1"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MongoProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"mongodb2"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.data.mongodb.db2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MongoProperties <span class="title">db2Properties</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LOGGER.info(<span class="string">"æ­£åœ¨åˆå§‹åŒ–db2"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MongoProperties();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é…ç½®<code>MongoRepository</code></p><blockquote><p>ä»¥ä¸‹æ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œæ‰€ä»¥é…ç½®äº†ä¸¤ä¸ªMongoRepositoryï¼Œå®é™…ä¸Šä½¿ç”¨äº†AOPçš„æ–¹å¼å®ç°çš„å¤šæ•°æ®æºï¼Œåªéœ€è¦é…ç½®ä¸€ä¸ªé»˜è®¤çš„MongoRepositoryå³å¯ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMongoRepositories</span>(mongoTemplateRef = <span class="string">"mongoDB2"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DB2Template</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"mongodb2"</span>)</span><br><span class="line">    <span class="keyword">private</span> MongoProperties mongoProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"mongoDB2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> MongoTemplate <span class="title">db2Template</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MongoTemplate(db2Factory(mongoProperties));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MongoDbFactory <span class="title">db2Factory</span><span class="params">(MongoProperties mongoProperties)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleMongoDbFactory(<span class="keyword">new</span> MongoClient(mongoProperties.getHost(),mongoProperties.getPort()),mongoProperties.getDatabase());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DB2Repository</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">MongoDB2</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœç•¥<code>DB1Template</code>çš„é…ç½®ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„</p><h2 id="ä¸€èˆ¬ä½¿ç”¨"><a href="#ä¸€èˆ¬ä½¿ç”¨" class="headerlink" title="ä¸€èˆ¬ä½¿ç”¨"></a>ä¸€èˆ¬ä½¿ç”¨</h2><p>ä¸Šè¿°çš„é…ç½®å¦‚æœéƒ½OKçš„è¯ï¼Œåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨<code>@Autowired</code>æ³¨è§£ä½¿ç”¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DB2Repository db2Repository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    DB1Repository db1Repository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">mongoUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        db2Repository.save(<span class="keyword">new</span> MongoDB2());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä½¿ç”¨AOPçš„æ–¹å¼çš„è¯ï¼Œåˆ‡<code>Service</code>è¿˜æ˜¯<code>Repository</code>æ˜¯éœ€è¦é€‰æ‹©çš„ï¼Œé¦–å…ˆå› ä¸ºåœ¨ä¸šåŠ¡ä½¿ç”¨ä¸­ï¼Œè‚¯å®šæ˜¯åŒ…å«è®¸å¤šçš„<code>Service</code>çš„ï¼Œå¦‚æœä»¥åéœ€è¦å†æ·»åŠ å…¶ä»–çš„<code>Service</code>ï¼Œè¿˜éœ€è¦æ·»åŠ åˆ‡ç‚¹ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚</p><p>å¦‚æœæ˜¯åˆ‡<code>Repository</code>çš„è¯ï¼Œé‚£ä¹ˆè¿™å°±å¥½åŠäº†ï¼Œç›´æ¥é…ç½®ä¸€ä¸ªä¸»Repositoryï¼Œç„¶ååˆ‡è¿™ä¸ªä¸»Repositoryï¼Œè¿™æ ·å°±å¯ä»¥å°†Serviceå’ŒAOPè¿›è¡Œè§£è€¦ã€‚ä»è€Œåœ¨Serviceé‡Œé¢ï¼Œå¯ä»¥éšæ„ä½¿ç”¨å…¶ä»–çš„æ•°æ®æºï¼Œä¾‹å¦‚:Mysqlæ•°æ®æºï¼ŒRedisæ•°æ®æºç­‰ã€‚æ›´åŠ çµæ´»</p><h2 id="åˆ‡é¢å†™æ³•"><a href="#åˆ‡é¢å†™æ³•" class="headerlink" title="åˆ‡é¢å†™æ³•"></a>åˆ‡é¢å†™æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order</span>(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoAspect</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"execution(* com.somersames.config.mongo.db2.DB2Repository.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">doSwitch</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> aopTest1(joinPoint);</span><br><span class="line"><span class="comment">//        aopTest2(joinPoint);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">aopTest1</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Field methodInvocationField = joinPoint.getClass().getDeclaredField(<span class="string">"methodInvocation"</span>);</span><br><span class="line">        methodInvocationField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        ReflectiveMethodInvocation o = (ReflectiveMethodInvocation) methodInvocationField.get(joinPoint);</span><br><span class="line">        Field targetField = o.getClass().getDeclaredField(<span class="string">"target"</span>);</span><br><span class="line">        targetField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object target = targetField.get(o);</span><br><span class="line">        Field modifiersField = Field.class.getDeclaredField(<span class="string">"modifiers"</span>);</span><br><span class="line">        modifiersField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object singletonTarget = AopProxyUtils.getSingletonTarget(target);</span><br><span class="line">        Field mongoOperationsField = singletonTarget.getClass().getDeclaredField(<span class="string">"mongoOperations"</span>);</span><br><span class="line">        mongoOperationsField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//éœ€è¦ç§»é™¤finalä¿®é¥°çš„å˜é‡</span></span><br><span class="line">        modifiersField.setInt(mongoOperationsField,mongoOperationsField.getModifiers()&amp;~Modifier.FINAL);</span><br><span class="line">        mongoOperationsField.set(singletonTarget, applicationContext.getBean(<span class="string">"mongoDB1"</span>));</span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">aopTest2</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Field methodInvocationField = joinPoint.getClass().getDeclaredField(<span class="string">"methodInvocation"</span>);</span><br><span class="line">        methodInvocationField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        ReflectiveMethodInvocation o = (ReflectiveMethodInvocation) methodInvocationField.get(joinPoint);</span><br><span class="line">        Field h = o.getProxy().getClass().getSuperclass().getDeclaredField(<span class="string">"h"</span>);</span><br><span class="line">        h.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        AopProxy aopProxy = (AopProxy) h.get(o.getProxy());</span><br><span class="line">        Field advised = aopProxy.getClass().getDeclaredField(<span class="string">"advised"</span>);</span><br><span class="line">        advised.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object o2 = advised.get(aopProxy);</span><br><span class="line">        <span class="keyword">if</span> (o2 <span class="keyword">instanceof</span> Advised) &#123;</span><br><span class="line">            Object o1 = ((Advised) o2).getTargetSource().getTarget();</span><br><span class="line">            Object o3 = AopProxyUtils.getSingletonTarget(o1);</span><br><span class="line">            System.out.println(o3);</span><br><span class="line">            Field mongoOperationsField = o3.getClass().getDeclaredField(<span class="string">"mongoOperations"</span>);</span><br><span class="line">            mongoOperationsField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            Field modifiersField = Field.class.getDeclaredField(<span class="string">"modifiers"</span>);</span><br><span class="line">            modifiersField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//éœ€è¦ç§»é™¤finalä¿®é¥°çš„å˜é‡</span></span><br><span class="line">            modifiersField.setInt(mongoOperationsField, mongoOperationsField.getModifiers() &amp; ~Modifier.FINAL);</span><br><span class="line">            mongoOperationsField.set(o3, applicationContext.getBean(<span class="string">"mongoDB1"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(org.springframework.context.ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼Œæä¾›äº†ä¸¤ç§çš„AOPçš„å†™æ³•ï¼Œä½†æ˜¯æœ€ç»ˆéƒ½æ˜¯è·å–<code>mongoOperations</code>ï¼Œç„¶åé€šè¿‡<code>applicationContext</code>æ¥æ›¿æ¢ã€‚</p><p>å¯¹æ¯”AOPçš„Rediså†™æ³•ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°åœ¨Springä¸­çš„<code>AOP</code>å®ç°ï¼Œæœ€èµ·ç ä½¿ç”¨<code>JDKåŠ¨æ€ä»£ç†</code>å’Œ<code>Cglib</code>ã€‚æ‰€ä»¥åœ¨æœ¬æ–‡ä¸­ï¼Œä½¿ç”¨çš„æ˜¯</p><blockquote><p>Field h = o.getProxy().getClass().getSuperclass().getDeclaredField(â€œhâ€);</p></blockquote><p>è¿™ä¸ªå°±æ˜¯è·å–JDKåŠ¨æ€ä»£ç†çš„å¯¹è±¡</p><p>è‡³æ­¤ï¼Œmongoçš„ä¸¤ç§ä»£ç†æ–¹å¼9æœ€åˆç‰ˆçš„ä»£ç ç¼–å†™å®Œæ¯•ï¼Œåç»­å¯èƒ½éœ€è¦å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»è€Œé¿å…æ¯ä¸€æ¬¡ä¿®æ”¹<code>application.yml</code>éƒ½éœ€è¦æ‰‹åŠ¨æ·»åŠ <code>Repository</code></p><p>å®Œæ•´ä»£ç å¯ä»¥è®¿é—®<a href="https://github.com/Somersames/Multi-Resource" target="_blank" rel="noopener">https://github.com/Somersames/Multi-Resource</a></p>]]></content>
      
      <categories>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Springboot </tag>
            
            <tag> Mongo </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Springä¸­AOPçš„æ¢ç´¢ä¸å®è·µ(ä¸€)ä¹‹Rediså¤šæ•°æ®æºåˆ‡æ¢</title>
      <link href="/2019/03/12/Spring%E4%B8%ADAOP%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5(%E4%B8%80)%E4%B9%8BRedis%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/"/>
      <url>/2019/03/12/Spring%E4%B8%ADAOP%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%AE%9E%E8%B7%B5(%E4%B8%80)%E4%B9%8BRedis%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/</url>
      <content type="html"><![CDATA[<p>ä¸€èˆ¬åœ¨é¡¹ç›®çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å€™ä¸ºäº†å‡è½»æ•°æ®åº“çš„å‹åŠ›ï¼Œä»è€Œå°†ä¸€éƒ¨åˆ†æ•°æ®ç¼“å­˜è‡³Redisï¼Œä½†æ˜¯éšç€ä¸šåŠ¡é‡çš„å¢å¤šã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„RedisæœåŠ¡å™¨ä¹Ÿä¼šè¶Šæ¥è¶Šå¤šï¼Œå°±ç®—ä¸éœ€è¦å¤šä¸ªRedisæ•°æ®æºï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªredisé‡Œé¢ï¼Œåˆ‡æ¢ä¸åŒçš„DBä¹Ÿæ˜¯å¾ˆéº»çƒ¦çš„ä¸€ä»¶äº‹æƒ…ã€‚</p><h2 id="éAOPçš„ä¸€èˆ¬çš„å¤šæ•°æ®æºæ“ä½œ"><a href="#éAOPçš„ä¸€èˆ¬çš„å¤šæ•°æ®æºæ“ä½œ" class="headerlink" title="éAOPçš„ä¸€èˆ¬çš„å¤šæ•°æ®æºæ“ä½œ"></a>éAOPçš„ä¸€èˆ¬çš„å¤šæ•°æ®æºæ“ä½œ</h2><p>åœ¨Redisçš„å¤šæ•°æ®æºä½¿ç”¨ä¸­ï¼Œä¸€èˆ¬çš„æ–¹æ³•æ˜¯ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–å¤šä¸ª<code>RedisProperties</code>ï¼Œè¯»å–åˆ°é…ç½®æ–‡ä»¶ä¹‹åï¼Œå°†<code>RedisProperties</code>é…ç½®åˆ°<code>RedisTemplate</code>ï¼Œç„¶åæ¯æ¬¡ä½¿ç”¨çš„æ—¶å€™å°±é€šè¿‡ä¸åŒçš„<code>Template</code>æ¥è°ƒç”¨RedisæœåŠ¡å™¨ã€‚ç¤ºä¾‹å¦‚ä¸‹:</p><h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><h4 id="Redisçš„é…ç½®ç±»"><a href="#Redisçš„é…ç½®ç±»" class="headerlink" title="Redisçš„é…ç½®ç±»"></a>Redisçš„é…ç½®ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span><span class="meta">@Order</span>(<span class="number">1</span>)</span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"redis1"</span>)</span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function">JedisConnectionFactory <span class="title">jedisConnectionFactory1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JedisConnectionFactory jedisConnectionFactory =<span class="keyword">new</span> JedisConnectionFactory();</span><br><span class="line">        jedisConnectionFactory.setHostName(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">        jedisConnectionFactory.setPort(<span class="number">6379</span>);</span><br><span class="line">        jedisConnectionFactory.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        jedisConnectionFactory.setDatabase(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> jedisConnectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span>(name = <span class="string">"redis2"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"spring.redis.db1"</span>)</span><br><span class="line">    <span class="function">JedisConnectionFactory <span class="title">jedisConnectionFactory2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        JedisConnectionFactory jedisConnectionFactory =<span class="keyword">new</span> JedisConnectionFactory();</span><br><span class="line">        jedisConnectionFactory.setHostName(<span class="string">"127.0.0.1"</span>);</span><br><span class="line">        jedisConnectionFactory.setPort(<span class="number">6379</span>);</span><br><span class="line">        jedisConnectionFactory.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">        jedisConnectionFactory.setDatabase(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> jedisConnectionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(jedisConnectionFactory1());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(jedisConnectionFactory2());</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„é…ç½®ç±»é‡Œé¢ï¼Œåˆ†åˆ«ç”Ÿæˆäº†ä¸¤ä¸ª<code>JedisConnectionFactory</code>å’Œä¸¤ä¸ª<code>RedisTemplate</code>ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨çš„æ—¶å€™ç›´æ¥é€šè¿‡æ³¨è§£<code>@Autowired</code>è£…é…ä¸¤ä¸ª<code>RedisTemplate</code>å³å¯ã€‚</p><h4 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCommonService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate2 ;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redis1Save</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redis1Save2</span><span class="params">(String key,String value)</span> </span>&#123;</span><br><span class="line">        redisTemplate2.opsForValue().set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è°ƒç”¨"><a href="#è°ƒç”¨" class="headerlink" title="è°ƒç”¨"></a>è°ƒç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">RestController</span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisCommonController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisCommonService redisCommonService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/redis1"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redis1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        redisCommonService.redis1Save(<span class="string">"1"</span>,<span class="string">"2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/redis2"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redis2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        redisCommonService.redis1Save2(<span class="string">"2"</span>,<span class="string">"3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨Redisçš„æœåŠ¡å™¨ä¸Šå¯ä»¥çœ‹åˆ°<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Redis%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªæ•°æ®åˆ†åˆ«å†™å…¥åˆ°äº†ä¸åŒçš„Dbä¸­</p><h2 id="é€šè¿‡AOPçš„è°ƒç”¨"><a href="#é€šè¿‡AOPçš„è°ƒç”¨" class="headerlink" title="é€šè¿‡AOPçš„è°ƒç”¨"></a>é€šè¿‡AOPçš„è°ƒç”¨</h2><p>é€šè¿‡AOPæ–¹æ³•è°ƒç”¨çš„åŸºç¡€æ˜¯éœ€è¦è·å–<code>RedisTemplate</code>é‡Œé¢çš„<code>JedisConnectionFactory</code><br>åˆ‡é¢ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around</span>(<span class="string">"execution(* com.somersames.service.redis.RedisService.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">as</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        Field methodInvocationField = joinPoint.getClass().getDeclaredField(<span class="string">"methodInvocation"</span>);</span><br><span class="line">        System.out.println(AopUtils.isAopProxy(joinPoint.getTarget()));</span><br><span class="line">        methodInvocationField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        ReflectiveMethodInvocation o = (ReflectiveMethodInvocation) methodInvocationField.get(joinPoint);</span><br><span class="line">        Field h = o.getProxy().getClass().getDeclaredField(<span class="string">"CGLIB$CALLBACK_0"</span>);</span><br><span class="line">        h.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object dynamicAdvisedInterceptor = h.get(o.getProxy());</span><br><span class="line">        Field advised = dynamicAdvisedInterceptor.getClass().getDeclaredField(<span class="string">"advised"</span>);</span><br><span class="line">        advised.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        Object target = ((AdvisedSupport)advised.get(dynamicAdvisedInterceptor)).getTargetSource().getTarget();</span><br><span class="line">        Field re = target.getClass().getDeclaredField(<span class="string">"redisTemplate"</span>);</span><br><span class="line">        re.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object re2= re.get(target);</span><br><span class="line"></span><br><span class="line">        Field d =  re2.getClass().getSuperclass().getDeclaredField(<span class="string">"connectionFactory"</span>);</span><br><span class="line">        d.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">        Object[] objs = joinPoint.getArgs();</span><br><span class="line">        <span class="keyword">if</span>(objs != <span class="keyword">null</span> &amp;&amp; objs.length !=<span class="number">0</span>)&#123;</span><br><span class="line">            re.set(target,applicationContext.getBean((String) objs[<span class="number">0</span>]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        joinPoint.proceed();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="RedisServer"><a href="#RedisServer" class="headerlink" title="RedisServer"></a>RedisServer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate&lt;String,Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">aopRedis</span><span class="params">(String reditTemplate)</span></span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"a"</span>,<span class="string">"a"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°çš„ä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯è·å–<code>RedisServer</code>çš„<code>aopRedis</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç„¶åé€šè¿‡AOPå°†å…¶æ›¿æ¢ä¸ºæŒ‡å®šçš„Redisè¿æ¥ã€‚æµ‹è¯•å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisService redisService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/redis"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCurd1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        redisService.aopRedis(<span class="string">"redisTemplate2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨<code>AopController</code>é‡Œé¢ï¼Œæˆ‘æƒ³é€šè¿‡<code>redisTemplate2</code>æ¥æ‰§è¡Œ<code>aopRedis</code>æ–¹æ³•ã€‚<br>ä½†æ˜¯åœ¨<code>RedisService</code>é‡Œé¢ï¼Œæˆ‘ä»¬åˆæ˜¯é…ç½®çš„æ˜¯Redisè¿æ¥æ•°æ®æº1ï¼Œé‚£ä¹ˆå¦‚ä½•</p><blockquote><p>RedisTemplate&lt;String,Object&gt; redisTemplate;</p></blockquote><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ‡é¢ï¼Œç›´æ¥æ›¿æ¢RedisTemplateçš„è¿æ¥ï¼Œä»è€Œè·å–æŒ‡å®šçš„Redisè¿æ¥ï¼Œæµ‹è¯•å¦‚ä¸‹ï¼š<br>å¯åŠ¨æœåŠ¡ã€‚<br>è®¿é—®<code>http://localhost:8080/redis</code>ã€‚</p><p>åœ¨ä¸å¼€å¯åˆ‡é¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç›´æ¥è®¿é—®çš„æ˜¯<code>0</code>å·åº“ï¼Œè€Œå¼€å¯åˆ‡é¢ä¹‹åï¼Œåœ¨è°ƒç”¨<code>RedisService</code>çš„æ—¶å€™ï¼Œç”±äºåˆ‡é¢å°†RedisTemplateçš„<code>connectionFactory</code>æ›¿æ¢ä¸º2å·åº“ï¼Œæ‰€ä»¥è®¿é—®ç»“æœå¦‚ä¸‹:<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/RedisAo.png" alt=""></p><p>æœ¬ç¯‡æ–‡ç« åªæ˜¯ç®€å•çš„ä»‹ç»äº†ä¸‹AOPçš„ä½¿ç”¨ï¼Œä¸‹é¢å‡ ç¯‡å¯èƒ½ä¼šåŸºäºè¿™ç¯‡æ–‡ç« åšä¸€äº›AOPè¡¥å……å’Œå¢åŠ ä¸€äº›å…¶ä»–åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼šæ·»åŠ Redisçš„AOPçš„è‡ªåŠ¨åˆ‡æ¢ï¼ŒåŒæ—¶æ·»åŠ å¤šä¸ªRedisæ•°æ®æºçš„è‡ªåŠ¨æ³¨å…¥ï¼Œä¸å†æ‰‹åŠ¨å†™Beanã€‚<br>ç„¶åä¼šå¯èƒ½åŸºäºMongoçš„å¤šæ•°æ®æºæ¥è®²è§£AOPçš„ä¸åŒä»£ç†è·å–æ–¹å¼ï¼Œå’Œä¸€èˆ¬é€šç”¨çš„è·å–æ–¹å¼</p>]]></content>
      
      <categories>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Springboot </tag>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä½¿ç”¨Mqå®ç°å»¶æ—¶é˜Ÿåˆ—</title>
      <link href="/2019/03/04/%E4%BD%BF%E7%94%A8Mq%E5%AE%9E%E7%8E%B0%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97/"/>
      <url>/2019/03/04/%E4%BD%BF%E7%94%A8Mq%E5%AE%9E%E7%8E%B0%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97/</url>
      <content type="html"><![CDATA[<p>åœ¨å®é™…çš„åº”ç”¨å¼€å‘ä¸­ï¼Œä¸‹æ¸¸ç³»ç»Ÿå¹¶ä¸éœ€è¦ç«‹å³å¤„ç†ä¸Šæ¸¸ç³»ç»Ÿçš„mqï¼Œä½†æ˜¯åˆä¸å¯èƒ½å°†æ¶ˆæ¯é˜»å¡åœ¨ä¸Šæœ‰ç³»ç»Ÿä¸­ã€‚ä¸”è¿™ä¸¤ä¸ªç³»ç»Ÿä¹‹é—´åˆæ²¡æœ‰æ¥å£æä¾›å‡ºæ¥ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡Mqçš„æ­»ä¿¡é˜Ÿåˆ—æ¥å®ç°ä¸€ä¸ªå»¶æ—¶æ•ˆæœ</p><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ç”±äºMqçš„å‘é€æ–¹ä¸æ”¯æŒå»¶è¿Ÿå‘é€(<strong>ç›®å‰çš„æ–°ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨æ’ä»¶æ¥æ”¯æŒï¼Œä½†æ˜¯å¯èƒ½ç”±äºå…¬å¸çš„å…¶ä»–é™åˆ¶ï¼Œå¯¼è‡´æ— æ³•å‡çº§</strong>)ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨Mqçš„æ­»ä¿¡é˜Ÿåˆ—æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒMqçš„å‘é€æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Mq%E4%B8%80%E8%88%AC%E6%B5%81%E7%A8%8B.png" alt=""></p><h2 id="Mqçš„æ­»ä¿¡é˜Ÿåˆ—"><a href="#Mqçš„æ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="Mqçš„æ­»ä¿¡é˜Ÿåˆ—"></a>Mqçš„æ­»ä¿¡é˜Ÿåˆ—</h2><p>åœ¨Mqçš„ä½¿ç”¨ä¸­ï¼Œæ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†ä¸€ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><blockquote><ol><li>The message is negatively acknowledged by a consumer using basic.reject or basic.nack with requeue parameter  set to false</li><li>The message expires due to TTL; or</li><li>The message is dropped because its queue exceeded a length limit</li></ol></blockquote><p>ä¸Šè¿°ä¸‰ç§æƒ…å†µåˆ†åˆ«æ˜¯</p><ol><li>æ¶ˆè´¹è€…æ‹’ç»äº†è¯¥Mqï¼ŒåŒæ—¶æ¶ˆè´¹è€…ä¹Ÿè®¾ç½®è¯¥æ¶ˆæ¯ä¸é‡æ–°å…¥é˜Ÿã€‚</li><li>æ¶ˆæ¯è¿‡æœŸï¼Œå³æ— äººæ¶ˆè´¹</li><li>é˜Ÿåˆ—è®¾ç½®äº†é•¿åº¦ï¼ŒåŒæ—¶é˜Ÿåˆ—å·²æ»¡</li></ol><p>ç”±äºMqä¸æ”¯æŒæ¶ˆæ¯çš„å»¶è¿Ÿå‘é€ï¼Œå³æ¶ˆæ¯ä¸€ç»æŠ•é€’ï¼Œå°±ä¼šé©¬ä¸Šå…¥é˜Ÿï¼Œåˆ°è¾¾äº¤æ¢æœºã€‚ç„¶åæ ¹æ®äº¤æ¢æœºçš„å±æ€§ï¼Œè¿›è¡ŒæŠ•é€’ã€‚</p><p>è¿™æ ·å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå‘é€æ–¹éœ€è¦æ¶ˆè´¹è€…ç­‰å¾…ä¸€å®šçš„æ—¶é—´æ‰èƒ½è¿›è¡Œæ¶ˆè´¹ã€‚å¦‚æœä¸ç»ç”±æ­»ä¿¡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆåªèƒ½åœ¨å‘é€æ–¹åšç­‰å¾…ã€‚</p><p>ä¾‹å¦‚ä½¿ç”¨<code>Thread.sleep()</code>æ¥å®ç°ï¼Œç”±äº<code>Sleep</code>æ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥è¿™æ ·åšåˆä¼šå½±å“åˆ°æ€§èƒ½ã€‚åˆæˆ–è€…é€šè¿‡å®šæ—¶ä»»åŠ¡æ¥å®ç°ï¼Œä½†æ˜¯å®šæ—¶ä»»åŠ¡æ¯ä¸€æ¬¡åˆè¦å»å–å‡ºè¯¥å‘é€çš„Mqï¼Œç„¶åå†å‘å‡ºå»ï¼Œè¿™æ ·å°±ä¼šéå¸¸çš„å½±å“åˆ°æ•ˆç‡ã€‚</p><h2 id="æ­»ä¿¡é˜Ÿåˆ—å®ç°å»¶è¿Ÿé˜Ÿåˆ—"><a href="#æ­»ä¿¡é˜Ÿåˆ—å®ç°å»¶è¿Ÿé˜Ÿåˆ—" class="headerlink" title="æ­»ä¿¡é˜Ÿåˆ—å®ç°å»¶è¿Ÿé˜Ÿåˆ—"></a>æ­»ä¿¡é˜Ÿåˆ—å®ç°å»¶è¿Ÿé˜Ÿåˆ—</h2><p>é€šè¿‡Rabbitmqçš„æ­»ä¿¡è½¬å‘è½¬å‘è§„åˆ™2ï¼Œä¾¿å¯ä»¥å®ç°ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Mqexpire.png" alt=""></p><p>è¿™é‡Œå®ç°çš„å…³é”®æ˜¯è®²æ¶ˆè´¹é˜Ÿåˆ—è®¾ç½®ä¸º<code>DLK</code>,<code>TTL</code>,<code>DLX</code>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/Mqmanage.png" alt=""></p><p>åœ¨ä¸Šå›¾é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°<code>Tutorials</code>æ˜¯ä¸€ä¸ªæ¶ˆè´¹é˜Ÿåˆ—ï¼ŒåŒæ—¶å·²ç»è®¾ç½®äº†å®ƒçš„æ­»ä¿¡è½¬å‘è§„åˆ™ã€‚è€Œ<code>dTutorials</code>æ˜¯ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯ç”¨äºå­˜æ”¾æ­»ä¿¡é˜Ÿåˆ—</p><h2 id="ä»£ç å¦‚ä¸‹ï¼š"><a href="#ä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="ä»£ç å¦‚ä¸‹ï¼š"></a>ä»£ç å¦‚ä¸‹ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"></span><br><span class="line">    factory.setHost(HOST);</span><br><span class="line">    factory.setUsername(USER);</span><br><span class="line">    factory.setPassword(PASSWORD);</span><br><span class="line">    factory.setPort(<span class="number">5672</span>);</span><br><span class="line">    factory.setVirtualHost(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">    connection = factory.newConnection();</span><br><span class="line"></span><br><span class="line">    channel = connection.createChannel();</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åœ¨è¿™é‡Œåˆ†åˆ«æ–°å»ºä¸¤ä¸ªExchangeï¼Œä¸€ä¸ªæ˜¯æ­»ä¿¡çš„Exchangeï¼Œä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…çš„Exchange</span></span><br><span class="line">    channel.exchangeDeclare(exchangeName,<span class="string">"direct"</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line">    channel.exchangeDeclare(dExchangeName,<span class="string">"direct"</span>,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">byte</span>[] bytes  =messgae.getBytes();</span><br><span class="line">    <span class="comment">//å£°æ˜ä¸€ä¸ªé˜Ÿåˆ— - æŒä¹…åŒ–ï¼ŒåŒæ—¶è®¾ç½®æ­»ä¿¡çš„è½¬å‘Exchangeå’ŒQueueã€‚ä»¥åŠæ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    Map&lt;String,Object&gt; args = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    args.put(<span class="string">"x-dead-letter-exchange"</span>,dExchangeName);</span><br><span class="line">    args.put(<span class="string">"x-dead-letter-routing-key"</span>,routingKey);</span><br><span class="line">    args.put(<span class="string">"x-message-ttl"</span>,<span class="number">2000</span>);</span><br><span class="line">    channel.queueDeclare(queueName, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, args);</span><br><span class="line">    channel.queueDeclare(dQueeueName, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®é€šé“é¢„å–è®¡æ•°</span></span><br><span class="line">    channel.basicQos(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šåˆ°Exchange</span></span><br><span class="line">    channel.queueBind(queueName, exchangeName, routingKey);</span><br><span class="line">    channel.queueBind(dQueeueName, dExchangeName, routingKey);</span><br><span class="line">    channel.basicPublish(exchangeName, routingKey, <span class="keyword">null</span>, bytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”Ÿäº§è€…ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">ConnectionFactory factory = <span class="keyword">new</span> ConnectionFactory();</span><br><span class="line"></span><br><span class="line">        factory.setHost(HOST);</span><br><span class="line">        factory.setUsername(USER);</span><br><span class="line">        factory.setPassword(PASSWORD);</span><br><span class="line">        factory.setPort(<span class="number">5672</span>);</span><br><span class="line">        factory.setVirtualHost(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å£°æ˜ä¸€ä¸ªè¿æ¥</span></span><br><span class="line">        connection = factory.newConnection();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å£°æ˜æ¶ˆæ¯é€šé“</span></span><br><span class="line">        channel = connection.createChannel();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åœ¨è¿™é‡Œæ¶ˆè´¹è€…ç›´æ¥æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—å³å¯</span></span><br><span class="line">        channel.queueBind(dQueueName, dExchangeName, routingKey);</span><br><span class="line">        DefaultConsumer defaultConsumer =<span class="keyword">new</span> DefaultConsumer(channel)&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleDelivery</span><span class="params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="keyword">byte</span>[] body)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                String str = <span class="keyword">new</span> String(body);</span><br><span class="line">                System.out.println(str);</span><br><span class="line">                System.out.println(<span class="keyword">new</span> Date());</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">"æµ‹è¯•"</span>.equals(str))&#123;</span><br><span class="line">                    channel.basicReject(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    channel.basicAck(envelope.getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        channel.basicConsume(dQueueName,defaultConsumer);</span><br></pre></td></tr></table></figure><p>ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹è€…æ€»æ˜¯åœ¨2ç§’é’Ÿä¹‹åæ”¶åˆ°äº†å‘é€æ–¹å‘é€çš„æ¶ˆæ¯ï¼Œè¿™æ—¶ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—å°±å®ç°äº†</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/GIF2.gif" alt=""></p><h2 id="è¯¦ç»†ä»£ç è¿æ¥"><a href="#è¯¦ç»†ä»£ç è¿æ¥" class="headerlink" title="è¯¦ç»†ä»£ç è¿æ¥"></a>è¯¦ç»†ä»£ç è¿æ¥</h2><p>å…·ä½“çš„ä»£ç ä»¥ä¸Šä¼ è‡³Github:<a href="https://github.com/Somersames/MqTutorials" target="_blank" rel="noopener">https://github.com/Somersames/MqTutorials</a></p>]]></content>
      
      <categories>
          
          <category> Rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rabbitmq </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨Mysqlä¸­ä½¿ç”¨å˜é‡è¿›è¡Œå¤æ‚çš„æŸ¥è¯¢(ä¸€)</title>
      <link href="/2019/02/27/%E5%9C%A8Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E5%A4%8D%E6%9D%82%E7%9A%84%E6%9F%A5%E8%AF%A2(%E4%B8%80)/"/>
      <url>/2019/02/27/%E5%9C%A8Mysql%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8F%98%E9%87%8F%E8%BF%9B%E8%A1%8C%E5%A4%8D%E6%9D%82%E7%9A%84%E6%9F%A5%E8%AF%A2(%E4%B8%80)/</url>
      <content type="html"><![CDATA[<blockquote><p>æ³¨æ„ï¼Œæ­¤æ–‡ç« ä½¿ç”¨çš„Mysqlå˜é‡å‡æ˜¯ç”¨æˆ·å˜é‡</p></blockquote><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>é¦–å…ˆçœ‹ä¸€ä¸ªéœ€æ±‚ï¼Œæœ‰å¦‚ä¸‹æ•°æ®è¡¨ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from t1 order by area_id;</span><br><span class="line">+<span class="comment">---------+-----------+</span></span><br><span class="line">| area_id | order_num |</span><br><span class="line">+<span class="comment">---------+-----------+</span></span><br><span class="line">|       1 |        22 |</span><br><span class="line">|       1 |        10 |</span><br><span class="line">|       1 |        10 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">|       2 |        10 |</span><br><span class="line">|       2 |        22 |</span><br><span class="line">|       3 |        10 |</span><br><span class="line">+<span class="comment">---------+-----------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.14</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆéå¸¸æ™®é€šçš„æ•°æ®è¡¨ã€‚</p><h2 id="éœ€æ±‚ä¸€"><a href="#éœ€æ±‚ä¸€" class="headerlink" title="éœ€æ±‚ä¸€"></a>éœ€æ±‚ä¸€</h2><p>å‡è®¾æŸä¸€æ¬¡è¿è¥éœ€è¦ç»Ÿè®¡æ¯ä¸€ä¸ªåœ°åŒºçš„é”€é‡é‡ï¼Œè®©ä½ å‡ºä¸€ä¸ªæŠ¥è¡¨ç»™ä»–ï¼Œé‚£ä¹ˆæ–¹æ³•å¦‚ä¸‹ï¼š</p><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><p>ç»Ÿè®¡æ¯ä¸€ä¸ªåœ°åŒºçš„æ€»é”€é‡ï¼š<br>å¸¸ç”¨SQLå¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select t1.area_id, sum(t1.order_num) from t1 group by area_id;</span><br><span class="line">+<span class="comment">---------+-------------------+</span></span><br><span class="line">| area_id | sum(t1.order_num) |</span><br><span class="line">+<span class="comment">---------+-------------------+</span></span><br><span class="line">|       1 | 42                |</span><br><span class="line">|       2 | 42                |</span><br><span class="line">|       3 | 10                |</span><br><span class="line">+<span class="comment">---------+-------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.14</span> sec)</span><br></pre></td></tr></table></figure></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¯¥SQLå·²ç»å¯ä»¥æŠŠæ¯ä¸ªåœ°åŒºçš„é”€å”®æ€»é‡å…¨éƒ¨ç»Ÿè®¡å®Œæ¯•äº†ã€‚ä½†æ˜¯æœ‰ä¸€å¤©ï¼Œéœ€æ±‚åˆå˜äº†ã€‚</p><h2 id="éœ€æ±‚äºŒï¼š"><a href="#éœ€æ±‚äºŒï¼š" class="headerlink" title="éœ€æ±‚äºŒï¼š"></a>éœ€æ±‚äºŒï¼š</h2><p>ç°åœ¨å…¶ä»–çš„è¿è¥ä¹Ÿè¿‡æ¥äº†ï¼Œè¯´éœ€è¦æŒ‰ç…§åŒºåŸŸçš„Idåšä¸ºä¼˜å…ˆçº§ï¼Œä¾æ¬¡ç»Ÿè®¡æ¯ä¸€ä¸ªä¼˜å…ˆçº§åœ°åŒºçš„æ€»é”€é‡ã€‚å³å¦‚ä¸‹ï¼š</p><ol><li>åœ°åŒº1çš„é”€é‡ä¸º42ï¼Œç”±äºæ²¡æœ‰åœ°åŒºIdä¸º0çš„ï¼Œæ‰€ä»¥åœ°åŒº1çš„é”€é‡æ˜¯42ã€‚</li><li>åœ°åŒº2çš„é”€é‡ä¸º42ï¼Œä½†æ˜¯ç”±äºåœ°åŒº2çš„ä¼˜å…ˆçº§é«˜äº1ï¼Œæ‰€ä»¥åœ°åŒº2çš„é”€é‡éœ€è¦åŒ…å«åœ°åŒº1çš„é”€é‡</li><li>åœ°åŒº3çš„é”€é‡ä¸º42ï¼Œä½†æ˜¯ç”±äºåœ°åŒº3çš„ä¼˜å…ˆçº§é«˜äº1å’Œ2ï¼Œæ‰€ä»¥åœ°åŒº3çš„é”€é‡éœ€è¦åŒ…å«åœ°åŒº1çš„é”€é‡å’Œåœ°åŒº2çš„é”€é‡</li></ol><p>æ­¤æ—¶ä½ ä¼šå‘ç°ï¼Œè™½ç„¶å¯ä»¥è¿›è¡Œ<code>groupby</code>ï¼Œä½†æ˜¯å´æ— æ³•ç»Ÿè®¡ä¹‹å‰çš„ç´¯åŠ å’Œï¼Œæ­¤æ—¶<code>Mysql</code>å˜é‡å°±å¯ä»¥ä½¿ç”¨äº†</p><h3 id="æ–¹æ³•ä¸€-1"><a href="#æ–¹æ³•ä¸€-1" class="headerlink" title="æ–¹æ³•ä¸€:"></a>æ–¹æ³•ä¸€:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT</span><br><span class="line">r1.area_id,</span><br><span class="line">@t_total := @t_total + r1.total AS &apos;t_total&apos; </span><br><span class="line">FROM</span><br><span class="line">( SELECT @t_total := 0 ) r,</span><br><span class="line">( SELECT t1.area_id, sum( t1.order_num ) AS &apos;total&apos; FROM t1 GROUP BY area_id ) r1 order by r1.area_id;</span><br><span class="line">+---------+---------+</span><br><span class="line">| area_id | t_total |</span><br><span class="line">+---------+---------+</span><br><span class="line">|       1 |      42 |</span><br><span class="line">|       2 |      84 |</span><br><span class="line">|       3 |      94 |</span><br><span class="line">+---------+---------+</span><br><span class="line">3 rows in set (0.18 sec)</span><br></pre></td></tr></table></figure><p>ç”±äºéœ€æ±‚æ˜¯éœ€è¦é«˜ä¸€çº§çš„åœ°åŒºéœ€è¦ç»Ÿè®¡æ‰€ä»¥ä½ä¸€çº§åœ°åŒºçš„é”€é‡ï¼Œæ‰€ä»¥æ­¤æ—¶è¿™ä¸ªéœ€æ±‚å·²ç»å®Œæˆäº†ã€‚</p><p>æ­¤æ—¶æŸ¥çœ‹<code>SQL</code>çš„æ•ˆæœï¼Œä¼šå‘ç°ï¼Œåœ°åŒº2çš„é”€é‡å·²ç»åŒ…å«äº†åœ°åŒº1çš„ï¼Œè€Œåœ°åŒº3çš„é”€é‡å·²ç»åŒ…å«äº†åœ°åŒº1å’Œåœ°åŒº2çš„ï¼Œæ‰€ä»¥è¯¥æ¡<code>SQL</code>å·²ç»ç¬¦åˆè¿è¥çš„éœ€æ±‚äº†ã€‚</p><h3 id="Mysqlå˜é‡çš„åˆæ­¥ä½¿ç”¨"><a href="#Mysqlå˜é‡çš„åˆæ­¥ä½¿ç”¨" class="headerlink" title="Mysqlå˜é‡çš„åˆæ­¥ä½¿ç”¨"></a>Mysqlå˜é‡çš„åˆæ­¥ä½¿ç”¨</h3><p>åœ¨ä¸Šé¢çš„è¿™æ¡SQLä¸­ï¼Œå¯ä»¥çœ‹åˆ°å‡ºç°äº†<code>@t_total</code>è¿™ä¸ªå˜é‡ï¼ŒåŒæ—¶ä¹Ÿå‡ºç°äº†<code>:=</code>æ“ä½œç¬¦ï¼Œè¿™å°±æ˜¯Mysqlçš„å˜é‡ã€‚</p><h2 id="éœ€æ±‚ä¸‰"><a href="#éœ€æ±‚ä¸‰" class="headerlink" title="éœ€æ±‚ä¸‰"></a>éœ€æ±‚ä¸‰</h2><p>ç°åœ¨è¿è¥å‘ç°ï¼Œè¿™æ ·ç»Ÿè®¡çš„è¯æœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦è¿›è¡Œè°ƒæ•´ä¸‹ï¼š</p><ol><li>åœ°åŒº1çš„é”€é‡ä¸º42ï¼Œä¸èƒ½åŒ…å«è‡ªèº«çš„é”€é‡ï¼Œäºæ˜¯åªèƒ½ç»Ÿè®¡æ¯”1å°çš„åœ°åŒºï¼Œæ‰€ä»¥åœ°åŒº1çš„é”€é‡æ˜¯0ã€‚</li><li>åœ°åŒº2çš„é”€é‡ä¸º42ï¼Œä¸èƒ½åŒ…å«è‡ªèº«çš„é”€é‡ï¼Œäºæ˜¯åªèƒ½ç»Ÿè®¡æ¯”2å°çš„åœ°åŒºï¼Œæ‰€ä»¥åœ°åŒº1çš„é”€é‡æ˜¯42ã€‚</li><li>åœ°åŒº2çš„é”€é‡ä¸º10ï¼Œä¸èƒ½åŒ…å«è‡ªèº«çš„é”€é‡ï¼Œäºæ˜¯åªèƒ½ç»Ÿè®¡æ¯”3å°çš„åœ°åŒºï¼Œæ‰€ä»¥åœ°åŒº3çš„é”€é‡æ˜¯84ã€‚</li><li></li></ol><h3 id="æ–¹æ³•ä¸€-2"><a href="#æ–¹æ³•ä¸€-2" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT</span><br><span class="line">r1.area_id,</span><br><span class="line">@t_total := @t_total + r1.total AS 't_total',</span><br><span class="line">@before_total := @t_total - r1.total AS 'before_total' </span><br><span class="line">FROM</span><br><span class="line">( <span class="keyword">SELECT</span> @t_total := <span class="number">0</span> ) r,</span><br><span class="line">( <span class="keyword">SELECT</span> @before_total := <span class="number">0</span> ) rr,</span><br><span class="line">( <span class="keyword">SELECT</span> t1.area_id, <span class="keyword">sum</span>( t1.order_num ) <span class="keyword">AS</span> <span class="string">'total'</span> <span class="keyword">FROM</span> t1 <span class="keyword">GROUP</span> <span class="keyword">BY</span> area_id ) r1;</span><br><span class="line">+<span class="comment">---------+---------+--------------+</span></span><br><span class="line">| area_id | t_total | before_total |</span><br><span class="line">+<span class="comment">---------+---------+--------------+</span></span><br><span class="line">|       1 |      42 |            0 |</span><br><span class="line">|       2 |      84 |           42 |</span><br><span class="line">|       3 |      94 |           84 |</span><br><span class="line">+<span class="comment">---------+---------+--------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.16</span> sec)</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ä¼šçœ‹åˆ°<code>before_total</code>å­—æ®µå®Œç¾çš„ç¬¦åˆå’Œéœ€æ±‚ä¸‰ã€‚</p><h2 id="Mysqlå˜é‡"><a href="#Mysqlå˜é‡" class="headerlink" title="Mysqlå˜é‡"></a>Mysqlå˜é‡</h2><p>é€šè¿‡éœ€æ±‚äºŒå’Œéœ€æ±‚ä¸‰å¯ä»¥çœ‹åˆ°Mysqlçš„å˜é‡ä½¿ç”¨æŠ€å·§ï¼Œåœ¨Mysqlä¸­ï¼Œä½¿ç”¨å˜é‡å¯ä»¥å®ç°å¾ˆå¤šå¤æ‚çš„éœ€æ±‚ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨Mysqlå˜é‡çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œç”¨æˆ·å˜é‡éœ€è¦é…åˆ<code>Select</code>ä¸€èµ·æ¥ä½¿ç”¨ã€‚</p>]]></content>
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>javaå¼‚æ­¥IOçš„å›è°ƒæœºåˆ¶</title>
      <link href="/2019/01/24/java%E5%BC%82%E6%AD%A5IO%E7%9A%84%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6/"/>
      <url>/2019/01/24/java%E5%BC%82%E6%AD%A5IO%E7%9A%84%E5%9B%9E%E8%B0%83%E6%9C%BA%E5%88%B6/</url>
      <content type="html"><![CDATA[<h2 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h2><p>åœ¨Javaçš„nioé‡Œé¢ï¼Œç»å¸¸é‡åˆ°çš„ä¸€ä¸ªè¯è¯­æ˜¯<code>å›è°ƒ</code>ï¼Œä¸€ä¸ªä¸»çº¿ç¨‹è´Ÿè´£åˆ†å‘å„ç§è¯·æ±‚è‡³å­çº¿ç¨‹ï¼ŒåŒæ—¶å­çº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åé€šçŸ¥ä¸»çº¿ç¨‹ï¼Œè¿™å…¶ä¸­å°±æ¶‰åŠåˆ°äº†å›è°ƒæœºåˆ¶ã€‚</p><p>åœ¨Javaä¸­ï¼Œå¼‚æ­¥IOçš„å›è°ƒæ–¹å¼ä¸»è¦æ˜¯<code>CallBack</code>å’Œ<code>Future</code>ã€‚</p><p>ç”±äº<code>Future</code>è·å–ç»“æœæ˜¯ä¸€ç§é˜»å¡çš„æ–¹å¼ï¼Œæ‰€ä»¥æœ¬æ¬¡å°±ä¸»è¦æ¥äº†è§£<code>Callback</code>å›è°ƒæ–¹å¼çš„è¿è¡Œæœºåˆ¶ã€‚</p><p>ç”±äºåœ¨å¼‚æ­¥IOé‡Œé¢ï¼Œä¸»çº¿ç¨‹ä¸éœ€è¦ç­‰å¾…å­çº¿ç¨‹æ¥è·å–ç»“æœï¼Œæ‰€ä»¥å¯ä»¥æå¤§çš„æé«˜ç¨‹åºè¿è¡Œçš„æ•ˆç‡ï¼Œä½†æ˜¯å­çº¿ç¨‹å¿…é¡»åœ¨å®Œæˆä¹‹åé€šçŸ¥çˆ¶çº¿ç¨‹ï¼Œäºæ—¶è¿™å°±å¼•å‡ºäº†å›è°ƒã€‚</p><p>åœ¨Javaä¸­å›è°ƒæ˜¯é€šè¿‡ä¸€ä¸ªåŒ¿åå¯¹è±¡æ¥å®ç°ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å­çº¿ç¨‹åœ¨è¿è¡Œçš„æ—¶å€™éƒ½ä¼šä¼ å…¥ä¸€ä¸ªåŒ¿åçš„å¯¹è±¡ï¼Œç„¶åå­çº¿ç¨‹å®Œæˆä»»åŠ¡ä¹‹åï¼Œé€šè¿‡è°ƒç”¨è¯¥å¯¹åŒ¿åå¯¹è±¡æ¥è¿›è¡Œå›è°ƒ</p><h3 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h3><h4 id="å›è°ƒæ¥å£"><a href="#å›è°ƒæ¥å£" class="headerlink" title="å›è°ƒæ¥å£"></a>å›è°ƒæ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ComplateHande</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">complated</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fial</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å­çº¿ç¨‹"><a href="#å­çº¿ç¨‹" class="headerlink" title="å­çº¿ç¨‹"></a>å­çº¿ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientServer</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ComplateHande complateHande;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> sleepTime;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientServer</span><span class="params">(ComplateHande complateHande,String message,<span class="keyword">int</span> sleepTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message= message;</span><br><span class="line">        <span class="keyword">this</span>.sleepTime = sleepTime;</span><br><span class="line">        <span class="keyword">this</span>.complateHande = complateHande;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClientServer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            comulate();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">comulate</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread.currentThread().sleep(sleepTime*<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="keyword">this</span>.message);</span><br><span class="line">        <span class="keyword">this</span>.complateHande.complated();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="Mainæ–¹æ³•"><a href="#Mainæ–¹æ³•" class="headerlink" title="Mainæ–¹æ³•"></a>Mainæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        ClientServer clientServer1 =<span class="keyword">new</span> ClientServer(<span class="keyword">new</span> ComplateHande() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"å¤„ç†å®Œæ¯•"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"å¤„ç†å¤±è´¥"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"ä¸€å·ä»»åŠ¡"</span>,<span class="number">2</span>);</span><br><span class="line">        clientServer1.start();</span><br><span class="line">        ClientServer clientServer2 =<span class="keyword">new</span> ClientServer(<span class="keyword">new</span> ComplateHande() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"2å¤„ç†å®Œæ¯•"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"å¤„ç†å¤±è´¥"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"äºŒå·ä»»åŠ¡"</span>,<span class="number">1</span>);</span><br><span class="line">        clientServer2.start();</span><br><span class="line">        ClientServer clientServer3 =<span class="keyword">new</span> ClientServer(<span class="keyword">new</span> ComplateHande() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"3å¤„ç†å®Œæ¯•"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"2å¤„ç†å¤±è´¥"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"ä¸‰å·ä»»åŠ¡"</span>,<span class="number">1</span>);</span><br><span class="line">        clientServer3.start();</span><br><span class="line">        ClientServer clientServer4 =<span class="keyword">new</span> ClientServer(<span class="keyword">new</span> ComplateHande() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">complated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"4å¤„ç†å®Œæ¯•"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"å¤„ç†å¤±è´¥"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="string">"å››å·ä»»åŠ¡"</span>,<span class="number">3</span>);</span><br><span class="line">        clientServer4.start();</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="string">"è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+1"</span>);</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="string">"è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+1"</span>);</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="string">"è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+1"</span>);</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(<span class="string">"è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+1"</span>);</span><br><span class="line">        Thread.currentThread().sleep(<span class="number">10000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿è¡Œç»“æœ"><a href="#è¿è¡Œç»“æœ" class="headerlink" title="è¿è¡Œç»“æœ"></a>è¿è¡Œç»“æœ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">äºŒå·ä»»åŠ¡</span><br><span class="line"><span class="number">2</span>å¤„ç†å®Œæ¯•</span><br><span class="line">ä¸‰å·ä»»åŠ¡</span><br><span class="line"><span class="number">3</span>å¤„ç†å®Œæ¯•</span><br><span class="line">è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+<span class="number">1</span></span><br><span class="line">ä¸€å·ä»»åŠ¡</span><br><span class="line">è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+<span class="number">1</span></span><br><span class="line">å¤„ç†å®Œæ¯•</span><br><span class="line">å››å·ä»»åŠ¡</span><br><span class="line"><span class="number">4</span>å¤„ç†å®Œæ¯•</span><br><span class="line">è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+<span class="number">1</span></span><br><span class="line">è‡ªå·±å¤„ç†è‡ªå·±çš„äº‹æƒ…+<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–æ–¹å¼"><a href="#å…¶ä»–æ–¹å¼" class="headerlink" title="å…¶ä»–æ–¹å¼"></a>å…¶ä»–æ–¹å¼</h2><p>åœ¨<code>nio</code>é‡Œé¢ï¼Œå…¶å®è¿˜æœ‰å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡å»ºç«‹ä¸€ä¸ªä¸»çº¿ç¨‹çš„é˜»å¡é˜Ÿåˆ—ï¼Œç„¶ååˆ†å‘ä»»åŠ¡è‡³å­çº¿ç¨‹ï¼Œå­çº¿ç¨‹è‹¥å¤„ç†å®Œæ¯•ï¼Œåˆ™æäº¤ä»»åŠ¡è‡³ä¸»çº¿ç¨‹</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SSOå•ç‚¹ç™»å½•çš„ç†è®ºä¸å®è·µ(ä¸€)</title>
      <link href="/2019/01/13/SSO%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E4%B8%80/"/>
      <url>/2019/01/13/SSO%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95%E7%9A%84%E7%90%86%E8%AE%BA%E4%B8%8E%E5%AE%9E%E8%B7%B5-%E4%B8%80/</url>
      <content type="html"><![CDATA[<h1 id="SSOç®€ä»‹"><a href="#SSOç®€ä»‹" class="headerlink" title="SSOç®€ä»‹"></a>SSOç®€ä»‹</h1><p>éšç€ä¼ä¸šä¸šåŠ¡çš„å‘å±•ï¼Œä¼ä¸šä¸­å¯èƒ½ä¼šå‡ºç°å¤šä¸ªä¸šåŠ¡çš„ç³»ç»Ÿã€‚å¦‚æœæ˜¯å¯¹å†…ä½¿ç”¨çš„è¯ï¼Œé‚£ç¨å¾®è¿˜å¥½ç‚¹ï¼Œå¦‚æœæ˜¯ToCçš„ä¸šåŠ¡ï¼Œå®¢æˆ·å¦‚æœæ¯è¿›å…¥ä¸€ä¸ªç³»ç»Ÿéƒ½éœ€è¦ç™»å½•çš„è¯ï¼Œå¯¹ç”¨æˆ·æ¥è¯´æ˜¯ä¸€ä¸ªéº»çƒ¦äº‹æƒ…ï¼Œå¾ˆå¯èƒ½ä¼šé€ æˆç”¨æˆ·çš„æµå¤±ã€‚</p><p>å¦‚æœåœ¨æ¯ä¸€ä¸ªç³»ç»Ÿé‡Œé¢éƒ½å­˜å‚¨ä¸€ä»½ç”¨æˆ·çš„è´¦å·å’Œå¯†ç æ•°æ®ï¼Œè¿™ç§åšæ³•æ˜¾ç„¶æ˜¯ä¸é è°±çš„ï¼Œè€Œä¸”ä¹Ÿä¸å®‰å…¨çš„ã€‚ä¼šé€ æˆå®¢æˆ·çš„æ•°æ®å¤§é‡å†—ä½™ï¼Œè€Œä¸”è¿˜ä¼šå¯¼è‡´åæœŸç»´æŠ¤ååˆ†çš„éº»çƒ¦ã€‚</p><p>æ‰€ä»¥ï¼Œç°åœ¨ä¸€èˆ¬éƒ½ä¼šé‡‡ç”¨SSOå•ç‚¹ç™»å½•</p><p>åœ¨ä»‹ç»<code>SSOç™»å½•</code>ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸€ä¸‹æµè§ˆå™¨çš„<strong>åŒæºç­–ç•¥</strong></p><h2 id="æµè§ˆå™¨åŒæºç­–ç•¥"><a href="#æµè§ˆå™¨åŒæºç­–ç•¥" class="headerlink" title="æµè§ˆå™¨åŒæºç­–ç•¥"></a>æµè§ˆå™¨åŒæºç­–ç•¥</h2><p>æ­¤å¤„ç›´æ¥å°†mozillaå®˜ç½‘ç»™å‡ºçš„ä»‹ç»æ¬è¿‡æ¥<code>https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy</code></p><table><thead><tr><th>URL</th><th>ç»“æœ</th><th>åŸå› </th></tr></thead><tbody><tr><td><a href="http://store.company.com/dir2/other.html" target="_blank" rel="noopener">http://store.company.com/dir2/other.html</a></td><td>æˆåŠŸ</td><td></td></tr><tr><td><a href="http://store.company.com/dir/inner/another.html" target="_blank" rel="noopener">http://store.company.com/dir/inner/another.html</a></td><td>æˆåŠŸ</td><td></td></tr><tr><td><a href="https://store.company.com/secure.html" target="_blank" rel="noopener">https://store.company.com/secure.html</a></td><td>å¤±è´¥</td><td>ä¸åŒåè®® ( httpså’Œhttp )</td></tr><tr><td><a href="http://store.company.com:81/dir/etc.html" target="_blank" rel="noopener">http://store.company.com:81/dir/etc.html</a></td><td>å¤±è´¥</td><td>ä¸åŒç«¯å£ ( 81å’Œ80)</td></tr><tr><td><a href="http://news.company.com/dir/other.html" target="_blank" rel="noopener">http://news.company.com/dir/other.html</a></td><td>å¤±è´¥</td><td>ä¸åŒåŸŸå ( newså’Œstore )</td></tr></tbody></table><blockquote><p>æ‰€ä»¥æ ¹æ®æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ŒSSOå•ç‚¹ç™»å½•åˆåˆ†ä¸ºè·¨åŸŸå’Œéè·¨åŸŸ</p></blockquote><h2 id="SSOç™»å½•"><a href="#SSOç™»å½•" class="headerlink" title="SSOç™»å½•"></a>SSOç™»å½•</h2><table><thead><tr><th>ç±»åˆ«</th><th>ç¤ºä¾‹</th><th>å®ç°è¦æ±‚</th></tr></thead><tbody><tr><td>åŒä¸€ä¸ªåŸŸåä¸‹å•ç‚¹ç™»å½•</td><td><code>a.com/user</code>,<code>a.com/order</code></td><td>ç”¨æˆ·åœ¨è®¿é—®å®Œç”¨æˆ·ç³»ç»Ÿä¹‹åï¼Œå¦‚æœè¿›å…¥è®¢å•ç³»ç»Ÿï¼Œåˆ™æ— éœ€ç™»å½•æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯</td></tr><tr><td>éåŒä¸€ä¸ªåŸŸåä¸‹SSOç™»å½•</td><td><code>a.com/user</code>,<code>b.com/user</code></td><td>å½“ç”¨æˆ·è®¿é—®aç³»ç»Ÿç„¶åå†è®¿é—®bç³»ç»Ÿï¼Œè‡ªåŠ¨è·å–ç”¨æˆ·æ•°æ®</td></tr><tr><td>å‰åç«¯åˆ†ç¦»è·¨åŸŸ</td><td>è¿™ä¸ªåªæ˜¯ä¸Šé¢éåŒæºè·¨åŸŸçš„ä¸€ä¸ªå‰åç«¯åˆ†ç¦»ç‰ˆæœ¬</td><td>å®ç°ç»†èŠ‚å¦‚ä¸Šï¼Œä¸è¿‡æ˜¯å‰ç«¯è‡ªå·±ä¸€ä¸ªæœåŠ¡å™¨</td></tr></tbody></table><p>è€Œå®ç°<code>SSOç™»å½•</code>çš„ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ç”¨æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼Œå³å¦‚ä½•ç¡®åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ç”Ÿæˆçš„ç”¨æˆ·å‡­æ®åœ¨å…¶ä»–å‡ ä¸ªç³»ç»Ÿä¸­éƒ½å¯ä»¥è¢«è¯†åˆ«ã€‚</p><h3 id="SSOç™»å½•åŒæºçš„å®ç°"><a href="#SSOç™»å½•åŒæºçš„å®ç°" class="headerlink" title="SSOç™»å½•åŒæºçš„å®ç°"></a>SSOç™»å½•åŒæºçš„å®ç°</h3><p>åŒæºä¹‹é—´çš„å®ç°æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºæ˜¯åŒæºï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡<code>cookie</code>æˆ–è€…<code>jwt</code>å®ç°ï¼Œå…·ä½“çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/sso%E5%90%8C%E6%BA%90.png" alt=""></p><p>ä»…ä»…æƒ³å®ç°åŒæºä¸‹çš„<code>SSO</code>ç™»å½•ï¼Œå®ç°çš„æ–¹å¼å¯ä»¥æœ‰å¤šç§ï¼Œä½†æ˜¯æœ€ç»ˆçš„ä¸€ç‚¹å°±æ˜¯<code>SSO</code>ç”Ÿæˆçš„ç”¨æˆ·å‡­æ®ï¼Œå…¶ä»–çš„ç³»ç»Ÿå¿…é¡»è¦å¯ä»¥è§£å¯†å‡ºæ¥ã€‚è¿™æ ·ä¸€ä¸ªåŒæºä¸‹çš„<code>SSOå•ç‚¹ç™»å½•</code>ä¾¿å¯ä»¥å®ç°</p><h3 id="SSOç™»å½•éåŒæºçš„å®ç°"><a href="#SSOç™»å½•éåŒæºçš„å®ç°" class="headerlink" title="SSOç™»å½•éåŒæºçš„å®ç°"></a>SSOç™»å½•éåŒæºçš„å®ç°</h3><p>ç”±äºæ˜¯åœ¨éåŒæºä¸‹å®ç°<code>SSOå•ç‚¹ç™»å½•</code>ï¼Œæ‰€ä»¥ä¸€ä¸ªç”¨æˆ·åœ¨<code>a.com</code>ä¸‹ç™»å½•äº†è´¦æˆ·ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·è®¿é—®<code>b.com</code>çš„æ—¶å€™ï¼Œ<code>cookie</code>è‚¯å®šæ˜¯å¸¦ä¸è¿‡å»çš„ã€‚è¿™æ—¶å€™ä¸å¦¨å‚è€ƒä¸‹ä¸šå†…çš„å…¬å¸çš„è®¾è®¡</p><h4 id="æ·˜å®å’Œå¤©çŒ«çš„å®ç°"><a href="#æ·˜å®å’Œå¤©çŒ«çš„å®ç°" class="headerlink" title="æ·˜å®å’Œå¤©çŒ«çš„å®ç°"></a>æ·˜å®å’Œå¤©çŒ«çš„å®ç°</h4><p>æ‰“å¼€æµè§ˆå™¨ï¼Œåœ¨<code>taobao.com</code>ä¸‹ç™»å½•æˆ‘ä»¬çš„è´¦å·ï¼ŒæˆåŠŸè·å–åˆ°ç”¨æˆ·ä¿¡æ¯ä¹‹åï¼Œè¿™æ—¶å€™æˆ‘ä»¬å†æ–°å»ºä¸€ä¸ªæ ‡ç­¾é¡µï¼Œç„¶åæ‰“å¼€<code>tmall.com</code>ï¼Œè¿™æ—¶å€™ä¼šå‘ç°ï¼Œå¤©çŒ«å·²ç»è‡ªåŠ¨çš„å¸®æˆ‘ä»¬ç™»å½•äº†è´¦å·ã€‚<br>è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>æ·˜å®å’Œå¤©çŒ«çš„åŸŸåå¹¶éåŒæº</li><li>æˆ‘ä»¬åªåœ¨ä¸€å¤„è¿›è¡Œäº†ç™»å½•</li><li>æˆ‘ä»¬å¹¶æœªåœ¨<code>tmall</code>åŸŸåä¸‹è¾“å…¥ä»»ä½•æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œç„¶åæˆ‘ä»¬å†æ¬¡è®¿é—®å¤©çŒ«ï¼Œå¤©çŒ«å°±è‡ªåŠ¨è¯†åˆ«å‡ºæ¥æˆ‘ä»¬äº†</li></ol><p>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬åœ¨è¯·æ±‚<code>tmall</code>ä¹‹å‰ï¼Œæ·˜å®å·²ç»å°†æˆ‘ä»¬çš„ä¿¡æ¯åŒæ­¥åˆ°äº†<code>tmall</code></p><p>æ‰€ä»¥æ ¹æ®ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œå¦‚ä½•è®©ä¸åŒç³»ç»Ÿä¹‹é—´äº’ç›¸è¯†åˆ«ç”¨æˆ·</p><p>å¸¸è§çš„éåŒæºSSOç™»å½•ä½“ç³»ä¸­ä¸€èˆ¬æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æˆæƒä¸­å¿ƒï¼Œå†åŠ ä¸Šä¸€ä¸ªå…±ç”¨çš„ç”¨æˆ·å‡­æ®å­˜å‚¨ä¸­å¿ƒï¼Œå¦‚ä¸‹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/sso2.png" alt=""></p><p>åœ¨ä¸Šå›¾çš„æµç¨‹ä¸­ï¼Œä¸ä»…å¯ä»¥é€šè¿‡<code>jsonp</code>æ¥è¿›è¡Œä¼ è¾“ï¼Œè¿˜å¯ä»¥é€šè¿‡<code>iframe</code>è¿›è¡Œé€šä¿¡(æ·˜å®å’Œå¤©çŒ«çš„åšæ³•)ï¼Œ</p><p>è¿™ä¸ªç®€å•ç‰ˆçš„<code>SSO</code>ç™»å½•ï¼Œä¸»è¦æ˜¯é€šè¿‡cookiesæ¥å­˜å‚¨tokenï¼Œç„¶åè¿›è¡Œæ¯ä¸ªè·¨åŸŸç³»ç»Ÿçš„äº¤äº’ï¼Œå½“ç„¶è¿™ä¸ªæ–¹å¼æ˜¯æœ‰ç‘•ç–µçš„ï¼Œå› ä¸ºè¿™ç§æ–¹å¼åœ¨è·¨åŸŸç³»ç»Ÿå¤šçš„æ—¶å€™ï¼Œéœ€è¦ç»´æŠ¤å¤šä¸ªè·¨åŸŸç³»ç»Ÿï¼Œä»£ç ä¼šå†™çš„æ¯”è¾ƒå¤šï¼ŒåæœŸå¦‚æœæ–°å¢æˆ–è€…åˆ é™¤ä¸€ä¸ªç³»ç»Ÿçš„è¯ï¼Œéœ€è¦éœ€æ”¹jsæ–‡ä»¶ï¼Œå°±ä¼šæ˜¾å¾—å¾ˆç¹çã€‚</p><h2 id="å®ç°ï¼š"><a href="#å®ç°ï¼š" class="headerlink" title="å®ç°ï¼š"></a>å®ç°ï¼š</h2><p>ç”±äºåŒæºä¸‹çš„<code>SSOç™»å½•</code>å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥æ­¤æ¬¡ç›´æ¥å®ç°å‰åç«¯åˆ†ç¦»çš„SSOå•ç‚¹ç™»å½•</p><p>å¯ä»¥çœ‹ä¸‹éåŒæºä¸‹çš„å®ç°ï¼š</p><blockquote><p>æ‰€ç”¨æŠ€æœ¯:SprngCloud,redis,vue</p></blockquote><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/jc5gk-wxd0.gif" alt=""></p><p>é¦–å…ˆåˆ†åˆ«è®¿é—®<code>http://localhost:8092/#/orderinfo</code>å’Œ<code>http://localhost:8091/#/orderinfo</code>,è¿™ä¸ªæ—¶å€™ç”±äºéƒ½æ²¡æœ‰ç™»å½•ï¼Œæ‰€ä»¥ç›´æ¥è¢«é‡å®šå‘åˆ°ç™»å½•ç•Œé¢ï¼Œä½†æ˜¯åœ¨<code>http://localhost:8092/#/</code>ç™»å½•ä¹‹åï¼Œå†æ¬¡è®¿é—®<code>http://localhost:8091/#/orderinfo</code>ï¼Œå¯ä»¥çœ‹åˆ°<code>8092</code>ç«¯å£çš„æœåŠ¡ç›´æ¥è¯†åˆ«å‡ºæ¥äº†æ˜¯è¯¥ç”¨æˆ·</p><p>è¿™é‡Œæœ‰ä¸¤ä¸ªæ³¨æ„ç‚¹ï¼šé¦–å…ˆï¼Œæˆ‘åœ¨<code>8092</code>ç«¯å£çš„æœåŠ¡å™¨ä¸Šå¹¶æœªç™»å½•è¿‡ï¼Œè€Œä¸”<code>8091</code>æœåŠ¡å’Œ<code>8092</code>æœåŠ¡æ˜¯ä¸€ä¸ªéåŒæºæœåŠ¡ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾<code>8091</code>æœåŠ¡æ˜¯æ— æ³•å°†<code>cookie</code>ç»™åˆ°<code>8092</code>æœåŠ¡å™¨ã€‚</p><h3 id="é¡¹ç›®ç»“æ„ï¼š"><a href="#é¡¹ç›®ç»“æ„ï¼š" class="headerlink" title="é¡¹ç›®ç»“æ„ï¼š"></a>é¡¹ç›®ç»“æ„ï¼š</h3><p>æ­¤æ¬¡çš„é¡¹ç›®ç»“æ„æ˜¯ä¸€ä¸ª<code>Auth</code>è®¤è¯ä¸­å¿ƒï¼Œ<code>ä¸¤ä¸ªåç«¯ç³»ç»Ÿ</code>ï¼Œ<code>ä¸¤ä¸ªå‰ç«¯ç³»ç»Ÿ</code>ã€‚è€Œä¸”ä¸€ä¸ªå‰ç«¯åˆ†åˆ«å¯¹åº”ä¸€ä¸ªåç«¯ç³»ç»Ÿ</p><h3 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h3><p>é¦–å…ˆä¸¤ä¸ªå­ç³»ç»Ÿçš„è®¤è¯åˆ†åˆ«æ˜¯åŸºäºcookieï¼Œç„¶åå°†<code>tokan</code>å­˜å…¥cookieï¼Œé¦–æ¬¡ç™»å½•çš„æ—¶å€™ï¼Œcookieè‚¯å®šæ˜¯ä¸å­˜åœ¨çš„ï¼Œç„¶åé‡å®šå‘è‡³<code>SSOç™»å½•ç³»ç»Ÿ</code>,<code>SSO</code>è®¤è¯ä¹‹åä¼šä¸‹å‘ä¸€ä¸ª<code>token</code>ï¼Œç„¶åç™»å½•çš„ç³»ç»Ÿä¼šå°†æ­¤tokenä»¥<code>get</code>çš„æ–¹å¼ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªä¸ªç³»ç»Ÿï¼Œå¦ä¸€ä¸ªç³»ç»Ÿå†å°†æ­¤<code>token</code>å­˜å…¥<code>cookie</code>è¿›è¡Œå›å†™ï¼Œæœ€ç»ˆå®ç°ä¸¤ä¸ªç³»ç»Ÿéƒ½ä¸€èµ·ç™»å½•</p><p>###å›è°ƒå®ç°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(ApiConstant.APP+<span class="string">"/&#123;token&#125;"</span>)</span><br><span class="line">   <span class="function"><span class="keyword">public</span> ResponseUtils <span class="title">getInfo</span><span class="params">(@PathVariable String token , HttpServletResponse response)</span></span>&#123;</span><br><span class="line">       ResponseUtils&lt;String&gt; resp = <span class="keyword">new</span> ResponseUtils&lt;String&gt;();</span><br><span class="line">       ResponseEnum.SUCCESS.setResponse(resp);</span><br><span class="line">       response.addCookie(<span class="keyword">new</span> Cookie(<span class="string">"token"</span>,token));</span><br><span class="line">       <span class="keyword">return</span> resp;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>è·å–<code>SSOç™»å½•</code>è¿”å›çš„<code>token</code>ç„¶åè°ƒç”¨å„ä¸ªè·¨åŸŸç³»ç»Ÿ<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">setApp1Token (userdata) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(userdata)</span><br><span class="line">      <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">        method: <span class="string">'get'</span>,</span><br><span class="line">        url: <span class="string">'http://localhost:8083/api/app1/query/'</span> + userdata</span><br><span class="line">      &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">this</span>.$http(&#123;</span><br><span class="line">        method: <span class="string">'get'</span>,</span><br><span class="line">        url: <span class="string">'http://localhost:8085/api/app2/query/'</span> + userdata</span><br><span class="line">      &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> <span class="string">'OK'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure></p><h2 id="é¡¹ç›®åœ°å€"><a href="#é¡¹ç›®åœ°å€" class="headerlink" title="é¡¹ç›®åœ°å€"></a>é¡¹ç›®åœ°å€</h2><blockquote><p><a href="https://github.com/Somersames/Springboot-vue-sso" target="_blank" rel="noopener">https://github.com/Somersames/Springboot-vue-sso</a><br>è¯¥é¡¹ç›®ä¸ºäº†éªŒè¯ï¼Œä»…ä»…æ˜¯ç”¨userIdè¿›è¡Œmd5åŠ å¯†ä½œä¸ºtokenï¼Œæ‰€ä»¥æ¯”è¾ƒç®€é™‹ï¼Œä½†æ˜¯ä»¥åå¦‚æœæœ‰æ—¶é—´ä¼šç»§ç»­å†™å‡ ç¯‡æ–‡ç« åŒæ—¶ä¹Ÿå°†è¿™ä¸ªé¡¹ç›®è¡¥èµ·æ¥</p></blockquote>]]></content>
      
      <categories>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Springboot </tag>
            
            <tag> SSO </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨Springä¸­å…¨å±€å¤„ç†å¼‚å¸¸</title>
      <link href="/2019/01/10/%E5%9C%A8Spring%E4%B8%AD%E5%85%A8%E5%B1%80%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8/"/>
      <url>/2019/01/10/%E5%9C%A8Spring%E4%B8%AD%E5%85%A8%E5%B1%80%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8/</url>
      <content type="html"><![CDATA[<p>éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œåœ¨æ¯ä¸€ä¸ªä¸šåŠ¡æ¨¡å—é‡Œé¢éƒ½å¯èƒ½ä¼šå‡ºç°ä¸€äº›è‡ªå®šä¹‰çš„é€šç”¨å¼‚å¸¸ï¼Œä¾‹å¦‚Â·<code>éªŒè¯å¤±è´¥</code>ï¼Œ<code>æƒé™ä¸è¶³</code>ç­‰ç­‰ ï¼Œè¿™äº›è‡ªå®šä¹‰çš„å¼‚å¸¸å¾ˆå¯èƒ½ä¼šè¢«æ‰€æœ‰æ¨¡å—å…¬ç”¨ï¼Œåœ¨ä»£ç é‡Œé¢ï¼Œæœ€å¸¸è§çš„ä¸€ç§å†™æ³•æ˜¯åœ¨æ¯ä¸€ä¸ªæ–¹æ³•é‡Œé¢è¿›è¡Œæ•è·ï¼Œç„¶ååœ¨<code>Controller</code>é‡Œé¢è¿›è¡Œcatchï¼Œæœ€åè¿›è¡Œç›¸åº”å¤„ç†</p><h2 id="å¸¸è§å†™æ³•"><a href="#å¸¸è§å†™æ³•" class="headerlink" title="å¸¸è§å†™æ³•"></a>å¸¸è§å†™æ³•</h2><p><strong>ç¬¬ä¸€ç§å†™æ³•ï¼š</strong></p><p>è¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„å†™æ³•ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½å¤„ç†è‡ªå·±çš„ç‰¹å®šå¼‚å¸¸<br><strong>Controllerå±‚</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">//é€»è¾‘å¤„ç†</span></span><br><span class="line">  &#125;<span class="keyword">catch</span>(AuthException e)&#123;</span><br><span class="line">      XXX</span><br><span class="line">  &#125;<span class="keyword">catch</span>(CrsfException e)&#123;</span><br><span class="line">      XXX</span><br><span class="line">  &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      XXX</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·çš„ä»£ç å¦‚æœåˆ†å¸ƒåœ¨ä¸åŒçš„<code>Controller</code>é‡Œé¢ï¼Œå°†ä¼šæ˜¯ä¸€ç§éšæ‚£ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€å¤©ï¼Œéœ€è¦å¯¹æ‰€æœ‰çš„<code>AuthException</code>å¼‚å¸¸éƒ½æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œç”¨äºå‰ç«¯çš„é¡µé¢å±•ç¤ºï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬å°±éœ€è¦åœ¨ä»£ç é‡Œé¢æ‰¾å‡ºæ‰€æœ‰çš„<code>AuthException</code>ï¼Œç„¶åå†æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„å­—æ®µï¼Œå¦‚æœæ¼æ‰äº†å‡ ä¸ªï¼Œå°±ä¼šå¼•èµ·ä¸€äº›bugã€‚</p><p><strong>ç¬¬äºŒç§å†™æ³•ï¼š</strong></p><p>ç¬¬äºŒç§å†™æ³•å‡ ä¹å’Œç¬¬ä¸€ç§ä¸€æ ·ï¼Œä¸è¿‡ä¸åŒä¹‹å¤„åœ¨äºç¬¬äºŒç§å†™æ³•æ˜¯ç¼–å†™äº†ä¸€ä¸ªå…¬å…±çš„å¤„ç†æ–¹æ³•.</p><p><strong>Controllerå±‚</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(value=<span class="string">"login"</span>,methods=Request.POST)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">login</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">      <span class="comment">//é€»è¾‘å¤„ç†</span></span><br><span class="line">  &#125;<span class="keyword">catch</span>(AuthException e)&#123;</span><br><span class="line">      ExceptionHandle.handleAuthException();</span><br><span class="line">  &#125;<span class="keyword">catch</span>(CrsfException e)&#123;</span><br><span class="line">      XXX</span><br><span class="line">  &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">      XXX</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>å…±ç”¨æ–¹æ³•</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">ExceptionHandle</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">handleAuthException</span><span class="params">()</span></span>&#123;</span><br><span class="line">        XXX<span class="comment">//é€»è¾‘å¤„ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ç§æ–¹æ³•è™½ç„¶æ¯”ç¬¬ä¸€ç§æ›´åŠ å…·æœ‰å…±ç”¨æ€§ï¼Œä½†æ˜¯ä»£ç ä¸€ç‚¹éƒ½ä¸æ•´æ´å’Œä¾¿äºç»´æŠ¤ã€‚ä¾‹å¦‚ï¼Œç°åœ¨éœ€è¦å†æ¬¡åŠ ä¸€ä¸ªå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±åªèƒ½æ˜¯åœ¨<code>Controller</code>é‡Œé¢å†æ¬¡<code>Catch</code>ï¼Œå¦‚æœæ˜¯å¢åŠ è¿˜å¥½ï¼Œä½†æ˜¯ä¸€æ—¦éœ€è¦é‡Œé¢æ—¢åŒ…å«å¢åŠ åˆåŒ…å«åˆ é™¤ï¼Œå¯¹äºç»´æŠ¤äººå‘˜ï¼Œè¿™æ˜¯ææ˜“å‡ºé”™çš„ã€‚</p><h2 id="Springçš„å…¨å±€å¤„ç†å¼‚å¸¸"><a href="#Springçš„å…¨å±€å¤„ç†å¼‚å¸¸" class="headerlink" title="Springçš„å…¨å±€å¤„ç†å¼‚å¸¸"></a>Springçš„å…¨å±€å¤„ç†å¼‚å¸¸</h2><p>å…¶å®åœ¨Springé‡Œé¢æœ‰æ›´åŠ ä¼˜é›…çš„å¤„ç†æ–¹å¼ï¼Œé‚£å°±æ˜¯å…¨å±€çš„å¼‚å¸¸å¤„ç†ï¼Œå¯¹äºä¸€äº›å¸¸ç”¨çš„å¼‚å¸¸ï¼Œç›´æ¥åœ¨<code>Controller</code>é‡Œé¢æŠ›å‡ºï¼Œè€Œå¯¹äºæŸä¸€äº›æ–¹æ³•çš„ç‰¹å®šå¼‚å¸¸ï¼Œåˆ™åªéœ€è¦è‡ªå·±è¿›è¡Œæ•è·ï¼Œç„¶åè‡ªå·±è¿›è¡Œå¤„ç†</p><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>åœ¨Springé‡Œé¢å¯ä»¥ä½¿ç”¨<code>@RestControllerAdvice</code>æˆ–<code>@ControllerAdvice</code>ï¼Œç„¶åé…åˆ<code>@ExceptionHandler</code>è¿›è¡Œå¤„ç†ï¼Œè¿™æ ·å¤„ç†å¯ä»¥ä½¿çš„é¡¹ç›®åœ¨æ•´ä¸ªå¼‚å¸¸å¤„ç†è¿™å—ååˆ†çš„é€šç”¨å’Œä¼˜é›…</p><p><strong>å¼‚å¸¸å¤„ç†ç±»</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AuthException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AuthException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AuthException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AuthException</span><span class="params">(String message, Exception e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>å…¨å±€çš„å¼‚å¸¸å¤„ç†ç±»</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionHandle</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(AuthException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">handleAuthException</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ResponseEntity&lt;String&gt; resp = <span class="keyword">new</span> ResponseEntity&lt;&gt;();</span><br><span class="line">        resp.setCode(<span class="number">201</span>);</span><br><span class="line">        resp.setMessage(<span class="string">"éªŒè¯å¤±è´¥"</span>);</span><br><span class="line">        resp.setData(<span class="string">"å…¨å±€å¼‚å¸¸æ‰€æŠ›å‡ºçš„å¼‚å¸¸"</span>);</span><br><span class="line">        <span class="keyword">return</span> resp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>Controller</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ExceptionService exceptionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"auth"</span>,method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">testAuth</span><span class="params">(@RequestBody String param)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        ResponseEntity&lt;String&gt; resp = <span class="keyword">new</span> ResponseEntity&lt;String&gt;();</span><br><span class="line">        exceptionService.auth(param);</span><br><span class="line">        resp.setCode(<span class="number">200</span>);</span><br><span class="line">        resp.setMessage(<span class="string">"OK"</span>);</span><br><span class="line">        resp.setData(<span class="string">"Controlleræ¶ˆæ¯"</span>);</span><br><span class="line">        <span class="keyword">return</span> resp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>Service</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">auth</span><span class="params">(String param)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"1"</span>.equalsIgnoreCase(param))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthException(<span class="string">"éæ³•è®¿é—®"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æµ‹è¯•å¦‚ä¸‹ï¼š"><a href="#æµ‹è¯•å¦‚ä¸‹ï¼š" class="headerlink" title="æµ‹è¯•å¦‚ä¸‹ï¼š"></a>æµ‹è¯•å¦‚ä¸‹ï¼š</h3><p>è¯·æ±‚<code>api/auth</code>ï¼Œå¹¶ä¸”æºå¸¦å‚æ•°<code>1</code><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"data"</span>: <span class="string">"å…¨å±€å¼‚å¸¸æ‰€æŠ›å‡ºçš„å¼‚å¸¸"</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">201</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"éªŒè¯å¤±è´¥"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¯·æ±‚<code>api/auth</code>ï¼Œå¹¶ä¸”æºå¸¦å‚æ•°<code>2</code><br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"data"</span>: <span class="string">"Controlleræ¶ˆæ¯"</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">200</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"OK"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="å¢åŠ ç‰¹æ®Šå¤„ç†"><a href="#å¢åŠ ç‰¹æ®Šå¤„ç†" class="headerlink" title="å¢åŠ ç‰¹æ®Šå¤„ç†"></a>å¢åŠ ç‰¹æ®Šå¤„ç†</h3><p>è¿™æ ·ä¸€æ¥ï¼Œæ‰€æœ‰çš„<code>AuthException</code>éƒ½å¯ä»¥è¢«ç»Ÿä¸€çš„è¿›è¡Œå¤„ç†ï¼Œè€Œä¸”æ ¹æ®ä¸šåŠ¡çš„éœ€è¦ä»¬å¯ä»¥åœ¨<code>Controller</code>å¢åŠ ä¸€äº›ç‰¹å®šçš„å¼‚å¸¸</p><blockquote><p><strong>æ­¤å¤„ä»¥NullPointerExceptionä»£æ›¿</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(value = <span class="string">"api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ExceptionService exceptionService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"auth"</span>,method = RequestMethod.POST)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title">testAuth</span><span class="params">(@RequestBody String param)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        ResponseEntity&lt;String&gt; resp = <span class="keyword">new</span> ResponseEntity&lt;String&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            exceptionService.auth(param);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (NullPointerException e)&#123;</span><br><span class="line">            resp.setCode(<span class="number">400</span>);</span><br><span class="line">            resp.setMessage(<span class="string">"NUll"</span>);</span><br><span class="line">            resp.setData(<span class="string">"Null"</span>);</span><br><span class="line">            <span class="keyword">return</span> resp;</span><br><span class="line">        &#125;</span><br><span class="line">        resp.setCode(<span class="number">200</span>);</span><br><span class="line">        resp.setMessage(<span class="string">"OK"</span>);</span><br><span class="line">        resp.setData(<span class="string">"Controlleræ¶ˆæ¯"</span>);</span><br><span class="line">        <span class="keyword">return</span> resp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">auth</span><span class="params">(String param)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"1"</span>.equalsIgnoreCase(param))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthException(<span class="string">"éæ³•è®¿é—®"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">"3"</span>.equals(param))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å†æ¬¡æµ‹è¯•"><a href="#å†æ¬¡æµ‹è¯•" class="headerlink" title="å†æ¬¡æµ‹è¯•"></a>å†æ¬¡æµ‹è¯•</h3><p>è¯·æ±‚<code>api/auth</code>ï¼Œå¹¶ä¸”æºå¸¦å‚æ•°<code>3</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"data"</span>: <span class="string">"Null"</span>,</span><br><span class="line">    <span class="attr">"code"</span>: <span class="number">400</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"NUll"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ­¤æ–¹æ³•è™½ç„¶å¯ä»¥ç»Ÿä¸€çš„å¤„ç†é¡¹ç›®é‡Œé¢çš„å¼‚å¸¸ï¼Œä½†æ˜¯å¯¹é¡¹ç›®å†…çš„å¼€å‘äººå‘˜è¦æ±‚è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œéœ€è¦ä¸€èµ·éµå®ˆç»Ÿä¸€çš„å¼€å‘è§„èŒƒ</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Springbootä¸­ä½¿ç”¨Mysqlå¤šæ•°æ®æº</title>
      <link href="/2019/01/06/Springboot%E4%B8%AD%E4%BD%BF%E7%94%A8Mysql%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/"/>
      <url>/2019/01/06/Springboot%E4%B8%AD%E4%BD%BF%E7%94%A8Mysql%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90/</url>
      <content type="html"><![CDATA[<p>éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œå¾ˆå¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œé¢åŒæ—¶ä½¿ç”¨å¤šä¸ªæ•°æ®æºã€‚</p><p>å¤§è‡´çœ‹äº†ç½‘ä¸Šçš„å¤šæ•°æ®æºDemoï¼Œå‘ç°æ— éæœ‰ä¸¤ç§ï¼š</p><blockquote><p>ä¸€ç§æ˜¯è‡ªå·±å°è£…å¤šä¸ª<code>JdbcTemplate</code>ï¼Œç„¶åè°ƒç”¨å¯¹åº”çš„æ•°æ®åº“å°±ä½¿ç”¨å¯¹åº”çš„<code>JdbcTemplate</code></p></blockquote><blockquote><p>ä¸€ç§æ˜¯é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥å®ç°ï¼Œåœ¨éœ€è¦åˆ‡æ¢æ•°æ®æºçš„æ–¹æ³•ä¸Šæ·»åŠ ä¸€ä¸ªè‡ªå·±å°è£…çš„æ³¨è§£ä¾¿å¯ä»¥å®Œæˆåˆ‡æ¢ã€‚</p></blockquote><p>è€ƒè™‘äº†ä¸€ä¸‹ä»¥åçš„æ‰©å±•æ€§å’Œé€šç”¨æ€§ï¼Œä¾¿å†³å®šé‡‡ç”¨åŸºäºæ³¨è§£çš„å¤šæ•°æ®æºæ–¹å¼</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>çœ‹äº†ä¸‹å®˜ç½‘çš„ä»‹ç»ï¼Œå¤§è‡´äº†è§£äº†åœ¨Springä¸­ä½¿ç”¨å¤šæ•°æ®æºçš„ä¸€ä¸ªå…³é”®ç±»æ˜¯<code>AbstractRoutingDataSource</code>ã€‚</p><p>å…ˆçœ‹ä¸‹è¿™ä¸ªç±»çš„ç»“æ„<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E8%B7%AF%E7%94%B1%E7%B1%BB%E5%9B%BE.png" alt=""></p><p>åœ¨è¿™ä¸ªç±»é‡Œé¢ï¼Œåªéœ€è¦å…³æ³¨ä¸€ä¸‹å‡ ä¸ªå˜é‡æˆ–è€…æ–¹æ³•å³å¯ã€‚</p><blockquote><ol><li>private Map&lt;Object, Object&gt; targetDataSources; </li><li>private Object defaultTargetDataSource;</li><li>protected Object determineCurrentLookupKey()</li></ol></blockquote><h3 id="targetDataSources"><a href="#targetDataSources" class="headerlink" title="targetDataSources"></a>targetDataSources</h3><p>è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®æºçš„Mapï¼Œå…¶å®ä¸€èˆ¬åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæ›´åŠ åƒæ˜¯<code>Map&lt;String, DataSource&gt;</code>è¿™æ ·çš„ï¼Œå…¶ä¸­keyè¡¨ç¤ºçš„æ˜¯è¿™ä¸ªæ•°æ®æºçš„åç§°ï¼Œè€Œvalueåˆ™æ˜¯è¡¨ç¤ºè¿™ä¸ªDataSourceçš„ä¿¡æ¯(ä¾‹å¦‚urlï¼Œusernameç­‰)</p><h3 id="defaultTargetDataSource"><a href="#defaultTargetDataSource" class="headerlink" title="defaultTargetDataSource"></a>defaultTargetDataSource</h3><p>è¯¥å˜é‡è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªé»˜è®¤çš„æ•°æ®æºï¼Œéç©ºï¼Œå¿…é¡»è®¾ç½®</p><h3 id="determineCurrentLookupKey"><a href="#determineCurrentLookupKey" class="headerlink" title="determineCurrentLookupKey"></a>determineCurrentLookupKey</h3><p>è¯¥æ–¹æ³•è¿”å›çš„ä¸€ä¸ª<code>targetDataSources</code>é‡Œé¢çš„é”®ï¼Œç”¨äºé€‰æ‹©æŸä¸€ä¸ªæ•°æ®æºã€‚å…¶ä¸­å¤šæ•°æ®æºçš„åˆ‡æ¢å°±æ˜¯æ§åˆ¶è¯¥æ–¹æ³•çš„è¿”å›å€¼æ¥å®ç°ã€‚</p><blockquote><p>è¯¥æ–¹æ³•è¿”å›çš„æ˜¯<code>targetDataSources</code>é‡Œé¢çš„é”®ï¼Œä»è€Œ<code>HikariPool</code>å¯ä»¥ç›´æ¥åˆ‡æ¢æ•°æ®æº</p></blockquote><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>é¦–å…ˆæ˜¯é€šè¿‡è¯»å–é…ç½®æ–‡ä»¶ï¼Œå°†å…¶è½¬ä¸ºDataSourceï¼Œç„¶åå†å°†dataSourceå­˜å…¥<code>targetDataSources</code></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>é…ç½®æ–‡ä»¶<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">multi-resource</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    mysql1:</span></span><br><span class="line"><span class="attr">      driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">      jdbc-url:</span> <span class="attr">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">    mysql2:</span></span><br><span class="line"><span class="attr">      driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">      jdbc-url:</span> <span class="attr">jdbc:mysql://localhost:3306/cloud?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">      username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">      password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">  aop:</span></span><br><span class="line"><span class="attr">    auto:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    proxy-target-class:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>è·å–é…ç½®æ–‡ä»¶ä¿¡æ¯<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlMultiProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(MysqlMultiProperties.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"mysql1"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"spring.datasource.mysql1"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">mysql1Source</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">"æ­£åœ¨åˆå§‹åŒ–Mysql_DB1"</span>);</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>(<span class="string">"mysql2"</span>)</span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(<span class="string">"spring.datasource.mysql2"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">mysql2Source</span><span class="params">()</span></span>&#123;</span><br><span class="line">        log.info(<span class="string">"æ­£åœ¨åˆå§‹åŒ–Mysql_DB2"</span>);</span><br><span class="line">        <span class="keyword">return</span> DataSourceBuilder.create().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®ç°<code>AbstractRoutingDataSource</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceRouter</span> <span class="keyword">extends</span> <span class="title">AbstractRoutingDataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;String&gt; contextHolder = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">determineCurrentLookupKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getDataSource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setDataSource</span><span class="params">(String dataSource)</span> </span>&#123;</span><br><span class="line">        contextHolder.set(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> contextHolder.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®ä¾‹åŒ–Bean<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"mysql1"</span>)</span><br><span class="line">    DataSource mysql1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier</span>(<span class="string">"mysql2"</span>)</span><br><span class="line">    DataSource mysql2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSourceRouter <span class="title">generateRouter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        DataSourceRouter router =<span class="keyword">new</span> DataSourceRouter();</span><br><span class="line">        Map&lt;Object,Object&gt; targetMap = <span class="keyword">new</span> HashMap&lt;Object, Object&gt;();</span><br><span class="line">        targetMap.put(<span class="string">"mysql1"</span>,mysql1);</span><br><span class="line">        targetMap.put(<span class="string">"mysql2"</span>,mysql2);</span><br><span class="line">        router.setTargetDataSources(targetMap);</span><br><span class="line">        router.setDefaultTargetDataSource(mysql1);</span><br><span class="line">        router.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> router;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="AOPåˆ‡é¢"><a href="#AOPåˆ‡é¢" class="headerlink" title="AOPåˆ‡é¢"></a>AOPåˆ‡é¢</h3><p><strong>åœ¨ä½¿ç”¨åˆ‡é¢çš„æ—¶å€™é‡åˆ°äº†ä¸€äº›å‘ï¼Œè¿™ä¸ªæœ‰ç©ºå†è¯´</strong></p><p>æ–°å»ºä¸€ä¸ªæ³¨è§£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> UseDataSource &#123;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ–°å»ºä¸€ä¸ªåˆ‡é¢ç±»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order</span>(-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlSourceAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"@annotation(useDataSource)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeMysqlSource</span><span class="params">(UseDataSource useDataSource)</span></span>&#123;</span><br><span class="line">        DataSourceRouter.setDataSource(useDataSource.name());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‡³æ­¤å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½å·²ç»å®ç°äº†ï¼Œåœ¨Springbootçš„å¯åŠ¨ç±»ä¸Šæ·»åŠ æˆ–ä¿®æ”¹å¦‚ä¸‹æ³¨è§£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span>(exclude=&#123;DataSourceAutoConfiguration.class&#125;)</span><br><span class="line"><span class="meta">@MapperScan</span>(basePackages = <span class="string">"com.somersames.dao"</span>)</span><br><span class="line"><span class="meta">@Import</span>(&#123;MysqlConfig.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ServiceApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åªéœ€è¦åœ¨åˆ‡æ¢æ•°æ®æºçš„åœ°æ–¹æ·»åŠ <code>@UseDataSource</code>æ³¨è§£å³å¯ã€‚</p><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/Somersames/Multi-Resource" target="_blank" rel="noopener">https://github.com/Somersames/Multi-Resource</a></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡åœ¨ç¼–å†™AOPéƒ¨åˆ†çš„æ—¶å€™éœ€è¦äº†ä¸€ç‚¹å°å‘ï¼Œæœ‰ç©ºä¼šæ•´ç†å‡ºæ¥</p>]]></content>
      
      <categories>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Springboot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaçš„volatileå’ŒMESIåè®®</title>
      <link href="/2019/01/05/Java%E7%9A%84volatile%E5%92%8CMESI%E5%8D%8F%E8%AE%AE/"/>
      <url>/2019/01/05/Java%E7%9A%84volatile%E5%92%8CMESI%E5%8D%8F%E8%AE%AE/</url>
      <content type="html"><![CDATA[<p>ä½¿ç”¨è¿‡Javaå¤šçº¿ç¨‹çš„éƒ½çŸ¥é“ï¼Œ<code>volatile</code>å¯ä»¥ç¡®ä¿å¤šçº¿ç¨‹æ°¸è¿œéƒ½å¯ä»¥è¯»å–åˆ°æœ€æ–°çš„å˜é‡ã€‚ä½†æ˜¯å´æ— æ³•ä¿è¯ä¸€ä¸ªæ“ä½œçš„åŸå­æ€§<br>å…³äºè¿™éƒ¨åˆ†å¯ä»¥å…ˆä»ç¡¬ä»¶éƒ¨åˆ†è¯´èµ·ï¼š</p><h1 id="ç¡¬ä»¶"><a href="#ç¡¬ä»¶" class="headerlink" title="ç¡¬ä»¶"></a>ç¡¬ä»¶</h1><h2 id="å•æ ¸CPU"><a href="#å•æ ¸CPU" class="headerlink" title="å•æ ¸CPU"></a>å•æ ¸CPU</h2><p>åœ¨ç°ä»£è®¡ç®—æœºä¸­ï¼ŒCPUçš„é€Ÿåº¦æ˜¯è¿œè¿œå¿«äºå†…å­˜çš„ï¼Œå¦‚æœä¸åŠ ä»¥ä»»ä½•å¤„ç†ï¼Œæ­¤æ—¶CPUå°±ä¼šä¸€ç›´åœ¨ç­‰å¾…å†…å­˜çš„IOï¼Œä»è€Œå¯¼è‡´ä¸€äº›èµ„æºçš„æµªè´¹ã€‚æ‰€ä»¥å°±æœ‰äº†é«˜é€Ÿç¼“å†²åŒº(cache)ï¼Œä½†æ˜¯åœ¨Cacheé‡Œé¢è‚¯å®šæ˜¯ä¸ä¼šå°†å†…å­˜çš„æ‰€æœ‰æ•°æ®éƒ½æ‹·è´ä¸€ä»½ï¼Œå› ä¸ºcacaheåªæœ‰å‡ åkbçš„å¤§å°ã€‚ </p><p>è¿™å°±é€ æˆäº†ä¸€ä¸ªç°è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªæ ¸å¿ƒéƒ½ä¼šæœ‰ä¸€ä¸ªå…±äº«çš„å†…å­˜åŒºåŸŸå’Œä¸€ä¸ªè‡ªå·±CacheåŒºåŸŸã€‚</p><h2 id="å¤šæ ¸CPU"><a href="#å¤šæ ¸CPU" class="headerlink" title="å¤šæ ¸CPU"></a>å¤šæ ¸CPU</h2><p>éšç€ç°ä»£æŠ€æœ¯çš„å‘å±•ï¼Œå•æ ¸CPUå·²ç»è¢«æ·˜æ±°äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å¤šæ ¸CPUï¼Œè€Œä¸”ç°ä»£çš„CPUå·²ç»éƒ½æ˜¯å¤šçº§ç¼“å­˜äº†ï¼Œå¤§éƒ¨åˆ†æ˜¯ä¸‰çº§ç¼“å­˜ã€‚åœ¨å¤šæ ¸å¿ƒçš„CPUä¸­ï¼Œæ¯ä¸€ä¸ªæ ¸å¿ƒéƒ½ä¼šæœ‰è‡ªå·±çš„Cacheï¼Œå¦‚æœæŸä¸€ä¸ªæ ¸å¿ƒä¿®æ”¹äº†è‡ªå·±ç¼“å­˜åŒºçš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆè‡ªå·±çš„ç¼“å­˜åŒºå’Œå†…å­˜ä¸­æ•°æ®ä¸ä¸€è‡´ æ‰€ä»¥è¿™æ—¶å€™å°±ä¼šæœ‰ä¸€ä¸ª<code>MESI</code>åè®®(ç¼“å­˜ä¸€è‡´æ€§)</p><h2 id="MESIåè®®"><a href="#MESIåè®®" class="headerlink" title="MESIåè®®"></a>MESIåè®®</h2><p><code>MESI</code>åè®®ç®€å•æ¥è®²ï¼Œå°±æ˜¯ä¸ºäº†ç¡®ä¿æ¯ä¸€ä¸ªæ ¸å¿ƒçš„ç¼“å­˜æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚å½“æœ‰ä¸€ä¸ªæ ¸å¿ƒå¯¹æŸä¸€ä¸ªå˜é‡åšäº†ä¿®æ”¹ä¹‹åï¼Œå°±ä¼šé€šçŸ¥åˆ°å…¶ä»–çš„æ ¸å¿ƒï¼Œç„¶åä½¿å…¶å¤±æ•ˆã€‚</p><h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h2><p>åœ¨äº†è§£<code>volatile</code>ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦äº†è§£Javaçš„å†…å­˜æ¨¡å‹<code>JMM</code>ï¼Œåœ¨Javaå†…å­˜æ¨¡å‹ä¸­ï¼Œå †æ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/JMM%E6%A8%A1%E5%9E%8B%E5%92%8Ccpu.png" alt=""></p><p>å›¾ä¸­å³æ˜¯JMMæ¨¡å‹å¯¹ç¡¬ä»¶çš„ç®€å•æ˜ å°„ï¼Œåœ¨Javaé‡Œé¢ï¼Œå¯¹è±¡éƒ½æ˜¯åœ¨å †ä¸­ï¼Œè€Œåœ¨çº¿ç¨‹çš„ç§æœ‰æ ˆç©ºé—´ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹åªèƒ½å¯¹å˜é‡è¿›è¡Œä¿®æ”¹æˆ–è€…èµ‹å€¼æ“ä½œã€‚</p><h2 id="volatile-1"><a href="#volatile-1" class="headerlink" title="volatile"></a>volatile</h2><p>é¦–å…ˆå¤šçº¿ç¨‹çš„æœ¬è´¨å…¶å®æ˜¯å¤šä¸ªçº¿ç¨‹è½®æµæ‰§è¡Œï¼Œåœ¨<code>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</code>é‡Œé¢ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šè·å–åˆ°ä¸€ä¸ªæ‰§è¡Œæ—¶é—´ï¼Œæ‰§è¡Œæ—¶é—´ç»“æŸï¼Œå°±ä¼šè½®åˆ°å…¶ä»–çš„çº¿ç¨‹æ‰§è¡Œã€‚</p><h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><p>è€ƒè™‘ä¸€ä¸‹åœºæ™¯ï¼Œå¦‚æœå†…å­˜ä¸­æœ‰ä¸€ä¸ªå€¼x=1ï¼Œ<code>çº¿ç¨‹ä¸€</code>å’Œ<code>çº¿ç¨‹äºŒ</code>éƒ½ä¼šå¯¹xè¿›è¡Œä¸€ä¸ª<code>x+=1</code>çš„æ“ä½œã€‚é‚£ä¹ˆæ— è®ºå“ªä¸€ä¸ªçº¿ç¨‹ç‡å…ˆæ‰§è¡Œå®Œæ¯•ï¼Œéƒ½ä¼šå°†æœ€æ–°çš„ç»“æœé›†å†™å…¥åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹åœ¨è¯»å–çš„æ—¶å€™éƒ½ä¼šè¯»å–åˆ°æœ€æ–°çš„æ•°æ®ã€‚è¿™æ ·å°±ä¿è¯äº†ä»»æ„ä¸€ä¸ªçº¿ç¨‹åœ¨è¯»å–è¿™ä¸ªæ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸€ä¸ªæœ€æ–°çš„å€¼ã€‚</p><blockquote><p>å¦‚æœä¸åŠ <code>volatile</code>é™åˆ¶ï¼Œåˆ™å¯èƒ½æ¯ä¸€ä¸ªæ ¸å¿ƒæ“ä½œå®Œæˆä¹‹ååªæ˜¯å°†å€¼å†™å…¥åˆ°è‡ªå·±CacheåŒºï¼Œè€Œä¸åˆ·æ–°å†…å­˜ã€‚ä»€ä¹ˆæ—¶å€™åˆ·æ–°å®Œå…¨æ˜¯éšæœºçš„</p></blockquote><h3 id="éåŸå­æ€§"><a href="#éåŸå­æ€§" class="headerlink" title="éåŸå­æ€§"></a>éåŸå­æ€§</h3><p>ä½†æ˜¯å¦‚æœå‡ºç°ä¸€ä¸‹æƒ…å†µï¼š</p><blockquote><ol><li>çº¿ç¨‹ä¸€è¯»å–x=1</li><li>çº¿ç¨‹ä¸€æ­£åœ¨æ‰§è¡Œ+1çš„æ“ä½œ</li><li>çº¿ç¨‹ä¸€çš„æ‰§è¡Œæ—¶é—´ç»“æŸï¼Œæ­¤æ—¶çº¿ç¨‹äºŒå¼€å§‹æ‰§è¡Œ</li><li>çº¿ç¨‹äºŒåœ¨æ‰§è¡Œçš„æ—¶å€™è¯»å–å†…å­˜æ•°æ®ä¹Ÿæ˜¯x=1ï¼Œ</li><li>äºæ˜¯çº¿ç¨‹äºŒå°†x+1çš„ç»“æœå†™å…¥å†…å­˜(ç”±äºvolatileçš„é™åˆ¶ï¼ŒCPUåœ¨æ‰§è¡Œå®Œæ¯•çš„æ—¶å€™å¿…é¡»å¼ºåˆ¶å†™å…¥å†…å­˜)</li><li>çº¿ç¨‹ä¸€å°†x+1çš„ç»“æœå†™å…¥å†…å­˜</li></ol></blockquote><p>æ‰€ä»¥volatileè™½ç„¶å…·æœ‰<code>å¯è§æ€§</code>ï¼Œä½†æ˜¯å´æ— æ³•ä¿è¯ä¸€ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå¦‚ä¸‹ä¸Šæµ‹è¯•ä»£ç ï¼š<br>æ–°å»ºä¸€ä¸ªå¢é•¿ç±»:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AInstance</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">static</span>  <span class="keyword">int</span> a =<span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        a++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶åæ–°å»ºä¸€ä¸ªæµ‹è¯•çº¿ç¨‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ; i&lt;<span class="number">100</span> ;i++)&#123;</span><br><span class="line">            AInstance.increase();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€åå¯åŠ¨ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ATest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;<span class="number">1000</span>; i++)&#123;</span><br><span class="line">            AThread aThread = <span class="keyword">new</span> AThread();</span><br><span class="line">            aThread.start();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(AInstance.a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœä½¿ç”¨<code>Volatile</code>ä¿®é¥°çš„å˜é‡å¯ä»¥ä¿è¯åŸå­æ€§çš„è¯ï¼Œé‚£ä¹ˆaä¸€å®šä¼šæ˜¯<code>100000</code>,ä½†æ˜¯æµ‹è¯•ç»“æœä¸€ç›´æ˜¯éšæœºæ•°å­—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">31600æˆ–è€…å…¶ä»–çš„</span><br></pre></td></tr></table></figure></p><h3 id="MESIåè®®å’Œvolatile"><a href="#MESIåè®®å’Œvolatile" class="headerlink" title="MESIåè®®å’Œvolatile"></a>MESIåè®®å’Œvolatile</h3><p>è™½ç„¶MESIåè®®å¯ä»¥ä¿è¯ç¼“å­˜ä¸€è‡´æ€§ï¼Œä½†æ˜¯å¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ­£è¦è¿›è¡Œ<code>+1</code>çš„æ—¶å€™è¢«æŒ‚èµ·äº†ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åˆ™æ­£å¥½æ‰§è¡Œå®Œäº†<code>x+=1</code>çš„æ“ä½œï¼Œæ­¤æ—¶å›åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯çš„æ•°æ®ã€‚å¦‚ä¸‹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E6%89%A7%E8%A1%8C%E5%9B%BE.png" alt=""></p><h4 id="volatile-2"><a href="#volatile-2" class="headerlink" title="volatile"></a>volatile</h4><p>æ‰€ä»¥è™½ç„¶æœ‰<code>MESI</code>ä¿è¯ç¼“å­˜çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯åœ¨èµ‹å€¼æ“ä½œä¹‹å‰å·²ç»è¯»å–äº†ï¼Œæ‰€ä»¥æ­¤æ—¶å¹¶ä¸ä¼šå†æ¬¡è¯»å–å†…å­˜</p><p>è¿™å°±æ˜¯<code>volatile</code>åªèƒ½ä¿è¯å†…å­˜çš„å¯è§æ€§ï¼Œä½†æ˜¯æ— æ³•ä¿è¯åŸå­æ€§çš„é—®é¢˜</p><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>æ­£æ˜¯ç”±äºvolatileçš„è¿™ä¸ªç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨å¤šçº¿ç¨‹ä¸­çš„å•ä¾‹æ¨¡å¼éƒ½ä¼šåœ¨è·å–å®ä¾‹çš„æ–¹æ³•ä¸ŠåŠ ä¸Šä¸€ä¸ª<code>synchronized</code>å…³é”®å­—ï¼Œä»¥ç¡®ä¿åªä¼šç”Ÿæˆä¸€ä¸ªå¯¹è±¡ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨å¤šçº¿ç¨‹çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨volatileéœ€è¦æ³¨æ„çš„æ˜¯åŸå­æ€§æ“ä½œçš„é—®é¢˜ï¼Œå¦åˆ™å°±ä¼šé€ æˆç¨‹åºçš„æ•°æ®é”™è¯¯</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SpringBootä¸­åœ¨ä¸€ä¸ªäº‹ç‰©ä¸­æ›´æ–°å¤šè¡¨çš„æ³¨æ„äº‹é¡¹</title>
      <link href="/2019/01/02/SpringBoot%E4%B8%AD%E5%9C%A8%E4%B8%80%E4%B8%AA%E4%BA%8B%E7%89%A9%E4%B8%AD%E6%9B%B4%E6%96%B0%E5%A4%9A%E8%A1%A8%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2019/01/02/SpringBoot%E4%B8%AD%E5%9C%A8%E4%B8%80%E4%B8%AA%E4%BA%8B%E7%89%A9%E4%B8%AD%E6%9B%B4%E6%96%B0%E5%A4%9A%E8%A1%A8%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      <content type="html"><![CDATA[<h2 id="ç°è±¡ï¼š"><a href="#ç°è±¡ï¼š" class="headerlink" title="ç°è±¡ï¼š"></a>ç°è±¡ï¼š</h2><p>å…·ä½“è¡¨ç°ä¸ºæ•°æ®è¢«updateä¹‹åï¼Œåœ¨åŒä¸€ä¸ªäº‹ç‰©é‡Œé¢å†æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ˜¯ä¸€ä¸ªæ›´æ–°ä¹‹åçš„å€¼ã€‚</p><h2 id="å¤ç°æ­¥éª¤"><a href="#å¤ç°æ­¥éª¤" class="headerlink" title="å¤ç°æ­¥éª¤"></a>å¤ç°æ­¥éª¤</h2><p>æ›´æ–°ä¸€ä¸ªå•†å“çš„ä¿¡æ¯ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>æ›´æ–°å•†å“è¡¨çš„ä¸€äº›æ•°æ®</li><li>åœ¨è¿›å±•è¡¨ä¸­æ–°åŠ å…¥ä¸€æ¡ç”³è¯·</li><li>åœ¨æ“ä½œæ—¥å¿—è¡¨ä¸­æ–°å¢å„ç§å˜æ›´çš„æ“ä½œ(<code>è®°å½•å˜æ›´ä¹‹å‰çš„å€¼ï¼Œå˜æ›´ä¹‹åçš„å€¼</code>)</li></ol><p>ç”±äºä¹‹å‰æ˜¯æ¯ä¸€ä¸ªæ•°æ®çš„æ“ä½œéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å…¶ä»£ç ç»“æ„å¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ceateProductEditRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">editProduct</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createNewProductProgress</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertLogs</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯è¿™æ ·çš„æ“ä½œé¡ºåºä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªäº‹ç‰©ä¸­ã€‚é¦–å…ˆæ‰§è¡Œäº†æ›´æ–°å•†å“çš„æ“ä½œï¼Œç„¶ååœ¨è¿›å±•è¡¨ä¸­æ–°å¢ä¸€ä¸ªè®°å½•ã€‚ä¸€ç›´åˆ°è¿™é‡Œ</p><p>åœ¨æ­¤ä¹‹å‰ä¸€ç›´éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œç„¶è€Œåœ¨ç¬¬ä¸‰æ­¥çš„æ—¶å€™ï¼Œç”±äºæ•°æ®åº“ä¸­å·²ç»å°†å•†å“è¡¨çš„æ•°æ®è¿›è¡Œäº†æ›´æ–°ï¼Œæ‰€ä»¥æ­¤æ—¶æŸ¥è¯¢å‡ºæ¥çš„æ˜¯ä¸€ä¸ªæ›´æ–°ä¹‹åçš„å€¼ã€‚ä½†æ˜¯æ—¥å¿—è¡¨ä¸­æ˜¯éœ€è¦è®°å½•ç”³è¯·çš„å‰åå€¼å¾—å˜åŒ–ã€‚æ‰€ä»¥æ­¤æ—¶å°±éœ€è¦è°ƒæ•´æ–¹æ³•çš„é¡ºåºã€‚</p><h2 id="æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆ"></a>æ–¹æ¡ˆ</h2><p>åŒä¸€ä¸ªäº‹ç‰©é‡Œé¢ï¼Œåœ¨æ›´æ–°ä¹‹åè¿›è¡Œçš„æŸ¥è¯¢è¯­å¥ï¼ŒæŸ¥è¯¢å‡ºçš„æ˜¯æ›´æ–°ä¹‹åçš„è¯­å¥ï¼Œå¦‚æœè¦å®ç°ä¸Šè¿°çš„ä¸šåŠ¡åœºæ™¯ï¼Œå³éœ€è¦å°†<code>insertLogs</code>æ–¹æ³•æè‡³<code>editProduct</code>ä¹‹å‰ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ceateProductEditRequest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertLogs</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">editProduct</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createNewProductProgress</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç”±äºåœ¨åŒä¸€ä¸ªäº‹ç‰©é‡Œé¢ï¼Œä¸”è¯¥ä¸šåŠ¡åœºæ™¯å®é™…ä¸­å¹¶ä¸å¤šã€‚æ‰€ä»¥è¿™æ ·ç®€å•å¤„ç†äº†ä¸‹ã€‚</p><p>ä½†æ˜¯è¿™æ ·çš„å†™æ³•åœ¨å¹¶å‘é«˜çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è€ƒè™‘æ•°æ®åº“çš„é”è®¾è®¡ï¼Œé˜²æ­¢å‡ºç°äº†æ­»é”ï¼Œä¾‹å¦‚æ•°æ®åº“å¼€å¯äº†<code>GAP</code>é”æˆ–è€…<code>Next-Key Lock</code></p>]]></content>
      
      <categories>
          
          <category> Springboot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Springboot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸€æ¬¡nginxçš„æ’æŸ¥ç»å†</title>
      <link href="/2018/12/21/%E4%B8%80%E6%AC%A1nginx%E7%9A%84%E6%8E%92%E6%9F%A5%E7%BB%8F%E5%8E%86/"/>
      <url>/2018/12/21/%E4%B8%80%E6%AC%A1nginx%E7%9A%84%E6%8E%92%E6%9F%A5%E7%BB%8F%E5%8E%86/</url>
      <content type="html"><![CDATA[<h2 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h2><p>é…ç½®nginxçš„httpsï¼Œä½†æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶ä¹‹åä¸€ç›´æ— æ³•è®¿é—®ã€‚ã€‚ã€‚</p><h2 id="æ’æŸ¥æ­¥éª¤"><a href="#æ’æŸ¥æ­¥éª¤" class="headerlink" title="æ’æŸ¥æ­¥éª¤"></a>æ’æŸ¥æ­¥éª¤</h2><p>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯é˜²ç«å¢™çš„åŸå› ï¼Œç”±äºæ˜¯é˜¿é‡Œäº‘çš„ä¸»æœºï¼Œæ‰€ä»¥ç›´æ¥ç™»å½•äº‘ä¸»æœºæŸ¥çœ‹å®‰å…¨é…ç½®ã€‚ä¸€åˆ‡éƒ½æ˜¯OKçš„ã€‚</p><p>ç„¶ååˆæŸ¥çœ‹ä¸»æœºè‡ªå·±çš„é˜²ç«å¢™ï¼Œç”±äºæ˜¯<code>centos7</code>ï¼Œæ‰€ä»¥åœ¨æ­¤èŠ±äº†ç‚¹æ—¶é—´ï¼Œæœ€åè¿˜æ˜¯å°†443ç«¯å£æ·»åŠ åˆ°äº†é˜²ç«å¢™è§„åˆ™ä¸­ï¼Œç„¶åé‡å¯é˜²ç«å¢™ã€‚ã€‚ã€‚</p><p><code>https</code>è®¿é—®ç½‘ç«™ï¼Œå‘ç°è¿˜æ˜¯æ²¡ååº”ã€‚</p><p>è¿™ä¸ªæ—¶å€™å°±å¼€å§‹æ€€ç–‘nginxçš„é…ç½®æ–‡ä»¶æ˜¯ä¸æ˜¯å“ªé‡Œé…ç½®é”™è¯¯äº†ï¼Œä¸»è¦éƒ½æ˜¯ä¿®æ”¹çš„ 443 çš„æœåŠ¡</p><blockquote><p>å…¶å®è¿™æ—¶å€™æ€è·¯å·²ç»é”™è¯¯äº†</p></blockquote><p>åæ¥é€šè¿‡<code>https</code>è¿˜æ˜¯ä¸€ç›´ä¸èƒ½è®¿é—®åˆ°</p><h2 id="ç»§ç»­æ’æŸ¥"><a href="#ç»§ç»­æ’æŸ¥" class="headerlink" title="ç»§ç»­æ’æŸ¥"></a>ç»§ç»­æ’æŸ¥</h2><p>å½“æ—¶æƒ³äº†ä¸‹ï¼Œç´¢æ€§ç›´æ¥ä¿®æ”¹ <code>80</code> é…ç½®çš„<code>server</code>ï¼Œç„¶åå‘ç°ä¿®æ”¹ä¹‹åè¿˜èƒ½æ­£å¸¸è®¿é—®ï¼Œäºæ˜¯å°±æ¨æ–­å¯èƒ½æ˜¯ä¿®æ”¹çš„<code>nginx</code>çš„é…ç½®æ–‡ä»¶å¹¶éæ˜¯nginxæ‰€è¯»å–çš„ã€‚äºæ—¶é€šè¿‡ä»¥ä¸‹å‘½ä»¤å‘ç°é—®é¢˜ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2lqpf5ei7560Z ~]# locate nginx.conf</span><br><span class="line">/usr/local/nginx/conf/nginx.conf</span><br><span class="line">/usr/local/nginx/conf/nginx.conf.default</span><br><span class="line">/usr/local/nginx/nginx-1.10.1/conf/nginx.conf</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æˆ‘çš„æœåŠ¡å™¨ä¸­å‡ºç°äº†ä¸¤ä¸ª<code>nginx.conf</code>ï¼Œæœ€ä¸‹é¢é‚£ä¸€ä¸ªæ˜¯nginxå®‰è£…æ–‡ä»¶ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä¹‹å‰ä¸€ç›´æ”¹çš„å°±æ˜¯è¿™ä¸ªæ–‡ä»¶</p><p>ç„¶åå†æŸ¥çœ‹<code>nginx</code>çš„æœåŠ¡<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2lqpf5ei7560Z ~]# ps -ef|grep nginx</span><br><span class="line">root      4154     1  0 Dec16 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">root      4155  4154  0 Dec16 ?        00:00:00 nginx: worker process</span><br><span class="line">root     10071 10026  0 00:15 pts/2    00:00:00 grep --color=auto nginx</span><br><span class="line">[root@iZ2lqpf5ei7560Z ~]#</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°è¿™é‡Œå°±å¤§æ¦‚çŸ¥é“åŸå› äº†ã€‚ä¹‹å‰ä¸€ç›´æ”¹çš„æ˜¯ç¼–è¯‘æ–‡ä»¶ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œè‡ªç„¶æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚</p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p>è¿™ä¹Ÿä¸ºä¹‹åé‡åˆ°é—®é¢˜çš„æ’æŸ¥æ€è·¯æä¾›äº†ä¸€ç‚¹è­¦ç¤ºï¼Œå³é‡åˆ°é—®é¢˜çš„æ—¶å€™ä¸è¦æ…Œå¼ ï¼Œé¦–å…ˆä¸€ç‚¹ç‚¹çš„æ¢³ç†é€»è¾‘ï¼Œç„¶åå†è¿›è¡Œæ’æŸ¥ã€‚</p>]]></content>
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºè‡ªå·±ä»£ç é£æ ¼çš„ä¸€ç‚¹æ€è€ƒ</title>
      <link href="/2018/12/09/%E5%85%B3%E4%BA%8E%E8%87%AA%E5%B7%B1%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/"/>
      <url>/2018/12/09/%E5%85%B3%E4%BA%8E%E8%87%AA%E5%B7%B1%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<p>éšç€ç¬¬ä¸€ä¸ªé¡¹ç›®æ­£å¼ä¸Šçº¿ï¼Œæ˜¯æ—¶å€™æ€»ç»“ç‚¹ä»€ä¹ˆäº†ã€‚ä»¥ä¾›è‡ªå·±æ—¥ååæ€ã€‚<br>é¡ºä¾¿ä¹Ÿæé†’ä¸‹è‡ªå·±æ˜¯æ—¶å€™çœ‹ä¸‹<code>ã€Šä»£ç æ•´æ´ä¹‹é“ã€‹</code>äº†</p><h2 id="å…³äºæšä¸¾å’Œé™æ€å¸¸é‡"><a href="#å…³äºæšä¸¾å’Œé™æ€å¸¸é‡" class="headerlink" title="å…³äºæšä¸¾å’Œé™æ€å¸¸é‡"></a>å…³äºæšä¸¾å’Œé™æ€å¸¸é‡</h2><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>åœ¨ä»£ç é‡Œé¢æœ€å¥½ä¸è¦æœ‰<code>é­”æ³•å€¼</code>ï¼Œè¿™ä¸ªè™½ç„¶åœ¨é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œä¸­æåˆ°è¿‡ï¼Œä½†æ˜¯è‡ªå·±åˆšå¼€å§‹çš„æ—¶å€™ä¸€ç›´è§‰å¾—ï¼Œæœ‰æ—¶å€™è¿™ä¸ªå˜é‡å°±ä½¿ç”¨ä¸€æ¬¡ï¼Œä¸ºå•¥è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œé‚£æ ·åˆ°æ—¶å€™å»å¯»æ‰¾è¿™ä¸ªå˜é‡çš„æ—¶å€™ä¸æ˜¯æ›´åŠ éº»çƒ¦ä¹ˆã€‚</p><p>åæ¥æ‰å‘ç°è¿™ä¸ªæƒ³æ³•æœ‰ç‚¹æ„šè ¢ï¼Œå› ä¸ºä½ æ ¹æœ¬ä¸çŸ¥é“åæ¥ä¼šä¸ä¼šä½¿ç”¨è¿™ä¸ªå˜é‡ã€‚ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">"A"</span>.equals(A))&#123;</span><br><span class="line">    XXX</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å‡è®¾ä»£ç ä¸­å°±ä¸€å¤„ä½¿ç”¨è¿™ä¸ªâ€Aâ€ï¼Œæ²¡é—®é¢˜ã€‚ä½†æ˜¯å½“ä»£ç ä¸­æœ‰å¤šå¤„æœ‰ç±»ä¼¼çš„åˆ¤æ–­æ—¶ï¼Œç›´æ¥ç”¨ä¸Šè¿°ä»£ç è™½ç„¶ä¹Ÿå¯ä»¥å®Œæˆï¼Œè‹¥éšåéœ€æ±‚ä¸€å˜åŠ¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹å¤šä¸ªä»£ç å—çš„åˆ¤æ–­ã€‚è¿™æ—¶å€™å°±ä¼šæ˜¾å¾—å¾ˆç¹çï¼Œè€Œä¸”è¿˜è¯´ä¸å‡†ä¼šæ¼æ‰å‡ ä¸ªã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™ä¸€ä¸ªé™æ€å˜é‡æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String XX_TYYPE =<span class="string">"A"</span>;</span><br><span class="line"><span class="keyword">if</span>(XX_TYPE.equals(A))&#123;</span><br><span class="line">    XXX</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="æšä¸¾"><a href="#æšä¸¾" class="headerlink" title="æšä¸¾"></a>æšä¸¾</h3><p>æšä¸¾å…¶å®å’Œå¸¸é‡åœ¨æ„ä¹‰ä¸Šæ˜¯ä¸€æ ·çš„ã€‚åŒºåˆ«å°±æ˜¯æšä¸¾å¯ä»¥è¡¨è¾¾æ›´å¤šçš„ä¿¡æ¯ã€‚ä¾‹å¦‚æœ€å¸¸ç”¨çš„æ¥å£è¿”å›å€¼ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResponseEnum&#123;</span><br><span class="line"></span><br><span class="line">   SUCCESS(<span class="string">"200"</span>,<span class="string">"success"</span>),</span><br><span class="line">   FAIL(<span class="string">"100"</span>,<span class="string">"fail"</span>)</span><br><span class="line">   ;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResponseEnum</span><span class="params">(String code,String message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = messgae;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™å°±å¯ä»¥è¡¨è¾¾æ›´å¤šçš„ä¿¡æ¯äº†ã€‚åŒæ ·çš„ï¼Œåˆ©ç”¨æšä¸¾ä¹Ÿå¯ä»¥æ¥å®šä¹‰ä¸€äº›Exceptionã€‚</p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>é™¤äº†ä¸Šè¿°çš„æšä¸¾å’Œå¸¸é‡ä¹‹å¤–ï¼Œå…¶å®è¿˜å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ¥å®šä¹‰ä¸€äº›é€šç”¨çš„å˜é‡ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ä¸€äº›å˜é‡çš„æœ‰ç‚¹æ˜¯æ— éœ€ä¿®æ”¹ä»£ç (<code>å‰ææ˜¯ä½¿ç”¨äº†å¾®æœåŠ¡ï¼Œæœ‰è‡ªå·±çš„é…ç½®ä¸­å¿ƒ</code>)ã€‚<br>ç„¶ååœ¨ä»£ç ä¸­ä½¿ç”¨<code>@Value</code>æ³¨è§£æ¥è·å–è¯¥å˜é‡ã€‚ä»è€Œæ— éœ€æ”¹åŠ¨ä»£ç ã€‚</p><h2 id="å…³äºLambdaè¡¨è¾¾å¼"><a href="#å…³äºLambdaè¡¨è¾¾å¼" class="headerlink" title="å…³äºLambdaè¡¨è¾¾å¼"></a>å…³äºLambdaè¡¨è¾¾å¼</h2><p>Java8ä¸­ä½¿ç”¨çš„<code>Lambda</code>è¡¨è¾¾å¼ç¡®å®å¯ä»¥ç®€åŒ–ä¸å°‘ä»£ç çš„ç¼–å†™ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™ä¸è¦å†™è¿‡é•¿çš„è¡¨è¾¾å¼ã€‚è¿™æ ·è™½ç„¶å¯ä»¥æ–¹ä¾¿å¼€å‘è€…çœå»ä¸å°‘çš„æ—¶å€™ï¼Œä½†æ˜¯æœ‰æ—¶å€™å´ä¸åˆ©äºåæ¥ç»´æŠ¤è€…é˜…è¯»ä»£ç ã€‚</p><h2 id="å…³äºOptionalæ³›å‹"><a href="#å…³äºOptionalæ³›å‹" class="headerlink" title="å…³äºOptionalæ³›å‹"></a>å…³äºOptionalæ³›å‹</h2><p>è¿™ä¸ªæ³›å‹å…¶å®ç›®å‰æˆ‘ä½¿ç”¨çš„è¿˜æ˜¯ä¸è¾ƒå°‘ï¼Œæ‰€ä»¥å¯¹äºè¿™ä¸ªæ³›å‹çš„ä½¿ç”¨ç›®å‰è¿˜ä¸æ¸…æ¥šæ˜¯å¦å¯ä»¥ç®€åŒ–ä»£ç ã€‚</p><h2 id="ä»£ç çš„ç®€åŒ–"><a href="#ä»£ç çš„ç®€åŒ–" class="headerlink" title="ä»£ç çš„ç®€åŒ–"></a>ä»£ç çš„ç®€åŒ–</h2><p>ä»£ç çš„ç®€åŒ–æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œä¸ä»…ä»…æ˜¯å¯ä»¥ç®€åŒ–ä»£ç çš„</p><h3 id="å‡½æ•°å’Œå˜é‡å‘½å"><a href="#å‡½æ•°å’Œå˜é‡å‘½å" class="headerlink" title="å‡½æ•°å’Œå˜é‡å‘½å"></a>å‡½æ•°å’Œå˜é‡å‘½å</h3><p>å¯¹äºå‡½æ•°å’Œå˜é‡çš„å‘½åï¼Œæœ€å¥½æ˜¯è¶Šæ˜ç¡®è¶Šè§„èŒƒè¶Šå¥½ã€‚ä¸ç„¶è‡ªå·±æ—¥åè¯»èµ·æ¥â€¦è‡ªå·±éƒ½ä¸æ¸…æ¥šè¿™ä¸ªå‡½æ•°æ˜¯å¹²å•¥çš„</p><h3 id="ä»£ç è¡Œæ•°å¤ªå¤šï¼Œæœ€å¥½æŠ½ç¦»å‡ºæ¥"><a href="#ä»£ç è¡Œæ•°å¤ªå¤šï¼Œæœ€å¥½æŠ½ç¦»å‡ºæ¥" class="headerlink" title="ä»£ç è¡Œæ•°å¤ªå¤šï¼Œæœ€å¥½æŠ½ç¦»å‡ºæ¥"></a>ä»£ç è¡Œæ•°å¤ªå¤šï¼Œæœ€å¥½æŠ½ç¦»å‡ºæ¥</h3><p>ä¸€ä¸ªæ–¹æ³•é‡Œé¢å¦‚æœè¡Œæ•°å¤ªå¤šï¼Œæœ€å¥½å°†å…¶æŠ½ç¦»å‡ºæ¥çš„ï¼Œä½œä¸ºä¸€äº›ç‹¬ç«‹çš„æ–¹æ³•ã€‚è¿™æ ·ä¸ä»…ä¹‹åé˜…è¯»èµ·æ¥æ¯”è¾ƒæ–¹ä¾¿ï¼Œè€Œä¸”è¿˜æ–¹ä¾¿ä»¥åæ›¿æ¢é€»è¾‘ï¼Œå¦‚æœæ–¹æ³•é‡Œé¢é€»è¾‘å¤ªå¤šï¼Œé‚£ä¹ˆåœ¨ä»¥åå¦‚æœå‡ºç°ä¸€ä¸ªéœ€æ±‚ï¼ŒåŠŸèƒ½å’Œä¹‹å‰çš„æŸä¸€ä¸ªæ–¹æ³•ç±»ä¼¼ï¼Œä»…ä»…æ˜¯ä¸€ç‚¹ä¸åŒã€‚</p><p>å¦‚æœæ˜¯ä¼˜åŒ–åçš„ä»£ç ï¼Œåˆ™ä»…ä»…æ˜¯æ›¿æ¢æ‰é‚£éƒ¨åˆ†ä¸åŒçš„æ–¹æ³•å³å¯ã€‚è‹¥ä¸€ä¸ªä»£ç çš„æ–¹æ³•é€»è¾‘å¤ªå¤šï¼Œåˆ™å¿…é¡»é‡å†™ä¸€ä¸ªç±»ä¼¼çš„æ–¹æ³•ã€‚è¿™æ— å½¢ä¹‹é—´åˆåŠ å¤§äº†å¼€å‘çš„å·¥ä½œé‡ï¼Œè€Œä¸”ä¹Ÿä¸ä¾¿äºæ—¥åçš„ç»´æŠ¤ã€‚</p>]]></content>
      
      <categories>
          
          <category> æ€è€ƒ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€è€ƒ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mongoå¤šæ•°æ®æºçš„ä½¿ç”¨</title>
      <link href="/2018/12/05/mongo%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2018/12/05/mongo%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…çš„ä¼šä½¿ç”¨å¤šæ•°æ®æºï¼Œä½†æ˜¯ç›¸å¯¹äºMysqlçš„å¤šæ•°æ®æºï¼ŒMongoçš„å¤šæ•°æ®æºé…ç½®è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“çš„ã€‚</p><p>é¦–å…ˆåœ¨<code>pom.xml</code>ä¸­å¼•å…¥<code>mongo</code>çš„é©±åŠ¨jaråŒ…ä»¥åŠ<code>springboot</code>å’Œ<code>mongo</code>çš„ä¸€ä¸ªjaråŒ…</p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>Mongoçš„å¤šæ•°æ®æºæ— éæ˜¯é¦–å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆ<code>MongoProperties</code>ï¼Œé€šè¿‡<code>MongoProperties</code>æ¥ç”Ÿæˆä¸€ä¸ª<code>MongoTemplate</code>,æœ€åé€šè¿‡<code>Repository</code>æ¥æ“ä½œMongoã€‚</p><p>è€Œå¤šæ•°æ®æºå°±æ˜¯ç”Ÿæˆå¤šäº†<code>MongoTemplate</code>ï¼Œç„¶åé€šè¿‡å¤šä¸ª<code>MongoTemplate</code>æ‰€å¯¹åº”çš„<code>Repository</code>æ¥æ“ä½œMongoæ•°æ®åº“</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongodb-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Mongoç›¸å…³--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mongodb/mongo-java-driver --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongo-java-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mongodb/bson --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Mysqlä¹‹binlogçš„ä½¿ç”¨(ä¸€)</title>
      <link href="/2018/11/11/Mysql%E4%B9%8Bbinlog%E7%9A%84%E4%BD%BF%E7%94%A8-%E4%B8%80/"/>
      <url>/2018/11/11/Mysql%E4%B9%8Bbinlog%E7%9A%84%E4%BD%BF%E7%94%A8-%E4%B8%80/</url>
      <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å‡è®¾æœ‰ä¸€ä¸ªå¦‚ä¸‹çš„ä¸šåŠ¡åœºæ™¯å¦‚ä¸‹ï¼š<br>éœ€è¦è®°å½•ä¸€ä¸ªå•†å“æˆ–è€…è‚¡ç¥¨çš„å®æ—¶ä»·æ ¼ï¼Œæ¯ä¸€ä¸ªå°æ—¶è®°å½•ä¸€æ¬¡ï¼Œè€Œå•†å“æˆ–è€…è‚¡ç¥¨çš„æ•°é‡ååˆ†å¤šï¼Œè¿™æ—¶ä¸šåŠ¡å‘å±•åˆ°ä¸€å®šçš„ç¨‹åº¦ä¹‹åå°±éœ€è¦è€ƒè™‘æ•°æ®åº“çš„è®¾è®¡ã€‚é¦–å…ˆå•†å“æ¯ä¸ªå°æ—¶çš„ä»·æ ¼è‚¯å®šæ˜¯éœ€è¦å…¥åº“çš„ã€‚å…¶æ¬¡æ¯å°æ—¶çš„è´­ä¹°äººç¾¤ä»¥åŠå„ç§åŸ‹ç‚¹æ•°æ®éšä¹‹ä¸€èµ·ä¹Ÿè¦å…¥åº“ã€‚ä»¥ä¾¿äºæ—¥åçš„æ•°æ®åˆ†æã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>éšç€æ•°æ®é‡çš„å¢å¤§ï¼Œä¸€èˆ¬çš„è§£å†³æ–¹æ¡ˆæ˜¯è®¾ç½®ç´¢å¼•ï¼Œç„¶åå†è€ƒè™‘æ˜¯è¿›è¡Œå‚ç›´è¿˜æ˜¯æ°´å¹³åˆ†åº“åˆ†è¡¨ã€‚</p><p>ä½†æ˜¯ä¸€æ—¦ä½¿ç”¨æ°´å¹³åˆ†åº“åˆ†è¡¨å°±ä¼šæ— å½¢ä¹‹é—´å¢åŠ å¼€å‘çš„å¤æ‚ç¨‹åº¦ï¼Œè€Œä¸”åˆ†åº“åˆ†è¡¨ä¹‹åè€ƒè™‘çš„å„ç§å› ç´ ä¹Ÿä¼šéšä¹‹è€Œæ¥å¢åŠ æ•°å€ã€‚ä¾‹å¦‚å„ç§è¡¨çš„<code>å”¯ä¸€ID</code>ä»¥åŠå¦‚ä½•è¿›è¡Œç»´åº¦çš„åˆ’åˆ†ã€‚</p><p>å¯¹äºæ•°æ®é‡ä¸å¤§çš„ä¸€ä¸ªå¦è§£å†³æ–¹æ³•æ˜¯ï¼šè§£æ<code>mysql</code>çš„binlogæ—¥å¿—ï¼Œç„¶åå°†å…¶å­˜å…¥å¦ä¸€ä¸ªåº“ï¼Œä¼˜å…ˆæ¨è<code>mongo</code>ï¼Œè¯¥åº“åªä½œä¸ºä¸€ä¸ªè¯»å–åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸è¿›è¡Œä»»ä½•çš„å†™å…¥ã€‚è¿™æ ·å¤„ç†ä¹‹åï¼Œåœ¨ä¸­ç­‰ç¨‹åº¦çš„è§„æ¨¡æ•°æ®æ˜¯å®Œå…¨å¯ä»¥æ»¡è¶³éœ€æ±‚çš„ï¼Œå°†å…¶è¯»å†™è¿›è¡Œåˆ†ç¦»ã€‚è€Œä¸”ä¸æ¯«ä¸å½±å“ä¹‹å‰çš„ä¸šåŠ¡å’Œè®¾è®¡ã€‚</p><h2 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h2><p>å…¶å®å¯¹äºå¢åˆ æ”¹æŸ¥ä¹‹å¤–ï¼Œ<code>mysql</code>çš„binlogæ—¥å¿—ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œå®ƒå¯ä»¥è®°å½•ä¸‹æ•°æ®åº“çš„æ¯ä¸€æ¬¡æ“ä½œï¼Œä¾‹å¦‚æŸ¥è¯¢ï¼Œæ–°å¢ï¼Œåˆ é™¤ï¼Œæ›´æ–°ç­‰ã€‚ç„¶åå°†å…¶ä½œä¸ºæ—¥å¿—è®°å½•åœ¨binlogä¹‹ä¸­ã€‚</p><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><p>é¦–å…ˆç¡®ä¿ä½ çš„æ•°æ®åº“å·²ç»å¼€å¯äº†<code>binlog</code>æ—¥å¿—ï¼Œ<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like 'log_%';</span><br><span class="line">+<span class="comment">----------------------------------------+------------------------------------------------------------------+</span></span><br><span class="line">| Variable_name                          | Value                                                            |</span><br><span class="line">+<span class="comment">----------------------------------------+------------------------------------------------------------------+</span></span><br><span class="line">| log_bin                                | ON                                                               |</span><br><span class="line">| log_bin_basename                       | /opt/mysql/mysql-8.0.11-linux-glibc2.12-x86_64/data/master       |</span><br><span class="line">| log_bin_index                          | /opt/mysql/mysql-8.0.11-linux-glibc2.12-x86_64/data/master.index |</span><br><span class="line">| log_bin_trust_function_creators        | OFF                                                              |</span><br><span class="line">| log_bin_use_v1_row_events              | OFF                                                              |</span><br><span class="line">| log_error                              | ./error.log                                                      |</span><br><span class="line">| log_error_services                     | log_filter_internal; log_sink_internal                           |</span><br><span class="line">| log_error_verbosity                    | 2                                                                |</span><br><span class="line">| log_output                             | FILE                                                             |</span><br><span class="line">| log_queries_not_using_indexes          | OFF                                                              |</span><br><span class="line">| log_slave_updates                      | ON                                                               |</span><br><span class="line">| log_slow_admin_statements              | OFF                                                              |</span><br><span class="line">| log_slow_slave_statements              | OFF                                                              |</span><br><span class="line">| log_statements_unsafe_for_binlog       | ON                                                               |</span><br><span class="line">| log_syslog                             | ON                                                               |</span><br><span class="line">| log_syslog_facility                    | daemon                                                           |</span><br><span class="line">| log_syslog_include_pid                 | ON                                                               |</span><br><span class="line">| log_syslog_tag                         |                                                                  |</span><br><span class="line">| log_throttle_queries_not_using_indexes | 0                                                                |</span><br><span class="line">| log_timestamps                         | UTC                                                              |</span><br><span class="line">+<span class="comment">----------------------------------------+------------------------------------------------------------------+</span></span><br><span class="line">20 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°<code>| log_bin                                | ON</code>ï¼Œè¿™å°±è¡¨ç¤ºæ•°æ®åº“å·²ç»å¼€å¯äº†<code>binlog</code>æ—¥å¿—ï¼Œå¦‚æœä½ æŸ¥è¯¢åˆ°è¿˜æ²¡æœ‰å¼€å¯çš„è¯ï¼Œå¯ä»¥å»æœç´¢ä¸‹å¦‚ä½•å¼€å¯ã€‚</p><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ éœ€è¦åœ¨<code>binlog</code>ä¸­çœ‹åˆ°æ—¥å¿—çš„è¯ï¼Œä½ åŒæ—¶ä¹Ÿéœ€è¦åœ¨Mysqlä¸­è®¾ç½®<code>binlog_rows_query_log_events</code>ä¸º<code>Row</code>ï¼Œå¦‚æœä¸ç¡®å®šçš„è¯ï¼Œå¯ä»¥å°†<code>set binlog_rows_query_log_events=1</code>æ‰§è¡Œä¸€æ¬¡ã€‚</p><p>ä¸ºäº†æµ‹è¯•ï¼Œå·²ç»å»ºç«‹å¥½äº†ä¸€ä¸ªè¡¨ï¼Œå…¶ç»“æ„ä¸å¦‚ä¸‹ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc T_fund;</span><br><span class="line">+<span class="comment">-------+---------------+------+-----+---------+-----------------------------+</span></span><br><span class="line">| Field | Type          | Null | Key | Default | Extra                       |</span><br><span class="line">+<span class="comment">-------+---------------+------+-----+---------+-----------------------------+</span></span><br><span class="line">| id    | int(10)       | NO   | PRI | NULL    |                             |</span><br><span class="line">| name  | varchar(255)  | YES  |     | NULL    |                             |</span><br><span class="line">| price | decimal(10,2) | YES  |     | NULL    |                             |</span><br><span class="line">| date  | timestamp     | NO   |     | NULL    | on <span class="keyword">update</span> <span class="keyword">CURRENT_TIMESTAMP</span> |</span><br><span class="line">+<span class="comment">-------+---------------+------+-----+---------+-----------------------------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆç°åœ¨å°è¯•å‘è¯¥è¡¨æ’å…¥ä¸€ä¸ªè¯­å¥ï¼Œ<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;   insert into T_fund(id,name,price,date) values(3,'æµ‹è¯•åŸºé‡‘3',1234.1,'2018-11-11 22:12:00');</span><br><span class="line">Query OK, 1 row affected (0.09 sec)</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶æŸ¥çœ‹binlogï¼Œ<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master logs;</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| Log_name      | File_size |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">| master.000001 |       178 |</span><br><span class="line">| master.000002 |     62644 |</span><br><span class="line">| master.000003 |    112942 |</span><br><span class="line">+<span class="comment">---------------+-----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°ç›®å‰æ˜¯æœ‰ä¸‰ä¸ª<code>binlog</code>æ–‡ä»¶ï¼Œç”±äºbinlogæ˜¯ä¾æ¬¡ä»1å¼€å§‹é€’å¢ï¼Œæ‰€ä»¥åˆšåˆšçš„æ’å…¥è¯­å¥æ˜¯åœ¨ç¬¬ä¸‰ä¸ªæ—¥å¿—ä¸­ï¼ŒæŸ¥çœ‹<code>master.000003</code>å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  show binlog events in 'master.000003' from 114213\G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">   Log_name: master.000003</span><br><span class="line">        Pos: 114213</span><br><span class="line"> Event_type: Rows_query</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 114330</span><br><span class="line">       Info: # insert into T_fund(id,name,price,date) values(3,'æµ‹è¯•åŸºé‡‘3',1234.1,'2018-11-11 22:12:00')</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">   Log_name: master.000003</span><br><span class="line">        Pos: 114330</span><br><span class="line"> Event_type: Table_map</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 114397</span><br><span class="line">       Info: table_id: 179 (T_binlog.T_fund)</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">   Log_name: master.000003</span><br><span class="line">        Pos: 114397</span><br><span class="line"> Event_type: Write_rows</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 114461</span><br><span class="line">       Info: table_id: 179 flags: STMT_END_F</span><br><span class="line">*************************** 4. row ***************************</span><br><span class="line">   Log_name: master.000003</span><br><span class="line">        Pos: 114461</span><br><span class="line"> Event_type: Xid</span><br><span class="line">  Server_id: 1</span><br><span class="line">End_log_pos: 114492</span><br><span class="line">       Info: <span class="keyword">COMMIT</span> <span class="comment">/* xid=4004 */</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘çŸ¥é“è¯¥æ¡æ—¥å¿—çš„<code>position</code>ï¼Œæ‰€ä»¥åŠ äº†ä¸€ä¸ªå‚æ•°<code>from 114213</code>ï¼Œå¦‚æœä¸çŸ¥é“çš„è¯ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥<code>show binlog events in &#39;master.000003</code>ç„¶åçœ‹ç»“å°¾å³å¯ã€‚ </p><p>æœ‰äº†<code>mysql</code>çš„binlogä¹‹åï¼Œä¸‹ä¸€æ­¥å°±éœ€è¦è€ƒè™‘å¦‚ä½•å°†<code>binlog</code>è§£æåˆ°å…¶ä»–çš„æ•°æ®åº“ä¹‹ä¸­ï¼Œç›®å‰å¼€æºçš„è½®å­ï¼Œæ¯”è¾ƒå¥½çš„æœ‰:</p><blockquote><p><a href="https://github.com/zendesk/maxwell" target="_blank" rel="noopener">Maxwell(github)</a><br><br>  <a href="https://github.com/alibaba/canal" target="_blank" rel="noopener">canal(alibaba)</a></p></blockquote><p>  åœ¨è¿™é‡Œæ¨èMaxwellï¼Œå› ä¸ºMaxwellç›®å‰å·²ç»å¯¹<code>MySql8</code>æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ”¯æŒäº†ï¼Œè€Œä¸”æˆ‘ä»¬å·²ç»å°†éƒ¨åˆ†ä¸šåŠ¡åº”ç”¨åˆ°äº†Maxwelläº†ï¼Œç›®å‰è¿˜æ¯”è¾ƒç¨³å®šã€‚</p><p>  ä¸‹ä¸€ç¯‡ä¸»è¦ä¼šå°†<code>Maxwell</code>ä¸<code>binlog</code>ä»¥åŠ<code>rabbitmq</code>è¿›è¡Œä¸€ä¸ªæ•´åˆã€‚</p>]]></content>
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Rabbitmqæ·±åº¦å­¦ä¹ äºŒ</title>
      <link href="/2018/11/10/Rabbitmq%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%BA%8C/"/>
      <url>/2018/11/10/Rabbitmq%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%BA%8C/</url>
      <content type="html"><![CDATA[<h2 id="æ¶ˆæ¯çš„æ¥æ”¶å’Œæ‹’ç»"><a href="#æ¶ˆæ¯çš„æ¥æ”¶å’Œæ‹’ç»" class="headerlink" title="æ¶ˆæ¯çš„æ¥æ”¶å’Œæ‹’ç»"></a>æ¶ˆæ¯çš„æ¥æ”¶å’Œæ‹’ç»</h2><p>å½“æ¶ˆè´¹æ®µæ¥æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯ä¹‹åï¼Œä¼šè¿›è¡Œæ¶ˆè´¹çš„å¤„ç†ã€‚å‡å¦‚åœ¨ä¸šåŠ¡ä¸­å‘ç°è¯¥æ¶ˆæ¯æ˜¯ä¸€ä¸ªé”™è¯¯çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ä¸šåŠ¡æ–¹ä¼šç›´æ¥æ‹’ç»æ­¤æ¡æ¶ˆæ¯ã€‚</p><h3 id="æ‹’ç»æ¶ˆæ¯"><a href="#æ‹’ç»æ¶ˆæ¯" class="headerlink" title="æ‹’ç»æ¶ˆæ¯"></a>æ‹’ç»æ¶ˆæ¯</h3><p>æ‹’ç»æ¶ˆæ¯ä¸€èˆ¬åœ¨æ¶ˆè´¹ç«¯è°ƒç”¨<code>reject</code>æˆ–è€…<code>neck</code>ï¼Œè¿™ä¸¤ä¸ªApiçš„ä½œç”¨åˆ†åˆ«æ˜¯ï¼šä¸€ä¸ªå¯ä»¥æ‰¹é‡æ¶ˆæ¯ï¼Œä¸€ä¸ªåˆ™åªæ˜¯æ¯ä¸€æ¬¡å¤„ç†ä¸€æ¡</p><h3 id="æ¥æ”¶æ¶ˆæ¯"><a href="#æ¥æ”¶æ¶ˆæ¯" class="headerlink" title="æ¥æ”¶æ¶ˆæ¯"></a>æ¥æ”¶æ¶ˆæ¯</h3><p>ä¸€èˆ¬ç›´æ¥è°ƒç”¨<code>basic.ack</code>å³å¯</p><h2 id="å‘é€æ–¹çš„æ¶ˆæ¯ç¡®è®¤"><a href="#å‘é€æ–¹çš„æ¶ˆæ¯ç¡®è®¤" class="headerlink" title="å‘é€æ–¹çš„æ¶ˆæ¯ç¡®è®¤"></a>å‘é€æ–¹çš„æ¶ˆæ¯ç¡®è®¤</h2><h3 id="æ¶ˆæ¯çš„ç¡®è®¤"><a href="#æ¶ˆæ¯çš„ç¡®è®¤" class="headerlink" title="æ¶ˆæ¯çš„ç¡®è®¤"></a>æ¶ˆæ¯çš„ç¡®è®¤</h3><p>æ—¢ç„¶rabbitmqä½œä¸ºä¸€æ¬¾æˆç†Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿæœ‰å®Œå–„çš„æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ã€‚æ¶ˆæ¯ç¡®è®¤æœºåˆ¶åˆ†ä¸ºç”Ÿäº§è€…ç«¯å’Œæ¶ˆè´¹è€…ç«¯ï¼Œç”Ÿäº§è€…ç«¯çš„æ¶ˆæ¯ç¡®è®¤ä¸»è¦æ˜¯ç”¨äºç¡®è®¤æ¶ˆæ¯æ˜¯å¦æˆåŠŸçš„åˆ°è¾¾äº¤æ¢æœºä»¥åŠå…¶ç»‘å®šçš„é˜Ÿåˆ—ã€‚</p><p>ä½¿ç”¨ç”Ÿäº§è€…ç«¯çš„æ¶ˆæ¯ç¡®è®¤éœ€è¦å®ç°<code>RabbitTemplate.ConfirmCallback</code>å’Œ<code>abbitTemplate.ConfirmCallback</code>ï¼Œå¹¶ä¸”é‡å†™<code>confirm</code>æ–¹æ³•ï¼Œä¾‹å¦‚ä¸€ä¸‹ä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqConfirmCallback</span> <span class="keyword">implements</span> <span class="title">RabbitTemplate</span>.<span class="title">ConfirmCallback</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> b, String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b) &#123;</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯ç¡®è®¤æˆåŠŸ"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"æ¶ˆæ¯ç¡®è®¤å¤±è´¥"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MqReturnCallback</span> <span class="keyword">implements</span> <span class="title">RabbitTemplate</span>.<span class="title">ConfirmCallback</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">confirm</span><span class="params">(CorrelationData correlationData, <span class="keyword">boolean</span> b, String s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ç¡®è®¤å›è°ƒè¢«å‡ºå‘"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“é‡å†™å®Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹åè¿˜ä¸è¡Œï¼Œå¦å¤–è¿˜éœ€è¦çš„æ˜¯åœ¨<code>RabbitTemplate</code>è®¾ç½®å…¶<code>setConfirmCallback</code>å’Œ<code>setReturnCallback</code>,ç„¶åå³å¯ä½¿ç”¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    MqConfirmCallback mqConfirmCallback;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MqReturnCallback mqReturnCallback;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        rabbitTemplate.setConfirmCallback(mqConfirmCallback);</span><br><span class="line">        rabbitTemplate.setReturnCallback(mqReturnCallback);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶å¯åŠ¨ç”Ÿäº§è€…ä½†æ˜¯å´ä¸å¯åŠ¨æ¶ˆè´¹è€…ï¼Œç„¶åå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œåœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºæ¥äº†<code>æ¶ˆæ¯ç¡®è®¤æˆåŠŸ</code>,æ­¤æ—¶è¡¨æ˜æ¶ˆæ¯å·²ç»æˆåŠŸçš„åˆ°è¾¾äº†äº¤æ¢æœºï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœæˆ‘å°†ç»‘å®šåœ¨äº¤æ¢æœºä¸Šçš„æ‰€æœ‰é˜Ÿåˆ—åˆ é™¤å‘¢?</p><h4 id="åˆ é™¤äº¤æ¢æœºä»¥åŠé˜Ÿåˆ—æ¥æµ‹è¯•"><a href="#åˆ é™¤äº¤æ¢æœºä»¥åŠé˜Ÿåˆ—æ¥æµ‹è¯•" class="headerlink" title="åˆ é™¤äº¤æ¢æœºä»¥åŠé˜Ÿåˆ—æ¥æµ‹è¯•"></a>åˆ é™¤äº¤æ¢æœºä»¥åŠé˜Ÿåˆ—æ¥æµ‹è¯•</h4><p>æ­¤æ—¶æ¶ˆæ¯å› ä¸ºåˆ°ä¸äº†äº¤æ¢æœºï¼Œæ§åˆ¶å°ä¼šæ‰“å°<code>ç¡®è®¤å›è°ƒè¢«å‡ºå‘</code>å’Œ<code>æ¶ˆæ¯ç¡®è®¤æˆåŠŸ</code>ï¼Œè‡³äºæ­¤å¤„æ˜æ˜¾æ˜¯ç”±äºæ¶ˆæ¯è·¯ç”±ä¸åˆ°äº¤æ¢æœºï¼Œè€Œå¯¼è‡´æ¶ˆæ¯è¢«Returnã€‚é‚£ä¹ˆä¸ºå•¥é‚£ä¹ˆè¿˜ä¼šå‡ºå‘ä¸€æ¬¡<code>æ¶ˆæ¯ç¡®è®¤æˆåŠŸ</code>å‘¢ï¼Ÿã€‚æŸ¥çœ‹Rabbitmqçš„æ–‡æ¡£å‘ç°ï¼š</p><blockquote><p>For unroutable messages, the broker will issue a confirm once the exchange verifies a message wonâ€™t route to any queue (returns an empty list of queues). If the message is also published as mandatory, the basic.return is sent to the client before basic.ack. The same is true for negative acknowledgements (basic.nack)</p></blockquote><p>æ„æ€å°±æ˜¯å½“æ¶ˆæ¯ä¸å¯è·¯ç”±çš„æ—¶å€™ï¼Œåˆ™brokerä¼šåœ¨<code>basic.ack</code>ä¹‹å‰å‘é€ä¸€ä¸ª<code>basic.return</code>ã€‚é‚£ä¹ˆä¹Ÿå°±ä¸å¥‡æ€ªäº†ä¸ºä»€ä¹ˆè¿™é‡Œä¼šæ”¶åˆ°ä¸¤æ¡æ¶ˆæ¯</p><h4 id="æ¶ˆè´¹è€…æ‹’ç»æµ‹è¯•"><a href="#æ¶ˆè´¹è€…æ‹’ç»æµ‹è¯•" class="headerlink" title="æ¶ˆè´¹è€…æ‹’ç»æµ‹è¯•"></a>æ¶ˆè´¹è€…æ‹’ç»æµ‹è¯•</h4><p>æ—¢ç„¶mqçš„å‘é€æ–¹ä¼šæœ‰ä¸€ä¸ªç¡®è®¤ï¼Œé‚£ä¹ˆå¦‚æœæ¶ˆè´¹è€…æ‹’ç»äº†æ­¤æ¡æ¶ˆæ¯ï¼Œå‘é€æ–¹è¿˜ä¼šæ”¶åˆ°æç¤ºå—ï¼Ÿ<br>å¯ä»¥çœ‹åˆ°åœ¨æ§åˆ¶å°åªä¼šæ‰“å°<code>æ¶ˆæ¯ç¡®è®¤æˆåŠŸ</code>ï¼Œä¹Ÿå°±æ˜¯è¯´å‘é€æ–¹åªä¼šç¡®è®¤æ­¤æ¡æ¶ˆæ¯åˆ°è¾¾äº†äº¤æ¢æœºï¼Œè€Œä¸”äº¤æ¢æœºå¯ä»¥è·¯ç”±åˆ°æŒ‡å®šå¯¹çš„é˜Ÿåˆ—ã€‚</p><h3 id="ä¸å¯é‡å¤åœ¨ä¸€ä¸ªmessageè¿›è¡Œå¤šæ¬¡æ“ä½œ"><a href="#ä¸å¯é‡å¤åœ¨ä¸€ä¸ªmessageè¿›è¡Œå¤šæ¬¡æ“ä½œ" class="headerlink" title="ä¸å¯é‡å¤åœ¨ä¸€ä¸ªmessageè¿›è¡Œå¤šæ¬¡æ“ä½œ"></a>ä¸å¯é‡å¤åœ¨ä¸€ä¸ªmessageè¿›è¡Œå¤šæ¬¡æ“ä½œ</h3><p>å‡è®¾åœ¨ä¸€ä¸ªæ¶ˆæ¯ä¸Šè¿›è¡Œäº†æ‹’ç»ä¹‹åï¼Œç„¶åå†è¿›è¡Œç¡®è®¤ï¼Œæ­¤æ—¶<code>mq</code>ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: com.rabbitmq.client.ShutdownSignalException: channel error; reason: &#123;#method&lt;channel.close&gt;(reply-code=406, reply-text=PRECONDITION_FAILED - unknown delivery tag 1, class-id=60, method-id=80)</span><br></pre></td></tr></table></figure></p><h3 id="ä¸è¦å°†é”™è¯¯çš„æ¶ˆæ¯é‡æ–°å½’é˜Ÿ"><a href="#ä¸è¦å°†é”™è¯¯çš„æ¶ˆæ¯é‡æ–°å½’é˜Ÿ" class="headerlink" title="ä¸è¦å°†é”™è¯¯çš„æ¶ˆæ¯é‡æ–°å½’é˜Ÿ"></a>ä¸è¦å°†é”™è¯¯çš„æ¶ˆæ¯é‡æ–°å½’é˜Ÿ</h3><p>è‹¥ä¸€ä¸ªæ¶ˆæ¯å·²ç»æ˜ç¡®çŸ¥é“ä¼šå¯¼è‡´æ¶ˆè´¹æ–¹å¼‚å¸¸ï¼Œåˆ™ä¸è¦å°†æ­¤æ¡æ¶ˆæ¯æ‹’ç»ç„¶åé‡æ–°å†™åˆ°é˜Ÿåˆ—ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸€ä¸ªå¾ªç¯ï¼Œä»è€Œé˜»å¡åé¢çš„æ¶ˆæ¯</p>]]></content>
      
      <categories>
          
          <category> Rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rabbitmq </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Rabbitmqæ·±åº¦å­¦ä¹ ä¸€</title>
      <link href="/2018/11/07/Rabbitmq%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%80/"/>
      <url>/2018/11/07/Rabbitmq%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E4%B8%80/</url>
      <content type="html"><![CDATA[<h2 id="rabbitmq-æ·±åº¦å­¦ä¹ ä¸€"><a href="#rabbitmq-æ·±åº¦å­¦ä¹ ä¸€" class="headerlink" title="rabbitmq æ·±åº¦å­¦ä¹ ä¸€"></a>rabbitmq æ·±åº¦å­¦ä¹ ä¸€</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>rabbitmqæ˜¯ç›®å‰ä½¿ç”¨æœ€å¤šçš„ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé…åˆå¾®æœåŠ¡çš„ä½¿ç”¨å¯ä»¥ä½¿ä¸šåŠ¡æ¨¡å—åŒ–ï¼Œä¾¿äºä¹‹åçš„ç»´æŠ¤ã€‚åŒæ—¶ä½¿ç”¨rabbitmqå¯ä»¥å°†è®¸å¤šä¸šåŠ¡å¼‚æ­¥åŒ–ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><h3 id="é˜Ÿåˆ—çš„åˆ›å»ºåŸåˆ™"><a href="#é˜Ÿåˆ—çš„åˆ›å»ºåŸåˆ™" class="headerlink" title="é˜Ÿåˆ—çš„åˆ›å»ºåŸåˆ™"></a>é˜Ÿåˆ—çš„åˆ›å»ºåŸåˆ™</h3><p>ä½†æ˜¯åœ¨ä½¿ç”¨rabbitmq çš„æ—¶å€™éœ€è¦æ³¨æ„ç‚¹å°±æ˜¯åˆ°åº•æ˜¯<code>ç”Ÿäº§è€…</code>æ¥å»ºç«‹é˜Ÿåˆ—å’Œäº¤æ¢æœºè¿˜æ˜¯ç”±<code>æ¶ˆè´¹è€…</code>æ¥å»ºç«‹äº¤æ¢æœºå’Œé˜Ÿåˆ—ã€‚ä¸€èˆ¬çš„æƒ…å†µæ˜¯ç”±æ¶ˆè´¹è€…æ¥å»ºç«‹é˜Ÿåˆ—ï¼Œä½†æ˜¯å‡å¦‚æ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œå¯¼è‡´ç”Ÿäº§è€…å‘å‡ºçš„æ¶ˆæ¯è¢«äº¤æ¢æœºè·¯ç”±åˆ°äº†ä¸€ä¸ªä¸å­˜åœ¨çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆæ­¤æ—¶ rabbitmqä¼šå¿½ç•¥è¯¥æ¡æ¶ˆæ¯ã€‚æ‰€ä»¥å¯¹äºé‡è¦çš„æ¶ˆæ¯ã€‚å³ä¸å…è®¸è¯¥æ¶ˆæ¯ä¸¢å¤±ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ€å¥½æ˜¯ç”±ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸€èµ·èˆ¹åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ã€‚</p><p>åœ¨rabbité‡Œé¢ï¼Œå‡è®¾ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åŒæ—¶åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—çš„å„é¡¹å‚æ•°éƒ½ç›¸åŒçš„è¯ï¼Œrabbitmqæ˜¯ä¸ä¼šæœ‰é—®é¢˜çš„ï¼Œå‡è®¾ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…åŒæ—¶åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼Œä½†æ˜¯ååˆ›å»ºçš„å’Œå‰é¢åˆ›å»ºçš„å‚æ•°ä¸åŒï¼Œé‚£ä¹ˆæ­¤æ—¶rabbitmqå°±ä¼šæŠ¥é”™ã€‚</p><h4 id="ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼šæ­»ä¿¡é˜Ÿåˆ—"><a href="#ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼šæ­»ä¿¡é˜Ÿåˆ—" class="headerlink" title="ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼šæ­»ä¿¡é˜Ÿåˆ—"></a>ç‰¹æ®Šçš„é˜Ÿåˆ—ï¼šæ­»ä¿¡é˜Ÿåˆ—</h4><p>æ­»ä¿¡é˜Ÿåˆ—é€‚ç”¨äºå½“æŸä¸€ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯è¢«æ‹’ç»çš„æ—¶å€™ï¼Œæˆ–é˜Ÿåˆ—çš„æ¶ˆæ¯å¤§äºæœ€å¤§TTLæ—¶ä»¥åŠé˜Ÿåˆ—å¤§äºæœ€å¤§å€¼ã€‚æ­¤æ—¶è¯¥æ¶ˆæ¯ä¼šè¢«è·¯ç”±åˆ°æ­»ä¿¡äº¤æ¢å™¨ã€‚<br>å…¶ä¸€èˆ¬çš„ä½¿ç”¨æ–¹å¼æ˜¯å»ºç«‹ä¸€ä¸ªæ­»ä¿¡äº¤æ¢æœºå’Œä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—ï¼Œç„¶åç›‘å¬æ­»ä¿¡é˜Ÿåˆ—å³å¯ã€‚</p><h4 id="ä»£ç ç¤ºä¾‹ï¼š"><a href="#ä»£ç ç¤ºä¾‹ï¼š" class="headerlink" title="ä»£ç ç¤ºä¾‹ï¼š"></a>ä»£ç ç¤ºä¾‹ï¼š</h4><h5 id="ç”Ÿäº§è€…ç«¯å»ºç«‹é˜Ÿåˆ—"><a href="#ç”Ÿäº§è€…ç«¯å»ºç«‹é˜Ÿåˆ—" class="headerlink" title="ç”Ÿäº§è€…ç«¯å»ºç«‹é˜Ÿåˆ—"></a>ç”Ÿäº§è€…ç«¯å»ºç«‹é˜Ÿåˆ—</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(ignoreUnknownFields = <span class="keyword">false</span>, prefix = <span class="string">"somersames.rabbitmq"</span>)</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitmqConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String laGouFailQueue = <span class="string">"laGouFailQueue"</span>;</span><br><span class="line">    <span class="keyword">private</span> String laGouQueue = <span class="string">"laGouQueue"</span>;</span><br><span class="line">    <span class="keyword">private</span> String laGouFailExchange = <span class="string">"laGouFailExchange"</span>;</span><br><span class="line">    <span class="keyword">private</span> String laGouFailExchangeRoutingKey = <span class="string">"laGouFailExchangeRoutingKey"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_LETTER_EXCHANGE = <span class="string">"x-dead-letter-exchange"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_LETTER_ROUTING_KEY = <span class="string">"x-dead-letter-routing-key"</span>;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">laGouFailQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(laGouFailQueue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">laGouFailExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(laGouFailExchange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingLagouFailExchange</span><span class="params">(Queue laGouFailQueue, DirectExchange laGouFailExchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(laGouFailQueue).to(laGouFailExchange).with(laGouFailExchangeRoutingKey);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">laGouQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(DEAD_LETTER_EXCHANGE, laGouFailExchange);<span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        map.put(DEAD_LETTER_ROUTING_KEY, laGouFailExchangeRoutingKey);<span class="comment">//è®¾ç½®æ­»ä¿¡routingKey</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(laGouQueue, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, map);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="æ¶ˆè´¹è€…ç«¯å»ºç«‹é˜Ÿåˆ—"><a href="#æ¶ˆè´¹è€…ç«¯å»ºç«‹é˜Ÿåˆ—" class="headerlink" title="æ¶ˆè´¹è€…ç«¯å»ºç«‹é˜Ÿåˆ—"></a>æ¶ˆè´¹è€…ç«¯å»ºç«‹é˜Ÿåˆ—</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String laGouQueue = <span class="string">"laGouQueue"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String laGouExchange = <span class="string">"laGouExchange"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String laGouFailQueue = <span class="string">"laGouFailQueue"</span>;</span><br><span class="line">    <span class="keyword">private</span> String laGouFailExchange = <span class="string">"laGouFailExchange"</span>;</span><br><span class="line">    <span class="keyword">private</span> String laGouFailExchangeRoutingKey = <span class="string">"laGouExchangeRoutingKey"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_LETTER_EXCHANGE = <span class="string">"x-dead-letter-exchange"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEAD_LETTER_ROUTING_KEY = <span class="string">"x-dead-letter-routing-key"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">laGouQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(DEAD_LETTER_EXCHANGE, laGouFailExchange);<span class="comment">//è®¾ç½®æ­»ä¿¡äº¤æ¢æœº</span></span><br><span class="line">        map.put(DEAD_LETTER_ROUTING_KEY, laGouFailExchangeRoutingKey);<span class="comment">//è®¾ç½®æ­»ä¿¡routingKey</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(laGouQueue, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, map);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">laGouFailQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(laGouFailQueue);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">laGouFailExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(laGouFailExchange);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimpleMessageListenerContainer <span class="title">laGouListenerContainer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            ConnectionFactory connectionFactory,</span></span></span><br><span class="line"><span class="function"><span class="params">            LagouRabbitMqListener lagouRabbitMqListener,</span></span></span><br><span class="line"><span class="function"><span class="params">            Queue laGouQueue)</span> </span>&#123;</span><br><span class="line">        SimpleMessageListenerContainer container = <span class="keyword">new</span> SimpleMessageListenerContainer();</span><br><span class="line">        container.setMessageListener(lagouRabbitMqListener);</span><br><span class="line">        container.setQueues(laGouQueue);</span><br><span class="line">        container.setConnectionFactory(connectionFactory);</span><br><span class="line">        container.setConcurrentConsumers(<span class="number">10</span>);</span><br><span class="line">        container.setMaxConcurrentConsumers(<span class="number">20</span>);</span><br><span class="line">        container.setAcknowledgeMode(AcknowledgeMode.MANUAL);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LagouRabbitMqListener</span> <span class="keyword">implements</span> <span class="title">ChannelAwareMessageListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = message.getBody();</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(bytes));</span><br><span class="line">        channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="rabbitmqçš„è·¯ç”±æ–¹å¼"><a href="#rabbitmqçš„è·¯ç”±æ–¹å¼" class="headerlink" title="rabbitmqçš„è·¯ç”±æ–¹å¼"></a>rabbitmqçš„è·¯ç”±æ–¹å¼</h3><p>ä¸€èˆ¬æ¥è®²rabbitmqçš„è·¯ç”±æ–¹å¼åˆ†ä¸ºä¸‰ç§ï¼Œä¸€ç§æ˜¯<code>fanout</code>ï¼Œå³è¯¥äº¤æ¢æœºä¼šå°†æ­¤æ¡æ¶ˆæ¯æ¨é€åˆ°æœºç»‘å®šåœ¨è¯¥äº¤æ¢æ‰€æœ‰é˜Ÿåˆ—ä¹‹ä¸­ã€‚</p><p><code>topic</code>:è¯¥è·¯ç”±å™¨å¯ä»¥æ”¯æŒé€šé…ç¬¦æ¥è¿›è¡Œæ¶ˆæ¯çš„åŒ¹é…ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingPublicFundFailExchange</span><span class="params">(Queue queue, DirectExchange directExchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(directExchange).with(<span class="string">"*.key"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><code>#</code>å¯ä»¥åŒ¹é…å¤šä¸ªå…³é”®å­—<br><code>*</code>åªå¯ä»¥åŒ¹é…ä¸€ä¸ªå…³é”®å­—</p><p><code>direct</code>:è¯¥è·¯ç”±å™¨ä¼šç²¾ç¡®åŒ¹é…é˜Ÿåˆ—çš„keyï¼Œä»è€Œè·¯ç”±å™¨ä¼šå°†æŒ‡å®šçš„æ¶ˆæ¯å‘é€åˆ°ç›¸åº”çš„é˜Ÿåˆ—<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingPublicFundFailExchange</span><span class="params">(Queue queue, DirectExchange directExchange)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queue).to(directExchange).with(<span class="string">"error.key"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>topicæ˜¯<code>fanout</code>å’Œ<code>diret</code>å±…ä¸­çš„ä¸€ç§æ¨¡å¼ï¼Œå½“<code>topic</code>ä¸º<code>#</code>çš„æ—¶å€™å°±ç±»ä¼¼äºfanoutï¼Œå½“<code>topic</code>çš„è®¾ç½®ä¸å¸¦æœ‰<code>*</code> å’Œ <code>#</code> çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸€ä¸ª<code>directe</code> äº†ã€‚</p><h3 id="vhostå¤šç§Ÿæˆ·æ¨¡å¼"><a href="#vhostå¤šç§Ÿæˆ·æ¨¡å¼" class="headerlink" title="vhostå¤šç§Ÿæˆ·æ¨¡å¼"></a>vhostå¤šç§Ÿæˆ·æ¨¡å¼</h3><p>åœ¨ä¸€ä¸ªä¼ä¸šä¸­ï¼Œè‚¯å®šä¸ä¼šæ˜¯ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿä¼šä½¿ç”¨rabbitmqï¼Œé‚£ä¹ˆå‡è®¾æ¯ä¸€ä¸ªä¸šåŠ¡ç³»ç»Ÿéƒ½æ­å»ºä¸€ä¸ªè‡ªå·±çš„rabbitmqæœåŠ¡ï¼Œæ­¤æ—¶å°±ä¼šé€ æˆæå¤§çš„æµªè´¹ã€‚æœ€å¥½çš„è§£å†³åŠæ³•æ˜¯æ­å»ºä¸€ä¸ªé›†å›¢ä¸€èµ·ä½¿ç”¨çš„rabbbitmqé›†ç¾¤ï¼Œç„¶åé€šè¿‡rabbitmqçš„vhostæ¥è¿›è¡Œä¸€ä¸ªéš”ç¦»ã€‚</p><p><code>vhost</code>æ¨¡å¼ç±»ä¼¼äºdockerç¯å¢ƒï¼Œä¸€ä¸ªvhostå°±æ˜¯ä¸€ä¸ªdockeré•œåƒï¼Œæ¯ä¸€ä¸ªvhosté‡Œé¢çš„äº¤æ¢æœºå’Œé˜Ÿåˆ—éƒ½æ˜¯äº’ç›¸éš”ç¦»çš„ã€‚åœ¨rabbitmqä¸­ï¼Œé»˜è®¤çš„vhostå°±æ˜¯ä¸€ä¸ª<code>\</code>ï¼Œ</p>]]></content>
      
      <categories>
          
          <category> Rabbitmq </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rabbitmq </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Vueä¸­ä½¿ç”¨routeré‡åˆ°æ— æ³•è·³è½¬çš„é—®é¢˜</title>
      <link href="/2018/10/31/Vue%E4%B8%AD%E4%BD%BF%E7%94%A8router%E9%81%87%E5%88%B0%E6%97%A0%E6%B3%95%E8%B7%B3%E8%BD%AC%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2018/10/31/Vue%E4%B8%AD%E4%BD%BF%E7%94%A8router%E9%81%87%E5%88%B0%E6%97%A0%E6%B3%95%E8%B7%B3%E8%BD%AC%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨é…ç½®Vueçš„è·¯ç”±çš„æ—¶å€™ï¼Œåœ¨routerçš„<code>index.js</code>ä¸­é…ç½®äº†å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'@/pages/components/home/Home'</span></span><br><span class="line"><span class="keyword">import</span> Tree <span class="keyword">from</span> <span class="string">'@/pages/components/tree/Tree'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      name: <span class="string">'Home'</span>,</span><br><span class="line">      component: Home</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/tree'</span>,</span><br><span class="line">      name: <span class="string">'Tree'</span>,</span><br><span class="line">      component: Tree</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯å´åœ¨å¯åŠ¨é¡¹ç›®çš„æ—¶å€™ï¼Œè¾“å…¥URL:<code>localhost:8080/tree</code>æ— æ³•å®ç°è·³è½¬ï¼Œåæ¥å‘ç°æ˜¯åœ¨<code>App.vue</code>ä¸­æ²¡æœ‰è®¾ç½®<code>&lt;router-view&gt;</code>,æœ€ååŠ ä¸Šå»å³å¯ã€‚</p><p>ä¾‹å¦‚åœ¨<code>App.vue</code>ä¸­é…ç½®äº†ä¸€ä¸ª<code>&lt;router-view&gt;</code>ï¼Œè¾“å…¥URL:<code>localhost:8080/tree</code>å°±ä¼šè·³è½¬åˆ°äº†<code>Tree.vue</code>ã€‚<br>é‚£å‡è®¾åœ¨<code>Tree.vue</code>ä¸­å†é…ç½®é…ç½®ä¸€ä¸ª<code>&lt;router-view&gt;</code>ï¼Œè¿™æ—¶å€™å°±ä¼šåŒ¹é…çš„æ˜¯<code>localhost:8080/tree/XXX</code>,å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ç”¨<code>&lt;router-link&gt;</code>è·³è½¬åˆ°æŒ‡å®šçš„ç»„ä»¶ä¸­</p>]]></content>
      
      <categories>
          
          <category> Vue </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>cssä¸­å®šä½çš„å­¦ä¹ </title>
      <link href="/2018/10/13/css%E4%B8%AD%E5%AE%9A%E4%BD%8D%E7%9A%84%E5%AD%A6%E4%B9%A0/"/>
      <url>/2018/10/13/css%E4%B8%AD%E5%AE%9A%E4%BD%8D%E7%9A%84%E5%AD%A6%E4%B9%A0/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆé¡µé¢ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div1'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div2'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div3'</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div4'</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div22'</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">#div1&#123;</span></span><br><span class="line"><span class="undefined">    width: 700px;</span></span><br><span class="line"><span class="undefined">    height: 700px;</span></span><br><span class="line"><span class="undefined">    background: red;</span></span><br><span class="line"><span class="undefined">    margin-top: 50px;</span></span><br><span class="line"><span class="undefined">    margin-left: 50px;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h1 id="relativeå’Œabsolute"><a href="#relativeå’Œabsolute" class="headerlink" title="relativeå’Œabsolute"></a>relativeå’Œabsolute</h1><p>relativeå•ç‹¬ä½¿ç”¨ï¼Œä»£ç å¦‚ä¸‹<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#div2</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">background</span>: <span class="built_in">rgb</span>(17, 0, 255);</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…¶æ˜¾ç¤ºç»“æœå¦‚å›¾ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/relative-1.png" alt=""></p><p>è¯´æ˜ä¸€åˆ‡éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œdiv2æ˜¯æŒ‰ç…§div1æ¥è¿›è¡Œç›¸å¯¹å®šä½çš„ã€‚é‚£ä¹ˆå•ç‹¬ä½¿ç”¨<code>absolute</code>å‘¢</p><h1 id="absoluteå•ç‹¬ä½¿ç”¨"><a href="#absoluteå•ç‹¬ä½¿ç”¨" class="headerlink" title="absoluteå•ç‹¬ä½¿ç”¨"></a>absoluteå•ç‹¬ä½¿ç”¨</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#div2</span>&#123;</span><br><span class="line">       <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">       <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">       <span class="attribute">background</span>: <span class="built_in">rgb</span>(17, 0, 255);</span><br><span class="line">       <span class="attribute">position</span>: absolute;</span><br><span class="line">       <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">       <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">       <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">       <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/absolutu.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨<code>absolute</code>çš„<code>div2</code>å¹¶æœªæŒ‰ç…§<code>div1</code></p><p>é‚£å¦‚æœ<code>div3</code>ä¹Ÿæ˜¯absoluteå®šä½çš„è¯ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¼šç›¸å¯¹äº<code>div2</code>å®šä½è¿˜æ˜¯ç›¸å¯¹äº<code>div1</code>å‘¢?<br>æµ‹è¯•å¦‚ä¸‹ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#div1</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">700px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">700px</span>;</span><br><span class="line">        <span class="attribute">background</span>: red;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">50px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#div2</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">background</span>: <span class="built_in">rgb</span>(17, 0, 255);</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#div3</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">background</span>: green;</span><br><span class="line">        <span class="attribute">position</span>: absolute;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶é¡µé¢çš„æ˜¾ç¤ºå¦‚ä¸‹ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/absolute-2.png" alt=""><br>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>div3</code>æ˜¯æŒ‰ç…§<code>div2</code>æ¥å®šä½çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆå°±æ˜¯<code>div2</code>æ˜¯æŒ‰ç…§htmlå®šä½çš„å‘¢ï¼Ÿ<br>è§£é‡Šå°±æ˜¯ï¼Œä½¿ç”¨<code>absolute</code>å®šä½çš„å…ƒç´ ä¼šä¸€ç›´å‘ä¸Šå¯»æ‰¾ï¼Œç›´åˆ°æ‰¾å‡ºåŒ…å«<code>position</code>çš„ä¸€ä¸ªå…ƒç´ ï¼Œç„¶åæŒ‰ç…§å…¶å®šä½ï¼Œé‚£ä¹ˆ<code>relative</code>å‘¢?<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#div1</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">700px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">700px</span>;</span><br><span class="line">        <span class="attribute">background</span>: red;</span><br><span class="line">        <span class="attribute">margin-top</span>: <span class="number">50px</span>;</span><br><span class="line">        <span class="attribute">margin-left</span>: <span class="number">50px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#div2</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">500px</span>;</span><br><span class="line">        <span class="attribute">background</span>: <span class="built_in">rgb</span>(17, 0, 255);</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">20px</span>;</span><br><span class="line">        <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">        <span class="attribute">bottom</span>: <span class="number">20px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#div3</span>&#123;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">        <span class="attribute">background</span>: green;</span><br><span class="line">        <span class="attribute">position</span>: relative;</span><br><span class="line">        <span class="attribute">left</span>: <span class="number">10px</span>;</span><br><span class="line">        <span class="attribute">top</span>: <span class="number">10px</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/relative-2.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®šä½éƒ½æ˜¯ç›´æ¥ä»¥å…¶ä¸Šçº§å…ƒç´ ä¸ºæ ‡å‡†çš„ã€‚</p><h1 id="absoluteçš„ç‰¹æ€§"><a href="#absoluteçš„ç‰¹æ€§" class="headerlink" title="absoluteçš„ç‰¹æ€§"></a>absoluteçš„ç‰¹æ€§</h1><p>absolute å…·æœ‰çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å…¶åŒ…è£¹æ€§ï¼Œä¹Ÿå°±æ˜¯<code>absolute</code>çš„<code>width</code>çš„å®½åº¦æ˜¯100%çš„æ—¶å€™ï¼Œå…¶å®½åº¦å…¶å®æ˜¯å†…å®¹çš„å®½åº¦ï¼Œè€Œä¸æ˜¯çœŸæ­£çš„<code>100%</code>å®½åº¦ã€‚å³è¢«<code>inline-block</code>åŒ–äº†ã€‚</p><h2 id="å¦™ç”¨1"><a href="#å¦™ç”¨1" class="headerlink" title="å¦™ç”¨1"></a>å¦™ç”¨1</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div-span-1'</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">'span-1'</span>&gt;</span>adad<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"> <span class="selector-id">#div-span-1</span>&#123;</span></span><br><span class="line"><span class="css">        <span class="comment">/* width: 700px; */</span></span></span><br><span class="line"><span class="css">        <span class="comment">/* height: 200px; */</span></span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        color: pink;</span></span><br><span class="line"><span class="undefined">        border: 10px solid black</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    /* #span-1&#123;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">    &#125; */</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„æ­¤æ—¶ä¸Šå±‚divä¸å¯ä»¥è®¾ç½®widthï¼Œè¿™æ ·å°±å¯ä»¥å®ç°å¤–å±‚divçš„å®½åº¦è‡ªåŠ¨æ˜¯å†…å®¹çš„å®½åº¦<br>ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#div-span-1</span>&#123;</span><br><span class="line">       <span class="comment">/* width: 700px; */</span></span><br><span class="line">       <span class="comment">/* height: 200px; */</span></span><br><span class="line">       <span class="attribute">position</span>: absolute;</span><br><span class="line">       <span class="attribute">color</span>: pink;</span><br><span class="line">       <span class="attribute">border</span>: <span class="number">10px</span> solid black;</span><br><span class="line">       <span class="attribute">float</span>: left;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><h2 id="absoluteä¼šç ´åå…¶çˆ¶å…ƒç´ çš„å®½åº¦ï¼š"><a href="#absoluteä¼šç ´åå…¶çˆ¶å…ƒç´ çš„å®½åº¦ï¼š" class="headerlink" title="absoluteä¼šç ´åå…¶çˆ¶å…ƒç´ çš„å®½åº¦ï¼š"></a>absoluteä¼šç ´åå…¶çˆ¶å…ƒç´ çš„å®½åº¦ï¼š</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div-span-1'</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">'span-1'</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-id">#div-span-1</span>&#123;</span></span><br><span class="line"><span class="css">       <span class="comment">/* width: 700px; */</span></span></span><br><span class="line"><span class="css">       <span class="comment">/* height: 200px; */</span></span></span><br><span class="line"><span class="css">       <span class="comment">/* position: absolute; */</span></span></span><br><span class="line"><span class="undefined">       color: pink;</span></span><br><span class="line"><span class="undefined">       border: 10px solid black;</span></span><br><span class="line"><span class="undefined">       float: left;</span></span><br><span class="line"><span class="undefined">   &#125;</span></span><br><span class="line"><span class="css">   <span class="selector-id">#span-1</span>&#123;</span></span><br><span class="line"><span class="undefined">       width: 300px;</span></span><br><span class="line"><span class="undefined">       height: 300px;</span></span><br><span class="line"><span class="undefined">       position: absolute;</span></span><br><span class="line"><span class="undefined">       border: 10px solid gray</span></span><br><span class="line"><span class="undefined">   &#125;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/absolute-3.png" alt=""></p><p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°çˆ¶å…ƒç´ çš„é«˜åº¦å·²ç»è¢«ç ´åäº†</p>]]></content>
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Vueå¼•å…¥stylesçš„ä¸€ä¸ªå°å‘</title>
      <link href="/2018/10/13/Vue%E5%BC%95%E5%85%A5styles%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/"/>
      <url>/2018/10/13/Vue%E5%BC%95%E5%85%A5styles%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%8F%E5%9D%91/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨<code>styus</code>çš„æ—¶å€™ï¼Œç»å¸¸ä¼šå®šä¹‰ä¸€äº›cssçš„å¸¸ç”¨å˜é‡ï¼Œä½†æ˜¯åœ¨å¼•å…¥stylæ–‡ä»¶ä¸€ç›´ä½¿ç”¨çš„æ˜¯<code>@import &#39;~styles/mixins&#39;</code>ï¼Œç„¶åå°±æ˜¯ä¸€ç›´åœ¨æŠ¥é”™ï¼Œ<br>åæ¥ç»è¿‡äº†è§£å‘ç°ï¼Œè¿™ç§å†™æ³•éœ€è¦åœ¨<code>build</code>ä¸­çš„<code>webpack.conf.js</code>ä¸­è®¾ç½®<code>style</code>çš„åˆ«åï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">    extensions: [<span class="string">'.js'</span>, <span class="string">'.vue'</span>, <span class="string">'.json'</span>],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">'vue$'</span>: <span class="string">'vue/dist/vue.esm.js'</span>,</span><br><span class="line">      <span class="string">'@'</span>: resolve(<span class="string">'src'</span>),</span><br><span class="line">      <span class="string">'styles'</span>: resolve(<span class="string">'src/assets/styles'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>ç„¶åå°†<code>styles</code>æŒ‡å‘æ”¾<code>styl</code>çš„æ–‡ä»¶å¤¹å³å¯ã€‚</p>]]></content>
      
      <categories>
          
          <category> css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>csså®½é«˜æ¯”è‡ªé€‚åº”çš„è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2018/10/13/css%E5%AE%BD%E9%AB%98%E6%AF%94%E8%87%AA%E9%80%82%E5%BA%94%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
      <url>/2018/10/13/css%E5%AE%BD%E9%AB%98%E6%AF%94%E8%87%AA%E9%80%82%E5%BA%94%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
      <content type="html"><![CDATA[]]></content>
      
      <categories>
          
          <category> Css </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Css </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Leetcodeä¸Šä¸¤é“åˆ¤æ–­næ¬¡æ–¹çš„é¢˜ç›®</title>
      <link href="/2018/09/26/Leetcode%E4%B8%8A%E4%B8%A4%E9%81%93%E5%88%A4%E6%96%ADn%E6%AC%A1%E6%96%B9%E7%9A%84%E9%A2%98%E7%9B%AE/"/>
      <url>/2018/09/26/Leetcode%E4%B8%8A%E4%B8%A4%E9%81%93%E5%88%A4%E6%96%ADn%E6%AC%A1%E6%96%B9%E7%9A%84%E9%A2%98%E7%9B%AE/</url>
      <content type="html"><![CDATA[<p>è¿™ä¸¤é“é¢˜ç›®éƒ½æ˜¯åˆ¤æ–­ä¸€ä¸ªæ•°å­—æ˜¯ä¸æ˜¯2(ç¬¬ä¸€é¢˜)ï¼Œ3(ç¬¬äºŒé¢˜)çš„næ¬¡æ–¹ï¼Œåœ¨åšç¬¬ä¸€é¢˜çš„æ—¶å€™æ€è·¯åŸºæœ¬ä¸Šå’Œæ ‡å‡†è§£æ³•æƒ³æ³•ç›¸åŒï¼Œä½†æ˜¯åœ¨åšç¬¬äºŒé¢˜çš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®¸å¤šæ¯”è¾ƒæœ‰åˆ›æ„çš„è§£æ³•ï¼Œæ‰€ä»¥è®°å½•ä¸‹</p><h2 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„næ¬¡æ–¹"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„næ¬¡æ–¹" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„næ¬¡æ–¹"></a>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯2çš„næ¬¡æ–¹</h2><h3 id="è§£æ³•ä¸€"><a href="#è§£æ³•ä¸€" class="headerlink" title="è§£æ³•ä¸€"></a>è§£æ³•ä¸€</h3><p>è¿™ä¸ªè§£æ³•ä¹Ÿå°±æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å°±æƒ³åˆ°çš„ä¸€ä¸ªè§£æ³•ï¼Œå°±æ˜¯åš <code>&amp;</code> è¿ç®—ï¼Œå› ä¸ºä¸€ä¸ªæ•°å­—è‹¥æ˜¯2çš„næ¬¡æ–¹ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾å°±æ˜¯è¿™ä¸ªæ•°å­—çš„2è¿›åˆ¶è‚¯å®šåªä¼šæœ‰ä¸€ä¸ª<code>1</code>ï¼Œä¾‹å¦‚ï¼š<br>32=100000 ,64 =1000000ã€‚æ‰€ä»¥åªéœ€è¦åˆ¤æ–­ n ä¸ n-1 åšä¸€ä¸ª<code>&amp;</code> è¿ç®—å°±å¯ä»¥çŸ¥é“äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( n &lt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (n &amp; ( n-<span class="number">1</span>)) ==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h3 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>åœ¨Javaé‡Œé¢ã€‚Intçš„æœ€å¤§å€¼æ˜¯<code>2^31 - 1</code>åˆ° <code>-2^31</code>æ¬¡ï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œåªéœ€è¦è®© n ä¸ <code>2^30</code> æ¬¡åšä¸€ä¸ª <code>&amp;</code> è¿ç®—å³å¯ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPowerOfTwo</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( n&lt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1073741824</span> % n) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h2 id="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯3çš„næ¬¡æ–¹"><a href="#åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯3çš„næ¬¡æ–¹" class="headerlink" title="åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯3çš„næ¬¡æ–¹"></a>åˆ¤æ–­ä¸€ä¸ªæ•°æ˜¯ä¸æ˜¯3çš„næ¬¡æ–¹</h2><h3 id="æ ‡å‡†è§£æ³•"><a href="#æ ‡å‡†è§£æ³•" class="headerlink" title="æ ‡å‡†è§£æ³•"></a>æ ‡å‡†è§£æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPowerOfThree</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(n ==<span class="number">0</span>)&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="keyword">while</span>(n % <span class="number">3</span> ==<span class="number">0</span>)&#123;</span><br><span class="line">          n = n/<span class="number">3</span>;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="keyword">return</span> n ==<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><h3 id="è§£æ³•äºŒ-1"><a href="#è§£æ³•äºŒ-1" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h3><p>åœ¨Javaé‡Œé¢intçš„æœ€å¤§å€¼æ˜¯<code>2^30</code>ï¼Œé‚£ä¹ˆç”¨3çš„æœ€å¤§å€¼å°±å¯ä»¥æ˜¯<code>3^19</code>,æ‰€ä»¥è§£æ³•äºŒä¸ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPowerOfThree</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( n&lt;<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1162261467</span> % n) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h3 id="è§£æ³•ä¸‰"><a href="#è§£æ³•ä¸‰" class="headerlink" title="è§£æ³•ä¸‰"></a>è§£æ³•ä¸‰</h3><p>ç”±æ•°å­¦å…¬å¼: n= 3^1,å¯ä»¥å¾—åˆ°<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/TIM%E6%88%AA%E5%9B%BE20180927002429.png" alt=""></p><p>æ‰€ä»¥ä¼šæœ‰ä»¥ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPowerOfThree</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> (Math.log10(n) / Math.log10(<span class="number">3</span>)) % <span class="number">1</span> == <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä¸€æ¬¡SpringBootåˆå§‹åŒ–å¼•èµ·çš„æ€è€ƒ</title>
      <link href="/2018/09/25/%E4%B8%80%E6%AC%A1SpringBoot%E5%88%9D%E5%A7%8B%E5%8C%96%E5%BC%95%E8%B5%B7%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>/2018/09/25/%E4%B8%80%E6%AC%A1SpringBoot%E5%88%9D%E5%A7%8B%E5%8C%96%E5%BC%95%E8%B5%B7%E7%9A%84%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<p>åœ¨Springä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨<code>@Resource</code>æ³¨è§£æ¥è‡ªåŠ¨è£…é…ä¸€äº›Beanï¼Œä½†æ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™è¿˜æ˜¯æœ‰ä¸€ç‚¹å°å‘çš„ï¼Œä¸‹é¢æ˜¯ä¸€æ®µä»£ç ï¼Œæœ‰ä¸‰ä¸ªç±»ï¼Œåˆ†åˆ«æ˜¯Aï¼ŒBï¼ŒCã€‚</p><p>ç±»Aï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    B b;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(b.getC() == <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç±»Bï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    C c ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> C cParam =getC();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> C <span class="title">getC</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.getAnewC();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç±»Cï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name ;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> C <span class="title">getAnewC</span><span class="params">()</span></span>&#123;</span><br><span class="line">        C c =<span class="keyword">new</span> C();</span><br><span class="line">        c.setI(<span class="number">1</span>);</span><br><span class="line">        c.setName(<span class="string">"a"</span>);</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getI</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setI</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.i = i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶è¿™ä¸‰ä¸ªç±»æœ‰ä¸€ä¸ªåœ°æ–¹ä¼šæŠ›å‡ºä¸€ä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå¦‚æœä½ å¯ä»¥ä¸€çœ¼çœ‹å‡ºæ¥çš„è¯ï¼Œä¸å¦¨ç»§ç»­èµ°ä¸‹å»çœ‹çœ‹æ˜¯å¦æ­£ç¡®ã€‚<br>ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(SpringJUnit4ClassRunner.class)</span><br><span class="line"><span class="meta">@SpringApplicationConfiguration</span>(classes = DemoApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    A a ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        a.someMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·çœ‹ä¸‹å»ï¼Œå¯èƒ½å°±çœ‹ä¸å‡ºå“ªé‡Œæœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿è¡Œä¹‹åä¼šæŠ›å‡ºä¸€ä¸ª<code>NullException</code>ï¼Œé”™è¯¯æ—¥å¿—å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name <span class="string">'b'</span> defined in file [C:\Users\SZH\IdeaProject\firstcloud\target\classes\szh\demo\test\B.class]: Instantiation of bean failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [szh.demo.test.B]: Constructor threw exception; nested exception is java.lang.NullPointerException</span><br><span class="line">--------------------------------------------------</span><br><span class="line"></span><br><span class="line">Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [szh.demo.test.B]: Constructor threw exception; nested exception is java.lang.NullPointerException</span><br><span class="line">------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Caused by: java.lang.NullPointerException</span><br><span class="line">at szh.demo.test.B.getC(B.java:<span class="number">21</span>)</span><br><span class="line">at szh.demo.test.B.&lt;init&gt;(B.java:<span class="number">18</span>)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:<span class="number">62</span>)</span><br><span class="line">at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:<span class="number">45</span>)</span><br><span class="line">at java.lang.reflect.Constructor.newInstance(Constructor.java:<span class="number">423</span>)</span><br><span class="line">at org.springframework.beans.BeanUtils.instantiateClass(BeanUtils.java:<span class="number">142</span>)</span><br><span class="line">... <span class="number">55</span> more</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶çš„å¼‚å¸¸æ ˆå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ç±»<code>B</code>é‡Œé¢ï¼Œç¬¬18è¡Œï¼Œä¹Ÿå°±æ˜¯<code>public C cParam =getC();</code>æŠ›å‡ºäº†ä¸€ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸çš„åŸå› å°±æ˜¯åœ¨æ–¹æ³•<code>getC()</code>é‡Œé¢ï¼Œcæ˜¯ä¸€ä¸ªnullï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå¯èƒ½å°±ä¼šæœ‰ä¸€ä¸ªç–‘é—®äº†ï¼ŒSpringä¸æ˜¯ä¼šè‡ªåŠ¨è£…é…æœ‰<code>Resource</code>æ³¨è§£çš„å—ï¼Ÿé‚£ä¹ˆæ­¤æ—¶çš„<code>c</code>ä¸ºä»€ä¹ˆæ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚</p><h2 id="Springçš„åˆå§‹åŒ–"><a href="#Springçš„åˆå§‹åŒ–" class="headerlink" title="Springçš„åˆå§‹åŒ–"></a>Springçš„åˆå§‹åŒ–</h2><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œæ— è®ºSpringæ— è®ºæ€æ ·åˆå§‹åŒ–ï¼Œéƒ½æ˜¯éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯¹è±¡çš„ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ç®¡æ˜¯é€šè¿‡<code>Class.loadClass</code>æˆ–è€…<code>Class.forName</code>ç­‰ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯æ— è®ºé€ƒä¸è¿‡Javaçš„åˆå§‹åŒ–ï¼Œåœ¨è¿™é‡Œä¸ºäº†éªŒè¯<code>B</code>ä¸­çš„å¼‚å¸¸æ˜¯åœ¨åˆå§‹åŒ–Bçš„æ—¶å€™äº§ç”Ÿçš„ï¼Œæ­¤æ—¶ä¿®æ”¹Bä½å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    C c ;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"public C cParam =getC()ä¸Šé¢ä¸€è¡Œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> C cParam =getC();</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"public C cParam =getC()ä¸‹é¢ä¸€è¡Œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> C <span class="title">getC</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.getAnewC();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨æ­¤è°ƒç”¨æµ‹è¯•ç±»ï¼Œä½ ä¼šå‘ç°<code>&quot;public C cParam =getC()ä¸Šé¢ä¸€è¡Œ&quot;</code>æ‰“å°å‡ºæ¥ä¹‹åé©¬ä¸Šå°±ä¼šå‡ºé”™ï¼Œè¿™ä¹Ÿå°è¯äº†å‰é¢çš„çŒœæƒ³ï¼Œè¿™ä¸ªå¼‚å¸¸æ˜¯åœ¨åˆå§‹åŒ–Bçš„æ—¶å€™äº§ç”Ÿçš„ã€‚</p><h3 id="çŒœæƒ³"><a href="#çŒœæƒ³" class="headerlink" title="çŒœæƒ³"></a>çŒœæƒ³</h3><p>é‚£ä¹ˆåœ¨è¿™é‡Œå°±åŸºæœ¬ä¸Šå¯ä»¥æ‰å‡ºæ¥Springçš„ä¸€ä¸ªåŠ è½½æµç¨‹äº†ï¼Œé¦–å…ˆSpringä¼šæ‰«ææ‰€æœ‰çš„å¸¦æœ‰æ³¨è§£å¾—ç±»ï¼Œç„¶åå½“åˆå§‹åŒ–å®Œæ¯•ä¹‹åæ”¾å…¥Beanfactoryï¼Œæœ€åå†è¿›è¡Œä¸€ä¸ªå˜é‡çš„èµ‹å€¼ï¼Œä¸ºäº†éªŒè¯æ­¤çŒœæƒ³ï¼Œä¿®æ”¹<code>B</code>å’Œ<code>A</code>ä»£ç ä¸ºå¦‚ä¸‹ï¼š<br>ç±»B<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    C c ;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"public C cParam =getC()ä¸Šé¢ä¸€è¡Œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> C cParam =<span class="keyword">null</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        System.out.println(<span class="string">"public C cParam =getC()ä¸‹é¢ä¸€è¡Œ"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> C <span class="title">getC</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> c.getAnewC();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç±»Aï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    B b;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(b.getC() == <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶è§£å†³ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ‰€ä»¥ä»¥ååœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„å˜é‡çš„åˆå§‹åŒ–æ˜¯å¦ä¼šæ¶‰åŠåˆ°ä¸€äº›å¯¹è±¡</p>]]></content>
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Springçš„æœ¬è´¨-Servletåˆæ¢</title>
      <link href="/2018/09/18/Spring%E7%9A%84%E6%9C%AC%E8%B4%A8-Servlet%E5%88%9D%E6%8E%A2/"/>
      <url>/2018/09/18/Spring%E7%9A%84%E6%9C%AC%E8%B4%A8-Servlet%E5%88%9D%E6%8E%A2/</url>
      <content type="html"><![CDATA[<p>ç°åœ¨Javaçš„webå¼€å‘ä½“ç³»ä¸­ï¼ŒSpringä»¥å…¶è½»é‡çº§ï¼Œä½è€¦åˆè€Œå æ®äº†è€å¤§çš„åœ°ä½ï¼Œä½†æ˜¯Springçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆåœ¨Springé‡Œé¢ä¸éœ€è¦åƒä»¥å‰å†™Servleté¡¹ç›®ä¸€æ ·ï¼Œéœ€è¦é…ç½®<code>web.xml</code>ã€‚è¿™äº›éƒ½éœ€è¦æˆ‘ä»¬å»åˆ¨æ ¹é—®åº•çš„ã€‚</p><h1 id="Servletæ˜¯ä»€ä¹ˆ"><a href="#Servletæ˜¯ä»€ä¹ˆ" class="headerlink" title="Servletæ˜¯ä»€ä¹ˆ"></a>Servletæ˜¯ä»€ä¹ˆ</h1><p>æŒ‰ç…§Servletè§„èŒƒæ‰€è§£é‡Šçš„é‚£æ ·ï¼ŒServletæ˜¯ä¸€ä¸ªWebç»„ä»¶ï¼Œå°±æ˜¯ç±»ä¼¼äºç”Ÿç‰©é‡Œé¢çš„<code>ç—…æ¯’</code>å’Œ<code>å®¿ä¸»</code>ä¸€æ ·ï¼Œ<code>ç—…æ¯’</code>è¿˜æ˜¯é‚£ä¸ªç—…æ¯’ï¼Œä½†æ˜¯ç¦»å¼€äº†<code>å®¿ä¸»</code>ä¹‹åå°±ä¸èƒ½å•ç‹¬ç”Ÿå­˜äº†ã€‚è€Œ<code>å®¿ä¸»</code>å°±æ˜¯ä¸€ä¸ªServletå®¹å™¨ã€‚(tomcatå°±æ˜¯ä¸€ä¸ªServletå®¹å™¨)</p><blockquote><p>Servlet æ˜¯åŸºäº Java æŠ€æœ¯çš„ web ç»„ä»¶ï¼Œå®¹å™¨æ‰˜ç®¡çš„ï¼Œç”¨äºç”ŸæˆåŠ¨æ€å†…å®¹ã€‚åƒå…¶ä»–åŸºäº Java çš„ç»„ä»¶æŠ€æœ¯ä¸€æ ·ï¼Œ<br>  Servlet ä¹Ÿæ˜¯åŸºäºå¹³å°æ— å…³çš„ Java ç±»æ ¼å¼ï¼Œè¢«ç¼–è¯‘ä¸ºå¹³å°æ— å…³çš„å­—èŠ‚ç ï¼Œå¯ä»¥è¢«åŸºäº Java æŠ€æœ¯çš„ web server<br>  åŠ¨æ€åŠ è½½å¹¶è¿è¡Œã€‚å®¹å™¨ï¼Œæœ‰æ—¶å€™ä¹Ÿå«åš servlet å¼•æ“ï¼Œæ˜¯ web server ä¸ºæ”¯æŒ servlet åŠŸèƒ½æ‰©å±•çš„éƒ¨åˆ†ã€‚å®¢æˆ·ç«¯<br>  é€šè¿‡ Servlet å®¹å™¨å®ç°çš„è¯·æ±‚/åº”ç­”æ¨¡å‹ä¸ Servlet äº¤äº’</p></blockquote><p>åœ¨Tomcatçš„æºç åŒ…é‡Œé¢ï¼ŒServletå…¶å®æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>initæ–¹æ³•ä»£è¡¨çš„æ˜¯ä¸€ä¸ªServletå®ä¾‹åŒ–å®Œæ¯•ä¹‹åæ‰§è¡Œçš„æ–¹æ³•ï¼Œè¯¥ç›®çš„æ˜¯ä¸ºäº†åœ¨ä½¿ç”¨Servletä¹‹å‰åˆå§‹åŒ–ä¸€äº›åŸºç¡€æ•°æ®ï¼Œä¾‹å¦‚æ•°æ®åº“è¯»å–æˆ–è€…æŸäº›å¿…é¡»çš„åˆå§‹åŒ–</p><h2 id="Springä¸Servletçš„è”ç³»"><a href="#Springä¸Servletçš„è”ç³»" class="headerlink" title="Springä¸Servletçš„è”ç³»"></a>Springä¸Servletçš„è”ç³»</h2><p>åœ¨Springçš„é…ç½®é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªæœ€é‡è¦çš„æ­¥éª¤å°±æ˜¯é…ç½®Springçš„<code>DispatcherServlet</code>ï¼Œç„¶åå†é…ç½®ä¸€ä¸ª<code>ContextListener</code>ï¼Œé‚£ä¹ˆSpringå’ŒServletæœ‰ä»€ä¹ˆå…³ç³»å‘¢?<br>é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">String servletName = getServletName();</span><br><span class="line">Assert.hasLength(servletName, <span class="string">"getServletName() must not return empty or null"</span>);</span><br><span class="line"></span><br><span class="line">ApplicationContext applicationContext = createApplicationContext();</span><br><span class="line">Assert.notNull(applicationContext, <span class="string">"createApplicationContext() must not return null."</span>);</span><br><span class="line"></span><br><span class="line">refreshApplicationContext(applicationContext);</span><br><span class="line">registerCloseListener(servletContext, applicationContext);</span><br><span class="line"></span><br><span class="line">HttpHandler httpHandler = WebHttpHandlerBuilder.applicationContext(applicationContext).build();</span><br><span class="line">ServletHttpHandlerAdapter servlet = <span class="keyword">new</span> ServletHttpHandlerAdapter(httpHandler);</span><br><span class="line"></span><br><span class="line">ServletRegistration.Dynamic registration = servletContext.addServlet(servletName, servlet);</span><br><span class="line">Assert.notNull(registration, <span class="string">"Failed to register servlet '"</span> + servletName + <span class="string">"'."</span>);</span><br><span class="line"></span><br><span class="line">registration.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">registration.addMapping(getServletMapping());</span><br><span class="line">registration.setAsyncSupported(<span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ã€‚ã€‚ã€‚æœªå®Œå¾…ç»­</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>äºŒå‰æ ‘éå†çš„ä¸€äº›ç»å…¸é¢˜ç›®æ€»ç»“</title>
      <link href="/2018/09/16/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%8F%E5%85%B8%E9%A2%98%E7%9B%AE%E6%80%BB%E7%BB%93/"/>
      <url>/2018/09/16/%E4%BA%8C%E5%8F%89%E6%A0%91%E9%81%8D%E5%8E%86%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%8F%E5%85%B8%E9%A2%98%E7%9B%AE%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h2 id="éœ€è¦ä¿ç•™çŠ¶æ€çš„"><a href="#éœ€è¦ä¿ç•™çŠ¶æ€çš„" class="headerlink" title="éœ€è¦ä¿ç•™çŠ¶æ€çš„"></a>éœ€è¦ä¿ç•™çŠ¶æ€çš„</h2><blockquote><p>æ±‚å‡ºä¸€ä¸ªäºŒå‰æ ‘ä¸­ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€å°å€¼</p></blockquote><p>è¯¥é¢˜å°±éœ€è¦æ³¨æ„å¯èƒ½rootèŠ‚ç‚¹æœ€åº•å±‚èŠ‚ç‚¹ä¹‹é—´çš„å€¼</p><blockquote><p>å°†ä¸€ä¸ªæ ‘æ¯è¡Œæ‰“å°æˆä¸€ä¸ªStringï¼Œç„¶åå­˜å…¥ä¸€ä¸ªList</p></blockquote><p>è¯¥é¢˜éœ€è¦é‡‡ç”¨BFSï¼Œç„¶åé…åˆé˜Ÿåˆ—çš„ä¸€äº›APIæ–¹æ³•</p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºä¸¤é“åŠ¨æ€è§„åˆ’çš„æ€è€ƒ</title>
      <link href="/2018/09/15/%E5%85%B3%E4%BA%8E%E4%B8%A4%E9%81%93%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>/2018/09/15/%E5%85%B3%E4%BA%8E%E4%B8%A4%E9%81%93%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E7%9A%84%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<p>è¯´åˆ°åŠ¨æ€è§„åˆ’ï¼Œç¦»ä¸å¼€ä¸€ä¸ªçˆ¬æ¥¼æ¢¯çš„é—®é¢˜å’Œä¸€ä¸ªé“ºç –å¿«çš„é—®é¢˜ã€‚<br>çˆ¬æ¥¼æ¢¯çš„é—®é¢˜ï¼š</p><blockquote><p>ä¸€ä¸ªNå±‚çš„æ¥¼æ¢¯ï¼Œä¸€æ¬¡å¯ä»¥èµ°ä¸€æ­¥æˆ–è€…ä¸¤æ­¥ï¼Œæ±‚èµ°åˆ°æ¥¼æ¢¯é¡¶éƒ¨çš„æ‰€æœ‰æ­¥æ•°</p></blockquote><p>é“ºç –å¿«çš„é—®é¢˜ï¼š</p><blockquote><p>ä¸€ä¸ª2*nçš„åœ°æ–¹ï¼Œéœ€è¦é“ºä¸Šç“·ç –ï¼Œä½†æ˜¯ç“·ç –çš„è§„æ ¼åªæœ‰ 2x1 çš„ï¼Œæ±‚å¤šå°‘ç§é“ºæ³•ã€‚</p></blockquote><p>è®¡ç®—åˆ°é¡¶å±‚çš„æœ€å°é—®é¢˜ï¼š</p><blockquote><p>On a staircase, the i-th step has some non-negative cost cost[i] assigned (0 indexed).<br>  Once you pay the cost, you can either climb one or two steps. You need to find minimum cost to reach the top of the floor, and you can either start from the step with index 0, or the step with index 1.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä»0æˆ–è€…1å¼€å§‹é€‰æ‹©èµ·ç‚¹ï¼Œè€Œä¸”æ¯ä¸€æ­¥éƒ½å¯ä»¥é€‰æ‹©èµ°ä¸€æ­¥è¿˜æ˜¯ä¸¤æ­¥ã€‚</p><h2 id="èµ°æ¥¼æ¢¯"><a href="#èµ°æ¥¼æ¢¯" class="headerlink" title="èµ°æ¥¼æ¢¯"></a>èµ°æ¥¼æ¢¯</h2><p>é¦–å…ˆè¿™ä¸¤é“é¢˜ç›®éƒ½å¯ä»¥ä½¿ç”¨é€’å½’æ¥å®ç°ï¼Œå…³äºçˆ¬æ¥¼æ¢¯çš„é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯é‡‡ç”¨é€’å½’å®ç°ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> step è¡¨ç¤ºä»ç¬¬å‡ æ­¥å¼€å§‹èµ°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end è¡¨ç¤ºæœ‰å¤šå°‘å±‚æ¥¼æ¢¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>  <span class="title">upLouti</span><span class="params">(<span class="keyword">int</span> step ,<span class="keyword">int</span> end)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(step == end || step == end -<span class="number">1</span> )&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         <span class="keyword">return</span> upLouti(step+<span class="number">1</span>,end) + upLouti(step+<span class="number">2</span>,end);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæ­¤é¢˜çš„é€’å½’è§£æ³•å°±æ˜¯ä»0ä¸€ç›´æ±‚åˆ°endï¼Œç›´åˆ°ç»“æŸã€‚</p><h2 id="é“ºç“·ç –"><a href="#é“ºç“·ç –" class="headerlink" title="é“ºç“·ç –"></a>é“ºç“·ç –</h2><p>é“ºç“·ç –ä¹Ÿæ˜¯ç±»ä¼¼çš„ä¸€ä¸ªè§£æ³•ï¼Œä¹Ÿå°±æ˜¯å¦‚æœç¬¬ä¸€æ¬¡æ˜¯æ¨ªç€é“ºï¼Œé‚£ä¹ˆä¸‹é¢ä¸€ä¸ªè‚¯å®šä¹Ÿæ˜¯åªèƒ½æ¨ªç€é“ºã€‚å¦‚æœç¬¬ä¸€ä¸ªç“·ç –æ˜¯ç«–ç€é“ºçš„ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è¿›è¡Œé•¿åº¦å‡1ï¼Œç„¶åå†è®¡ç®—ã€‚</p><p>ç¬¬ä¸€æ¬¡é“ºï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E7%AC%AC%E4%B8%80%E6%AC%A1%E9%93%BA.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç¬¬ä¸€æ¬¡é“ºçš„ç –å—æ˜¯ç«–ç€é“ºçš„è¯ï¼Œé‚£ä¹ˆå‰©ä½™çš„è®¡ç®—å°±æ˜¯<code>n-1</code>ã€‚</p><p>å¦‚æœç¬¬ä¸€æ¬¡æ˜¯æ¨ªç€é“ºçš„è¯ï¼Œé‚£ä¹ˆå…¶ä¸‹é¢çš„ä¸€å—ç –è‚¯å®šä¹Ÿæ˜¯åªèƒ½æ¨ªç€é“ºçš„ï¼Œæ‰€ä»¥ç›´æ¥é•¿åº¦å‡2ï¼Œè®¡ç®—å°±æ˜¯<code>n-2</code><br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E9%93%BA.png" alt=""></p><p>ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">puCiZhuan</span><span class="params">(<span class="keyword">int</span> step ,<span class="keyword">int</span> end)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(step &gt;= end)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(step ==  end -<span class="number">1</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(step == end -<span class="number">3</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> puCiZhuan(step+<span class="number">1</span>,end)  + puCiZhuan(step + <span class="number">3</span> ,end);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><h2 id="æœ€å°è·¯å¾„åˆ°é¡¶ç‚¹"><a href="#æœ€å°è·¯å¾„åˆ°é¡¶ç‚¹" class="headerlink" title="æœ€å°è·¯å¾„åˆ°é¡¶ç‚¹"></a>æœ€å°è·¯å¾„åˆ°é¡¶ç‚¹</h2><p>å½“åœ¨è§£å†³è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œä¸èƒ½å’Œèµ°æ¥¼æ¢¯æœ‰ä¸€æ ·çš„æ€è·¯äº†ï¼Œå› ä¸ºè¯¥é¢˜ä¸ä»…ä»…éœ€è¦è€ƒè™‘ä¸‹ä¸€æ­¥çš„ä½ç½®ï¼Œè¿˜éœ€è¦è€ƒè™‘ä¸‹ä¸‹ä¸€æ­¥çš„ä½ç½®ã€‚<br>ä¾‹å¦‚<code>0,2,2,1</code>ï¼Œå¦‚æœåªè€ƒè™‘å•æ­¥çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„æœ€ä¼˜è§£å°±æ˜¯<code>1+2 =3</code> ï¼Œä½†æ˜¯å…¶å®ç€ä¸€é“é¢˜ç›®çš„æœ€ä¼˜è§£æ˜¯<code>2+0=2</code> ,æ‰€ä»¥åœ¨è¿™é‡Œéœ€è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•ä¿å­˜ä¸Šä¸€æ¬¡çš„ç»“æœç„¶åè¿›è¡Œæ¯”è¾ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">minCostClimbingStairs</span><span class="params">(<span class="keyword">int</span>[] cost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> f1 = <span class="number">0</span>, f2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = cost.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">int</span> f0 = cost[i] + Math.min(f1, f2);</span><br><span class="line">            f2 = f1;</span><br><span class="line">            f1 = f0;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.min(f1, f2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%8F%98%E5%8C%96%E5%9B%BE.png" alt=""></p><p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°åœ¨è¯¥ç®—æ³•ä¸­ï¼Œå…¶ä¸­f2ä¸€ç›´ä¿å­˜ç€ä¸Šä¸€æ¬¡çš„è®¡ç®—ç»“æœ</p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³•ï¼ŒåŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaé€šè¿‡getResourceAsStream()è¯»å–ä¸åˆ°æ–‡ä»¶çš„åŸå› </title>
      <link href="/2018/09/10/Java%E9%80%9A%E8%BF%87getResourceAsStream()%E8%AF%BB%E5%8F%96%E4%B8%8D%E5%88%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%8E%9F%E5%9B%A0/"/>
      <url>/2018/09/10/Java%E9%80%9A%E8%BF%87getResourceAsStream()%E8%AF%BB%E5%8F%96%E4%B8%8D%E5%88%B0%E6%96%87%E4%BB%B6%E7%9A%84%E5%8E%9F%E5%9B%A0/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆå‡ºç°è¿™ä¸ªåŸå› çš„æ—¶å€™ï¼Œéœ€è¦å¼„æ¸…æ¥šå·¥ç¨‹ç›®å½•å’Œç¼–è¯‘ç›®å½•ã€‚</p><h2 id="å·¥ç¨‹ç›®å½•"><a href="#å·¥ç¨‹ç›®å½•" class="headerlink" title="å·¥ç¨‹ç›®å½•"></a>å·¥ç¨‹ç›®å½•</h2><p>ä»¥IDEAä¸ºä¾‹ï¼Œåœ¨IDEAé‡Œé¢ï¼Œæˆ‘ä»¬å†™ä»£ç çš„åœ°æ–¹å°±æ˜¯ä¸€ä¸ªå·¥ç¨‹ç›®å½•ï¼Œå¸¸è§çš„ä¾‹å¦‚<code>src</code>ä¸‹é¢çš„å„ç§javaæ–‡ä»¶ï¼Œè¿™ç§ç›®å½•å°±å¯ä»¥ç§°ä¹‹ä¸ºä¸€ä¸ªå·¥ç¨‹ç›®å½•ï¼Œä¾‹å¦‚å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%B7%A5%E7%A8%8B%E7%9B%AE%E5%BD%95.png" alt=""></p><p>å·¥ç¨‹ç›®å½•ä¸»è¦å­˜æ”¾çš„æ˜¯ä¸€äº›é…ç½®æ–‡ä»¶æˆ–è€…ä¸€äº›javaæ–‡ä»¶ä¹‹ç±»çš„ï¼Œè€Œç»jvmç¼–è¯‘ä¹‹åçš„ç›®å½•ä¾¿æ˜¯ç¼–è¯‘ç›®å½•äº†</p><h2 id="ç¼–è¯‘ç›®å½•"><a href="#ç¼–è¯‘ç›®å½•" class="headerlink" title="ç¼–è¯‘ç›®å½•"></a>ç¼–è¯‘ç›®å½•</h2><p>ç¼–è¯‘ç›®å½•ä¸»è¦ç”¨äºå­˜æ”¾javaç¼–è¯‘åçš„classæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿è¡Œçš„æ–‡ä»¶ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œjavaæ˜¯ä¸€ç§è·¨å¹³å°è¯­è¨€ï¼Œæ‰€ä»¥jvmå®é™…è¿è¡Œçš„æ˜¯javaå˜å¼‚ä¹‹åçš„classæ–‡ä»¶ã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E7%BC%96%E8%AF%91%E7%9B%AE%E5%BD%95.png" alt=""></p><p>å½“çŸ¥é“äº†è¿™ä¸ªä¹‹åä¾¿ä¼šç†è§£ä¸ºä»€ä¹ˆä¼šé€šè¿‡<code>getResourceAsStream()</code>è¯»ä¸åˆ°æ–‡ä»¶äº†ã€‚</p><h2 id="getResourceAsStream"><a href="#getResourceAsStream" class="headerlink" title="getResourceAsStream()"></a>getResourceAsStream()</h2><p>ç¿»å¼€Javaçš„å®˜æ–¹æ–‡æ¡£ï¼Œå¯ä»¥çœ‹åˆ°<code>getResourceAsStream()</code>æ˜¯ClassLoaderçš„ä¸€ä¸ªæ–¹æ³•ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> InputStream<span class="title">getSystemResourceAsStream</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">Open <span class="keyword">for</span> reading, a resource of the specified name from the search path used to load classes.</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆä¸€èˆ¬è·å–Javaé…ç½®æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputStream inputStream = DemoTest.class.getClassLoader().getResourceAsStream();</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™ç¨‹åºè¿è¡Œèµ·æ¥äº†ï¼Œé‚£ä¹ˆå¥¹å°±ä¸ä¼šå»å·¥ç¨‹ç›®å½•ä¸‹å¯»æ‰¾é…ç½®æ–‡ä»¶äº†ï¼Œä¾‹å¦‚åœ¨å¦‚ä¸‹å·¥ç¨‹é‡Œé¢è¿è¡Œå¦‚ä¸‹ä»£ç ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%951.png" alt=""><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        InputStream inputStream = DemoTest.class.getClassLoader().getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">        <span class="keyword">if</span> (inputStream == <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"è·å–å¼‚å¸¸"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"è·å–åˆ°äº†æ–‡ä»¶"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">ç¨‹åºæ‰“å°å¦‚ä¸‹ï¼š</span><br><span class="line">è·å–å¼‚å¸¸</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°<code>getResourceAsStream</code>è·å–ä¸åˆ°æ–‡ä»¶äº†ï¼Œé‚£ä¹ˆå‡å¦‚å°†<code>mybatis-config.xml</code>å¤åˆ¶åˆ°targetçš„ç›®å½•ä¸‹é¢å»å‘¢?<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E8%BF%90%E8%A1%8C%E6%B5%8B%E8%AF%952.png" alt=""></p><p>å†æ¬¡è¿è¡Œè¯¥ä»£ç ï¼Œæ§åˆ¶å°æ‰“å°ï¼šè·å–åˆ°äº†æ–‡ä»¶ã€‚</p><p>æ‰€ä»¥é‡åˆ°äº†è¿™ä¸ªæƒ…å†µçš„è¯ä¸€èˆ¬å°±æ˜¯å·¥ç¨‹ç›®å½•å’Œç¼–è¯‘ç›®å½•ç¼ºå°‘æ–‡ä»¶äº†ã€‚</p><h2 id="å¦‚ä½•æ‰¾åˆ°ClassLoaderçš„è·å–æ–‡ä»¶ç›®å½•å‘¢"><a href="#å¦‚ä½•æ‰¾åˆ°ClassLoaderçš„è·å–æ–‡ä»¶ç›®å½•å‘¢" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°ClassLoaderçš„è·å–æ–‡ä»¶ç›®å½•å‘¢"></a>å¦‚ä½•æ‰¾åˆ°ClassLoaderçš„è·å–æ–‡ä»¶ç›®å½•å‘¢</h2><p>åªéœ€åœ¨<code>Resource</code>ç±»ä¸‹é¢debug<code>getResourceAsStream</code>ï¼Œç„¶åæ‰“å¼€loaderå³å¯ï¼Œæ‰¾å‡º<code>domain</code>å±æ€§å°±å¯ä»¥çœ‹åˆ°äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InputStream <span class="title">getResourceAsStream</span><span class="params">(ClassLoader loader, String resource)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    InputStream in = classLoaderWrapper.getResourceAsStream(resource, loader);</span><br><span class="line">    <span class="keyword">if</span> (in == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Could not find resource "</span> + resource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> in;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/mybatis.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°é‚£ä¸ªå°±æ˜¯ä¸€ä¸ªè·å–çš„ç¼–è¯‘ç›®å½•ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>ä½¿ç”¨Mybatisé‡åˆ°çš„there is no getter å¼‚å¸¸</title>
      <link href="/2018/09/10/%E4%BD%BF%E7%94%A8Mybatis%E9%81%87%E5%88%B0%E7%9A%84there-is-no-getter-%E5%BC%82%E5%B8%B8/"/>
      <url>/2018/09/10/%E4%BD%BF%E7%94%A8Mybatis%E9%81%87%E5%88%B0%E7%9A%84there-is-no-getter-%E5%BC%82%E5%B8%B8/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨mybatisçš„æ—¶å€™æœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ˜æ˜å‚æ•°æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæç¤º<code>There is no getter XXX</code>è¿™ä¸ªå¼‚å¸¸ï¼Œä½†æ˜¯ä¸€èˆ¬çš„è§£å†³åŠæ³•æ˜¯åœ¨mapperé‡Œé¢æ·»åŠ <code>@Param</code>æ³¨è§£æ¥å®Œæˆæ˜¯åˆ«çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>ä»¥ä¸‹ä¸ºä¸¾ä¾‹ä»£ç :</p><blockquote><p>Mapperå±‚ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Pro1_Mapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">Pro1_Studnet <span class="title">insertStu</span><span class="params">(Pro1_Studnet pro1_studnet)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®ä½“ç±»ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pro1_Studnet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String stuId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String stuName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String stuClass;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String stuTeacher;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuId</span><span class="params">(String stuId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuId = stuId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuName</span><span class="params">(String stuName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuName = stuName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuClass</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuClass</span><span class="params">(String stuClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuClass = stuClass;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStuTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stuTeacher;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStuTeacher</span><span class="params">(String stuTeacher)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stuTeacher = stuTeacher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>Mainæ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = <span class="keyword">null</span>;</span><br><span class="line">        logger = Logger.getLogger(Pro1_Main.class.getName());</span><br><span class="line">        logger.setLevel(Level.DEBUG);</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">            Pro1_Mapper pro1_Mapper = sqlSession.getMapper(Pro1_Mapper.class);</span><br><span class="line">            Pro1_Studnet pro1_studnet =<span class="keyword">new</span> Pro1_Studnet();</span><br><span class="line">            pro1_studnet.setStuName(<span class="string">"å¼ ä¸‰"</span>);</span><br><span class="line">            Pro1_Studnet pro1_studnet1 =pro1_Mapper.insertStu(pro1_studnet);</span><br><span class="line">            System.out.println(pro1_studnet1.getStuClass());</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>XMLæ–‡ä»¶</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"study.szh.demo.project1.Pro1_Mapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"study.szh.demo.project1.Pro1_Studnet"</span> <span class="attr">id</span>=<span class="string">"pro1_stu"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"stuId"</span> <span class="attr">column</span>=<span class="string">"stu_id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"stuName"</span> <span class="attr">column</span>=<span class="string">"stu_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"stuClass"</span> <span class="attr">column</span>=<span class="string">"stu_class"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"stuTeacher"</span> <span class="attr">column</span>=<span class="string">"stu_teacher"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"insertStu"</span> <span class="attr">parameterType</span>=<span class="string">"study.szh.demo.project1.Pro1_Studnet"</span> <span class="attr">resultMap</span>=<span class="string">"pro1_stu"</span>&gt;</span></span><br><span class="line">        SELECT * from pro_1stu where stu_name =  #&#123;pro1_studnet.stuName&#125;;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰§è¡Œä¸Šè¿°çš„ä»£ç ï¼Œä½ ä¼šå‘ç°mybatisä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š<br><code>There is no getter for property named &#39;pro1_studnet&#39; in &#39;class study.szh.demo.project1.Pro1_Studnet&#39;</code><br>å¾ˆæ˜æ˜¾å°±æ˜¯è¯´<code>pro1_studnet</code>è¿™ä¸ªåˆ«åæ²¡æœ‰è¢«mybatisæ­£ç¡®çš„è¯†åˆ«ï¼Œé‚£ä¹ˆå°†è¿™ä¸ª<code>pro1_studnet</code>å»æ‰å‘¢?</p><p>å°è¯•å°†xmlæ–‡ä»¶ä¸­çš„<code>pro1_studnet</code>å»æ‰ç„¶ååªä¿ç•™<code>stuName</code>ï¼Œæ‰§è¡Œä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¼ ä¸‰</span><br></pre></td></tr></table></figure></p><p>è¿™è¡¨æ˜ç¨‹åºè¿è¡Œçš„ååˆ†æ­£å¸¸ï¼Œä½†æ˜¯åœ¨å®é™…çš„å†™æ³•ä¸­ï¼Œè¿˜æœ‰å¦‚æœå‚æ•°ä¸º<code>String</code>ä¹Ÿä¼šå¯¼è‡´æŠ›å‡ºgetterå¼‚å¸¸ï¼Œæ‰€ä»¥æ­¤æ¬¡æ­£å¥½æ¥åˆ†æä¸‹</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="mybatisæ˜¯å¦‚ä½•è§£æmapperå‚æ•°çš„"><a href="#mybatisæ˜¯å¦‚ä½•è§£æmapperå‚æ•°çš„" class="headerlink" title="mybatisæ˜¯å¦‚ä½•è§£æmapperå‚æ•°çš„"></a>mybatisæ˜¯å¦‚ä½•è§£æmapperå‚æ•°çš„</h3><p>è·Ÿè¸ªæºç ä½ ä¼šå‘ç°åœ¨<code>MapperProxy</code>çš„<code>invoke</code>å¤„ä¼šè¿›è¡Œå…¥å‚:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">        <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDefaultMethod(method)) &#123;</span><br><span class="line">        <span class="keyword">return</span> invokeDefaultMethod(proxy, method, args);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> MapperMethod mapperMethod = cachedMapperMethod(method);</span><br><span class="line">    <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„æ­¤å¤„çš„argsï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯mapperçš„å…¥å‚ã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/args%E5%8F%82%E6%95%B0.png" alt=""></p><p>é‚£ä¹ˆmybatisåœ¨è¿™é‡Œæ¥æ”¶åˆ°è¿™ä¸ªå‚æ•°ä¹‹åï¼Œå®ƒä¼šå°†å‚æ•°å†ä¸€æ¬¡è¿›è¡Œä¼ é€’ï¼Œæ­¤æ—¶ä¼šè¿›å…¥åˆ°<code>MapperMethod</code>çš„<code>execute</code>æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">execute</span><span class="params">(SqlSession sqlSession, Object[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//çœç•¥æ— å…³ä»£ç </span></span><br><span class="line">      <span class="keyword">case</span> SELECT:</span><br><span class="line">        <span class="keyword">if</span> (method.returnsVoid() &amp;&amp; method.hasResultHandler()) &#123;</span><br><span class="line">          executeWithResultHandler(sqlSession, args);</span><br><span class="line">          result = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.returnsMany()) &#123;</span><br><span class="line">          result = executeForMany(sqlSession, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.returnsMap()) &#123;</span><br><span class="line">          result = executeForMap(sqlSession, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.returnsCursor()) &#123;</span><br><span class="line">          result = executeForCursor(sqlSession, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          Object param = method.convertArgsToSqlCommandParam(args);</span><br><span class="line">          result = sqlSession.selectOne(command.getName(), param);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> FLUSH:</span><br><span class="line">        result = sqlSession.flushStatements();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">"Unknown execution method for: "</span> + command.getName());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="keyword">null</span> &amp;&amp; method.getReturnType().isPrimitive() &amp;&amp; !method.returnsVoid()) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> BindingException(<span class="string">"Mapper method '"</span> + command.getName() </span><br><span class="line">          + <span class="string">" attempted to return null from a method with a primitive return type ("</span> + method.getReturnType() + <span class="string">")."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>å› ä¸ºåœ¨<code>xml</code>æ–‡ä»¶é‡Œé¢ä½¿ç”¨çš„æ˜¯<code>select</code>æ ‡ç­¾ï¼Œæ‰€ä»¥ä¼šè¿›å…¥<code>case</code>çš„selectï¼Œç„¶åæ­¤æ—¶ä¼šè¿›å…¥åˆ°<code>Object param = method.convertArgsToSqlCommandParam(args);</code> åœ¨è¿™é‡Œ<code>args</code>è¿˜æ˜¯Stuçš„å®ä½“ç±»ï¼Œå¹¶æœªå‘ç”Ÿå˜åŒ–</p><p>éšåè¿›å…¥<code>convertArgsToSqlCommandParam</code>æ–¹æ³•ï¼Œç„¶åç»è¿‡ä¸€ä¸ªæ–¹æ³•çš„è·³è½¬ï¼Œæœ€åä¼šè¿›å…¥åˆ°<code>ParamNameResolver</code>çš„<code>getNamedParams</code>æ–¹æ³•ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getNamedParams</span><span class="params">(Object[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> paramCount = names.size();</span><br><span class="line">    <span class="keyword">if</span> (args == <span class="keyword">null</span> || paramCount == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!hasParamAnnotation &amp;&amp; paramCount == <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> args[names.firstKey()];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> Map&lt;String, Object&gt; param = <span class="keyword">new</span> ParamMap&lt;Object&gt;();</span><br><span class="line">      <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;Integer, String&gt; entry : names.entrySet()) &#123;</span><br><span class="line">        param.put(entry.getValue(), args[entry.getKey()]);</span><br><span class="line">        <span class="comment">// add generic param names (param1, param2, ...)</span></span><br><span class="line">        <span class="keyword">final</span> String genericParamName = GENERIC_NAME_PREFIX + String.valueOf(i + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// ensure not to overwrite parameter named with @Param</span></span><br><span class="line">        <span class="keyword">if</span> (!names.containsValue(genericParamName)) &#123;</span><br><span class="line">          param.put(genericParamName, args[entry.getKey()]);</span><br><span class="line">        &#125;</span><br><span class="line">        i++;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> param;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶æ³¨æ„<code>hasParamAnnotation</code>è¿™ä¸ªåˆ¤æ–­ï¼Œè¿™ä¸ªåˆ¤æ–­è¡¨ç¤ºè¯¥å‚æ•°æ˜¯å¦å«æœ‰æ ‡ç­¾ï¼Œæœ‰çš„è¯åœ¨è¿™é‡Œä¼šåœ¨Mapé‡Œé¢æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œå…¶é”®å°±æ˜¯<code>GENERIC_NAME_PREFIX</code>(param) + i çš„å€¼ã€‚åƒåœ¨æœ¬æ¬¡çš„æµ‹è¯•ä»£ç çš„è¯ï¼Œä¼šç›´æ¥åœ¨<code>return args[names.firstKey()];</code>è¿”å›ï¼Œä¸è¿‡è¿™ä¸æ˜¯é‡ç‚¹ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œä¼šè¿”å›åˆ°<code>MapperMethod</code>çš„<code>execute</code>æ–¹æ³•çš„è¿™ä¸€è¡Œ<code>result = sqlSession.selectOne(command.getName(), param);</code></p><p>æ­¤æ—¶çš„paramå°±æ˜¯ä¸€ä¸ªStuå¯¹è±¡äº†ã€‚<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E5%AF%B9%E8%B1%A1.png" alt=""></p><p>ç»§ç»­èµ°ä¸‹å»â€¦ç”±äºmybatisçš„è°ƒç”¨é“¾å¤ªå¤šï¼Œæ­¤å¤„åªä¼šå†™å‡ºéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå¯ä»¥åœ¨è‡ªå·±debugçš„æ—¶å€™ç¨å¾®æ³¨æ„ä¸‹ã€‚</p><h5 id="BaseExecutorçš„createCacheKeyçš„æ–¹æ³•"><a href="#BaseExecutorçš„createCacheKeyçš„æ–¹æ³•" class="headerlink" title="BaseExecutorçš„createCacheKeyçš„æ–¹æ³•"></a><code>BaseExecutor</code>çš„<code>createCacheKey</code>çš„æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CacheKey <span class="title">createCacheKey</span><span class="params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, BoundSql boundSql)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (closed) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ExecutorException(<span class="string">"Executor was closed."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    CacheKey cacheKey = <span class="keyword">new</span> CacheKey();</span><br><span class="line">    cacheKey.update(ms.getId());</span><br><span class="line">    cacheKey.update(rowBounds.getOffset());</span><br><span class="line">    cacheKey.update(rowBounds.getLimit());</span><br><span class="line">    cacheKey.update(boundSql.getSql());</span><br><span class="line">    List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();</span><br><span class="line">    TypeHandlerRegistry typeHandlerRegistry = ms.getConfiguration().getTypeHandlerRegistry();</span><br><span class="line">    <span class="comment">// mimic DefaultParameterHandler logic</span></span><br><span class="line">    <span class="keyword">for</span> (ParameterMapping parameterMapping : parameterMappings) &#123;</span><br><span class="line">      <span class="keyword">if</span> (parameterMapping.getMode() != ParameterMode.OUT) &#123;</span><br><span class="line">        Object value;</span><br><span class="line">        String propertyName = parameterMapping.getProperty();</span><br><span class="line">        <span class="keyword">if</span> (boundSql.hasAdditionalParameter(propertyName)) &#123;</span><br><span class="line">          value = boundSql.getAdditionalParameter(propertyName);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (parameterObject == <span class="keyword">null</span>) &#123;</span><br><span class="line">          value = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (typeHandlerRegistry.hasTypeHandler(parameterObject.getClass())) &#123;</span><br><span class="line">          value = parameterObject;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          MetaObject metaObject = configuration.newMetaObject(parameterObject);</span><br><span class="line">          value = metaObject.getValue(propertyName);</span><br><span class="line">        &#125;</span><br><span class="line">        cacheKey.update(value);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (configuration.getEnvironment() != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="comment">// issue #176</span></span><br><span class="line">      cacheKey.update(configuration.getEnvironment().getId());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cacheKey;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å½“è¿›è¡Œåˆ°è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œç”±äºmybatisçš„ç±»å¤ªå¤šäº†ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©æ€§çš„è·³è¿‡ï¼Œå½“ç„¶é‡è¦çš„ä»£ç è¿˜æ˜¯ä¼šä»‹ç»çš„ã€‚</p><h5 id="DefaultReflectorFactoryçš„findForClassæ–¹æ³•"><a href="#DefaultReflectorFactoryçš„findForClassæ–¹æ³•" class="headerlink" title="DefaultReflectorFactoryçš„findForClassæ–¹æ³•"></a>DefaultReflectorFactoryçš„findForClassæ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Reflector <span class="title">findForClass</span><span class="params">(Class&lt;?&gt; type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (classCacheEnabled) &#123;</span><br><span class="line">            <span class="comment">// synchronized (type) removed see issue #461</span></span><br><span class="line">      Reflector cached = reflectorMap.get(type);</span><br><span class="line">      <span class="keyword">if</span> (cached == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cached = <span class="keyword">new</span> Reflector(type);</span><br><span class="line">        reflectorMap.put(type, cached);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> cached;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Reflector(type);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>MetaObject</code>çš„<code>getValue</code>æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getValue</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">   PropertyTokenizer prop = <span class="keyword">new</span> PropertyTokenizer(name);</span><br><span class="line">   <span class="keyword">if</span> (prop.hasNext()) &#123;</span><br><span class="line">     MetaObject metaValue = metaObjectForProperty(prop.getIndexedName());</span><br><span class="line">     <span class="keyword">if</span> (metaValue == SystemMetaObject.NULL_META_OBJECT) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> metaValue.getValue(prop.getChildren());</span><br><span class="line">     &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> objectWrapper.get(prop);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„nameçš„å€¼æ˜¯<code>pro1_stu.stuName</code>,è€Œpropçš„å±æ€§æ˜¯è¿™æ ·çš„:<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/prop.png" alt=""><br>è¿™é‡Œçš„<code>hasNext</code>å‡½æ•°ä¼šåˆ¤æ–­è¿™ä¸ª<code>prop</code>çš„childrenæ˜¯ä¸æ˜¯ä¸ºç©ºï¼Œå¦‚æœä¸æ˜¯ç©ºçš„è¯å°±ä¼šè¿›å…¥ get æ–¹æ³•ï¼Œç„¶åè¿›å…¥åˆ°å¦‚ä¸‹çš„æ–¹æ³•é€šè¿‡è¿”å›è·å–getæ–¹æ³•ã€‚<br>æ‰€ä»¥å½“éå†åˆ°<code>stuName</code>çš„æ—¶å€™ä¼šç›´æ¥returnï¼Œ</p><p>ç„¶åå°±éœ€è¦æ³¨æ„<code>Reflector</code>çš„<code>getGetInvoker</code>æ–¹æ³•ï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Invoker <span class="title">getGetInvoker</span><span class="params">(String propertyName)</span> </span>&#123;</span><br><span class="line">    Invoker method = getMethods.get(propertyName);</span><br><span class="line">    <span class="keyword">if</span> (method == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> ReflectionException(<span class="string">"There is no getter for property named '"</span> + propertyName + <span class="string">"' in '"</span> + type + <span class="string">"'"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> method;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ª<code>propertyName</code>å°±æ˜¯<code>pro1_studnet</code>ï¼Œè€Œ<code>getMethods.get(propertyName);</code>å°±æ˜¯è¦é€šè¿‡åå°„è·å–<code>pro1_studnet</code>æ–¹æ³•ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œæ˜¯è·å–ä¸åˆ°çš„ï¼Œæ‰€ä»¥æ­¤æ—¶å°±ä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚</p><h3 id="é‚£ä¹ˆä¸ºä»€ä¹ˆåŠ äº†-paramæ³¨è§£ä¹‹åå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸å‘¢"><a href="#é‚£ä¹ˆä¸ºä»€ä¹ˆåŠ äº†-paramæ³¨è§£ä¹‹åå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸å‘¢" class="headerlink" title="é‚£ä¹ˆä¸ºä»€ä¹ˆåŠ äº†@paramæ³¨è§£ä¹‹åå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸å‘¢"></a>é‚£ä¹ˆä¸ºä»€ä¹ˆåŠ äº†@paramæ³¨è§£ä¹‹åå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸å‘¢</h3><p>æ­¤æ—¶å°±éœ€è¦æ³¨æ„<code>MapWrapper</code>ç±»çš„<code>get</code>æ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(PropertyTokenizer prop)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (prop.getIndex() != <span class="keyword">null</span>) &#123;</span><br><span class="line">     Object collection = resolveCollection(prop, map);</span><br><span class="line">     <span class="keyword">return</span> getCollectionValue(prop, collection);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> map.get(prop.getName());</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨ä¹‹å‰å°±è¯´è¿‡ï¼Œå¦‚æœåŠ äº†æ³¨è§£çš„è¯ï¼Œmapçš„ç»“æ„æ˜¯{â€œparam1â€,â€pro1_studnetâ€,â€pro1_studnetâ€,XXXå¯¹è±¡}ï¼Œæ­¤æ—¶ç”±äºpropçš„indexæ˜¯nullï¼Œæ‰€ä»¥ä¼šç›´æ¥è¿”å›mapçš„é”®å€¼ä¸º<code>pro1_studnet</code>çš„å¯¹è±¡ã€‚<br>è€Œåœ¨<code>DefaultReflectorFactory</code>çš„<code>findForClass</code>é‡Œé¢ï¼Œç”±äºæ‰€åŠ è½½çš„å®ä½“ç±»å·²ç»åŒ…å«äº†Pro1_Studentï¼Œéšååœ¨<code>metaValue.getValue(prop.getChildren());</code>çš„å°†<code>stu_name</code>ä¼ å…¥è¿‡å»ï¼Œå°±å¯ä»¥äº†è·å–åˆ°äº†å±æ€§çš„å€¼äº†ã€‚</p>]]></content>
      
      <categories>
          
          <category> Mybatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Jsonçš„åº•å±‚å®ç°ä¸€è§ˆ</title>
      <link href="/2018/09/06/Json%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E4%B8%80%E8%A7%88/"/>
      <url>/2018/09/06/Json%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E4%B8%80%E8%A7%88/</url>
      <content type="html"><![CDATA[<p>åœ¨å¼€å§‹äº†è§£Jsonçš„åŸç†ä¹‹å‰ï¼Œé¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼Œåœ¨è¿™é‡Œä»¥é˜¿é‡Œçš„<code>FastJson</code>ä¸ºä¾‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonRun</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        JSONObject jsonObject =<span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject.put(<span class="string">"id"</span>,<span class="string">"a"</span>);</span><br><span class="line">        jsonObject.put(<span class="string">"name"</span>,<span class="string">"b"</span>);</span><br><span class="line">        System.out.println(jsonObject.toJSONString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å½“çœ‹åˆ°ä¸Šè¿°ä»£ç çš„æ—¶å€™ï¼Œå¯èƒ½ä¸€èˆ¬çš„ç¨‹åºå‘˜éƒ½ä¼šæƒ³åˆ°çš„æ˜¯è¾“å‡ºä¸ºå¦‚ä¸‹<code>Json</code>ä¸²</p><blockquote><p>{â€œidâ€:â€aâ€,â€nameâ€:â€bâ€}<br>ä½†æ˜¯è¿è¡Œè¿™æ®µç¨‹åºï¼Œä½ ä¼šå‘ç°æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„æ˜¯å¦‚ä¸‹ä»£ç ï¼š<br>{â€œnameâ€:â€bâ€,â€idâ€:â€aâ€}</p></blockquote><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Œç¿»å¼€<code>FastJson</code>çš„æºç ä¾¿çŸ¥é“äº†ï¼Œé¦–å…ˆå®šä½åˆ° JsonObject è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">JSONObject</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">boolean</span> ordered)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ordered) &#123;</span><br><span class="line">            map = <span class="keyword">new</span> LinkedHashMap&lt;String, Object&gt;(initialCapacity);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(initialCapacity);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„ <code>ordered</code> ä¸ºä¸€ä¸ªæ„é€ å‚æ•°ï¼Œè¡¨ç¤ºçš„æ˜¯æ˜¯å¦æŒ‰ç…§é¡ºåºæ·»åŠ ï¼Œæ­¤å¤„å…ˆä¸ç®¡ï¼Œç„¶åå¯ä»¥å‘ç°åœ¨é˜¿é‡Œçš„FastJsonä¸­ï¼Œå…¶å®é»˜è®¤çš„Jsonå®ç°æ˜¯ä¸€ä¸ªMapï¼Œé‚£ä¹ˆå¯¹äºLinkedHashMapæ¥è®²ï¼Œå®ƒæ˜¯ä¸€ä¸ªmapå’ŒåŒå‘é“¾è¡¨çš„æ•´åˆä½“ï¼Œæ‰€ä»¥åœ¨LinkedListä¸­ï¼Œæ¯ä¸€ä¸ªNodeéƒ½ä¼šæœ‰ä¸€ä¸ªå‰æŒ‡é’ˆå’Œä¸€ä¸ªåæŒ‡é’ˆ</p><h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><p>LinkedHashMap æ˜¯ä¸€ä¸ªHashMapçš„å˜ç§ï¼Œå¤§å®¶éƒ½çŸ¥é“ï¼Œä¸€ä¸ªHashMapæ˜¯ç”±ä¸€ä¸ªæ¡¶å’Œä¸€ä¸ªæ¡¶åé¢çš„èŠ‚ç‚¹ç»„æˆçš„ï¼Œè€Œæ¡¶å…¶å®æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªæ¡¶çš„ç´¢å¼•æ‰€å¯¹åº”çš„å€¼éƒ½æ˜¯ç”±<code>Hash()</code>å‡½æ•°è®¡ç®—å¾—å‡ºçš„ã€‚é‚£ä¹ˆè¿™æ ·å°±ä¼šå¯¼è‡´æ¡¶çš„å…ƒç´ æ˜¯ä¸€ä¸ªä¹±åºçš„å­˜å‚¨çš„ï¼Œä¾‹å¦‚åœ¨æœ¬æ®µä»£ç ä¸­çš„<code>id</code>å’Œ<code>name</code>ï¼Œå®ƒä»¬æ‰€åœ¨çš„æ¡¶ç´¢å¼•å¯èƒ½æ˜¯:<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/TIM%E6%88%AA%E5%9B%BE20180909203451.png" alt=""></p><p>è¿™æ ·å°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯Jsonçš„é”®çš„é¡ºåºæ˜¯æ— æ³•ä¿è¯çš„ï¼Œé‚£ä¹ˆæ—¢ç„¶HashMapæ˜¯æ— æ³•ä¿è¯çš„ï¼Œä¸ºä»€ä¹ˆLinkedHashMapå´å¯ä»¥ä¿è¯é¡ºåºã€‚</p><h2 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h2><p>ç¿»å¼€LinkedHashMapçš„æºç å¯ä»¥å‘ç°ï¼Œåœ¨å…¶èŠ‚ç‚¹ç±»é‡Œé¢ï¼ŒLinkedHashMapåœ¨ HashMapçš„EntryåŸºç¡€ä¸Šåˆæ·»åŠ äº†ä¸€ä¸ª<code>before</code>å’Œ<code>after</code>æŒ‡é’ˆï¼Œ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">HashMap</span>.<span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">      Entry&lt;K,V&gt; before, after;</span><br><span class="line">      Entry(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">          <span class="keyword">super</span>(hash, key, value, next);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆå°±æ˜¯åŒå‘é“¾è¡¨çš„æŒ‡é’ˆã€‚æœ‰äº†è¿™ä¸¤ä¸ªæŒ‡é’ˆä¹‹åï¼Œæ¯ä¸€ä¸ªæ–°æ’å…¥çš„èŠ‚ç‚¹éƒ½ä¼šçŸ¥é“ä»–çš„å‰é©±ç»“ç‚¹å’Œåç½®èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯¹äºLinkedHashMapçš„æ’å…¥é¡ºåºå°±ä¼šæœ‰ä¿è¯äº†ã€‚æ‰€ä»¥å…¶å¯¹åº”çš„æ•°æ®ç»“æ„å¦‚å›¾ï¼š<br><img src="https://szhtc-1252780558.cos.ap-shanghai.myqcloud.com/%E9%93%BE%E8%A1%A8%E4%B9%8B%E5%90%8E.png" alt=""></p><p>åœ¨è¿™ä¸ªç»“æ„é‡Œé¢ï¼Œæ¡¶ç´¢å¼•æ˜¯<code>id</code>çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œåœ¨æ–°æ’å…¥<code>name</code>çš„æ—¶å€™ï¼ŒLinkedHashMapä¼šå°†headèŠ‚ç‚¹çš„<code>after</code>æŒ‡é’ˆæŒ‡å‘nameï¼Œæ‰€ä»¥è™½ç„¶è¿™æ˜¯ä¸€ä¸ªHashMapï¼Œä½†æ˜¯å®ƒçš„é¡ºåºè¿˜æ˜¯å¯ä»¥ä¿è¯çš„ã€‚</p><h2 id="LinkedHashMapçš„è¿­ä»£"><a href="#LinkedHashMapçš„è¿­ä»£" class="headerlink" title="LinkedHashMapçš„è¿­ä»£"></a>LinkedHashMapçš„è¿­ä»£</h2><p>åŒºåˆ«äºHashMapä»¥ç´¢å¼•çš„æ–¹å¼è¿›è¡Œè¿­ä»£ï¼Œ<code>LinkedHashMap</code>æ˜¯ä»¥é“¾è¡¨çš„æŒ‡é’ˆè¿›è¡Œè¿­ä»£çš„ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedHashIterator</span> </span>&#123;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; next;</span><br><span class="line">        LinkedHashMap.Entry&lt;K,V&gt; current;</span><br><span class="line">        <span class="keyword">int</span> expectedModCount;</span><br><span class="line"></span><br><span class="line">        LinkedHashIterator() &#123;</span><br><span class="line">            next = head;</span><br><span class="line">            expectedModCount = modCount;</span><br><span class="line">            current = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> LinkedHashMap.<span class="function">Entry&lt;K,V&gt; <span class="title">nextNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            LinkedHashMap.Entry&lt;K,V&gt; e = next;  <span class="comment">//nextå°±æ˜¯headèŠ‚ç‚¹</span></span><br><span class="line">            <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">            <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">            current = e;</span><br><span class="line">            next = e.after; <span class="comment">//æ­¤å¤„æ¯ä¸€æ¬¡çš„è¿­ä»£éƒ½æ˜¯é“¾è¡¨çš„after</span></span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°åœ¨æ¯ä¸€æ¬¡è¿­ä»£çš„æ—¶å€™LinkedHashMapéƒ½æ˜¯ä»¥é“¾è¡¨çš„nextèŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªè¿­ä»£ï¼Œé‚£ä¹ˆHashMapå‘¢ï¼Ÿ</p><h2 id="HashMapçš„è¿­ä»£"><a href="#HashMapçš„è¿­ä»£" class="headerlink" title="HashMapçš„è¿­ä»£"></a>HashMapçš„è¿­ä»£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">HashIterator</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt; next;        <span class="comment">// next entry to return</span></span><br><span class="line">        Node&lt;K,V&gt; current;     <span class="comment">// current entry</span></span><br><span class="line">        <span class="keyword">int</span> expectedModCount;  <span class="comment">// for fast-fail</span></span><br><span class="line">        <span class="keyword">int</span> index;             <span class="comment">// current slot</span></span><br><span class="line"></span><br><span class="line">HashIterator() &#123;</span><br><span class="line">            expectedModCount = modCount;</span><br><span class="line">            Node&lt;K,V&gt;[] t = table;</span><br><span class="line">            current = next = <span class="keyword">null</span>;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (t != <span class="keyword">null</span> &amp;&amp; size &gt; <span class="number">0</span>) &#123; <span class="comment">// advance to first entry</span></span><br><span class="line">                <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">nextNode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            Node&lt;K,V&gt;[] t;</span><br><span class="line">            Node&lt;K,V&gt; e = next;</span><br><span class="line">            <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">            <span class="keyword">if</span> (e == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">            <span class="keyword">if</span> ((next = (current = e).next) == <span class="keyword">null</span> &amp;&amp; (t = table) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">do</span> &#123;&#125; <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> e;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™ä¸€æ®µä»£ç </p><blockquote><p> if (t != null &amp;&amp; size &gt; 0) { // advance to first entry<br>                do {} while (index &lt; t.length &amp;&amp; (next = t[index++]) == null);<br>    }</p></blockquote><p>è¿™ä¸€æ®µä»£ç çš„ä½œç”¨æ˜¯æ‰¾å‡º<code>table[]</code>ä¸­ç¬¬ä¸€ä¸ªä¸ä¸ºnullçš„æ¡¶ï¼Œæ‰€ä»¥å…¶å®HashMapçš„è¿­ä»£å°±æ˜¯ä¾æ®æ¡¶ä¸­çš„é¡ºåºæ¥çš„ï¼Œä½†æ˜¯LinkedHashMapåˆ™æ˜¯æŒ‰æ‰¾é“¾è¡¨çš„é¡ºåºæ¥çš„ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å…¶å®æ¯ä¸€ä¸ªjavaçš„è®¾è®¡éƒ½æ˜¯å¾ˆç²¾å¦™çš„â€¦</p>]]></content>
      
      <categories>
          
          <category> Json </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Json </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å°†Jacksonæ›¿æ¢æˆFastjosn</title>
      <link href="/2018/09/04/%E5%B0%86Jackson%E6%9B%BF%E6%8D%A2%E6%88%90Fastjosn/"/>
      <url>/2018/09/04/%E5%B0%86Jackson%E6%9B%BF%E6%8D%A2%E6%88%90Fastjosn/</url>
      <content type="html"><![CDATA[<p>è®°å¾—æœ‰ä¸€æ¬¡çš„é¢è¯•æ˜¯ã€‚å¦‚ä½•åœ¨Springä¸­å°†<code>JackSon</code> æ›¿æ¢ä¸º <code>FastJson</code>ï¼Œemmmmâ€¦å½“æ—¶çš„å›ç­”æ˜¯åªéœ€è¦æ›¿æ¢ pom.xmlï¼Œç„¶ååœ¨ä½¿ç”¨çš„æ—¶å€™å¼•å…¥FastJosnå°±è¡Œäº†ï¼Œä½†æ˜¯åœ¨å½“æ—¶æ˜¾ç„¶æ²¡æœ‰ç†è§£åˆ°é¢è¯•å®˜çš„æ„å›¾ï¼Œæ—¢ç„¶é¢è¯•å®˜å¼ºè°ƒçš„æ˜¯å¦‚ä½•æ›¿æ¢ï¼Œé‚£ä¹ˆä¿®æ”¹<code>pom.xml</code>å¾ˆæ˜¾ç„¶ä¸æ˜¯é¢è¯•å®˜æ‰€æƒ³è¦çš„ç­”æ¡ˆï¼Œé‚£è¿˜æœ‰ä»€ä¹ˆç­”æ¡ˆå‘¢ï¼Ÿ</p><p>æœ‰ä¸€ä¸ªæ–¹æ³•å¯èƒ½æ˜¯é¢è¯•å®˜æƒ³è¦çš„ï¼Œé‚£å°±æ˜¯é‡å†™Springçš„<code>HttpMesageConverter</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å¼•å…¥<code>FastJson</code>çš„é…ç½®ï¼Œç„¶åæ›¿æ¢æ‰Springé»˜è®¤çš„<code>Jackson</code>ã€‚</p><p>æ›¿æ¢æ–¹å¼æœ‰å‡ ç§ï¼Œä¸€ç§æ˜¯è¿”å›ä¸€ä¸ª<code>HttpMesageConverter</code>ï¼Œå¦ä¸€ç§æ˜¯ç»§æ‰¿<code>WebMvcConfigurerAdapter</code> æ¥å®ç° <code>configureMessageConverters</code></p><h2 id="ä»£ç å¦‚ä¸‹ï¼š"><a href="#ä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="ä»£ç å¦‚ä¸‹ï¼š"></a>ä»£ç å¦‚ä¸‹ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebConfig</span> <span class="keyword">extends</span> <span class="title">WebMvcConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">        FastJsonConfig fastJsonConfig = <span class="keyword">new</span> FastJsonConfig();</span><br><span class="line">        fastJsonConfig.setSerializerFeatures(</span><br><span class="line">                <span class="comment">// è¾“å‡ºç©ºç½®å­—æ®µ</span></span><br><span class="line">                SerializerFeature.WriteMapNullValue,</span><br><span class="line">                <span class="comment">// listå­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸º[]ï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">                SerializerFeature.WriteNullListAsEmpty,</span><br><span class="line">                <span class="comment">// æ•°å€¼å­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸º0ï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">                SerializerFeature.WriteNullNumberAsZero,</span><br><span class="line">                <span class="comment">// Booleanå­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸ºfalseï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">                SerializerFeature.WriteNullBooleanAsFalse,</span><br><span class="line">                <span class="comment">// å­—ç¬¦ç±»å‹å­—æ®µå¦‚æœä¸ºnullï¼Œè¾“å‡ºä¸º""ï¼Œè€Œä¸æ˜¯null</span></span><br><span class="line">                SerializerFeature.WriteNullStringAsEmpty);</span><br><span class="line"></span><br><span class="line">        fastJsonConfig.setCharset(Charset.forName(<span class="string">"UTF-8"</span>));</span><br><span class="line">        fastJsonConfig.setDateFormat(<span class="string">"yyyy-MM-dd hh:mm:ss"</span>);</span><br><span class="line">        FastJsonHttpMessageConverter Converter = <span class="keyword">new</span> FastJsonHttpMessageConverter();</span><br><span class="line">        Converter.setFastJsonConfig(fastJsonConfig);</span><br><span class="line">        HttpMessageConverter&lt;?&gt; converter = Converter;</span><br><span class="line">        converters.add(<span class="number">0</span>,converter);</span><br><span class="line">        <span class="keyword">super</span>.configureMessageConverters(converters);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="Controllerç±»"><a href="#Controllerç±»" class="headerlink" title="Controllerç±»"></a>Controllerç±»</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/testjson"</span>)</span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> TestJson <span class="title">forword</span><span class="params">(@RequestBody TestJson testJson)</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       System.out.println(testJson.getId());</span><br><span class="line">       System.out.println(testJson.getName());</span><br><span class="line">       System.out.println(testJson.isFlag());</span><br><span class="line">       <span class="keyword">return</span> testJson;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‘é€è¯·æ±‚</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="string">"id"</span>:<span class="number">1</span>,</span><br><span class="line"><span class="string">"name"</span>:<span class="keyword">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ§åˆ¶å°è¾“å‡º</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"flag"</span>: <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°é»˜è®¤çš„Jacksonå·²ç»è¢«æ›¿æ¢ä¸ºFastjsonäº†</p><p>ä¸ºäº†åŒºåˆ«ä¸Jacksonçš„å·®å¼‚ï¼Œåœ¨è¿™é‡Œæ³¨é‡Šæ‰Jacksonçš„configï¼Œç„¶åå†æ¬¡è¯·æ±‚ï¼Œç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"name"</span>: <span class="keyword">null</span>,</span><br><span class="line">    <span class="string">"flag"</span>: <span class="keyword">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°Stringä¸ºnullçš„è¯ï¼Œå¹¶æ²¡æœ‰è¢«æ›¿æ¢ä¸ºâ€â€</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linuxä¸Šå®‰è£…rabbitmqé‡åˆ°çš„ä¸€äº›é—®é¢˜</title>
      <link href="/2018/08/29/Linux%E4%B8%8A%E5%AE%89%E8%A3%85rabbitmq%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>/2018/08/29/Linux%E4%B8%8A%E5%AE%89%E8%A3%85rabbitmq%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h1 id="åœ¨å®‰è£…elixirçš„æ—¶å€™erlangï¼Œå®‰è£…äº†é”™è¯¯çš„åŒ…"><a href="#åœ¨å®‰è£…elixirçš„æ—¶å€™erlangï¼Œå®‰è£…äº†é”™è¯¯çš„åŒ…" class="headerlink" title="åœ¨å®‰è£…elixirçš„æ—¶å€™erlangï¼Œå®‰è£…äº†é”™è¯¯çš„åŒ…"></a>åœ¨å®‰è£…elixirçš„æ—¶å€™erlangï¼Œå®‰è£…äº†é”™è¯¯çš„åŒ…</h1><p>é”™è¯¯è®°å½•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;init terminating in do_boot&quot;,&#123;&apos;cannot get bootfile&apos;,&apos;no_dot_erlang.boot&apos;&#125;&#125;</span><br><span class="line">init terminating in do_boot (&#123;cannot get bootfile,no_dot_erlang.boot&#125;)</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶çš„é”™è¯¯æ˜¯åœ¨å®‰è£…erlangçš„æ—¶å€™å®‰è£…äº†é”™è¯¯çš„erlangï¼Œæ­£ç¡®çš„éœ€è¦å®‰è£…çš„æ˜¯<code>esl-erlang</code>ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š</p><blockquote><p>The â€œesl-erlangâ€ package is a file containg the complete installation: it includes the Erlang/OTP platform and all of its    applications. The â€œerlangâ€ package is a frontend to a number of smaller packages. Currently we support both â€œerlangâ€ and â€œesl-erlangâ€. Note that the split packages have multiple advantages:<br>seamless replacement of the available packages,<br>other packages have dependencies on â€œerlangâ€, not â€œesl-erlangâ€,<br>if your disk-space is low, you can get rid of some unused parts; â€œerlang-baseâ€ needs only ~13MB of space.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ç›¸è¾ƒäº<code>erlang</code>ï¼Œ<code>esl-erlang</code>çš„å®‰è£…åŒ…æ˜¯åŒ…å«äº†æ‰€æœ‰çš„ç»„ä»¶çš„ã€‚</p><h1 id="rabbitmqå’Œerlangçš„cookiesä¸ä¸€è‡´ï¼Œå¯¼è‡´å¯åŠ¨ä¸äº†"><a href="#rabbitmqå’Œerlangçš„cookiesä¸ä¸€è‡´ï¼Œå¯¼è‡´å¯åŠ¨ä¸äº†" class="headerlink" title="rabbitmqå’Œerlangçš„cookiesä¸ä¸€è‡´ï¼Œå¯¼è‡´å¯åŠ¨ä¸äº†"></a>rabbitmqå’Œerlangçš„cookiesä¸ä¸€è‡´ï¼Œå¯¼è‡´å¯åŠ¨ä¸äº†</h1><p>å¯åŠ¨çš„æ—¥å¿—å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">attempted to contact: [rabbit<span class="meta">@izm</span>5e0h94dt7do1kplgd15z]</span><br><span class="line"></span><br><span class="line">rabbit<span class="meta">@izm</span>5e0h94dt7do1kplgd15z:</span><br><span class="line">  * <span class="function">connected to <span class="title">epmd</span> <span class="params">(port <span class="number">4369</span>)</span> on izm5e0h94dt7do1kplgd15z</span></span><br><span class="line"><span class="function">  * epmd reports node 'rabbit' running on port 25672</span></span><br><span class="line"><span class="function">  * TCP connection succeeded but Erlang distribution failed</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  * Authentication <span class="title">failed</span> <span class="params">(rejected by the remote node)</span>, please check the Erlang cookie</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  current node details:</span></span><br><span class="line"><span class="function">  - node name: 'rabbitmq-cli-56@izm5e0h94dt7do1kplgd15z'</span></span><br><span class="line"><span class="function">  - home dir: /root</span></span><br><span class="line"><span class="function">  - cookie hash: ajtINcxQAbART7QakzjkSg</span>==</span><br></pre></td></tr></table></figure></p><p>åœ¨æœç´¢ä¸­å‘ç°äº†ä¸¤ä¸ªé“¾æ¥ï¼š<a href="https://stackoverflow.com/questions/47893899/authentication-failed-rejected-by-the-remote-node-please-check-the-erlang-coo?rq=1" target="_blank" rel="noopener">StackOverFlow</a><br>ã€<a href="http://www.rabbitmq.com/cli.html" target="_blank" rel="noopener">Rabbitmqå®˜æ–¹æ–‡æ¡£</a></p><p>å…¶ä¸­åœ¨å®˜ç½‘ä¸­çœ‹åˆ°äº†ä»‹ç»ï¼š</p><blockquote><p>Linux, MacOS, *BSD<br>On UNIX systems, the cookie will be typically located in /var/lib/rabbitmq/.erlang.cookie (used by the server) and $HOME/.erlang.cookie (used by CLI tools). Note that since the value of $HOME varies from user to user, itâ€™s necessary to place a copy of the cookie file for each user that will be using the CLI tools. This applies to both non-privileged users and root.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´åœ¨Linuxä¸Šï¼Œé»˜è®¤çš„cookiesæ˜¯åœ¨ <code>/var/lib/rabbitmq/.erlang.cookie</code>ï¼Œ ä½†æ˜¯è¯¥rabbitmqçš„homeç›®å½•æ˜¯<code>root</code>ï¼Œæ‰€ä»¥éœ€è¦å°†é»˜è®¤è·¯å¾„çš„cookiesæ›¿æ¢åˆ°homeç›®å½•ä¸‹ã€‚æ›¿æ¢ä¹‹åå³å¯ã€‚</p><h1 id="å…³äºRabbitmqçš„webç•Œé¢å¯åŠ¨ä¸äº†"><a href="#å…³äºRabbitmqçš„webç•Œé¢å¯åŠ¨ä¸äº†" class="headerlink" title="å…³äºRabbitmqçš„webç•Œé¢å¯åŠ¨ä¸äº†"></a>å…³äºRabbitmqçš„webç•Œé¢å¯åŠ¨ä¸äº†</h1><p>æç¤ºå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Plugin configuration unchanged.</span><br><span class="line"></span><br><span class="line">Applying plugin configuration to rabbit@izm5e0h94dt7do1kplgd15z... failed.</span><br></pre></td></tr></table></figure></p><p>å‘ç°åªè¦é‡å¯ä¸‹rabbitmqå°±å¥½äº†ã€‚ã€‚ã€‚</p><h1 id="å¦å¤–å°±æ˜¯erlangçš„ç‰ˆæœ¬æœ€å¥½åœ¨20ï¼Œåœ¨21è²Œä¼¼ä¼šå‡ºé—®é¢˜ï¼Œå½“ç„¶é’ˆå¯¹rabbit3-6-15ç‰ˆæœ¬"><a href="#å¦å¤–å°±æ˜¯erlangçš„ç‰ˆæœ¬æœ€å¥½åœ¨20ï¼Œåœ¨21è²Œä¼¼ä¼šå‡ºé—®é¢˜ï¼Œå½“ç„¶é’ˆå¯¹rabbit3-6-15ç‰ˆæœ¬" class="headerlink" title="å¦å¤–å°±æ˜¯erlangçš„ç‰ˆæœ¬æœ€å¥½åœ¨20ï¼Œåœ¨21è²Œä¼¼ä¼šå‡ºé—®é¢˜ï¼Œå½“ç„¶é’ˆå¯¹rabbit3.6.15ç‰ˆæœ¬"></a>å¦å¤–å°±æ˜¯erlangçš„ç‰ˆæœ¬æœ€å¥½åœ¨20ï¼Œåœ¨21è²Œä¼¼ä¼šå‡ºé—®é¢˜ï¼Œå½“ç„¶é’ˆå¯¹rabbit3.6.15ç‰ˆæœ¬</h1>]]></content>
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> rabbitmq </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>redisè¯»å–ymlé…ç½®çš„é—®é¢˜</title>
      <link href="/2018/08/27/redis%E8%AF%BB%E5%8F%96yml%E9%85%8D%E7%BD%AE%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2018/08/27/redis%E8%AF%BB%E5%8F%96yml%E9%85%8D%E7%BD%AE%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>å­—ç¬¦ä¸²æ•°ç»„ç»„æˆæœ€å°çš„æ•°å­—</title>
      <link href="/2018/08/25/%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E7%BB%84%E7%BB%84%E6%88%90%E6%9C%80%E5%B0%8F%E7%9A%84%E6%95%B0%E5%AD%97/"/>
      <url>/2018/08/25/%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%95%B0%E7%BB%84%E7%BB%84%E6%88%90%E6%9C%80%E5%B0%8F%E7%9A%84%E6%95%B0%E5%AD%97/</url>
      <content type="html"><![CDATA[<h1 id="å­—ç¬¦ä¸²æ•°ç»„æ‹¼æ¥å‡ºä¸€ä¸ªæœ€å°çš„æ•°å­—"><a href="#å­—ç¬¦ä¸²æ•°ç»„æ‹¼æ¥å‡ºä¸€ä¸ªæœ€å°çš„æ•°å­—" class="headerlink" title="å­—ç¬¦ä¸²æ•°ç»„æ‹¼æ¥å‡ºä¸€ä¸ªæœ€å°çš„æ•°å­—"></a>å­—ç¬¦ä¸²æ•°ç»„æ‹¼æ¥å‡ºä¸€ä¸ªæœ€å°çš„æ•°å­—</h1><p>è®°å¾—åœ¨ä¹‹å‰çš„ä¸€ä¸ªé¢è¯•ä¸­é‡åˆ°äº†è¿™ä¸ªç®—æ³•é¢˜ï¼Œ ä½†æ˜¯å½“æ—¶æ²¡æ€ä¹ˆæƒ³å¥½å¦‚ä½•åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´çš„å¤§å°ï¼Œæ¯”å¦‚ <code>23</code> å’Œ <code>223</code> ä¹‹é—´ï¼Œå…¶ç»„åˆèµ·æ¥ç»å¯¹æ˜¯ <code>23</code> å¤§äº <code>223</code>ï¼Œæ‰€ä»¥ <code>223</code>æ˜¯éœ€è¦æ”¾åœ¨å‰é¢çš„ã€‚</p><h1 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h1><p>å…¶å®å¯ä»¥å°†ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ ï¼Œä¾‹å¦‚ 22323 &lt; 23223 ï¼Œæ‰€ä»¥ <code>223</code> æ˜¯éœ€è¦æ”¾åœ¨ <code>23</code> å‰é¢çš„ï¼Œä¸‹é¢å°±æ˜¯ä»£ç .</p><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getNum</span><span class="params">(String[] str)</span></span>&#123;</span><br><span class="line">       sortString(str,<span class="number">0</span>,str.length-<span class="number">1</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sortString</span><span class="params">(String[] strArray ,<span class="keyword">int</span> start ,<span class="keyword">int</span> end)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(end &gt; strArray.length -<span class="number">1</span> || end &lt;<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(start &lt;<span class="number">0</span> || start &gt; strArray.length -<span class="number">1</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(start == end )&#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">int</span> mid =(start + end) / <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">while</span> (start &lt; end &amp;&amp; start &lt;mid &amp;&amp; end &gt;mid)&#123;</span><br><span class="line">           String s1 =strArray[start] +strArray[mid];</span><br><span class="line">           String s2 =strArray[mid] +strArray[start];</span><br><span class="line">           String s3 =strArray[mid] +strArray[end];</span><br><span class="line">           String s4 =strArray[end] +strArray[mid];</span><br><span class="line">           <span class="keyword">if</span>(Integer.parseInt(s1) &lt; Integer.parseInt(s2))&#123;</span><br><span class="line">               start++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span>(Integer.parseInt(s3) &lt; Integer.parseInt(s4))&#123;</span><br><span class="line">               end--;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       String temp =strArray[start];</span><br><span class="line">       strArray[start] = strArray[end];</span><br><span class="line">       strArray[end] =temp;</span><br><span class="line">       sortString(strArray,start,mid );</span><br><span class="line">       sortString(strArray,mid-<span class="number">1</span>,end );</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       String[] s =<span class="keyword">new</span> String[]&#123;<span class="string">"32"</span>,<span class="string">"321"</span>,<span class="string">"3"</span>&#125;;</span><br><span class="line">       <span class="keyword">new</span> GetSmallSum().getNum(s);</span><br><span class="line">       StringBuffer stringBuffer =<span class="keyword">new</span> StringBuffer();</span><br><span class="line">       <span class="keyword">for</span>(String s1 :s)&#123;</span><br><span class="line">           stringBuffer.append(s1);</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(Integer.parseInt(stringBuffer.toString()));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºLeetcodeä¸Šåˆ¤æ–­ä½æ•°çš„è§£æ³•</title>
      <link href="/2018/08/17/%E5%85%B3%E4%BA%8ELeetcode%E4%B8%8A%E5%88%A4%E6%96%AD%E4%BD%8D%E6%95%B0%E7%9A%84%E8%A7%A3%E6%B3%95/"/>
      <url>/2018/08/17/%E5%85%B3%E4%BA%8ELeetcode%E4%B8%8A%E5%88%A4%E6%96%AD%E4%BD%8D%E6%95%B0%E7%9A%84%E8%A7%A3%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>åœ¨Leetcodeä¸Šæœ‰ä¸€é“ç®—æ³•é¢˜ç›®åˆ¤æ–­æœ€åä¸€ä½æ˜¯ä¸æ˜¯ä¸€ä½çš„ï¼Œé¢˜ç›®çš„æ„æ€æ˜¯å½“åœ¨ä¸€ä¸ªæ•°ç»„ä¸­å¦‚æœå­˜åœ¨<code>10</code>æˆ–è€…<code>00</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯ä¸€ä¸ªè¿ç»­çš„ã€‚è¿™ä¸ªæ•°ç»„çš„æœ€åä¸€ä½æ°¸è¿œéƒ½æ˜¯<code>0</code>ã€‚</p><blockquote><p>We have two special characters. The first character can be represented by one bit 0. The second character can be represented by two bits (10 or 11).<br>Now given a string represented by several bits. Return whether the last character must be a one-bit character or not. The given string will always end with a zero.</p></blockquote><h1 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h1><p>åˆšå¼€å§‹é”™è¯¯çš„ç†è§£é¢˜ç›®çš„æ„æ€äº†ï¼Œå¯¼è‡´ä¸€ç›´åœ¨çº ç»“æ•°ç»„çš„æœ€åä¸¤ä½å’Œä¸‰ä½ï¼Œåæ¥çœ‹äº†ç­”æ¡ˆä¹‹åè§‰å¾—è‡ªå·±çš„æ€è·¯æ²¡æœ‰æƒ³åˆ°ç”µå­ä¸Šï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="è§£æ³•ä¸€ï¼š"><a href="#è§£æ³•ä¸€ï¼š" class="headerlink" title="è§£æ³•ä¸€ï¼š"></a>è§£æ³•ä¸€ï¼š</h2><p>è¿™ä¸€é¢˜æœ‰ä¸€ä¸ªæ˜æ˜¾çš„è§„å¾‹ï¼Œä¹Ÿå°±æ˜¯å½“ bits[i] ä¸º 1 çš„æ—¶å€™ï¼Œé‚£ä¹ˆä»–å°±å¯ä»¥ä¸ç®¡åé¢çš„ä¸€ä½ï¼Œå¯ä»¥ç›´æ¥åç§»ä¸¤ä½æ¥åˆ¤æ–­ã€‚å½“ bits[i] ä¸º 0 çš„æ—¶å€™ï¼Œé‚£ä¹ˆä»–å°±åªèƒ½æ˜¯å‘åç§»åŠ¨ä¸€ä½äº†ã€‚æ‰€ä»¥ç®—æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> len=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">int</span> len =<span class="number">0</span>  &amp;&amp; len&lt; bits.length)&#123;</span><br><span class="line">    len += bits[len] +<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(len == bits.length)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="è§£æ³•äºŒï¼š"><a href="#è§£æ³•äºŒï¼š" class="headerlink" title="è§£æ³•äºŒï¼š"></a>è§£æ³•äºŒï¼š</h2><p>ä»åéå†ï¼Œæ‰¾å‡ºç¬¬ä¸€ä¸ªä¸º 0 çš„ï¼Œå¦‚æœç¬¬ä¸€ä¸ªä¸º0çš„æ˜¯æ•°ç»„çš„å€’æ•°ç¬¬äºŒä½çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯ true<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> len =bits.length-<span class="number">2</span>;</span><br><span class="line"><span class="keyword">while</span>(len &gt;<span class="number">0</span> &amp;&amp; bits[len] &gt;<span class="number">0</span> )&#123;</span><br><span class="line">    len --;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(len == bits.length -<span class="number">2</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šä¾¿æ˜¯è¿™ä¸¤ç§è§£æ³•äº†ï¼Œåªä¸è¿‡å½“æ—¶è¿˜æœªæƒ³åˆ°ã€‚</p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¯¹æ•°æ®åº“äº‹ç‰©çš„ç†è§£</title>
      <link href="/2018/08/10/%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E7%89%A9%E7%9A%84%E7%90%86%E8%A7%A3/"/>
      <url>/2018/08/10/%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E7%89%A9%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯äº‹ç‰©"><a href="#ä»€ä¹ˆæ˜¯äº‹ç‰©" class="headerlink" title="ä»€ä¹ˆæ˜¯äº‹ç‰©"></a>ä»€ä¹ˆæ˜¯äº‹ç‰©</h1><p>äº‹ç‰©é€šä¿—çš„æ¥è®²å°±æ˜¯å°±æ˜¯ä¸€ç»„æ“ä½œäº‹ä»¶ï¼Œå¯ä»¥ç±»æ¯”äºJavaé‡Œé¢çš„åŸå­æ“ä½œã€‚åœ¨ä¸€ä¸ªäº‹ç‰©ä¸­ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå°±æ˜¯å…¨éƒ¨å¤±è´¥ã€‚</p><h1 id="mysqlä¸­çš„äº‹ç‰©"><a href="#mysqlä¸­çš„äº‹ç‰©" class="headerlink" title="mysqlä¸­çš„äº‹ç‰©"></a>mysqlä¸­çš„äº‹ç‰©</h1><p>åœ¨Mysqlçš„<code>innodb</code>ä¸­ï¼Œäº‹ç‰©çš„é»˜è®¤çº§åˆ«æ˜¯ <code>å¯é‡å¤è¯»</code>ï¼Œåœ¨è¯¥çº§åˆ«ä¸‹ï¼Œäº‹ç‰©å¯èƒ½å‡ºç°å¹»è¯»ã€‚å‡ºç°å¹»è¯»çš„æƒ…å†µæ˜¯è¯¥å¼•æ“ä¸ºè¡Œçº§é”ï¼Œå¯¼è‡´mysqlåœ¨è¿›è¡Œä¸€ä¸ªäº‹ç‰©çš„æ—¶å€™åªä¼šé”å®šä¸è¯¥äº‹ç‰©æœ‰å…³çš„å‡ è¡Œã€‚</p><h2 id="ç¤ºä¾‹å¦‚ä¸‹ï¼š"><a href="#ç¤ºä¾‹å¦‚ä¸‹ï¼š" class="headerlink" title="ç¤ºä¾‹å¦‚ä¸‹ï¼š"></a>ç¤ºä¾‹å¦‚ä¸‹ï¼š</h2><p>æ–°å»ºä¸€ä¸ªè¡¨ï¼Œå…¶ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from curd;</span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  3 | 4    |</span><br><span class="line">|  4 | 3    |</span><br><span class="line">|  5 | 2    |</span><br><span class="line">|  6 | 1    |</span><br><span class="line">+----+------+</span><br></pre></td></tr></table></figure></p><p>å¼€å¯ä¸€ä¸ªäº‹ç‰©ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> curd;</span><br><span class="line"><span class="keyword">UPDATE</span> curd <span class="keyword">SET</span> curd.name=<span class="string">'1000'</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> curd;</span><br><span class="line"><span class="comment">-- SELECT * FROM curd;</span></span><br><span class="line"><span class="comment">-- COMMIT;</span></span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶ä¸¤æ¬¡æŸ¥è¯¢çš„ç»“æœä¸ºï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START TRANSACTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM curd;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | name |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  3 | 4    |</span><br><span class="line">|  4 | 3    |</span><br><span class="line">|  5 | 2    |</span><br><span class="line">|  6 | 1    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">UPDATE</span> curd <span class="keyword">SET</span> curd.name=<span class="string">'1000'</span>;</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 4  Changed: 4  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM curd;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | name |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  3 | 1000 |</span><br><span class="line">|  4 | 1000 |</span><br><span class="line">|  5 | 1000 |</span><br><span class="line">|  6 | 1000 |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶å¯ä»¥çœ‹åˆ°ï¼Œåœ¨äº‹ç‰©ä¸€æœªæäº¤ä¹‹å‰ï¼Œäº‹ç‰©ä¸€åšäº†ä¸€ä¸ªå…¨è¡¨çš„æ›´æ–°ï¼Œå°†è¯¥è¡¨çš„æ•°å€¼å…¨éƒ¨æ›´æ–°ä¸º1000äº†ã€‚<br>ç„¶åå¼€å¯ <strong>äº‹ç‰©äºŒ</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; START TRANSACTION;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM curd;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | name |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  3 | 4    |</span><br><span class="line">|  4 | 3    |</span><br><span class="line">|  5 | 2    |</span><br><span class="line">|  6 | 1    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">INSERT</span> <span class="keyword">INTO</span> curd(curd.id,curd.name) <span class="keyword">VALUES</span>(<span class="number">7</span>,<span class="string">'7'</span>);</span><br><span class="line">ERROR 1205 (HY000): <span class="keyword">Lock</span> <span class="keyword">wait</span> <span class="keyword">timeout</span> exceeded; try restarting transaction</span><br><span class="line"><span class="comment">-- æ³¨æ„ä½¿ç”¨win10çš„ç®¡ç†å‘˜cmdä¼šå¡åœ¨è¿™ä¸€è¡Œï¼Œä½†æ˜¯ä½¿ç”¨sqlyogå°±ä¸ä¼šï¼Œmysqlä¼šå¡åœ¨è¿™ä¸€è¡Œ</span></span><br></pre></td></tr></table></figure></p><p>å½“äº‹ç‰©äºŒæ‰§è¡Œå®Œè¿™ä¸€å¥ä¹‹åï¼Œå›åˆ°äº‹ç‰©ä¸€ï¼Œç„¶åæŸ¥è¯¢è¡¨æ•°æ®ã€‚<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä½¿ç”¨Sqlyogæ–°å¢ä¹‹åçœ‹åˆ°çš„æ•°æ®</span></span><br><span class="line">mysql&gt; SELECT * FROM curd;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | name |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  3 | 1000 |</span><br><span class="line">|  4 | 1000 |</span><br><span class="line">|  5 | 1000 |</span><br><span class="line">|  6 | 1000 |</span><br><span class="line">|  7 | 7    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶å°±æ˜¯<code>å¹»è¯»</code>ï¼Œäº‹ç‰©ä¸€æ˜æ˜å°±æ›´æ–°äº†6æ¡æ•°æ®ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°7æ¡æ•°æ®ã€‚ã€‚<br>ç„¶åäº‹ç‰©ä¸€æäº¤ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶æ•°æ®åº“ä¸­çš„æ•°æ®å·²ç»å…¨éƒ¨æ›´æ–°æˆ1000ï¼Œä½†æ˜¯åœ¨äº‹ç‰©äºŒä¸­ï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM curd;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | name |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  3 | 4    |</span><br><span class="line">|  4 | 3    |</span><br><span class="line">|  5 | 2    |</span><br><span class="line">|  6 | 1    |</span><br><span class="line">|  7 | 7    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>è¯´æ˜ä¸¤ä¸ªäº‹ç‰©ä¹‹é—´ä¸èƒ½è¯»å–å…¶ä»–äº‹ç‰©æœªæäº¤çš„æ›´æ”¹ï¼Œå¹¶ä¸”åœ¨mysqlçš„è¯¥çº§åˆ«ä¸‹ï¼Œäº‹ç‰©å¼€å§‹å’Œç»“æŸçš„æ—¶å€™æ‰€è¯»å–çš„æ•°æ®æ˜¯ä¸€æ ·çš„ã€‚</p><p>æ­¤æ—¶æäº¤äº‹ç‰©äºŒï¼š<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; commit;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM curd;</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">| id | name |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">|  3 | 1000 |</span><br><span class="line">|  4 | 1000 |</span><br><span class="line">|  5 | 1000 |</span><br><span class="line">|  6 | 1000 |</span><br><span class="line">|  7 | 7    |</span><br><span class="line">+<span class="comment">----+------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶æ•°æ®åº“ä¸­çš„æ•°æ®å·²ç»å¦‚æˆä¸ºäº†ä¸Šé¢æ‰€ç¤ºäº†ã€‚</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>å…·ä½“æ˜¯å› ä¸ºmysqlçš„innodbä½¿ç”¨çš„æ˜¯<code>è¡Œçº§é”</code>ï¼Œè€Œä¸”åœ¨mysqlçš„æ¯ä¸€ä¸ªè¡¨é‡Œé¢éƒ½ä¼šæœ‰ä¸¤ä¸ªéšè—çš„åˆ—ï¼Œåˆ†åˆ«æ˜¯åˆ›å»ºçš„æ—¶å€™ç‰ˆæœ¬å·å’Œåˆ é™¤çš„æ—¶å€™çš„ç‰ˆæœ¬å·ã€‚<br>æ‰€ä»¥æ¯ä¸€ä¸ªäº‹ç‰©æ‰§è¡Œçš„æ—¶å€™çš„ç‰ˆæœ¬å·éƒ½ä¼šè¢«è¯¥äº‹ç‰©å·æ‰€æ›´æ–°ï¼Œå› æ­¤ä¼šå¯¼è‡´æœ‰çš„äº‹ç‰©åœ¨æ‰§è¡ŒæœŸé—´ä¼šå¯¼è‡´çœ‹åˆ°ä¸åŒçš„æ•°æ®ã€‚</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>ç°åœ¨mysql5.7è²Œä¼¼å·²ç»è§£å†³äº†å¹»è¯»ã€‚ã€‚ç”¨å‘½ä»¤è¡Œè¿›è¡Œæµ‹è¯•çš„ã€‚</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Rabbitmqå’ŒSpringbootä¸€èµ·ä½¿ç”¨çš„é—®é¢˜</title>
      <link href="/2018/08/04/Rabbitmq%E5%92%8CSpringboot%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2018/08/04/Rabbitmq%E5%92%8CSpringboot%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>åˆšåˆšå‡†å¤‡åœ¨Springbootä¸­ä½¿ç”¨rabbitmqæ¥å®ç°æ—¥å¿—çš„æ”¶é›†ï¼Œåœ¨ä½¿ç”¨ä¸­å‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸‹ã€‚</p><h2 id="æ¶ˆè´¹è€…æ¥æ”¶ä¸åˆ°æ¶ˆæ¯"><a href="#æ¶ˆè´¹è€…æ¥æ”¶ä¸åˆ°æ¶ˆæ¯" class="headerlink" title="æ¶ˆè´¹è€…æ¥æ”¶ä¸åˆ°æ¶ˆæ¯"></a>æ¶ˆè´¹è€…æ¥æ”¶ä¸åˆ°æ¶ˆæ¯</h2><p>è¿™ä¸ªé—®é¢˜å‡ºç°çš„é—®é¢˜ï¼Œä¸€ä¸ªæ˜¯æ²¡æœ‰å»ºç«‹ä¸€ä¸ªäº¤æ¢æœºï¼Œå¯¼è‡´ç”Ÿäº§è€…åœ¨æ¨é€æ¶ˆæ¯çš„æ—¶å€™ä½¿ç”¨çš„APIæ˜¯<code>this.amqpTemplate.convertAndSend(contet);</code>,ç›´æ¥å°†å†…å®¹æ¨å‡ºå»ï¼Œ</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rabbitmq </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Leetcodeæ±‚äºŒå‰æ ‘çš„èŠ‚ç‚¹æœ€å°ç»å¯¹å€¼</title>
      <link href="/2018/07/25/Leetcode%E6%B1%82%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%80%BC/"/>
      <url>/2018/07/25/Leetcode%E6%B1%82%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E8%8A%82%E7%82%B9%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%80%BC/</url>
      <content type="html"><![CDATA[<h1 id="äºŒå‰æ ‘çš„ä¸­åºéå†"><a href="#äºŒå‰æ ‘çš„ä¸­åºéå†" class="headerlink" title="äºŒå‰æ ‘çš„ä¸­åºéå†"></a>äºŒå‰æ ‘çš„ä¸­åºéå†</h1><p>é¢˜ç›®å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Given a binary search tree with non-negative values, find the minimum absolute difference between values of any two nodes.</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line"></span><br><span class="line">Input:</span><br><span class="line"></span><br><span class="line">   <span class="number">1</span></span><br><span class="line">    \</span><br><span class="line">     <span class="number">3</span></span><br><span class="line">    /</span><br><span class="line">   <span class="number">2</span></span><br><span class="line"></span><br><span class="line">Output:</span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line">Explanation:</span><br><span class="line">The minimum absolute difference is <span class="number">1</span>, which is the difference between <span class="number">2</span> and <span class="number">1</span> (or between <span class="number">2</span> and <span class="number">3</span>).</span><br></pre></td></tr></table></figure></p><p>æ„æ€å°±æ˜¯éœ€è¦æ±‚å‡ºä¸€ä¸ªäºŒå‰æ ‘ä¸­ç»å¯¹å€¼æœ€å°çš„å€¼ã€‚</p><p>åˆšå¼€å§‹çš„ç¬¬ä¸€ä¸ªæƒ³æ³•å°±æ˜¯é€’å½’ï¼Œç„¶åæ¯”è¾ƒå½“å‰èŠ‚ç‚¹å’Œå…¶å·¦å³ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼ï¼Œä½†æ˜¯å‘ç°æœ‰ä¸€ä¸ªç¼ºé™·å°±æ˜¯å¦‚æœä¸€ä¸ªæ ¹èŠ‚ç‚¹æ˜¯3ï¼Œå…¶å·¦èŠ‚ç‚¹æ˜¯10ï¼Œ10çš„å³èŠ‚ç‚¹æ˜¯4ï¼Œé‚£ä¹ˆæœ€å°çš„å€¼ä¾¿æ˜¯1ï¼Œç„¶åé€šè¿‡é€’å½’åªèƒ½æ˜¯ 10-3ï¼Œ10-4 ã€‚æ‰€ä»¥å½“æ—¶å°±æ”¾å¼ƒäº†</p><h2 id="ä¸­åºé€’å½’"><a href="#ä¸­åºé€’å½’" class="headerlink" title="ä¸­åºé€’å½’"></a>ä¸­åºé€’å½’</h2><p>åæ¥åˆæƒ³åˆ°äº†ä¸­åºé€’å½’ä¾¿æ˜¯è¿™ç§éå†é¡ºåºï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸­åºéå†çš„æ–¹å¼ä¾¿å¯ä»¥æ­£ç¡®çš„å¾—å‡ºç»“æœäº†ã€‚ä½†æ˜¯ä¸€ç›´æƒ³ä¸å‡ºè¿™ç§æƒ…å†µå¦‚ä½•è¿›è¡Œä¸­åºæ“ä½œï¼Œä½†æ˜¯åœ¨è®¨è®ºåŒºå‘ç°äº†ä¸€ä¸ªè§£æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> minDiff = Integer.MAX_VALUE;</span><br><span class="line">TreeNode prev;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMinimum</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">     inorder(root);</span><br><span class="line">     <span class="keyword">return</span> minDiff;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">inorder</span><span class="params">(TreeNode root)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (root == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">     inorder(root.left);</span><br><span class="line">     <span class="keyword">if</span> (prev != <span class="keyword">null</span>) minDiff = Math.min(minDiff, root.val - prev.val);</span><br><span class="line">     prev = root;</span><br><span class="line">     inorder(root.right);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>åæ¥å‘ç°è¿™ä¸ª prev æ‰æ˜¯è¿™ä¸ªä¸­åºéå†çš„å…³é”®ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦èŠ‚ç‚¹éå†å®Œä¹‹åï¼Œä¿å­˜è¯¥èŠ‚ç‚¹ä¸º Prev ç„¶åä¸ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚</p><p><img src="æµç¨‹å›¾.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>leetcodeä¸Šä¸€é“æ±‚å‡ºæ•°ç»„å‰ä¸‰å¤§çš„æ•°å­—</title>
      <link href="/2018/07/25/leetcode%E4%B8%8A%E4%B8%80%E9%81%93%E6%B1%82%E5%87%BA%E6%95%B0%E7%BB%84%E5%89%8D%E4%B8%89%E5%A4%A7%E7%9A%84%E6%95%B0%E5%AD%97/"/>
      <url>/2018/07/25/leetcode%E4%B8%8A%E4%B8%80%E9%81%93%E6%B1%82%E5%87%BA%E6%95%B0%E7%BB%84%E5%89%8D%E4%B8%89%E5%A4%A7%E7%9A%84%E6%95%B0%E5%AD%97/</url>
      <content type="html"><![CDATA[<p>é¢˜ç›®å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Given scores of N athletes, find their relative ranks and the people with the top three highest scores, who will be awarded medals: &quot;Gold Medal&quot;, &quot;Silver Medal&quot; and &quot;Bronze Medal&quot;.</span><br><span class="line"></span><br><span class="line">Input: [5, 4, 3, 2, 1]</span><br><span class="line">Output: [&quot;Gold Medal&quot;, &quot;Silver Medal&quot;, &quot;Bronze Medal&quot;, &quot;4&quot;, &quot;5&quot;]</span><br><span class="line">Explanation: The first three athletes got the top three highest scores, so they got &quot;Gold Medal&quot;, &quot;Silver Medal&quot; and &quot;Bronze Medal&quot;. </span><br><span class="line">For the left two athletes, you just need to output their relative ranks according to their scores.</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯ä¸€ä¸ªä¹±åºçš„æ•°ç»„ï¼Œç„¶åå°†æ•°ç»„ä¸­çš„å‰ä¸‰å¤§çš„æ•°ç»„æ¢æˆæŒ‡å®šçš„å­—ç¬¦ä¸²ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªè§£æ³•æ˜¯æ¯”è¾ƒæœ‰æ–°æ„çš„ï¼Œå…¶æ€è·¯å¦‚ä¸‹ï¼š</p><p>å¦å¤–å†å¼€è¾Ÿä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæ•°ç»„çš„é•¿åº¦æ˜¯åŸæ•°ç»„ä¸­æ•°å­—æœ€å¤§çš„é‚£ä¸ªå€¼ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œéå†çš„æ—¶å€™ï¼Œæ–°å»ºçš„æ•°ç»„ä¸­æœ€åä¸‰ä½è‚¯å®šæ˜¯æœ€å¤§çš„ï¼Œç„¶åä¾æ¬¡å°†å…¶åŸç´¢å¼•æ‰¾å‡ºæ¥å³å¯ã€‚</p><p>å…·ä½“çš„ä»£ç å¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String[] findRelativeRanks(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">       String[] s =<span class="keyword">new</span> String[nums.length];</span><br><span class="line">       <span class="keyword">int</span> max =<span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i : nums)&#123;</span><br><span class="line">           <span class="keyword">if</span>(i&gt; max)&#123;</span><br><span class="line">               max= i;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">int</span>[] index =<span class="keyword">new</span> <span class="keyword">int</span>[max+<span class="number">1</span>];</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt; nums.length ;i++)&#123;</span><br><span class="line">           index[nums[i]] =i+<span class="number">1</span>;  <span class="comment">//åœ¨è¿™é‡ŒåŠ ä¸€æ˜¯å› ä¸ºå¦‚æœä¸åŠ ä¸€é‚£ä¹ˆç¬¬ä¸€ä¸ªç´¢å¼•çš„æ•°ç»„ä¹‹åœ¨indexé‡Œé¢ä¼šæ˜¯0ï¼Œä¸å¥½åŒºåˆ†ã€‚</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">int</span> place=<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">int</span> i =index.length-<span class="number">1</span> ;i&gt;=<span class="number">0</span> ;i--)&#123;</span><br><span class="line">           <span class="keyword">if</span>(index[i] !=<span class="number">0</span> )&#123;</span><br><span class="line">               <span class="keyword">if</span>(place ==<span class="number">1</span> )&#123;</span><br><span class="line">                   s[index[i] -<span class="number">1</span>]=<span class="string">"Gold Medal"</span>;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(place ==<span class="number">2</span>)&#123;</span><br><span class="line">                   s[index[i] -<span class="number">1</span>]=<span class="string">"Silver Medal"</span>;</span><br><span class="line">               &#125;<span class="keyword">else</span> <span class="keyword">if</span>(place ==<span class="number">3</span>)&#123;</span><br><span class="line">                   s[index[i] -<span class="number">1</span>]=<span class="string">"Bronze Medal"</span>;</span><br><span class="line">               &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                   s[index[i] -<span class="number">1</span>]=String.valueOf(place);</span><br><span class="line">               &#125;</span><br><span class="line">               place++;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> s;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mavenå’Œjsonä»¥åŠspringçš„ä¸€äº›é—®é¢˜</title>
      <link href="/2018/07/18/maven%E5%92%8Cjson%E4%BB%A5%E5%8F%8Aspring%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/"/>
      <url>/2018/07/18/maven%E5%92%8Cjson%E4%BB%A5%E5%8F%8Aspring%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<h2 id="mavenå’ŒIDEAçš„ä¸€ä¸ªé—®é¢˜"><a href="#mavenå’ŒIDEAçš„ä¸€ä¸ªé—®é¢˜" class="headerlink" title="mavenå’ŒIDEAçš„ä¸€ä¸ªé—®é¢˜"></a>mavenå’ŒIDEAçš„ä¸€ä¸ªé—®é¢˜</h2><p>åœ¨ IDEA ä¸­å¯ä»¥æ­£å¸¸ä½¿ç”¨mavençš„ä¸€äº›å‘½ä»¤æ¥è¿›è¡Œ clean å’Œ complime ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨IDEAçš„buildåŠŸèƒ½æ—¶ä¸€ç›´æç¤ºæŸäº›åŒ…æ‰¾ä¸åˆ°ï¼Œè§£å†³åŠæ³•ï¼š<br>æ‰§è¡Œ <code>mvn clean</code> å‘½ä»¤æ¸…é™¤ç¼“å­˜ï¼Œç„¶ååˆ é™¤ <code>.idea</code> è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶</p><p>å¦‚æœè¿˜æ˜¯è§£å†³ä¸äº†åˆ™å¯ä»¥ç›´æ¥æ¢ä¸€ä¸ª maven ï¼Œæœ€å¥½çš„è§£å†³åŠæ³•åˆ™æ˜¯æ¯ä¸€ä¸ªé¡¹ç›®ï¼Œä¸€ä¸ª mavenã€‚</p><h2 id="é˜¿é‡Œçš„JsonåŒ…å’Œå¯¹è±¡ä¹‹é—´çš„è½¬æ¢"><a href="#é˜¿é‡Œçš„JsonåŒ…å’Œå¯¹è±¡ä¹‹é—´çš„è½¬æ¢" class="headerlink" title="é˜¿é‡Œçš„JsonåŒ…å’Œå¯¹è±¡ä¹‹é—´çš„è½¬æ¢"></a>é˜¿é‡Œçš„JsonåŒ…å’Œå¯¹è±¡ä¹‹é—´çš„è½¬æ¢</h2><p>ä»Šå¤©æœ‰ä¸€ä¸ªæ–°çš„éœ€æ±‚æ˜¯å°†ä¸€ä¸ª Json å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªJsonå¯¹è±¡ï¼Œæ­¤æ—¶å¯ä»¥è°ƒç”¨<br><code>JSON.parseObject( new TypeReference(XXX),jsonä¸²)</code>æ¥è®²ä¸€ä¸ª Json å­—ç¬¦ä¸²è½¬ä¸ºä¸€ä¸ªå¯¹è±¡</p><h2 id="springä¸­è¯»å–é…ç½®æ–‡ä»¶ç›¸å…³çš„é—®é¢˜"><a href="#springä¸­è¯»å–é…ç½®æ–‡ä»¶ç›¸å…³çš„é—®é¢˜" class="headerlink" title="springä¸­è¯»å–é…ç½®æ–‡ä»¶ç›¸å…³çš„é—®é¢˜"></a>springä¸­è¯»å–é…ç½®æ–‡ä»¶ç›¸å…³çš„é—®é¢˜</h2><p>åœ¨ spring ä¸­å¯ä»¥é€šè¿‡ <code>@Value</code> è¿™ä¸ªæ³¨è§£æ¥è·å–åˆ°é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼Œä½†æ˜¯è®°ä½â€¦.ä¸è¦å†ä½¿ç”¨ <code>new</code> å…³é”®å­—æ¥å†åˆå§‹åŒ–</p>]]></content>
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mavenä¸‹è½½å¿«ç…§çš„é—®é¢˜</title>
      <link href="/2018/07/17/maven%E4%B8%8B%E8%BD%BD%E5%BF%AB%E7%85%A7%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2018/07/17/maven%E4%B8%8B%E8%BD%BD%E5%BF%AB%E7%85%A7%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨ä½¿ç”¨mavenä¸‹è½½ä¸€ä¸ªå¿«ç…§æ–‡ä»¶çš„æ—¶å€™ï¼Œåªåœ¨ settings.xml æ–‡ä»¶ä¸­é…ç½®äº†é•œåƒæºï¼Œå¹¶æ²¡æœ‰é…ç½® release ç‰ˆæœ¬å’Œ snapshoot ç‰ˆæœ¬,æ‰€ä»¥å°±å¯¼è‡´äº†åœ¨ä¸‹è½½å¿«ç…§æ–‡ä»¶çš„æ—¶å€™ä¸€ç›´å‡ºç°é—®é¢˜ï¼š<br><code>Missing artifact</code> å¤§æ„å°±æ˜¯è¯´æ‰¾ä¸åˆ°è¿™ä¸ªjarçš„pomæ–‡ä»¶å•¥çš„ï¼Œç„¶åçœ‹äº†ä¸‹æœ¬åœ°çš„ä»“åº“ï¼Œä¹Ÿå¹¶æ²¡æœ‰çœ‹åˆ°ä¸‹è½½çš„æ–‡ä»¶å¤¹ã€‚</p><h2 id="è§£å†³åŠæ³•ï¼š"><a href="#è§£å†³åŠæ³•ï¼š" class="headerlink" title="è§£å†³åŠæ³•ï¼š"></a>è§£å†³åŠæ³•ï¼š</h2><p>åœ¨ <code>pom.xml</code> ä¸­è®¾ç½®å¿«ç…§çš„ä¸‹è½½åœ°å€ï¼Œé…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>ä»“åº“çš„ID<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--         &lt;name&gt;Spring Milestones&lt;/name&gt;  --&gt;</span> å¦‚æœæ²¡æœ‰å¯ä»¥å¿½ç•¥</span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.spring.io/libs-milestone<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  å¿«ç…§ä»“åº“çš„URL</span><br><span class="line">      <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>  æ‰“å¼€é•œåƒ</span><br><span class="line">      <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æœ€åè§£å†³äº†ï¼Œå¦‚æœä¸ºäº†æ–¹ä¾¿ï¼Œå…¶å®å¯ä»¥åœ¨ settings.xml ä¸­ç›´æ¥é…ç½®ï¼Œä»¥å‡å°‘åæœŸå¤šä¸ªpom.xmlé…ç½®çš„éº»çƒ¦</p>]]></content>
      
      <categories>
          
          <category> å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Leetcodeä¸Šä¸¤é“æ¯”è¾ƒå¥½çš„BFSå’ŒDFSé¢˜ç›®</title>
      <link href="/2018/06/14/Leetcode%E4%B8%8A%E4%B8%A4%E9%81%93%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84BFS%E5%92%8CDFS%E9%A2%98%E7%9B%AE/"/>
      <url>/2018/06/14/Leetcode%E4%B8%8A%E4%B8%A4%E9%81%93%E6%AF%94%E8%BE%83%E5%A5%BD%E7%9A%84BFS%E5%92%8CDFS%E9%A2%98%E7%9B%AE/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆæ˜¯Leetcodeä¸Šä¸¤é“æ¯”è¾ƒå¥½çš„ä¸€ä¸ªé¢˜ç›®ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><code>https://leetcode.com/problems/letter-case-permutation/description/</code> Letter Case Permutation</li><li><code>https://leetcode.com/problems/max-area-of-island/description/</code> Max Area of Island</li></ul><p>å…³äºå­—ç¬¦ä¸²çš„é‚£ä¸€é¢˜ä¾¿æ˜¯å°†ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦è¿›è¡Œå¤§å°å†™çš„å˜æ¢ï¼Œæ­¤é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼Œä¸€ç§æ˜¯ BFS æŒ‰ç…§å­—ç¬¦çªœä¸­çš„å­—ç¬¦éå†ï¼Œå°†å…¶å˜æˆå¤§å°å†™ï¼Œç„¶åå­˜å…¥æ ˆä¸­ï¼Œæœ€åä¾¿æ¯ä¸€æ¬¡å‘åè¿­ä»£ï¼Œç„¶åå†å­˜å…¥å³å¯ã€‚å¦ä¸€ç§åˆ™æ˜¯ DFS ï¼Œé€šè¿‡ä¸€ç§ä¸æ–­é€’å½’çš„æ–¹å¼æ¥è¿›è¡Œå¤§å°å†™çš„å˜æ¢çš„ï¼Œå’Œçˆ¬æ¥¼æ¢¯çš„é‚£ä¸ªç®—æ³•æå…¶ç±»ä¼¼</p><h1 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h1><h2 id="å­—ç¬¦ä¸²çš„BFS"><a href="#å­—ç¬¦ä¸²çš„BFS" class="headerlink" title="å­—ç¬¦ä¸²çš„BFS"></a>å­—ç¬¦ä¸²çš„BFS</h2><p>ä¼ªä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Stack &lt;- stack;</span><br><span class="line"><span class="keyword">for</span> i -&gt; S.length()&#123;</span><br><span class="line">    <span class="keyword">if</span>(i is <span class="keyword">char</span>)&#123;</span><br><span class="line">        stack.pop() -&gt; y;</span><br><span class="line">        y[i] &lt;- Upper</span><br><span class="line">        stack.push(y[i]);</span><br><span class="line">        y[i] &lt;- Lower</span><br><span class="line">        stack.push(y[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¸ªä»£ç çš„å†™æ³•ä¸­ï¼Œé‡‡å–çš„æ˜¯å¹¿åº¦æœ‰é™éå†ï¼Œå³åœ¨ä¸€ä¸ªå¹³é¢ä¸Šå±•å¼€ï¼Œè€Œä¸æ˜¯æ·±å…¥åˆ°è¿™ä¸ªå­—ç¬¦çš„</p><h2 id="å­—ç¬¦ä¸²çš„DFS"><a href="#å­—ç¬¦ä¸²çš„DFS" class="headerlink" title="å­—ç¬¦ä¸²çš„DFS"></a>å­—ç¬¦ä¸²çš„DFS</h2><p>ä¼ªä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">List &lt;- list ;</span><br><span class="line"><span class="keyword">char</span>[] c &lt;- S.toCharArray();</span><br><span class="line"><span class="function">fun <span class="title">change</span><span class="params">(list,index)</span></span>&#123;</span><br><span class="line"><span class="keyword">if</span>( index = S.length())&#123;</span><br><span class="line">    list.add(S);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(c[index] is not <span class="keyword">char</span>)&#123;</span><br><span class="line">    change(list,index+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">char</span>[] temp &lt;- S.toCharArray();</span><br><span class="line">temp[index] &lt;- UpperCase;</span><br><span class="line">change(list,index+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">temp[index] &lt;- Lower;</span><br><span class="line">change(list,index+<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="å…³äºè¿™ä¸¤ä¸ªç®—æ³•çš„å·®å¼‚"><a href="#å…³äºè¿™ä¸¤ä¸ªç®—æ³•çš„å·®å¼‚" class="headerlink" title="å…³äºè¿™ä¸¤ä¸ªç®—æ³•çš„å·®å¼‚"></a>å…³äºè¿™ä¸¤ä¸ªç®—æ³•çš„å·®å¼‚</h2><p>ä¸€ä¸ªæ˜¯ä»å¹¿åº¦å€ŸåŠ©é¢å¤–çš„å­˜å‚¨ç©ºé—´æ¥è¿›è¡Œå¤§å°å†™çš„å˜æ¢ï¼Œè€Œå¦ä¸€ä¸ªåˆ™æ˜¯é€šè¿‡é€’å½’å°†è¿™ä¸ªå­—ç¬¦ä¸²ä»å°¾åˆ°å¤´çš„è¿›è¡Œå¤§å°å†™çš„å˜åŒ–ã€‚</p><h1 id="æœ€å¤§å²›å±¿é¢ç§¯çš„DFS"><a href="#æœ€å¤§å²›å±¿é¢ç§¯çš„DFS" class="headerlink" title="æœ€å¤§å²›å±¿é¢ç§¯çš„DFS"></a>æœ€å¤§å²›å±¿é¢ç§¯çš„DFS</h1><p>é¢˜æ„å°±æ˜¯ä»ç»™å®šçš„äºŒç»´æ•°ç»„ä¸­æ‰¾å‡ºæ•°å­—ä¸º 1 çš„ï¼Œå¹¶ä¸”è¦æ±‚å®ƒä»¬ä¹‹é—´ä¸èƒ½æœ‰é—´éš™ï¼Œæ‰€ä»¥è¿™ä¸€é¢˜æ˜¯æ¯”è¾ƒé€‚åˆ DFS çš„è§£æ³•ï¼Œå…¶ç±»ä¼¼äºä¸Šæ¥¼æ¢¯çš„é‚£ä¸€é“é¢˜ç›®ï¼Œä¸Šæ¥¼æ¢¯å°±æ˜¯ä¸€ä¸ªé€’å½’ï¼ŒæŠŠæ¯ä¸€æ¬¡çš„æ­¥æ•°ç½—åˆ—å‡ºæ¥ã€‚</p><h2 id="é¢ç§¯é¢˜ç›®çš„DFS"><a href="#é¢ç§¯é¢˜ç›®çš„DFS" class="headerlink" title="é¢ç§¯é¢˜ç›®çš„DFS"></a>é¢ç§¯é¢˜ç›®çš„DFS</h2><p>ä¼ªä»£ç :<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span>[][] &lt;- x</span><br><span class="line"><span class="function">fun <span class="title">getMaxArea</span><span class="params">(<span class="keyword">int</span>[][] a, x,<span class="keyword">int</span> xIndex, <span class="keyword">int</span> yIndex )</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>( xIndex &lt; <span class="number">0</span> ,yINdex&lt;<span class="number">0</span> , xINdex&lt;a.length, yINdex&lt;a[<span class="number">0</span>].length)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    x &lt;- <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span>  <span class="number">1</span> + getMaxArea(a,x,xIndex+<span class="number">1</span>,yIndex)+getMaxArea(a,x,xIndex,yIndex+<span class="number">1</span>) + getMaxArea(a,x,xIndex-<span class="number">1</span>,yIndex) getMaxArea(a,x,xIndex,yIndex-<span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Leetcode </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>SpringCloudé…ç½®ä¸­å¿ƒçš„ä½¿ç”¨</title>
      <link href="/2018/06/11/SpringCloud%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2018/06/11/SpringCloud%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<p>åœ¨å®é™…çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¯èƒ½ä¼šæ¶‰åŠåˆ°å¾ˆå¤šçš„å¼€å‘ç¯å¢ƒï¼Œå¸¸è§çš„ä¾‹å¦‚ dev , product ç­‰ï¼Œåœ¨ä½¿ç”¨SpringCloudçš„æ—¶å€™å¯ä»¥é€šè¿‡é…ç½®ä¸­å¿ƒå¾®æœåŠ¡ï¼Œç»“åˆ Git ç®¡ç†å·¥å…·å®ç°é…ç½®çš„é›†ä¸­å¼ç®¡ç†ã€‚</p><h2 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h2><p>configé…ç½®ä¸­å¿ƒçš„ymlæ–‡ä»¶ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">sc-config</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      server:</span></span><br><span class="line"><span class="attr">        git:</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="string">$&#123;GitAddress:https://gitee.com/somersames/spring-cloud-demo-config&#125;</span></span><br><span class="line"><span class="attr">          search-paths:</span> <span class="string">$&#123;GitPath:dev&#125;</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://$&#123;EurekaHost:localhost&#125;:$&#123;EurekaPort:8081&#125;/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„ <code>${A:B}</code> é…ç½®è¡¨ç¤ºçš„æ˜¯å¦‚æœ A è·å–ä¸åˆ°å°±å– B çš„å€¼ã€‚<br><code>search-paths</code> åˆ™æ˜¯ä»£è¡¨ä»å“ªä¸ªæ–‡ä»¶å¤¹ä¸­è·å–é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>,</code> æ¥è¿›è¡Œåˆ†å‰²ã€‚<br>ç„¶ååœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ å¦‚ä¸‹å‡ ä¸ªæ³¨è§£ï¼Œä¸€ä¸ªé…ç½®ä¸­å¿ƒçš„å¾®æœåŠ¡ä¾¿å¼€å¯äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfogApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfogApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="è·å–é…ç½®ä¸­å¿ƒçš„é…ç½®"><a href="#è·å–é…ç½®ä¸­å¿ƒçš„é…ç½®" class="headerlink" title="è·å–é…ç½®ä¸­å¿ƒçš„é…ç½®"></a>è·å–é…ç½®ä¸­å¿ƒçš„é…ç½®</h2><p>å½“å…¶ä»–å‡ ä¸ªå¾®æœåŠ¡éœ€è¦é€šè¿‡é…ç½®ä¸­å¿ƒè·å–é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦æ·»åŠ ä¸€äº›é…ç½®æ–‡ä»¶æ‰å¯ä»¥ã€‚<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  profiles:</span></span><br><span class="line"><span class="attr">    active:</span> <span class="string">master</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">sc-auth</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      discovery:</span></span><br><span class="line"><span class="attr">        service-id:</span> <span class="string">sc-config</span> <span class="comment">#æ³¨å†Œä¸­å¿ƒçš„ServiceId</span></span><br><span class="line"><span class="attr">        enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">      label:</span> <span class="string">master</span> <span class="comment">#è¡¨ç¤ºçš„æ˜¯åˆ†æ”¯</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">config</span> <span class="comment">#è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ ‡ç­¾</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆè¿™ä¸ªå¾®æœåŠ¡åœ¨æ‹‰å–é…ç½®æ–‡ä»¶çš„æ—¶å€™å°±ä¼šæ‹‰å– <code>sc-auth-config.yml</code> çš„é…ç½®</p>]]></content>
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HashMapå¾—ä¸€ç‚¹æ€»ç»“</title>
      <link href="/2018/06/06/HashMap%E5%BE%97%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/"/>
      <url>/2018/06/06/HashMap%E5%BE%97%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h2 id="HashMappä¸ºä»€ä¹ˆåœ¨Hashçš„æ—¶å€™å‡1"><a href="#HashMappä¸ºä»€ä¹ˆåœ¨Hashçš„æ—¶å€™å‡1" class="headerlink" title="HashMappä¸ºä»€ä¹ˆåœ¨Hashçš„æ—¶å€™å‡1"></a>HashMappä¸ºä»€ä¹ˆåœ¨Hashçš„æ—¶å€™å‡1</h2><p>åœ¨Javaçš„Hashmapä¸­æœ‰å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">                ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                <span class="keyword">return</span> first;</span><br><span class="line">            <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">return</span> e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢æœ‰ä¸€è¡Œæ˜¯ <code>first = tab[(n - 1) &amp; hash]) != null</code> </p><h2 id="HashMapä¸ºä»€ä¹ˆåœ¨ä¼ å…¥å¦ä¸€ä¸ªMapæ—¶åŠ ä¸€"><a href="#HashMapä¸ºä»€ä¹ˆåœ¨ä¼ å…¥å¦ä¸€ä¸ªMapæ—¶åŠ ä¸€" class="headerlink" title="HashMapä¸ºä»€ä¹ˆåœ¨ä¼ å…¥å¦ä¸€ä¸ªMapæ—¶åŠ ä¸€"></a>HashMapä¸ºä»€ä¹ˆåœ¨ä¼ å…¥å¦ä¸€ä¸ªMapæ—¶åŠ ä¸€</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">putMapEntries</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m, <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> s = m.size();</span><br><span class="line">        <span class="keyword">if</span> (s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (table == <span class="keyword">null</span>) &#123; <span class="comment">// pre-size</span></span><br><span class="line">                <span class="keyword">float</span> ft = ((<span class="keyword">float</span>)s / loadFactor) + <span class="number">1.0F</span>;</span><br><span class="line">                <span class="keyword">int</span> t = ((ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class="line">                         (<span class="keyword">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class="line">                <span class="keyword">if</span> (t &gt; threshold)</span><br><span class="line">                    threshold = tableSizeFor(t);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (s &gt; threshold)</span><br><span class="line">                resize();</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;</span><br><span class="line">                K key = e.getKey();</span><br><span class="line">                V value = e.getValue();</span><br><span class="line">                putVal(hash(key), key, value, <span class="keyword">false</span>, evict);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡ŒåŠ ä¸€çš„ç›®çš„æ—¶å‘ä¸Šå–æ•´ï¼Œå‡è®¾ s=10 ï¼Œé‚£ä¹ˆä¹˜ä»¥0.75ä¹‹åä¾¿æ˜¯7.5ï¼ŒåŠ ä¸€ä¹‹åå†å–æ•´ï¼Œä¾¿æ˜¯æœ€æ°å½“çš„å­˜å‚¨ä¸ªæ•°äº†ã€‚ä¸‹é¢çš„åˆ¤æ–­åˆ™æ˜¯è¯´å½“å‰çš„mapå·²æœ‰çš„keyçš„æ•°é‡æ˜¯å¦è¾¾åˆ°äº†æ‰©å®¹çš„å¿…è¦ã€‚å¦‚æœéœ€è¦æ‰©å®¹çš„è¯ï¼Œåˆ™æ˜¯ç›´æ¥å‡ºå‘æ‰©å®¹å‡½æ•°ã€‚</p><h2 id="HashMapé€šè¿‡ä¸€ä¸ªé”®æ¥è·å–å€¼"><a href="#HashMapé€šè¿‡ä¸€ä¸ªé”®æ¥è·å–å€¼" class="headerlink" title="HashMapé€šè¿‡ä¸€ä¸ªé”®æ¥è·å–å€¼"></a>HashMapé€šè¿‡ä¸€ä¸ªé”®æ¥è·å–å€¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">       Node&lt;K,V&gt; e;</span><br><span class="line">       <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">       Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">       <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">           (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">               ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">               <span class="keyword">return</span> first;</span><br><span class="line">           <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                   <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">               <span class="keyword">do</span> &#123;</span><br><span class="line">                   <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                       ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                       <span class="keyword">return</span> e;</span><br><span class="line">               &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸»è¦æ˜¯é€šè¿‡ <code>get(object key)</code> ç„¶åå†Hashè¿™ä¸ªkeyï¼Œæœ€åé€šè¿‡hashçš„keyæ¥è·å–å…¶å€¼ã€‚å½“è·å–åˆ° hash çš„ key ä¹‹åå†é€šè¿‡<code>tab[(n - 1) &amp; hash</code>æ¥è·å–ä¿å­˜çš„ä½ç½®ï¼Œå½“å‘ç°è¯¥ä½ç½®ä¸º null çš„æ—¶å€™ä¾¿ç›´æ¥è¿”å› nullï¼Œ<br>è‹¥ä¸æ˜¯ null åˆ™åˆ¤æ–­ç¬¬ä¸€ä¸ªä½ç½®çš„é”®çš„ hash å€¼æ˜¯ä¸æ˜¯è¦è·å–çš„ key çš„ hash ç›¸åŒï¼Œæ˜¯çš„è¯ä¾¿è¿”å›ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸æ˜¯çš„è¯å°±æ¬§å®‰æ®µé“¾è¡¨çš„ä¸‹ä¸€ä¸ªæ˜¯ä¸æ˜¯ nullï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±åˆ¤æ–­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯çº¢é»‘æ ‘ï¼Œæ˜¯çš„è¯ç›´æ¥è°ƒç”¨çº¢é»‘æ ‘çš„æŸ¥è¯¢æ–¹æ³•ï¼Œç„¶åè¿”å›å³å¯ã€‚<br>è¿™é‡Œçš„åšæ³•æ˜¯è®© table ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„ next æŒ‡å‘çº¢é»‘æ ‘çš„å¤´èŠ‚ç‚¹æˆ–è€…æŒ‡å‘é“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p><h2 id="HashMapæ”¾å…¥é”®å’Œå€¼"><a href="#HashMapæ”¾å…¥é”®å’Œå€¼" class="headerlink" title="HashMapæ”¾å…¥é”®å’Œå€¼"></a>HashMapæ”¾å…¥é”®å’Œå€¼</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                   <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">        <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">            n = (tab = resize()).length;</span><br><span class="line">        <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">            tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Node&lt;K,V&gt; e; K k;</span><br><span class="line">            <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                e = p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                        <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                            treeifyBin(tab, hash);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                        ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">                V oldValue = e.value;</span><br><span class="line">                <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                    e.value = value;</span><br><span class="line">                afterNodeAccess(e);</span><br><span class="line">                <span class="keyword">return</span> oldValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ++modCount;</span><br><span class="line">        <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        afterNodeInsertion(evict);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿˜æ˜¯ä¸€æ ·ï¼Œåˆ¤æ–­ tab çš„é•¿åº¦æ˜¯å¦æ˜¯0ï¼Œæ˜¯çš„è¯å°±åˆå§‹åŒ– tableï¼Œç„¶åé€šè¿‡hashå‡ºæ¥çš„å€¼ä¸ table çš„é•¿åº¦è¿›è¡Œä¸è¿ç®—ï¼Œæ‰¾å‡ºæœ€åˆé€‚å­˜æ”¾è¯¥keyçš„ä½ç½®ï¼Œå¦‚æœä¸º null ,åˆ™å­˜å…¥ã€‚<br>ç„¶ååˆ¤æ–­hashæ˜¯å¦ç›¸åŒï¼Œå¦å¤–keyæ˜¯å¦ç›¸åŒï¼Œæ˜¯çš„è¯è·³å‡ºifï¼Œç„¶ååˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºnullï¼Œæ˜¯çš„è¯å°±æ‰§è¡Œ <code>afterNodeAccess</code> å°†è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°æœ«å°¾ã€‚<br>å¦‚æœå‘ç° p æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹çš„è¯ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨æ ‘çš„å­˜å…¥æ–¹æ³•å³å¯ï¼Œä¸æ˜¯çš„è¯å°±è°ƒç”¨å•é“¾è¡¨çš„æ–¹æ³•è¿›è¡Œæ’å…¥å³å¯ã€‚æœ€åè¿˜ä¼šåˆ¤æ–­æ˜¯å¦è¾¾åˆ°äº†é“¾è¡¨è½¬æ ‘çš„é˜ˆå€¼ï¼Œè¾¾åˆ°äº†å°±å¯ä»¥è½¬äº†ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>nettyçš„ä¸€äº›æ¦‚å¿µ</title>
      <link href="/2018/05/31/netty%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/"/>
      <url>/2018/05/31/netty%E7%9A%84%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5/</url>
      <content type="html"><![CDATA[<p>è¿™é‡Œé¢çš„éƒ¨åˆ†æ¦‚å¿µå‚è€ƒäº†ã€ŠApress JavaI.O . NIO and NIO2ã€‹</p><h2 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h2><p>NIOçš„ä¸€äº›æ“ä½œåŸºç¡€å°±æ˜¯Buffer</p><h2 id="Channels"><a href="#Channels" class="headerlink" title="Channels"></a>Channels</h2><p>å®ƒçš„å…·ä½“ä½œç”¨æ˜¯å¸®åŠ© DMA å¿«é€Ÿçš„ä»ç¡¬ç›˜ä¸Šè·å–å’Œå†™å…¥æ•°æ®</p><h2 id="Selector"><a href="#Selector" class="headerlink" title="Selector"></a>Selector</h2><p>é€‰æ‹©å™¨ï¼Œç›®çš„æ˜¯åœ¨å¼‚æ­¥æ¨¡å¼ä¸­å¯ä»¥é€šè¿‡ä¸€ä¸ªçº¿ç¨‹æ¥å®ç°å“ªäº›IOæ“ä½œå·²ç»å®Œæˆäº†ã€‚</p>]]></content>
      
      <categories>
          
          <category> Netty </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Netty </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>angularä¸­ä½¿ç”¨Service</title>
      <link href="/2018/05/30/angular%E4%B8%AD%E4%BD%BF%E7%94%A8Service/"/>
      <url>/2018/05/30/angular%E4%B8%AD%E4%BD%BF%E7%94%A8Service/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©ä½¿ç”¨ Angular çš„æ—¶å€™ï¼Œçœ‹åˆ°ä¹¦ä¸­å°è£…äº†è‡ªå·±å¾—ä¸€ä¸ª LoggerService ï¼Œç„¶åè‡ªå·±ä¹Ÿæƒ³å°è¯•ä¸‹ï¼Œé¡ºä¾¿ä¹Ÿå†™ä¸‹è¿™ä¸ªè®°å½•ã€‚</p><h2 id="æ–°å»ºä¸€ä¸ªServiceå¾—tsæ–‡ä»¶"><a href="#æ–°å»ºä¸€ä¸ªServiceå¾—tsæ–‡ä»¶" class="headerlink" title="æ–°å»ºä¸€ä¸ªServiceå¾—tsæ–‡ä»¶"></a>æ–°å»ºä¸€ä¸ªServiceå¾—tsæ–‡ä»¶</h2><p>åœ¨ app ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ª ts æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> LoggerService&#123;</span><br><span class="line">    info(msg : <span class="built_in">any</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    warn(msg: <span class="built_in">any</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    error(msg: <span class="built_in">any</span>)&#123;</span><br><span class="line">        <span class="built_in">console</span>.error(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªç±»å°±æ˜¯å°è£…äº†ä¸€å±‚æ—¥å¿—æ‰“å°å¾—å‡½æ•°ï¼Œå½“ç„¶åœ¨è¿™é‡Œä¹Ÿå¯ä»¥å°è£…ä¸€äº›å…¶ä»–å¾—å‡½æ•°ã€‚</p><h2 id="å°†æ”¹æœåŠ¡æ·»åŠ è‡³module"><a href="#å°†æ”¹æœåŠ¡æ·»åŠ è‡³module" class="headerlink" title="å°†æ”¹æœåŠ¡æ·»åŠ è‡³module"></a>å°†æ”¹æœåŠ¡æ·»åŠ è‡³module</h2><p>ä¿®æ”¹ app.module.ts æ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ—¥å¿—æœåŠ¡åŠ å…¥åˆ° app.module.ts è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; LoggerService &#125; <span class="keyword">from</span> <span class="string">'./loggerService'</span>;</span><br><span class="line"></span><br><span class="line">providers: [PersonService,LoggerService],</span><br></pre></td></tr></table></figure></p><h2 id="åœ¨ç»„ä»¶ä¸­ä½¿ç”¨"><a href="#åœ¨ç»„ä»¶ä¸­ä½¿ç”¨" class="headerlink" title="åœ¨ç»„ä»¶ä¸­ä½¿ç”¨"></a>åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</h2><p>å¦‚æœéœ€è¦åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è¿™ä¸ªæœåŠ¡çš„è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ç»„ä»¶å¾— Component ä¸­ import å³å¯ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; LoggerService &#125; <span class="keyword">from</span>  <span class="string">'../loggerService'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç„¶ååœ¨æ„é€ å‡½æ•°ä¸­åŠ å…¥</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> personService :PersonService,<span class="keyword">private</span> logger: LoggerService</span>) &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€åæ–¹æ³•ä¸­ä½¿ç”¨ï¼š</span></span><br><span class="line"> printItem()&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.item)</span><br><span class="line">    <span class="keyword">this</span>.logger.info(<span class="string">"LoggeræœåŠ¡å¾—æ—¥å¿—"</span>);</span><br><span class="line">    <span class="keyword">this</span>.emitor.emit(<span class="string">"æµ‹è¯•å›å‘æ•°æ®"</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h2 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h2>]]></content>
      
      <categories>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> angular </tag>
            
            <tag> webå‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨Angularä¸­ä½¿ç”¨Bootstrap</title>
      <link href="/2018/05/29/%E5%9C%A8Angular%E4%B8%AD%E4%BD%BF%E7%94%A8Bootstrap/"/>
      <url>/2018/05/29/%E5%9C%A8Angular%E4%B8%AD%E4%BD%BF%E7%94%A8Bootstrap/</url>
      <content type="html"><![CDATA[<p>åœ¨å»å¹´çš„æ—¶å€™çŸ­æš‚çš„æ¥è§¦äº†å¤§æ¦‚ä¸€ä¸ªæ˜ŸæœŸçš„ Angular ä¹‹åå°±å†ä¹Ÿæ²¡ç¢°è¿‡äº†ï¼Œä»Šå¤©çªç„¶æƒ³é‡æ–°æ¡èµ· Angular çš„ç›¸å…³çŸ¥è¯†ï¼Œå¹¶ä¸”æƒ³å°† Angular ç»“åˆ Bootstrap ä¸€èµ·ä½¿ç”¨ã€‚æ‰€ä»¥æ­£å¥½è®°å½•ä¸‹ä¸€èµ·ç»“åˆä½¿ç”¨çš„æ­¥éª¤ã€‚</p><p>åˆå§‹åŒ–ä¸€ä¸ª Angular çš„é¡¹ç›®ã€‚åˆå§‹åŒ–ä¹‹åæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install jquery --save-dev</span><br><span class="line">npm install bootstrap --save-dev</span><br></pre></td></tr></table></figure></p><p>è¾“å…¥ä»¥ä¸Šä¸¤æ¡å‘½ä»¤ä¹‹åï¼Œåœ¨ <code>package.json</code> ä¸­å¯ä»¥çœ‹åˆ°å·²ç»å¤šå‡ºäº† jquery å’Œ bootstrap è¿™ä¸¤ä¸ªåº“äº†ã€‚å¦‚ä¸‹ï¼š<br><img src="./ç¬¬ä¸€æ­¥åˆå§‹åŒ–.png" alt=""></p><p>å½“åˆå§‹åŒ–å®Œæˆä¹‹åä¼šåœ¨ node_modules ä¸­å‡ºç° bootstrap å’Œ jquery è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ã€‚</p><p>ç„¶åå†å°†éœ€è¦å¼•å…¥çš„ css æ–‡ä»¶å’Œ js æ–‡ä»¶åŠ å…¥åˆ° <code>.angular-cli.json</code>ä¸­ï¼Œå¦‚ä¸‹ï¼š<br><img src="./ç¬¬äºŒæ­¥åˆå§‹åŒ–.png" alt=""></p><p>æœ€åå†æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°† JS æ–‡ä»¶è½¬åŒ–ä¸º TypeScript æ–‡ä»¶ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @types/jquery --save -dev</span><br><span class="line"></span><br><span class="line">npm install @types/bootstrap  --save -dev</span><br></pre></td></tr></table></figure></p><h2 id="å‡ºé”™è§£å†³"><a href="#å‡ºé”™è§£å†³" class="headerlink" title="å‡ºé”™è§£å†³"></a>å‡ºé”™è§£å†³</h2><p>å¦‚æœå®‰è£…å®Œæˆä¹‹åæç¤ºçš„é”™è¯¯å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR in ./node_modules/css-loader?&#123;&quot;sourceMap&quot;:false,&quot;importLoaders&quot;:1&#125;!./node_modules/postcss-loader/lib?&#123;&quot;ident&quot;:&quot;postcss&quot;,&quot;sourceMap&quot;:false&#125;!./node_modules/bootstrap/dist/css/bootstrap.min.css Module build failed: BrowserslistError: Unknown browser major at error</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶éœ€è¦å°† node_modules é‡Œé¢çš„ bootstrap æ–‡ä»¶å¤¹ä¸­çš„ package.json ä¸­çš„ <code>&quot;last 1 major version&quot;,&quot;&gt;= 1%&quot;</code> åˆ é™¤ã€‚ç„¶å è¾“å…¥ <code>npm start</code>å°±å¯ä»¥äº†ã€‚</p>]]></content>
      
      <categories>
          
          <category> Angular </category>
          
      </categories>
      
      
        <tags>
            
            <tag> angular </tag>
            
            <tag> webå‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Erroræ˜¯çœŸçš„ä¸å¯ä»¥è¢«æ•è·çš„å—?</title>
      <link href="/2018/05/25/Error%E6%98%AF%E7%9C%9F%E7%9A%84%E4%B8%8D%E5%8F%AF%E4%BB%A5%E8%A2%AB%E6%8D%95%E8%8E%B7%E7%9A%84%E5%90%97/"/>
      <url>/2018/05/25/Error%E6%98%AF%E7%9C%9F%E7%9A%84%E4%B8%8D%E5%8F%AF%E4%BB%A5%E8%A2%AB%E6%8D%95%E8%8E%B7%E7%9A%84%E5%90%97/</url>
      <content type="html"><![CDATA[<p>åœ¨åˆšæ¥è§¦Javaçš„æ—¶å€™ç»å¸¸å¬åˆ°çš„ä¸€å¥è¯ä¾¿æ˜¯åœ¨ Java ä¸­ï¼ŒException æ˜¯å¯ä»¥æ•è·çš„ï¼ŒError æ˜¯ä¸å¯ä»¥æ•è·çš„ã€‚ä½†æ˜¯åœ¨éšç€å­¦ä¹ çš„æ·±å…¥ï¼Œä¼šå‘ç°æœ‰äº›è§‚ç‚¹éœ€è¦é‡æ–°è®¤è¯†ä¸‹äº†ã€‚<br>Throwable è¿™ä¸ªç±»æ˜¯è‡ª JDK1.0 å¼€å§‹å°±å­˜åœ¨äº Java çš„è¯­è¨€ä¹‹ä¸­ã€‚</p><h2 id="Throwable"><a href="#Throwable" class="headerlink" title="Throwable"></a>Throwable</h2><p>é¦–å…ˆå¼•ç”¨ä¸€æ®µ Oracle å®˜æ–¹æ–‡æ¡£ä¸Šå¯¹ Throwable çš„ä»‹ç»<a href="https://docs.oracle.com/javase/8/docs/api/?java/lang/Error.html" target="_blank" rel="noopener">Java8 Thrwoableçš„ä»‹ç»</a>ï¼š</p><blockquote><p>The Throwable class is the superclass of all errors and exceptions in the Java language. Only objects that are instances of this class (or one of its subclasses) are thrown by the Java Virtual Machine or can be thrown by the Java throw statement. Similarly, only this class or one of its subclasses can be the argument type in a catch clause. For the purposes of compile-time checking of exceptions, Throwable and any subclass of Throwable that is not also a subclass of either RuntimeException or Error are regarded as checked exceptions.<br>Instances of two subclasses, Error and Exception, are conventionally used to indicate that exceptional situations have occurred. Typically, these instances are freshly created in the context of the exceptional situation so as to include relevant information (such as stack trace data).<br>å¤ªé•¿ï¼Œçœç•¥å¤§éƒ¨åˆ†äº†â€¦â€¦</p></blockquote><p>ç®€å•ç¿»è¯‘ä¸‹å°±æ˜¯ï¼ŒThrowable æ˜¯ Error å’Œ Exception çš„çˆ¶ç±»ï¼Œå¹¶ä¸”åªèƒ½æ˜¯ Error å’Œ Exception çš„å®ä¾‹æ‰å¯ä»¥é€šè¿‡ throw è¯­å¥æˆ–è€… Javaè™šæ‹Ÿæœº æŠ›å‡ºå¼‚å¸¸ã€‚Exception æˆ–è€… Error æ˜¯åœ¨å‡ºé”™çš„æƒ…å†µä¸‹æ–°åˆ›å»ºçš„ï¼Œä»è€Œå°†å‡ºé”™çš„ä¿¡æ¯å’Œæ•°æ®åŒ…å«è¿›å»ã€‚<br>å¦å¤–åœ¨è¿™ä¸ªæ–‡æ¡£ä¸­è¿˜æåˆ°äº†ä¸€ç‚¹å°±æ˜¯å½“ä½å±‚æ–¹æ³•å‘é«˜å±‚æ–¹æ³•æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ï¼Œå¦‚æœæŠ›å‡ºçš„å¼‚å¸¸æ˜¯å—æ£€æŸ¥çš„å¼‚å¸¸ï¼Œåˆ™</p><h2 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h2><p>åœ¨çœ‹ Error ä¹‹å‰é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Error e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹è§ Error æ˜¯å¯ä»¥è¢«æ•è·çš„ï¼Œè™½ç„¶ Java çš„catchè¯­å¥å¯ä»¥æ•è· Errorï¼Œä½†æ˜¯åœ¨Errorçš„å®˜æ–¹æ–‡æ¡£ä¸Šå´åšäº†è¯´æ˜ï¼šä¸æ¨èå¯¹Errorè¿›è¡Œæ•è·ï¼Œä¹Ÿå°±æ˜¯è¯´ Error è™½ç„¶å¯ä»¥è¢« Java è¯­è¨€æ•è·ï¼Œä½†æ˜¯Javaå®˜æ–¹å´æ˜¯ä¸æ¨èå¯¹Errorè¿›è¡Œæ•è·çš„ã€‚å…·ä½“æ–‡æ¡£å¦‚ä¸‹ï¼š</p><blockquote><p> An Error is a subclass of Throwable that indicates serious problems that a reasonable application should not try to catch. Most such errors are abnormal conditions. The ThreadDeath error, though a â€œnormalâ€ condition, is also a subclass of Error because most applications should not try to catch it.<br>A method is not required to declare in its throws clause any subclasses of Error that might be thrown during the execution of the method but not caught, since these errors are abnormal conditions that should never occur. That is, Error and its subclasses are regarded as unchecked exceptions for the purposes of compile-time checking of exceptions.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´ Error çš„å‡ºç°è¡¨ç¤ºç¨‹åºå‡ºç°äº†ä¸¥é‡çš„éæ­£å¸¸é—®é¢˜ï¼Œå¹¶ä¸”åœ¨Javaæ€»å¤„äºä¸€äº›åŸå› ï¼ŒError è¢«è®¤ä¸ºæ˜¯æœªæ£€æŸ¥çš„å¼‚å¸¸ã€‚</p><h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><p>å¼‚å¸¸åˆ†ä¸ºå—æ£€æŸ¥çš„å¼‚å¸¸å’Œè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå—æ£€æŸ¥çš„å¼‚å¸¸æ ‡å¿—ç€ç¨‹åºåœ¨ç¼–è¯‘æœŸé—´å¿…é¡»å¤„ç†ï¼Œå¸¸è§çš„æ¯”å¦‚åœ¨è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼ŒJavaè¯­è¨€å¿…é¡»è¦æ±‚æŠ›å‡ºæˆ–è€…Catch FileNotFoundExceptionã€‚è€Œè¿è¡Œæ—¶å¼‚å¸¸ Java åˆ™æ˜¯å¯¹å…¶ä¸åšè¦æ±‚ã€‚</p><h2 id="ä¸ºä»€ä¹ˆJavaä¸æ¨èæ•è·Error"><a href="#ä¸ºä»€ä¹ˆJavaä¸æ¨èæ•è·Error" class="headerlink" title="ä¸ºä»€ä¹ˆJavaä¸æ¨èæ•è·Error"></a>ä¸ºä»€ä¹ˆJavaä¸æ¨èæ•è·Error</h2><p>Javaå®˜æ–¹æ–‡æ¡£çš„è§£é‡Šè¯´æ˜¯ Error çš„å‡ºç°ä»£è¡¨çš„æ˜¯ä¸€äº›ä¸¥é‡çš„éæ­£å¸¸çš„é”™è¯¯ã€‚é‚£ä¹ˆåœ¨ Java çš„å®˜æ–¹æ–‡æ¡£ä¸­ä»‹ç»çš„ Error æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><blockquote><p>AnnotationFormatError, AssertionError, AWTError, CoderMalfunctionError, FactoryConfigurationError, FactoryConfigurationError, IOError, LinkageError, SchemaFactoryConfigurationError, ServiceConfigurationError, ThreadDeath, TransformerFactoryConfigurationError, VirtualMachineErrorã€‚</p></blockquote><p>è¿™äº›Errorçš„å‡ºç°ä»£è¡¨çš„æ˜¯ç¨‹åºå·²ç»ä¸ç”¨è¿›è¡Œå¤„ç†äº†ï¼Œæ¯”å¦‚ OutOfMemoryErrorï¼Œå¦‚æœå‡ºç°äº†è¿™ä¸ªé”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆç¨‹åºå·²ç»æ— æ³•è¿è¡Œä¸‹å»äº†ï¼Œæ­¤æ—¶æ•è·å°±æ²¡æœ‰æ„ä¹‰äº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ‰€ä»¥å¹¶ä¸æ˜¯è¯´Erroræ˜¯ä¸å¯ä»¥æ•è·çš„ï¼Œè€Œæ˜¯å¯ä»¥æ•è·çš„ï¼Œä½†æ˜¯ Java å®˜æ–¹å¹¶ä¸æ¨èæ•è·Errorã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>TreeSetå’ŒTreeMapçš„ä¸€ç‚¹æ€»ç»“</title>
      <link href="/2018/05/24/TreeSet%E5%92%8CTreeMap%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/"/>
      <url>/2018/05/24/TreeSet%E5%92%8CTreeMap%E7%9A%84%E4%B8%80%E7%82%B9%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆç®€å•ä»‹ç»ä¸‹TreeSetå’ŒTreeMapçš„ä¸¤ç§æ’åºï¼š</p><ul><li>è‡ªç„¶æ’åº</li><li>é€šè¿‡comparatoræ’åº<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compareWithCpmparator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        TreeSet&lt;String&gt; treeSet =<span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">        List&lt;String&gt; list =<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"a"</span>);</span><br><span class="line">        list.add(<span class="string">"d"</span>);</span><br><span class="line">        list.add(<span class="string">"b"</span>);</span><br><span class="line">        treeSet.addAll(list);</span><br><span class="line">        Iterator&lt;String&gt; iterator =treeSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        Comparator&lt;String&gt;  comparator1 = (Comparator&lt;String&gt;) treeSet.comparator();</span><br><span class="line">        <span class="keyword">if</span> (comparator1 == <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">"comparator1æ˜¯ç©º"</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"comparator1ä¸æ˜¯ç©º"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        compareWithCpmparator();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><p>è¿è¡Œä¹‹åçš„ç»“æœå¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">b</span><br><span class="line">d</span><br><span class="line">comparator1æ˜¯ç©º</span><br></pre></td></tr></table></figure></p><p>è¿™æ®µä»£ç é‡Œé¢è·å–çš„<code>comparator</code>æ˜¯ç©ºçš„ï¼ŒDebugä¸€éï¼Œå‘ç°è¿™ä¸ªæ–¹æ³•å…¶å®è°ƒç”¨çš„æ˜¯<code>NavigableMap</code>é‡Œé¢çš„<code>comparator</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Comparator&lt;? <span class="keyword">super</span> E&gt; comparator() &#123;</span><br><span class="line">    <span class="keyword">return</span> m.comparator();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æŸ¥çœ‹å®˜ç½‘ä¸Šå¯¹å…¶çš„ä»‹ç»ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Comparator&lt;? super K&gt; comparator()</span><br><span class="line">Returns the comparator used to order the keys in this map, or null if this map uses the natural ordering of its keys.</span><br><span class="line">Returns:</span><br><span class="line">the comparator used to order the keys in this map, or null if this map uses the natural ordering of its keys</span><br></pre></td></tr></table></figure></p><p>åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™è‹¥æ˜¯è‡ªç„¶æ’åºï¼Œé‚£ä¹ˆä¼šè¿”å›ä¸€ä¸ªnullã€‚è‹¥æ˜¯é€šè¿‡comparatorè¿›è¡Œæ’åºçš„è¯å½“å‰é›†åˆé‡‡ç”¨çš„<code>comparator</code>ã€‚<br>æŸ¥çœ‹å®˜ç½‘å¯¹reeSetçš„æ— å‚æ„é€ å™¨çš„è§£é‡Šï¼š</p><blockquote><p>  /**</p><pre><code>* Constructs a new, empty tree set, sorted according to the* natural ordering of its elements.  All elements inserted into* the set must implement the {@link Comparable} interface.* Furthermore, all such elements must be &lt;i&gt;mutually* comparable&lt;/i&gt;: {@code e1.compareTo(e2)} must not throw a* {@code ClassCastException} for any elements {@code e1} and* {@code e2} in the set.  If the user attempts to add an element* to the set that violates this constraint (for example, the user* attempts to add a string element to a set whose elements are* integers), the {@code add} call will throw a* {@code ClassCastException}.</code></pre></blockquote><p>åœ¨ä½¿ç”¨TreeSetçš„æ—¶å€™ï¼Œæ’å…¥çš„å…ƒç´ éœ€è¦å®ç°Comparableè¿™ä¸ªæ¥å£ï¼Œè€Œåˆšåˆšçš„å…ƒç´ æ˜¯Stringï¼ŒæŸ¥çœ‹Stringçš„ä»£ç å‘ç°:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;, <span class="title">CharSequence</span> </span>&#123;</span><br></pre></td></tr></table></figure><p>ç¡®å®å®ç°äº†ï¼Œå†æµ‹è¯•ä¸€ä¸ªæ²¡æœ‰å®ç°çš„å…ƒç´ ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PojoTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PojoTest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PojoTest</span><span class="params">(<span class="keyword">int</span> id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">com</span><span class="params">()</span></span>&#123;</span><br><span class="line">        TreeSet&lt;PojoTest&gt; treeSet =<span class="keyword">new</span> TreeSet&lt;&gt;();</span><br><span class="line">        treeSet.add(<span class="keyword">new</span> PojoTest(<span class="number">1</span>,<span class="string">"a"</span>));</span><br><span class="line">        treeSet.add(<span class="keyword">new</span> PojoTest(<span class="number">2</span>,<span class="string">"b"</span>));</span><br><span class="line">        treeSet.add(<span class="keyword">new</span> PojoTest(<span class="number">3</span>,<span class="string">"c"</span>));</span><br><span class="line">        Iterator&lt;PojoTest&gt; iterator =treeSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next().getName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿è¡Œç»“æœå¦‚ä¸‹:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread <span class="string">"main"</span> java.lang.ClassCastException: SetAndMap.TreeSetAndTreeMap.PojoTest cannot be cast to java.lang.Comparable</span><br><span class="line">at java.util.TreeMap.compare(TreeMap.java:<span class="number">1294</span>)</span><br><span class="line">at java.util.TreeMap.put(TreeMap.java:<span class="number">538</span>)</span><br><span class="line">at java.util.TreeSet.add(TreeSet.java:<span class="number">255</span>)</span><br><span class="line">at SetAndMap.TreeSetAndTreeMap.TestTreeSet.com(TestTreeSet.java:<span class="number">77</span>)</span><br><span class="line">at SetAndMap.TreeSetAndTreeMap.TestTreeSet.main(TestTreeSet.java:<span class="number">88</span>)</span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜æ˜¾ï¼Œæ‰€ä»¥æ”¾åœ¨TreeSeté‡Œé¢çš„å…ƒç´ è¦ä¹ˆæ˜¯å®ç°Comparableäº†çš„è‡ªç„¶æ’åºï¼Œè¦ä¹ˆæ˜¯é€šè¿‡comparatoræ¥è¿›è¡Œæ’åºçš„ã€‚</p><p><strong>æœ€åé™„ä¸Šä¸€ä¸ªæ ‡å‡†çš„ä½¿ç”¨Comparatorçš„æ–¹æ³•</strong>ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Comparator&lt;String&gt;  comparator =<span class="keyword">new</span> Comparator&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(String o1, String o2)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(o1.toCharArray()[<span class="number">0</span>] &gt;o2.toCharArray()[<span class="number">0</span>])&#123;</span><br><span class="line">                    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(o1.toCharArray()[<span class="number">0</span>] == o2.toCharArray()[<span class="number">0</span>])&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        TreeSet&lt;String&gt; treeSet =<span class="keyword">new</span> TreeSet&lt;&gt;(comparator);</span><br><span class="line">        List&lt;String&gt; list =<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">"a"</span>);</span><br><span class="line">        list.add(<span class="string">"d"</span>);</span><br><span class="line">        list.add(<span class="string">"b"</span>);</span><br><span class="line">        treeSet.addAll(list);</span><br><span class="line">        Iterator&lt;String&gt; iterator =treeSet.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        Comparator&lt;String&gt;  comparator1 = (Comparator&lt;String&gt;) treeSet.comparator();</span><br><span class="line">        TreeSet&lt;String&gt; treeSet1 =<span class="keyword">new</span> TreeSet&lt;&gt;(comparator1);</span><br><span class="line">        treeSet1.add(<span class="string">"c"</span>);</span><br><span class="line">        treeSet1.add(<span class="string">"g"</span>);</span><br><span class="line">        treeSet1.add(<span class="string">"a"</span>);</span><br><span class="line">        Iterator&lt;String&gt; iterator1 =treeSet1.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator1.hasNext())&#123;</span><br><span class="line">            System.out.println(iterator1.next());</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><h2 id="è‡ªç„¶æ’åºï¼š"><a href="#è‡ªç„¶æ’åºï¼š" class="headerlink" title="è‡ªç„¶æ’åºï¼š"></a>è‡ªç„¶æ’åºï¼š</h2><p>æ˜¯å®ç°Comparableæ¥å£å¹¶ä¸”é‡å†™äº†compareToæ–¹æ³•çš„</p><h2 id="å¦ä¸€ä¸ªcomparator"><a href="#å¦ä¸€ä¸ªcomparator" class="headerlink" title="å¦ä¸€ä¸ªcomparator"></a>å¦ä¸€ä¸ªcomparator</h2><p>åˆ™æ˜¯é€šè¿‡comparatorå¹¶ä¸”é‡å†™compareæ–¹æ³•</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Spring Cloudçš„Zuulç›¸å…³æ€»ç»“</title>
      <link href="/2018/05/23/Spring-Cloud%E7%9A%84Zuul%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"/>
      <url>/2018/05/23/Spring-Cloud%E7%9A%84Zuul%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>Zuulæ˜¯SpringCloudç”Ÿæ€ä½“ç³»ä¸­çš„ç½‘å…³ä¸€ç¯ï¼Œé¦–å…ˆç®€å•é…ç½®å¦‚ä¸‹ï¼š<br>å¼€å¯æ³¨å†Œä¸­å¿ƒå¹¶ä¸”é…ç½®ymlæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">somersames-erueka</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    registerWithEureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    fetchRegistry:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8081/eureka/</span></span><br></pre></td></tr></table></figure></p><p>å¼€å¯ç”¨æˆ·çš„å¾®æœåŠ¡ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">somersames-user</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8082</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8081/eureka</span></span><br></pre></td></tr></table></figure></p><p>ç¼–å†™ä¸€ä¸ªæµ‹è¯•çš„Controllerï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"testuser"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/testzuul"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testZUul</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"æµ‹è¯•Zuul"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é…ç½®æ³¨å†Œä¸­å¿ƒï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">somersames-zuul</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    service-url:</span></span><br><span class="line"><span class="attr">        defaultZone:</span> <span class="attr">http://localhost:8081/eureka</span></span><br><span class="line"><span class="attr">zuul:</span></span><br><span class="line"><span class="attr">  routes:</span></span><br><span class="line"><span class="attr">    user-route:</span></span><br><span class="line">      <span class="string">url</span> <span class="string">:</span> <span class="attr">http://localhost:8082</span>  <span class="string">//ç”¨æˆ·å¾®æœåŠ¡çš„åœ°å€</span></span><br><span class="line">      <span class="string">path</span> <span class="string">:</span> <span class="string">/user/**</span>          <span class="string">//æ˜ å°„çš„è·¯å¾„</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8083</span></span><br></pre></td></tr></table></figure></p><p>è®¾ç½®Zuulå¯åŠ¨ç±»çš„æ³¨è§£ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableZuulProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZuulConfigApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ZuulConfigApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æµ‹è¯•ï¼š<br>ä½¿ç”¨å¾®æœåŠ¡çš„SericiceIdè®¿é—®ï¼š<br><img src="So.png" alt=""></p><p>ä½¿ç”¨Zuulçš„pathè®¿é—®ï¼š<br><img src="su.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> SpringCloud </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>çº¿ç¨‹çš„interruptå’ŒstopåŒºåˆ«ï¼Œä»¥åŠçº¿ç¨‹çš„ä¸­æ–­æœºåˆ¶</title>
      <link href="/2018/05/22/x%E7%BA%BF%E7%A8%8B%E7%9A%84interrupt%E5%92%8Cstop%E5%8C%BA%E5%88%AB%EF%BC%8C%E4%BB%A5%E5%8F%8A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%B8%AD%E6%96%AD%E6%9C%BA%E5%88%B6/"/>
      <url>/2018/05/22/x%E7%BA%BF%E7%A8%8B%E7%9A%84interrupt%E5%92%8Cstop%E5%8C%BA%E5%88%AB%EF%BC%8C%E4%BB%A5%E5%8F%8A%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%B8%AD%E6%96%AD%E6%9C%BA%E5%88%B6/</url>
      <content type="html"><![CDATA[<h2 id="interrupt"><a href="#interrupt" class="headerlink" title="interrupt"></a>interrupt</h2><p>åœ¨Javaé‡Œé¢çº¿ç¨‹çš„ä¸­æ–­æ˜¯ä¸€ä¸ªåä½œå¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹ä¼šåœ¨è‡ªå·±åˆé€‚çš„æ—¶å€™è‡ªå·±ä¸­æ–­è‡ªå·±ï¼Œä¸€èˆ¬æ¥è®²çº¿ç¨‹å¦‚æœéœ€è¦ä¸­æ–­çš„è¯æœ‰å¦‚ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>æ•è·InterruptException</li><li>é€šè¿‡Threadçš„<code>interrupted()</code>æˆ–è€…<code>isInterrupted()</code>æ–¹æ³•ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯<code>interrupted</code>ä¼šæ¸…é™¤è¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€</li></ul><p>å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„<code>interrupt</code>çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¹¶ä¸ä¼šé©¬ä¸Šç»“æŸï¼Œè€Œæ˜¯ä¼šè®¾ç½®ä¸€ä¸ªä¸­æ–­çš„çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹å¤„äºé˜»å¡çš„çŠ¶æ€ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯¥çº¿ç¨‹ä¼šé©¬ä¸ŠæŠ›å‡ºä¸€ä¸ªInterruptExceptionï¼Œç”±ä¸Šå±‚çš„ä»£ç è¿›è¡Œå¤„ç†ã€‚<br>è‹¥çº¿ç¨‹æ²¡æœ‰å¤„äºé˜»å¡çš„è¯ï¼Œæ­¤æ—¶çº¿ç¨‹è¿˜æ˜¯ä¼šæ‰§è¡Œçš„ã€‚ä½†æ˜¯çº¿ç¨‹éœ€è¦è‡ªå·±åœ¨åˆé€‚çš„åœ°æ–¹é€šè¿‡ä¸Šè¿°çš„ä¸¤ä¸ªæ–¹æ³•æ¥åˆ¤æ–­è‡ªå·±æ˜¯å¦åº”è¯¥ä¸­æ–­ã€‚å¦‚æœè‡ªå·±</p><h2 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h2><p>stopæ–¹æ³•å’Œinterruptæœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œå…·ä½“å°±æ˜¯åœ¨é˜»å¡çš„æ—¶å€™éƒ½ä¼šæŠ›å‡ºInterruptexceptionè¿™ä¸ªå¼‚å¸¸ã€‚<br>ä½†æ˜¯åœ¨è¿è¡ŒæœŸé—´çš„è¯<code>stop</code>æ–¹æ³•ä¼šç›´æ¥å¼ºè¿«å¦ä¸€ä¸ªçº¿ç¨‹ç»ˆæ­¢ï¼Œå¹¶ä¸”æŠ›å‡ºä¸€ä¸ªThreadDeathçš„<strong>Error</strong>ï¼Œè¿™ä¸ª</p><h2 id="ä¸­æ–­æœºåˆ¶ï¼š"><a href="#ä¸­æ–­æœºåˆ¶ï¼š" class="headerlink" title="ä¸­æ–­æœºåˆ¶ï¼š"></a>ä¸­æ–­æœºåˆ¶ï¼š</h2><p>æ€»ç»“äº†ä¸‹ï¼Œæœ‰å¦‚ä¸‹å‡ ç§ã€‚<br>å½“çº¿ç¨‹åœ¨é˜»å¡çš„æ—¶å€™æ”¶åˆ°ä¸­æ–­è¯·æ±‚ï¼Œä½†æ˜¯çº¿ç¨‹ä¼šæŠ›å‡ºä¸€ä¸ªExceptionå¹¶ä¸”çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä¼šè¢«æ¸…é™¤æ‰ã€‚ï¼ˆå¸¸è§çš„é˜»å¡å¦‚sleepï¼Œwaitï¼Œjoinï¼‰ç­‰</p><blockquote><p>æ­¤æ—¶éœ€è¦æ³¨æ„ï¼Œå¦‚æœæ— æ³•ç»§ç»­å‘ä¸ŠæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸çš„è¯ï¼Œé‚£ä¹ˆå°±åº”è¯¥ç»§ç»­è°ƒç”¨<code>interrupt</code>è¿™ä¸ªæ–¹æ³•ï¼Œå› ä¸ºæ¯ä¸€ä¸ªä¸­æ–­éƒ½åº”è¯¥è¢«ä¸Šå±‚çŸ¥é“çš„ã€‚</p></blockquote><p>åœ¨åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€çš„æ—¶å€™éœ€è¦æ³¨æ„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(!Thread.currentThread().isInterrupted())&#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">          <span class="comment">// IOæ“ä½œæˆ–è€…å…¶ä»–çš„ä¸­æ–­æ“ä½œ</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>(InterruptException e)&#123;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒIOæ“ä½œä¸€æ—¦å‘ç”Ÿé˜»å¡å¹¶ä¸”æ”¶åˆ°ä¸€ä¸ªä¸­æ–­å¼‚å¸¸ä½†æ˜¯è¿™ä¸ªå¼‚å¸¸åˆæ²¡æœ‰è¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™whileä¼šä¸€ç›´åˆ¤æ–­ä¸åˆ°è¿™ä¸ªçº¿ç¨‹å·²ç»æ˜¯éœ€è¦è¢«ä¸­æ–­çš„äº†</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…³äºçº¿ç¨‹ä¸­æ–­å°±æ˜¯æ•è·çš„å¼‚å¸¸ä¸€å®šéœ€è¦æŠ›å‡ºï¼Œä¸èƒ½æŠ›å‡ºå°±éœ€è¦è®¾ç½®ä¸­æ–­ä¸­æ–­çŠ¶æ€</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨nginxä¸­ç¼–å†™rewrite</title>
      <link href="/2018/05/20/%E5%9C%A8nginx%E4%B8%AD%E7%BC%96%E5%86%99rewrite/"/>
      <url>/2018/05/20/%E5%9C%A8nginx%E4%B8%AD%E7%BC%96%E5%86%99rewrite/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Nginxåšä¸€ä¸ªåå‘ä»£ç†çš„æ—¶å€™éš¾å…ä¼šç¢°åˆ°ä¸€äº›ç‰¹æ®Šçš„URLï¼Œä¾‹å¦‚è·å–å›¾ç‰‡çš„URLæ˜¯<code>http://dsda/XXX.jpg</code>ï¼Œåæ¥ç”±äºéœ€è¦åŠ ä¸€ä¸ªæ—¶é—´æˆ³æ¥è·å–å¦å¤–ä¸€å¼ å›¾ç‰‡çš„è¯ï¼Œæ­¤æ—¶çš„URLå°±ä¸º<code>http://dsda/XXX.jpg?time=YYYY</code>ã€‚<br>å½“é‡åˆ°è¿™ä¸ªæƒ…å†µçš„æ—¶å€™æ˜¯æœ‰ä¸¤ç§é€‰æ‹©çš„ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><h3 id="é…ç½®location"><a href="#é…ç½®location" class="headerlink" title="é…ç½®location"></a>é…ç½®location</h3><p>ä¹Ÿå°±æ˜¯åœ¨nginxä¸­çš„<code>server</code>é‡Œé¢å†åŠ å…¥ä¸€ä¸ªåŒ¹é… ï¼Œä½†æ˜¯è¿™æ ·åŠ å…¥çš„è¯è‹¥ä»¥åä¸å†æ›´æ”¹è¿˜å¥½ï¼Œä¸€æ—¦éœ€æ±‚å†æ¬¡å˜æ›´ï¼Œå°±ä¼šå¯¼è‡´é…ç½®è®¸å¤šçš„locationã€‚æ‰€ä»¥è¿™ç§åšæ³•çš„è¯å¦‚æœåªæ˜¯ä¸€äº›å›ºå®šçš„URLè¿˜æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯è‹¥åŒ¹é…ä¸€äº›åŠ¨æ€çš„URLåˆ™ä¸æ¨èã€‚<br>å®˜ç½‘çš„è¯´æ˜å¦‚ä¸‹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">listen</span>      <span class="number">80</span><span class="string">;</span></span><br><span class="line">    <span class="string">server_name</span> <span class="string">example.org</span> <span class="string">www.example.org;</span></span><br><span class="line">    <span class="string">root</span>        <span class="string">/data/www;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">/</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">index</span>   <span class="string">index.html</span> <span class="string">index.php;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">location</span> <span class="string">~*</span> <span class="string">\.(gif|jpg|png)$</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">expires</span> <span class="number">30</span><span class="string">d;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="é…ç½®rewriteè§„åˆ™"><a href="#é…ç½®rewriteè§„åˆ™" class="headerlink" title="é…ç½®rewriteè§„åˆ™"></a>é…ç½®rewriteè§„åˆ™</h3><p>é’ˆå¯¹ä¸Šé¢çš„è¯·æ±‚ï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹è§„åˆ™ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">location</span> <span class="string">/</span> <span class="string">&#123;</span></span><br><span class="line">      <span class="comment"># root   /usr/share/nginx/html;</span></span><br><span class="line">      <span class="comment"># index  index.html index.htm;</span></span><br><span class="line">      <span class="string">if</span> <span class="string">(</span> <span class="string">$request_uri</span> <span class="string">~*</span>  <span class="string">"time=(.+)$"</span> <span class="string">)</span>  <span class="string">&#123;</span></span><br><span class="line">      <span class="string">rewrite</span> <span class="string">.*?(?=\?)</span> <span class="string">break;</span></span><br><span class="line">      <span class="string">proxy_pass</span>  <span class="attr">http://localhost:3000;</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">   <span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œé¢çš„ä¸€ä¸ªifåˆ¤æ–­è¯­å¥ä¼šåˆ¤æ–­URLæ˜¯å¦æ˜¯ä»¥timeç»“å°¾ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™å°†<code>?</code>ä¹‹åçš„URLæˆªå–ç„¶åè½¬å‘è‡³3000ç«¯å£ï¼Œæœ€åä¾¿å¯ä»¥ä¸ç”¨å†™ä¸€ä¸ªlocationæ¥å®ç°è½¬å‘äº†</p>]]></content>
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é«˜æ€§èƒ½mysqlé˜…è¯»è®°å½•</title>
      <link href="/2018/05/15/%E9%AB%98%E6%80%A7%E8%83%BDmysql%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/05/15/%E9%AB%98%E6%80%A7%E8%83%BDmysql%E9%98%85%E8%AF%BB%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>nginxå‡ºç°403çš„æ€»ç»“</title>
      <link href="/2018/05/14/nginx%E5%87%BA%E7%8E%B0403%E7%9A%84%E6%80%BB%E7%BB%93/"/>
      <url>/2018/05/14/nginx%E5%87%BA%E7%8E%B0403%E7%9A%84%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨ä½¿ç”¨nginxçš„æ—¶å€™è®¿é—®é¦–é¡µæ€»æ˜¯æç¤º403forbiddenï¼Œç»è¿‡å„ç§æŸ¥è¯¢ä¹‹åï¼Œæ€»ç»“ä¸ºå¦‚ä¸‹å‡ ç§åŸå› ï¼š</p><ol><li>è®¿é—®çš„èµ„æºæƒé™ä¸è¶³ï¼Œæœ€å¥½å°†nginxè®¿é—®çš„èµ„æºæƒé™ä¿®æ”¹ä¸º<code>755</code>æˆ–è€…<code>777</code></li><li>SeLinuxçš„è®¾ç½®ä¸ºtrueï¼Œéœ€è¦å°†å…¶ä¿®æ”¹ä¸ºfalse</li></ol><p>å¦‚æœå‡ºç°é¦–é¡µçš„è®¿é—®èµ„æºä¸æ˜¯æŒ‡å®šçš„ç›®å½•çš„è¯ï¼Œå¯ä»¥åœ¨<code>/etc/nginx/nginx.conf</code>ä¸­æ·»åŠ ä¸€æ¡è¯­å¥<code>root XXX</code>ï¼ŒXXXä»£è¡¨çš„æ˜¯èµ„æºç›®å½•ã€‚<br>å…¶ä»–çš„æš‚æ—¶æ²¡å‘ç°ä»€ä¹ˆé—®é¢˜</p>]]></content>
      
      <categories>
          
          <category> nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºIOå¤šè·¯å¤ç”¨ä»¥åŠå…¶ä»–çš„æ•´ç†</title>
      <link href="/2018/04/28/%E5%85%B3%E4%BA%8EIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%9A%84%E6%95%B4%E7%90%86/"/>
      <url>/2018/04/28/%E5%85%B3%E4%BA%8EIO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%9A%84%E6%95%B4%E7%90%86/</url>
      <content type="html"><![CDATA[<p>è®°å¾—å»å¹´å»å¹´10æœˆä»½çš„æ—¶å€™ä¸€ä¸ªç”µè¯é¢è¯•ï¼Œå½“æ—¶é¢è¯•å®˜ç”±å¤šçº¿ç¨‹é‚£ä¸€éƒ¨åˆ†çŸ¥è¯†è½¬åˆ°äº†IOéƒ¨åˆ†ï¼Œå…ˆæå‡ºåŒæ­¥IOå’Œå¼‚æ­¥IOï¼Œæœ€åé¢è¯•å®˜æå‡ºè¦ä¸€ä¸ªIOçš„å¤šè·¯å¤ç”¨éœ€è¦æ€ä¹ˆå»å®ç°ã€‚ä½†æ˜¯ç”±äºå¯¹<code>å¤šè·¯å¤ç”¨</code> çš„ä¸€äº›æ¨¡å¼è¿˜æ˜¯ä¸å¤ªæ¸…æ¥šï¼Œè€Œç°åœ¨æ­£å¥½åœ¨ç ”ç©¶ <code>netty</code> çš„æ—¶å€™æƒ³èµ·æ¥äº†ï¼Œæ‰€ä»¥åšä¸€ä¸ªæ€»ç»“ç®—äº†ã€‚</p><h2 id="åŒæ­¥IO"><a href="#åŒæ­¥IO" class="headerlink" title="åŒæ­¥IO"></a>åŒæ­¥IO</h2><p>æ‰€è°“çš„åŒæ­¥IO ï¼Œåœ¨åˆšå­¦Javaçš„Socketé€šä¿¡æ—¶å°±æ˜¯ä¸€ä¸ªé˜»å¡IOï¼Œå…·ä½“æ¥è®²å°±æ˜¯åœ¨æœåŠ¡ç«¯çš„ä¸€ä¸ª while ä¸­ä¼šè°ƒç”¨ <code>Inputstream inputStream =scoket.getInputStream()</code> åœ¨è¿™é‡Œå¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰å‘é€æ•°æ®çš„è¯ï¼ŒæœåŠ¡ç«¯å°±ä¼šä¸€ç›´å¡åœ¨è¿™é‡Œã€‚æˆ–è€…è¯´åœ¨æ¥æ”¶æ•°æ®çš„è¿‡ç¨‹ä¸­ä¼šä¸€ç›´å¡åœ¨è¿™é‡Œï¼Œå¯¹äºæœåŠ¡ç«¯æ¥è®²çš„è¯è¿™é‡Œå°±æ˜¯ä¸€ä¸ªåŒæ­¥çš„ï¼Œå› ä¸ºåœ¨è¿™é‡Œæ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®çš„è¯ä»£ç ä¸€ç›´ä¸èƒ½å¾€ä¸‹èµ°ã€‚</p><h2 id="å¼‚æ­¥é˜»å¡IO-Reactor-IOå¤šè·¯å¤ç”¨"><a href="#å¼‚æ­¥é˜»å¡IO-Reactor-IOå¤šè·¯å¤ç”¨" class="headerlink" title="å¼‚æ­¥é˜»å¡IO Reactor IOå¤šè·¯å¤ç”¨"></a>å¼‚æ­¥é˜»å¡IO Reactor IOå¤šè·¯å¤ç”¨</h2><p>å¼‚æ­¥ä»£è¡¨çš„æ˜¯è¢«è°ƒç”¨æ–¹éœ€è¦ä¸»åŠ¨çš„åé¦ˆé€šçŸ¥ï¼Œå°±æ¯”å¦‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¯»å–Socketçš„æµï¼Œå¦‚æœåœ¨è¯»å–æµçš„æ—¶å€™å¿…é¡»ç­‰å¾…è°ƒç”¨æ–¹è‡ªå·±å»åˆ¤æ–­æ˜¯å¦è¯»å–å®Œæ¯•ï¼Œåˆ™è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªåŒæ­¥IOã€‚ä½†æ˜¯å¦‚æœåœ¨è°ƒå–çš„æ—¶å€™ï¼Œæ¯ä¸€æ¬¡è°ƒç”¨æ–¹éƒ½å¯ä»¥å¾—åˆ°ä¸€ä¸ªåé¦ˆï¼Œæ— è®ºå®¢æˆ·ç«¯æ˜¯å¦å‡†å¤‡å°±ç»ªã€‚åˆ™ç§°ä¹‹ä¸ºå¼‚æ­¥çš„ï¼šå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">InputStream in =read(); <span class="comment">// å‡è®¾æ­¤æ—¶æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¿”å›ä¸€ä¸ªç»“æœ</span></span><br><span class="line">Reader reader =<span class="keyword">new</span> InputStreamReader(in);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶å°±å¯ä»¥ç§°ä¹‹ä¸ºä¸€ä¸ªå¼‚æ­¥IOï¼Œä¸»è¦å°±æ˜¯å› ä¸ºè¿™ä¸ªè¯»å–æ“ä½œä¸å†ä¼šè¢«é˜»å¡ï¼Œæ¯ä¸€æ¬¡çš„è°ƒç”¨ï¼Œè¢«è°ƒç”¨æ–¹éƒ½ä¼šåé¦ˆä¸€ä¸ªä¿¡æ¯.</p><p>åœ¨ Java çš„  <code>Netty</code> ä¸­æ¯æ¬¡å¾ªç¯éƒ½ä¼šå»æ£€æŸ¥æ‰€æœ‰çš„keyï¼Œçœ‹ä¸‹æ˜¯ä¸æ˜¯æœ‰çš„keyå¯ä»¥éƒ½å»äº†æˆ–è€…å¯ä»¥å†™å…¥äº†ä¹‹ç±»çš„ï¼Œè¿™ä¸ªå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„IOå¤šè·¯å¤ç”¨</p><h2 id="åŒæ­¥éé˜»å¡"><a href="#åŒæ­¥éé˜»å¡" class="headerlink" title="åŒæ­¥éé˜»å¡"></a>åŒæ­¥éé˜»å¡</h2><p>ç»§ç»­ä»¥Socketä¸¾ä¾‹ï¼šåœ¨åŒæ­¥IOçš„æ—¶å€™ï¼Œæ²¡æœ‰æ”¶åˆ°æ•°æ®æ˜¯ä¸ä¼šè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œçš„ï¼Œä½†æ˜¯åŒæ­¥éé˜»å¡IOå°±æ˜¯åœ¨è¿™é‡Œç›´æ¥åˆ¤æ–­æ•°æ®å‡†å¤‡å¥½äº†æ²¡æœ‰ï¼Œä¸ç®¡æ˜¯å¦æœ‰æ•°æ®ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p><h2 id="å¼‚æ­¥éé˜»å¡"><a href="#å¼‚æ­¥éé˜»å¡" class="headerlink" title="å¼‚æ­¥éé˜»å¡"></a>å¼‚æ­¥éé˜»å¡</h2><p>å¼‚æ­¥IOæŒ‡çš„æ˜¯è°ƒç”¨æ–¹ä¸å¿…åœ¨è¿™é‡Œä¸€ç›´è¯¢é—®æ˜¯å¦å‡†å¤‡å¥½æ•°æ®æ²¡ï¼Œè€Œæ˜¯ç›´æ¥æ‰§è¡Œä»£ç ï¼Œæœ€åç­‰å¾…è¢«è°ƒç”¨æ–¹çš„ä¸€ä¸ªé€šçŸ¥å³å¯ã€‚åœ¨è¿™é‡Œè¿˜æ²¡æœ‰æ‰¾åˆ°å¾ˆå¥½çš„ä¸¾ä¾‹</p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>åœ¨è¿™é‡Œå…¶å®åœ¨Javaçš„å¤šçº¿ç¨‹ä¸­ CallBack å’Œ Future ç±»ä¼¼ï¼Œå½“CallBackæ‰§è¡Œå®Œæ¯•ä¹‹åå†æ‰§è¡Œ Future ä¾¿å¯ä»¥å¾—åˆ°ä¸€ä¸ªç»“æœï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯ä¸€ä¸ªåŒæ­¥é˜»å¡çš„ï¼Œå¼‚æ­¥</p>]]></content>
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springä¸­ä½¿ç”¨MappingJackson2HttpMessageConverteré‡åˆ°çš„ä¸€ä¸ªå‘</title>
      <link href="/2018/04/27/spring%E4%B8%AD%E4%BD%BF%E7%94%A8MappingJackson2HttpMessageConverter%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E5%9D%91/"/>
      <url>/2018/04/27/spring%E4%B8%AD%E4%BD%BF%E7%94%A8MappingJackson2HttpMessageConverter%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%B8%AA%E5%9D%91/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯åœ¨Springä¸­å¦‚æœç»§æ‰¿ <code>WebMvcConfigurerAdapter</code> ç„¶åå®ç° <code>configureMessageConverters</code> æ–¹æ³•æ¥å®ç°ä¸€ä¸ª Json çš„è½¬æ¢çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªæƒ…å†µå°±æ˜¯ï¼š<br>    å¦‚æœåœ¨Controlleré‡Œé¢çš„é‚£ä¸ªå‚æ•°æ˜¯Stringçš„è¯å°±ä¼šä¸€ç›´æç¤ºä¸€ä¸ªé”™è¯¯ <code>org.springframework.http.converter.HttpMessageNotReadableException&quot;,&quot;message&quot;:&quot;JSON parse error: Can not deserialize instance of java.lang.String out of START_OBJECT token; nested exception is com.fasterxml.jackson.databind.JsonMappingException: Can not deserialize instance of java.lang.String out of START_OBJECT token\n at [Source: java.io.PushbackInputStream@35b22c23; line: 1, column: 1]&quot;,&quot;path&quot;:&quot;/tetsjson&quot;}</code><br>åˆšå¼€å§‹ä¸€ç›´æ‰¾ä¸å‡ºåŸå› ï¼Œäºæ˜¯åœ¨ Spring æºç ä¸­ DEBUG :<br>åœ¨å¦‚ä¸‹ä¸¤å¤„æ‰“æ–­ç‚¹å‘ç°æ˜¯å¯ä»¥è·å–è¯·æ±‚ä½“çš„ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HttpInputMessage <span class="title">beforeBodyRead</span><span class="params">(HttpInputMessage request, MethodParameter parameter,</span></span></span><br><span class="line"><span class="function"><span class="params">Type targetType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (RequestBodyAdvice advice : getMatchingAdvice(parameter, RequestBodyAdvice.class)) &#123;</span><br><span class="line"><span class="keyword">if</span> (advice.supports(parameter, targetType, converterType)) &#123;</span><br><span class="line">request = advice.beforeBodyRead(request, parameter, targetType, converterType);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> request;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">afterBodyRead</span><span class="params">(Object body, HttpInputMessage inputMessage, MethodParameter parameter,</span></span></span><br><span class="line"><span class="function"><span class="params">Type targetType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (RequestBodyAdvice advice : getMatchingAdvice(parameter, RequestBodyAdvice.class)) &#123;</span><br><span class="line"><span class="keyword">if</span> (advice.supports(parameter, targetType, converterType)) &#123;</span><br><span class="line">body = advice.afterBodyRead(body, inputMessage, parameter, targetType, converterType);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> body;   <span class="comment">// å¯ä»¥æ­£å¸¸è§£æå‡ºè¯·æ±‚çš„body</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä¸€æ—¦åŠ ä¸Šè¯·æ±‚å¤´<code>Content-Type : application/json</code>.åœ¨æ–¹æ³•è¿›å…¥ <code>beforeBodyRead</code> é‡Œé¢çš„ <code>forå¾ªç¯</code> ä¹‹åä¾¿è·³è½¬åˆ°äº† <code>org.springframework.web.servlet.mvc.method.annotationgetMatchingAdvice()</code> æ–¹æ³•ï¼Œç„¶åç»§ç»­èµ°ä¸‹å»å‘ç°æœ‰ä¸€å¤„æç¤ºå¦‚ä¸‹ï¼š<br><img src="Stringè½¬Http.png" alt=""><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(MethodParameter methodParameter, Type targetType,</span></span></span><br><span class="line"><span class="function"><span class="params">Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; converterType)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ConverType :"class org.springframework.http.converter.json.MappingJackson2HttpMessgaeConverter"</span></span><br><span class="line"><span class="keyword">return</span> (AbstractJackson2HttpMessageConverter.class.isAssignableFrom(converterType) &amp;&amp;</span><br><span class="line">methodParameter.getParameterAnnotation(JsonView.class) != <span class="keyword">null</span>);</span><br><span class="line">              <span class="comment">// methodParamter: "method 'XXX' 'Controlleræ–¹æ³•' paramter 0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="ç¬¬äºŒæ¬¡è½¬æ¢.png" alt=""></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> &lt;A extends Annotation&gt; <span class="function">A <span class="title">getParameterAnnotation</span><span class="params">(Class&lt;A&gt; annotationType)</span> </span>&#123;</span><br><span class="line">Annotation[] anns = getParameterAnnotations();</span><br><span class="line"><span class="keyword">for</span> (Annotation ann : anns) &#123;</span><br><span class="line">           <span class="comment">//annotationType: â€œinterface conk fast erxml. jackson. annotation. JsonViewâ€ ann: â€œorg.springframework.web.bind. annotation. RequestBody(requiredtrue)</span></span><br><span class="line"><span class="keyword">if</span> (annotationType.isInstance(ann)) &#123;</span><br><span class="line"><span class="keyword">return</span> (A) ann;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ä¸Šé¢å·²ç»è®²Jsonè½¬æˆäº† <code>json.MappingJackson2HttpMessageConverter</code></p><p>ç„¶ååœ¨ <code>org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter</code>çš„read()æ–¹æ³•ä¸­ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">read</span><span class="params">(Type type, Class&lt;?&gt; contextClass, HttpInputMessage inputMessage)</span></span></span><br><span class="line"><span class="function"><span class="keyword">throws</span> IOException, HttpMessageNotReadableException </span>&#123;</span><br><span class="line"></span><br><span class="line">JavaType javaType = getJavaType(type, contextClass);</span><br><span class="line"><span class="keyword">return</span> readJavaType(javaType, inputMessage);  <span class="comment">//type :"class java.lang.String" contextClass :"class com.XXX.controller.UserContoller"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="Controllerå¯¹åº”Javaç±»å‹.png" alt=""></p><p>åæ¥å°±DEBUGä¸ä¸‹å»äº†ã€‚ã€‚ã€‚</p><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><p>å‡ºç°è¯¥BUGæ˜¯å› ä¸ºä½¿ç”¨äº† <code>MappingJackson2HttpMessageConverter</code> ä¹‹åä¼šå°†Jsonè§£ææˆå¯¹è±¡ï¼Œæ˜¯Stringè‚¯å®šä¼šæŠ¥é”™ã€‚</p><h2 id="è§£å†³åŠæ³•ï¼š"><a href="#è§£å†³åŠæ³•ï¼š" class="headerlink" title="è§£å†³åŠæ³•ï¼š"></a>è§£å†³åŠæ³•ï¼š</h2><p>è¦ä¹ˆåœ¨ <code>@RequestBody</code>é‡Œé¢ä½¿ç”¨å¯¹è±¡æ¥æ”¶ï¼Œè¦ä¹ˆä¿®æ”¹ <code>MappingJackson2HttpMessageConverter</code>æ–¹æ³•å°†Jsonè½¬æˆå¯¹è±¡</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>HTTPè¯·æ±‚çš„ContentTypeä»¥åŠå…¶ä½¿ç”¨èŒƒå›´</title>
      <link href="/2018/04/26/HTTP%E8%AF%B7%E6%B1%82%E7%9A%84ContentType%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BD%BF%E7%94%A8%E8%8C%83%E5%9B%B4/"/>
      <url>/2018/04/26/HTTP%E8%AF%B7%E6%B1%82%E7%9A%84ContentType%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BD%BF%E7%94%A8%E8%8C%83%E5%9B%B4/</url>
      <content type="html"><![CDATA[<p>åœ¨å‘é€è¯·æ±‚çš„æ˜¯æ—¶å€™æœ€éœ€è¦æ³¨æ„çš„æ˜¯ <code>Content-Type</code> ï¼Œå› ä¸ºä¸åŒçš„ Type å¯¹åº”çš„åˆ™æ˜¯ä¸åŒç±»å‹çš„æ•°æ®ï¼Œä»Šå¤©æ­£å¥½æ²¡ä»€ä¹ˆäº‹æƒ…ï¼Œæ‰€ä»¥æ¥æ€»ç»“ä¸‹ï¼š</p><h2 id="application-json"><a href="#application-json" class="headerlink" title="application/json"></a>application/json</h2><p>è¿™ç§ç±»å‹åœ¨æœ€è¿‘å‡ å¹´ç”¨çš„æ¯”è¾ƒå¤šï¼Œä¸»è¦æ˜¯ç”±äºç°åœ¨å‰åç«¯åˆ†ç¦»ï¼Œæ•°æ®çš„è¯·æ±‚æ–¹å¼å¯ä»¥ç”±ä»¥å‰çš„è¡¨å•æäº¤é€æ¸åå‘äºJsonçš„è¿™ç§æ ¼å¼ã€‚æ‰€ä»¥è¿™ç§ <code>application/json</code>æ ¼å¼çš„æ•°æ®ä¹Ÿå°±è¶Šæ¥è¶Šå¤šäº†ã€‚</p><p>è¿™ç§æ•°æ®ç°åœ¨ä¸€èˆ¬ä½¿ç”¨çš„è¾ƒå¤šã€‚<br>ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨Jqueryçš„æ—¶å€™å¦‚æœæ²¡æœ‰æŒ‡å®šdataTypeçš„è¯ï¼Œåœ¨åç«¯å¯ä»¥è®¾ç½® Content-Type ä¸º application/json ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚<br>ç”¨ Java åˆ™æ˜¯<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">"Content-Type"</span>,<span class="string">"application/json"</span>);</span><br></pre></td></tr></table></figure></p><h2 id="application-x-www-form-urlencoded"><a href="#application-x-www-form-urlencoded" class="headerlink" title="application/x-www-form-urlencoded"></a>application/x-www-form-urlencoded</h2><p>è¿™ç§å°±æ˜¯æœ€å¸¸è§çš„ä¸€ç§è¡¨å•æäº¤æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å¸¸ç”¨çš„formæäº¤äº†ã€‚å¦‚æœé€šè¿‡è¡¨å•æäº¤å¹¶ä¸”æƒ³åœ¨è¡¨å•ä¸­æ·»åŠ æ–‡ä»¶ï¼Œåˆ™éœ€è¦åœ¨ <code>form</code> æ ‡ç­¾ä¸­åŠ å…¥ <code>enctype</code>å±æ€§ï¼Œå¹¶ä¸”æŒ‡å®š <code>enctype</code> ä¸º <code>multipart/form-data</code>ã€‚</p><p>è€Œè¡¨å•é»˜è®¤çš„æ˜¯ <code>application/x-www-form-urlencoded</code> æ‰€ä»¥è¯´å…¶å®å½“æ²¡æœ‰ä¸»åŠ¨å†™è¿™ä¸ªå±æ€§çš„æ—¶å€™ï¼Œæµè§ˆå™¨å·²ç»å¸®ä½ åŠ ä¸Šå»äº†ã€‚</p><h2 id="text-plain"><a href="#text-plain" class="headerlink" title="text/plain"></a>text/plain</h2><p>æœ€å¸¸ç”¨çš„ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ è¾“ç±»å‹</p>]]></content>
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºå¾®æœåŠ¡çš„ä¸€äº›æ€è€ƒ</title>
      <link href="/2018/04/25/%E5%85%B3%E4%BA%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
      <url>/2018/04/25/%E5%85%B3%E4%BA%8E%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>springcloudä¸mockæœåŠ¡</title>
      <link href="/2018/04/24/springcloud%E4%B8%8Emock%E6%9C%8D%E5%8A%A1/"/>
      <url>/2018/04/24/springcloud%E4%B8%8Emock%E6%9C%8D%E5%8A%A1/</url>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>spring cloudä½¿ç”¨ELKæ—¥å¿—è®°å½•(å››)</title>
      <link href="/2018/04/23/spring-cloud%E4%BD%BF%E7%94%A8ELK%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95-%E5%9B%9B/"/>
      <url>/2018/04/23/spring-cloud%E4%BD%BF%E7%94%A8ELK%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95-%E5%9B%9B/</url>
      <content type="html"><![CDATA[<p>åœ¨ELKçš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†ä¸€ç‚¹å›°éš¾ï¼Œ æ‰€ä»¥æ­£å¥½å†™è¿™ä¸€ç¯‡æ–‡ç« æ¥è®°å½•ä¸‹ï¼š</p><h2 id="é—®é¢˜ä¸€ï¼šlogstashè¿æ¥elasticsearchæŠ¥é”™"><a href="#é—®é¢˜ä¸€ï¼šlogstashè¿æ¥elasticsearchæŠ¥é”™" class="headerlink" title="é—®é¢˜ä¸€ï¼šlogstashè¿æ¥elasticsearchæŠ¥é”™"></a>é—®é¢˜ä¸€ï¼šlogstashè¿æ¥elasticsearchæŠ¥é”™</h2><p>è¿™ä¸ªé—®é¢˜åœ¨è¿™è¾¹æ˜¯ç”±äº<code>logstash</code>è¿æ¥æŠ¥é”™ï¼ŒæŸ¥çœ‹äº†ä¸‹é”™è¯¯æ—¥å¿—å‘ç°æ˜¯ç”±äºè§£ææ¨¡æ¿å‡ºé”™ï¼Œåæ¥æ”¹äº†ä¸‹ä¹‹åä¾¿å¯ä»¥è¿æ¥äº†</p><h2 id="é—®é¢˜äºŒï¼škibamaå¯ä»¥è¿æ¥ä¸Šelasticsearchä½†æ˜¯ä¸€ç›´è¯»å–ä¸äº†æ•°æ®"><a href="#é—®é¢˜äºŒï¼škibamaå¯ä»¥è¿æ¥ä¸Šelasticsearchä½†æ˜¯ä¸€ç›´è¯»å–ä¸äº†æ•°æ®" class="headerlink" title="é—®é¢˜äºŒï¼škibamaå¯ä»¥è¿æ¥ä¸Šelasticsearchä½†æ˜¯ä¸€ç›´è¯»å–ä¸äº†æ•°æ®"></a>é—®é¢˜äºŒï¼škibamaå¯ä»¥è¿æ¥ä¸Šelasticsearchä½†æ˜¯ä¸€ç›´è¯»å–ä¸äº†æ•°æ®</h2><p><code>&quot;Couldn&#39;t find any Elasticsearch dataYou&#39;ll need to index some data into Elasticsearch before you can create an index pattern &quot;</code><br>è¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ä»”ç»†æ’é™¤ï¼Œä¸è¿‡å½“å‡ºç°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™å¯ä»¥å…ˆçœ‹ä¸‹Elasticsearch æ˜¯å¦å«æœ‰æ•°æ®ï¼Œè‹¥æ˜¯æ²¡æœ‰æ•°æ®åˆ™æ·»åŠ æ•°æ®å³å¯ã€‚<code>http://localhost:9200/_cat/indices</code>ã€‚å½“è¿™ä¸€æ­¥æ²¡é—®é¢˜äº†ä»¥åï¼Œè‹¥å‘ç°kibanaè¿˜æ˜¯æ— æ³•æ˜¾ç¤ºæ•°æ®åˆ™å¯ä»¥åœ¨kibanaçš„DevToolé‡Œé¢ç›´æ¥æ¨¡æ‹Ÿæ•°æ®ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST test/doc</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"filed"</span>: <span class="string">"myData"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ­¤æ—¶åˆ·æ–°<code>http://localhost:9200/_cat/indices</code>,è‹¥è¿˜æ˜¯æœªå‡ºç°æ•°æ®ï¼Œåˆ™è¡¨ç¤ºå¯èƒ½æ˜¯logstashï¼Œelasticsearchå’Œkibanaè¿æ¥çš„è¿‡ç¨‹å‡ºé”™äº†ï¼Œæ­¤æ—¶å°±éœ€è¦æ£€æŸ¥logæ—¥å¿—ã€‚<br>ä¸‹é¢è¿›å…¥è¿æ¥éƒ¨åˆ†</p><h2 id="è¿æ¥"><a href="#è¿æ¥" class="headerlink" title="è¿æ¥:"></a>è¿æ¥:</h2><p>é¦–å…ˆåœ¨å¾®æœåŠ¡ä¸­å¼•å…¥logstashæ‰€éœ€è¦çš„jarï¼Œç„¶åç¼–å†™logstash.xmlã€‚å…·ä½“å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/net.logstash.logback/logstash-logback-encoder --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.logstash.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logstash-logback-encoder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç¼–å†™logstash.xmlã€‚åœ¨è¿™é‡Œç›´æ¥å°†<code>springcloudä¸Dockerå¾®æœåŠ¡å®æˆ˜</code>çš„logstash.xmlæ‹¿æ¥ä½¿ç”¨äº†<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/defaults.xml"</span> /&gt;</span></span><br><span class="line">    â€‹</span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">"context"</span> <span class="attr">name</span>=<span class="string">"springAppName"</span> <span class="attr">source</span>=<span class="string">"spring.application.name"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Example for logging into the build folder of your project --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"LOG_FILE"</span> <span class="attr">value</span>=<span class="string">"$&#123;BUILD_FOLDER:-build&#125;/$&#123;springAppName&#125;"</span> /&gt;</span></span><br><span class="line">    â€‹</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"CONSOLE_LOG_PATTERN"</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">"%clr(%d&#123;yyyy-MM-dd HH:mm:ss&#125;)&#123;faint&#125; %clr($&#123;LOG_LEVEL_PATTERN:-%5p&#125;) %clr([$&#123;springAppName:-&#125;,%X&#123;X-B3-TraceId:-&#125;,%X&#123;X-B3-SpanId:-&#125;,%X&#123;X-B3-ParentSpanId:-&#125;,%X&#123;X-Span-Export:-&#125;])&#123;yellow&#125; %clr($&#123;PID:- &#125;)&#123;magenta&#125; %clr(---)&#123;faint&#125; %clr([%15.15t])&#123;faint&#125; %clr(%-40.40logger&#123;39&#125;)&#123;cyan&#125; %clr(:)&#123;faint&#125; %m%n$&#123;LOG_EXCEPTION_CONVERSION_WORD:-%wEx&#125;"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Appender to log to console --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"console"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- Minimum logging level to be presented in the console logs --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>DEBUG<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>utf8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Appender to log to file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"flatfile"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_FILE&#125;<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_FILE&#125;.%d&#123;yyyy-MM-dd&#125;.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>7<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>utf8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    â€‹</span><br><span class="line">    <span class="comment">&lt;!-- Appender to log to file in a JSON format --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"logstash"</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.RollingFileAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_FILE&#125;.json<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.core.rolling.TimeBasedRollingPolicy"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_FILE&#125;.json.%d&#123;yyyy-MM-dd&#125;.gz<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>7<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span> <span class="attr">class</span>=<span class="string">"net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">providers</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">timestamp</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">timeZone</span>&gt;</span>UTC<span class="tag">&lt;/<span class="name">timeZone</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">timestamp</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pattern</span>&gt;</span></span><br><span class="line">                        &#123;</span><br><span class="line">                        "severity": "%level",</span><br><span class="line">                        "service": "$&#123;springAppName:-&#125;",</span><br><span class="line">                        "trace": "%X&#123;X-B3-TraceId:-&#125;",</span><br><span class="line">                        "span": "%X&#123;X-B3-SpanId:-&#125;",</span><br><span class="line">                        "parent": "%X&#123;X-B3-ParentSpanId:-&#125;",</span><br><span class="line">                        "exportable": "%X&#123;X-Span-Export:-&#125;",</span><br><span class="line">                        "pid": "$&#123;PID:-&#125;",</span><br><span class="line">                        "thread": "%thread",</span><br><span class="line">                        "class": "%logger&#123;40&#125;",</span><br><span class="line">                        "rest": "%message"</span><br><span class="line">                        &#125;</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">providers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    â€‹</span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"console"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"logstash"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;appender-ref ref="flatfile"/&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç¼–å†™å®Œæˆè¿™ä¸ªå¾®æœåŠ¡ä¹‹åï¼Œéœ€è¦å»è®¾ç½®ELKç›¸å…³çš„config</p><h2 id="elasticsearch"><a href="#elasticsearch" class="headerlink" title="elasticsearch"></a>elasticsearch</h2><p>åœ¨ä½¿ç”¨<code>elasticsearch</code>çš„æ—¶å€™å¹¶ä¸éœ€è¦è¿‡å¤šçš„è®¾ç½®ã€‚ç”šè‡³å¯ä»¥ä¸ç”¨è¿›è¡Œè®¾ç½®ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥å¿½ç•¥æ‰</p><h2 id="logstash"><a href="#logstash" class="headerlink" title="logstash"></a>logstash</h2><p>åœ¨ä½¿ç”¨Logstashçš„æ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ªconfigæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æŒ‡å®šäº†è¯»å–æ—¥å¿—çš„è·¯å¾„ï¼Œä»¥åŠæ—¥å¿—çš„è¿‡æ»¤æ–¹å¼ï¼Œå’Œæ—¥å¿—çš„è¾“å‡ºæ–¹å¼<br>æ‰€ä»¥åœ¨è¿™é‡Œéœ€è¦è‡ªå·±é…ç½®ä¸‹ï¼šå¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">    file &#123;</span><br><span class="line">        codec =&gt; json</span><br><span class="line">        path =&gt; &quot;C:\ELK\log\build\microservice-provider-user.json&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">filter &#123;</span><br><span class="line">    grok &#123;</span><br><span class="line">      match =&gt; &#123; &quot;message&quot; =&gt; &quot;%&#123;TIMESTAMP_ISO8601:timestamp&#125;\s+%&#123;LOGLEVEL:</span><br><span class="line">  severity&#125;\s+\[%&#123;DATA:service&#125;,%&#123;DATA:trace&#125;,%&#123;DATA:\span&#125;,%&#123;DATA:exportable&#125;\]\s+%&#123;DATA:pid&#125;---\s+\[%&#123;DATA:thread&#125;\]\s+%&#123;DATA:class&#125;\s+:\</span><br><span class="line">  s+%&#123;GREEDYDATA:rest&#125;&quot;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">output &#123;</span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts =&gt; &quot;localhost:9200&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>input-&gt;pathæŒ‡å®šçš„æ˜¯è¯»å–æ—¥å¿—çš„è·¯å¾„ï¼Œè€Œoutput-&gt;elasticsearchåˆ™æ˜¯ä»£è¡¨å°†æ—¥å¿—è¾“å‡ºåˆ°<code>elasticsearch</code></p><h2 id="kibana"><a href="#kibana" class="headerlink" title="kibana"></a>kibana</h2><p>kibanaçš„é…ç½®å…¶å®ä¸éœ€è¦å¾ˆå¤šï¼Œåœ¨è¿™é‡Œä¹Ÿä»…ä»…é…ç½®äº†è¿æ¥elasticsearchçš„ç›¸å…³è®¾ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">elasticsearch.url:</span> <span class="string">"http://localhost:9200"</span></span><br><span class="line"><span class="string">elasticsearch.username:</span> <span class="string">"elastic"</span></span><br><span class="line"><span class="string">elasticsearch.password:</span> <span class="string">"changeme"</span></span><br></pre></td></tr></table></figure><p>æœ€åä¾æ¬¡å¯åŠ¨<code>elasticsearch</code>ï¼Œ<code>logstash</code>ï¼Œ<code>kibana</code>ã€‚æœ€åå°†åŒ…å«logstashç›¸å…³çš„å¾®æœåŠ¡æ‰“åŒ…æˆjarï¼Œç„¶åå¼€å¯æ³¨å†Œä¸­å¿ƒï¼Œæœ€åè¿è¡Œè¯¥é¡¹ç›®ï¼Œéšä¾¿è®¿é—®ä¸€ä¸ªè¿æ¥ï¼Œåº”è¯¥æ˜¯å¯ä»¥åœ¨<code>elasticsearch</code>çœ‹åˆ°åˆšåˆšçš„æ•°æ®</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>elasticsearchè·å–ä¸åˆ°æ•°æ®</li></ol><p>æ­¤æ—¶åº”è¯¥æ£€æŸ¥logstashçš„æ—¥å¿—è§‚å¯Ÿæ˜¯å¦æ¨¡æ¿å‡ºé”™ï¼Œå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯åœ¨åŒ¹é…çš„æ—¶å€™ä¸å¯ä»¥ä½¿ç”¨<code>*.json</code>ï¼Œä¸€å®šæ˜¯éœ€è¦æ–‡ä»¶åç§°åŠ ä¸Šjsonï¼Œå¦‚ä¸Šé…ç½®ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ— æ³•æ˜¯è¢«</p><ol start="2"><li>é…ç½®å¥½äº†è¿˜æ˜¯æ— æ³•è·å–æ•°æ®</li></ol><p>å¯ä»¥åœ¨kibanaçš„æ§åˆ¶å°æ‰‹åŠ¨æ·»åŠ æ•°æ®ï¼Œç„¶åè®¿é—®<code>http://localhost:9200/_cat/indices?v</code>ï¼Œå¦‚æœè¿˜æ˜¯æœªå‡ºç°æ•°æ®ï¼Œåˆ™è¡¨ç¤º kibana å’Œ elasticsearch çš„è¿æ¥é™¤äº†é—®é¢˜ï¼Œéœ€è¦æ’æŸ¥ã€‚ç›®å‰æä¾›äº†ä¸¤ç§æ€è·¯ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨kibanaçš„é…ç½®ä¸­æ‰‹åŠ¨é…ç½® elasticsearch çš„åœ°å€å’Œç”¨æˆ·åä»¥åŠå¯†ç ã€‚ç¬¬äºŒç§åˆ™æ˜¯åœ¨ kibana çš„æ§åˆ¶å°æ‰‹åŠ¨æ·»åŠ æ•°æ®:</p><p><img src="kibanaæ§åˆ¶å°.PNG" alt=""></p><p>å¦‚æœkibanaè¿æ¥æ­£å¸¸åˆ™ä¼šåœ¨<code>http://localhost:9200/_cat/indices?v</code>è¿™é‡Œå‡ºç°åˆšåˆšæ·»åŠ çš„æ•°æ®ã€‚æ²¡å‡ºç°çš„è¯å°±éœ€è¦ä»”ç»†æ£€æŸ¥äº†</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springcloudçš„å…¶ä»–ç»„ä»¶ä½¿ç”¨è®°å½•ä¹‹Config(å››)</title>
      <link href="/2018/04/22/springcloud%E7%9A%84%E5%85%B6%E4%BB%96%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/04/22/springcloud%E7%9A%84%E5%85%B6%E4%BB%96%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Spring Configçš„æ—¶å€™é‡åˆ°ä¸€äº›å‘ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹ï¼Œé¡ºä¾¿æ¢³ç†ä¸‹è¿™ä¸ªä½¿ç”¨ã€‚</p><h2 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h2><p>ä½¿ç”¨Spring Configæ¥é…åˆgitåšä¸€ä¸ªé…ç½®æ–‡ä»¶ç®¡ç†ï¼Œéœ€è¦ä¸€ä¸ªConfigçš„æœåŠ¡ç«¯å’Œä¸€ä¸ªConfigçš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯ä¸»è¦æ˜¯å’Œgitä»“åº“è¿›è¡Œä¸€ä¸ªè¿æ¥ï¼Œè€Œconfigçš„å®¢æˆ·ç«¯æ˜¯è¿æ¥æœåŠ¡ç«¯æ¥åˆ·æ–°é…ç½®æœåŠ¡çš„ã€‚<br>åœ¨Spring Cloud Configé‡Œé¢å®¢æˆ·ç«¯éœ€è¦ä½¿ç”¨<code>Spring4.0</code>å‡ºç°çš„ä¸€ä¸ªæ³¨è§£<code>@Value</code>é…åˆä¸€èµ·ä½¿ç”¨</p><h2 id="Spring-ConfigæœåŠ¡ç«¯"><a href="#Spring-ConfigæœåŠ¡ç«¯" class="headerlink" title="Spring ConfigæœåŠ¡ç«¯"></a>Spring ConfigæœåŠ¡ç«¯</h2><p>éœ€è¦å¼•å…¥ä¸€ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æ–°å»ºä¸€ä¸ªapplication.yml<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">microservice-server</span>  <span class="comment"># nameå¯ä»¥éšä¾¿å¡«å†™ï¼Œä»£è¡¨è¿™ä¸ªæœåŠ¡çš„ServiceId</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      server:</span></span><br><span class="line"><span class="attr">        git:</span></span><br><span class="line"><span class="attr">          uri:</span> <span class="attr">https://gitee.com/somersames/sprincloud-config.git</span>  <span class="comment"># gitçš„åœ°å€</span></span><br><span class="line"><span class="attr">          username:</span> <span class="string">yourname</span></span><br><span class="line"><span class="attr">          password:</span> <span class="string">yourpassword</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8099</span> <span class="comment"># æœåŠ¡å¼€å¯çš„ç«¯å£</span></span><br></pre></td></tr></table></figure></p><p>æ–°å»ºä¸€ä¸ªå¯åŠ¨ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableConfigServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(ConfigApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>@EnableConfigServer</code>ä»£è¡¨çš„æ˜¯å°†è¿™ä¸ªå¾®æœåŠ¡ä½œä¸ºConfigçš„æœåŠ¡å™¨</p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>éšååœ¨gitæœåŠ¡å™¨ä¸­æ–°å»ºå‡ ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æŒ‰ç…§peopertiesçš„æ ¼å¼è¾“å…¥å†…å®¹ï¼Œä¾‹å¦‚<code>profile=ad</code>å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">microservice-foo.properties</span><br><span class="line">microservice-foo-dev.properties</span><br><span class="line">microservice-foo-test.properties</span><br></pre></td></tr></table></figure></p><p>åˆ†åˆ«ä»£è¡¨çš„æ˜¯é»˜è®¤é…ç½®å’Œå¼€å‘ç¯å¢ƒä»¥åŠæµ‹è¯•ç¯å¢ƒçš„é…ç½®æ–‡ä»¶ã€‚</p><h2 id="å¼€å¯æœåŠ¡ç«¯"><a href="#å¼€å¯æœåŠ¡ç«¯" class="headerlink" title="å¼€å¯æœåŠ¡ç«¯"></a>å¼€å¯æœåŠ¡ç«¯</h2><p>è¿è¡ŒæœåŠ¡ç«¯ï¼Œç„¶åè®¿é—®URLï¼Œå…¶ä¸­URLçš„æ ¼å¼ä¸ºlocalhost:port/é»˜è®¤çš„é¡¹ç›®åç§°/åˆ†æ”¯.æ ¼å¼<br><img src="jsonæ ¼å¼.PNG" alt=""><br>è¿™ä¸ªURLçš„æ ¼å¼æœ‰å¾ˆå¤šç§æ ¼å¼ï¼Œå…·ä½“çš„å¯ä»¥ç™¾åº¦ä¹‹åå†è‡ªå·±å°è¯•<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"name"</span>:<span class="string">"microservice-foo"</span>,<span class="attr">"profiles"</span>:[<span class="string">"dev.json"</span>],<span class="attr">"label"</span>:<span class="string">"master"</span>,<span class="attr">"version"</span>:<span class="string">"7ac2a341dfe7959b809b7d5ec70b980970208b91"</span>,<span class="attr">"state"</span>:<span class="literal">null</span>,<span class="attr">"propertySources"</span>:[&#123;<span class="attr">"name"</span>:<span class="string">"https://gitee.com/somersames/sprincloud-config.git/microservice-foo.properties"</span>,<span class="attr">"source"</span>:&#123;<span class="attr">"profile"</span>:<span class="string">"default-1.0-changeewafasf"</span>&#125;&#125;]&#125;</span><br></pre></td></tr></table></figure></p><h2 id="æ·»åŠ å®¢æˆ·ç«¯"><a href="#æ·»åŠ å®¢æˆ·ç«¯" class="headerlink" title="æ·»åŠ å®¢æˆ·ç«¯"></a>æ·»åŠ å®¢æˆ·ç«¯</h2><p>å®¢æˆ·ç«¯ä¸è´Ÿè´£ç›´æ¥å’Œgitè¿›è¡Œé€šä¿¡ï¼Œè€Œæ˜¯ç›´æ¥å’ŒConfigçš„æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡è·å–æœ€æ–°çš„æ•°æ®</p><p>æ–°å»ºä¸€ä¸ªå·¥ç¨‹å¹¶ä¸”æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶<code>bootstrap.yml</code>ï¼Œæ²¡é”™ï¼Œæ˜¯bootstrap.ymlï¼Œç„¶åå†æ–°å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶<code>application.yml</code>.<br>åœ¨bootstrap.ymlä¸­æ·»åŠ å†…å®¹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">microservice-foo</span> <span class="comment"># è¿™é‡Œçš„åç§°å¡«å†™é¡¹ç›®çš„åç§°ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¹‹å‰è·å–çš„jsoné‡Œé¢çš„é‚£ä¸ªname</span></span><br><span class="line"><span class="attr">  cloud:</span></span><br><span class="line"><span class="attr">    config:</span></span><br><span class="line"><span class="attr">      uri:</span> <span class="attr">http://localhost:8099/</span>  <span class="comment"># å¡«å†™ConfigæœåŠ¡ç«¯åœ°å€</span></span><br><span class="line"><span class="attr">      profile:</span> <span class="string">dev</span>  <span class="comment">#é¡¹ç›®ç¯å¢ƒ</span></span><br><span class="line"><span class="attr">      label:</span> <span class="string">master</span>  <span class="comment">#é¡¹ç›®åˆ†æ”¯</span></span><br></pre></td></tr></table></figure></p><p>åœ¨Application.ymlé‡Œé¢æ·»åŠ å†…å®¹ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8088</span> <span class="comment"># æœåŠ¡å¼€å¯çš„ç«¯å£ï¼Œä»»æ„å³å¯</span></span><br></pre></td></tr></table></figure></p><p>æ–°å»ºä¸€ä¸ªController<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"config"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeignController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;profile&#125;"</span>)  <span class="comment">// è¿™é‡Œçš„profileä¸æ˜¯éšä¾¿å–å¾—ï¼Œè¿™é‡Œå–å¾—æ˜¯ä¸Šè¿°josnå­—ç¬¦ä¸²é‡Œé¢çš„propertySources ä¸‹çš„ source é‡Œé¢çš„é‚£ä¸ªé”®ï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œé¢å°±æ˜¯profile,</span></span><br><span class="line">    <span class="keyword">private</span> String profile;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/profile"</span>,method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.profile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…¶ä»–æ— éœ€æ”¹åŠ¨ï¼Œç„¶åè®¿é—®<code>localhost:8099/config/profile</code>ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š<br><img src="config.PNG" alt=""></p><h2 id="åˆ·æ–°"><a href="#åˆ·æ–°" class="headerlink" title="åˆ·æ–°"></a>åˆ·æ–°</h2><p>æœ‰æ—¶å€™éœ€è¦æ¯”å¦‚åŠ¨æ€åˆ·æ–°gitçš„æœ€æ–°é…ç½®çš„è¯ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„åŒ…ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  <span class="comment">&lt;!--æ ¹æ®è‡ªå·±çš„ç‰ˆæœ¬è‡ªå·±é€‰æ‹©åˆé€‚çš„ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶ååœ¨Controlleré‡Œé¢æ·»åŠ æ³¨è§£<code>@RefreshScope</code>,ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯é«˜ç‰ˆæœ¬éœ€è¦åœ¨bootstrap.ymlé‡Œé¢æ·»åŠ ä¸€ä¸ªé…ç½®<strong><code>management:security:enabled: false</code></strong>å¦åˆ™ä¼šå¯¼è‡´ä¿®æ”¹ä¹‹åè¯·æ±‚<code>refresh</code>åˆ·æ–°ä¸å‡ºæ¥ã€‚</p><p>è‡ªå·±é€šè¿‡gitä¿®æ”¹é‚£ä¸ªæ–‡ä»¶ä¹‹åç»§ç»­å¦‚ä¸‹æ“ä½œï¼š</p><p>ç„¶åPOSTMANå‘å‡ºä¸€ä¸ªPOSTè¯·æ±‚ï¼Œ<br><img src="POSTåˆ·æ–°.PNG" alt=""></p><p>å¦‚æœåœ¨é«˜ç‰ˆæœ¬é‡Œé¢ä¸æ·»åŠ é‚£ä¸ªé…ç½®ä¼šå¯¼è‡´åˆ·æ–°ä¸å‡ºæ¥ï¼Œå¦‚æœè‡ªå·±åˆ·æ–°ä¸å‡ºæ¥ï¼Œè¯·å°è¯•æ·»åŠ é‚£ä¸ªé…ç½®,å¦å¤–é‚£ä¸ªé¢å¤–æ·»åŠ çš„é…ç½®éœ€è¦æŒ‰ç…§æ ¼å¼è‡ªå·±è°ƒæ•´ä¸‹ã€‚åˆ·æ–°ä¹‹åå¦‚ä¸‹ï¼š</p><p><img src="åˆ·æ–°.PNG" alt=""></p><p>é‚£ä¸ªcvcvcvå°±æ˜¯åˆšåˆšä¿®æ”¹çš„å†…å®¹</p><p>è¿™ä¸ªå°±å·®ä¸å¤šç»“æŸäº†</p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springcloudä½¿ç”¨feignå¯¼è‡´çš„Excepted authority é”™è¯¯(ä¸‰)</title>
      <link href="/2018/04/21/%E8%AE%B0%E4%B8%80%E6%AC%A1springcloud%E4%BD%BF%E7%94%A8feign%E5%AF%BC%E8%87%B4%E7%9A%84Excepted-authority-%E9%94%99%E8%AF%AF-%E4%B8%89/"/>
      <url>/2018/04/21/%E8%AE%B0%E4%B8%80%E6%AC%A1springcloud%E4%BD%BF%E7%94%A8feign%E5%AF%BC%E8%87%B4%E7%9A%84Excepted-authority-%E9%94%99%E8%AF%AF-%E4%B8%89/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨ç”¨Feignçš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªBUGï¼Œè¿™ä¸ªBUGè™½ç„¶ä¸æ˜¯å¾ˆéš¾ï¼Œä½†æ˜¯ç”±äºç½‘ä¸Šæ²¡ä»€ä¹ˆè§£å†³åŠæ³•ï¼Œè€Œæ˜¯è‡ªå·±çš„DEBUGè§£å†³çš„ï¼Œæ‰€ä»¥æš‚ä¸”è®°å½•ä¸‹ï¼š</p><p>å¼‚å¸¸å°±æ˜¯<code>java.net.URISyntaxException: Expected authority at index 7: http://</code>ï¼Œåˆšå¼€å§‹çš„æ—¶å€™ä¸€å¤´é›¾æ°´ï¼Œåœ¨Googleäº†ä¸€éä¹‹åå¹¶æœªæ‰¾å‡ºè§£å†³åŠæ³•ï¼Œåæ¥åˆå°è¯•äº†åœ¨ä»£ç ä¸­è¿›è¡Œäº†DEBUGï¼Œå‘ç°ä»£ç åµŒå¥—çš„å¤ªæ·±äº†ï¼Œæ‰€ä»¥æ²¡åŠæ³•èµ°ä¸‹å»ï¼Œä¹‹åä¾¿å»StackOverflowä¸­æŸ¥çœ‹äº†ä¸‹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤´ç»ª<br>åœ¨è¿™é‡Œä¹Ÿæ£€æŸ¥è¿‡äº†æ˜¯ä¸æ˜¯æœåŠ¡æ²¡æ³¨å†Œè¿˜æ˜¯Feignçš„æ³¨è§£å¾®æœåŠ¡åç§°æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œéƒ½æ˜¾ç¤ºæ˜¯æ­£å¸¸çš„ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¿™ä¸ªåç§°è·å–å…¶å¯¹åº”çš„åœ°å€</p><p>åæ¥ä»Šæ—©èµ·æ¥çš„æ—¶å€™å†æ¬¡é€›StackOverflowçœ‹åˆ°æœ‰äººæç¤º<code>try to debug into the LoadBalancerFeignClient.cleanUrl()</code>ã€‚æŸ¥çœ‹äº†ä¸‹è¿™ä¸ªæ–¹æ³•çš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> URI <span class="title">cleanUrl</span><span class="params">(String originalUrl, String host)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> URI.create(originalUrl.replaceFirst(host, <span class="string">""</span>));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>çŒœæµ‹äº†ä¸‹åº”è¯¥æ˜¯è´Ÿè´£åˆ›å»ºFeignç›¸å…³URLçš„ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥å°è¯•åœ¨è¿™é‡ŒDEBUGï¼Œç„¶åå†å¼€å¯ä¸€ä¸ªæ­£å¸¸çš„å¯ä»¥ä½¿ç”¨Feignçš„æœåŠ¡ï¼Œæœ€åå‘ç°è¿™ä¸¤ä¸ªæœåŠ¡çš„åŒºåˆ«æ˜¯ï¼Œåœ¨è¿™ä¸ªå‡ºé”™çš„å¾®æœåŠ¡é‡Œé¢å‘å‡ºçš„è¯·æ±‚æ˜¯<code>http://xxx</code>,è€Œæ­£å¸¸çš„å¾®æœåŠ¡æ˜¯<code>http://xxx/user/name/XX</code>,æ‰€ä»¥é—®é¢˜é©¬ä¸Šå°±å®šä½å‡ºæ¥äº†ï¼Œå°±æ˜¯è¯·æ±‚çš„é—®é¢˜ï¼Œ</p><p>æŸ¥çœ‹Feignçš„æ¥å£ï¼Œå‘ç°åœ¨æ–¹æ³•ä¸Šé¢çš„<code>@RequestMapping</code>å‡ºäº†é—®é¢˜ï¼Œå‡ºé”™çš„é…ç½®å¦‚ä¸‹:<code>@RequestMapping(name = &quot;movie/user/{username}&quot; ,method = RequestMethod.GET)</code>,è¿™é‡Œå…¶å®åº”è¯¥æ˜¯valueè€Œä¸æ˜¯nameï¼Œè‡³äºnameçš„ä½œç”¨å‚ç…§ç½‘ä¸Šçš„è¯´æ³•å¦‚ä¸‹(è‡ªå·±å¹¶æœªè¯å®):<br>å‡è®¾åœ¨UserControllerä¸­æœ‰ä¸€ä¸ªgetUser()æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span></span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(name=<span class="string">"ceshifangfa"</span>,value=<span class="string">"/getuser"</span>,method=RequestMethod.GET)()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨jspé¡µé¢æ˜¯å¯ä»¥é€šè¿‡nameå±æ€§æ¥è®¿é—®è¿™ä¸ªæ¥å£ï¼š<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href="$&#123;s:mvcUrl('UC#ceshifangfa').build()&#125;"&gt;è·å–ç”¨æˆ·&lt;/a&gt;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæ­¤æ—¶åœ¨è¿™é‡Œä½¿ç”¨nameçš„è¯å¯¼è‡´äº†Feignæ‰¾ä¸åˆ°äº†è®¿é—®çš„URLï¼Œæ‰€ä»¥ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚<br>æœ€åä¿®æ”¹ä¸ºvalueï¼Œä¸€åˆ‡æ­£å¸¸</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨ç¢°åˆ°é—®é¢˜çš„æ—¶å€™è‡ªå·±çš„æ€è·¯ä¸€å¼€å§‹æ˜¯æ²¡é”™çš„ï¼Œä½†æ˜¯å½“æ—¶ä¸çŸ¥é“å¦‚ä½•æ‰¾å‡ºé‚£ä¸ªFeignçš„å‘è¯·æ±‚æ–¹æ³•ï¼Œæ‰€ä»¥ä¸€ç›´å¡åœ¨è¿™é‡Œäº†ã€‚<br>æç¤ºï¼šä»¥åå†StackOverflowçœ‹åˆ°åˆ«äººçš„å›ç­”çš„æ—¶å€™å¯ä»¥ç¨å¾®ä»”ç»†çš„æ€è€ƒä¸‹</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springcloudçš„æœåŠ¡æ³¨å†Œä¸è´Ÿè½½å‡è¡¡</title>
      <link href="/2018/04/20/springcloud%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"/>
      <url>/2018/04/20/springcloud%E7%9A%84%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%8E%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/</url>
      <content type="html"><![CDATA[<p>åœ¨springcloudä¸­ï¼ŒæœåŠ¡æ³¨å†Œå’Œè´Ÿè½½å‡è¡¡åˆ†åˆ«æ˜¯eurekaå’Œribbonã€‚å…¶ä¸­eurekaæ˜¯ä¸€ä¸ªæœåŠ¡æ³¨å†Œç»„ä»¶ï¼Œribbonåˆ™æ˜¯ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç»„ä»¶ã€‚å¦‚æœå¼€å¯äº†hystrixä¹‹åribbonå°±é»˜è®¤å·²ç»å¼€å¯äº†ã€‚</p><h2 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h2><p>åœ¨ä½¿ç”¨Eurekaçš„æ—¶å€™æœåŠ¡ç«¯å¼€å¯ä¹‹åç›´æ¥åœ¨å®¢æˆ·ç«¯çš„application.ymlä¸­åŠ å…¥å¦‚ä¸‹ä»£ç å³å¯:<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">          defaultZone:</span> <span class="attr">http://localhost:8083/eureka/</span></span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­defaultZoneä»£è¡¨çš„æ˜¯æœåŠ¡ç«¯çš„åœ°å€ï¼Œå¼€å¯æœåŠ¡ä¹‹ååœ¨eurekaçš„æœåŠ¡é¢æ¿ä¾¿ä¼šçœ‹åˆ°è¿™ä¸ªæ³¨å†Œä¿¡æ¯ã€‚å¦‚æœéœ€è¦åœ¨è¿™ä¸ªå®¢æˆ·ç«¯ä¸­åŠ å…¥ä¸€äº›å…ƒæ•°æ®çš„è¯å¯ä»¥åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">instance:</span></span><br><span class="line"><span class="attr">  prefer-ip-address:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    metadata-map:</span></span><br><span class="line"><span class="attr">      mydata:</span> <span class="string">testydata</span></span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­<code>metedata-map</code>ä¸‹é¢å°±ä»£è¡¨çš„æ˜¯è‡ªå·±å®šä¹‰çš„å…ƒæ•°æ®ï¼Œè¿™ä¸ªä¼šåœ¨å…¶ä»–å®¢æˆ·ç«¯è¯·æ±‚æŸ¥çœ‹å¾®æœåŠ¡ä¿¡æ¯çš„æ—¶å€™ä¸€åŒæ˜¾ç¤ºå‡ºæ¥ã€‚</p><h2 id="ribbon"><a href="#ribbon" class="headerlink" title="ribbon"></a>ribbon</h2><p>è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼Œå¯ä»¥å°†è¯·æ±‚å‡åŒ€çš„åˆ†å¸ƒåœ¨ç›¸åŒçš„å¾®æœåŠ¡å®ä¾‹ä¸Šï¼Œéœ€è¦å‡ ä¸ªå¾®æœåŠ¡éƒ½æ˜¯åŒä¸€ä¸ªç›¸åŒåç§°ï¼Œç«¯å£å¯ä»¥ä¸åŒã€‚<br>æ–°å»ºä¸¤ä¸ªå®¢æˆ·ç«¯,ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯ç«¯å£å·æ˜¯8085<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eurekamovie</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">          defaultZone:</span> <span class="attr">http://localhost:8083/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8085</span></span><br></pre></td></tr></table></figure></p><p>ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ç«¯å£æ˜¯8087<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">eurekamovie</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">          defaultZone:</span> <span class="attr">http://localhost:8083/eureka/</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8087</span></span><br></pre></td></tr></table></figure></p><p>è¿™ä¸¤ä¸ªæœåŠ¡å»ºç«‹å¹¶å¼€å¯ä¹‹åï¼Œæ–°å»ºä¸€ä¸ªæœåŠ¡ç«¯ï¼Œç„¶åé€šè¿‡ribbonè®¿é—®<code>eurekamovie</code>è¿™ä¸ªæœåŠ¡åç§°ï¼Œè¿™æ ·è¯·æ±‚å°±ä¼šå‡åŒ€çš„åˆ†å¸ƒåœ¨è¿™ä¸¤ä¸ªæœåŠ¡ä¸Šã€‚</p><p>å»ºç«‹ä¸€ä¸ªRestTemplateè‡ªåŠ¨æ³¨è§£ç±»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RestTemplate <span class="title">restTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">LoadBalancerClient loadBalancerClient;</span><br></pre></td></tr></table></figure></p><p>æœ€ååœ¨Controlleré‡Œé¢çš„æ–¹æ³•é‡Œé¢é€šè¿‡è°ƒç”¨è¯¥æœåŠ¡åç§°å®Œæˆè°ƒç”¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RestTemplate restTemplate = <span class="keyword">new</span> RestTemplate();</span><br><span class="line">ServiceInstance instance = loadBalancerClient.choose(<span class="string">"EUREKAMOVIE"</span>);</span><br><span class="line">URI uri = instance.getUri();</span><br><span class="line">User user =<span class="keyword">this</span>.restTemplate().getForEntity(uri+<span class="string">"aa"</span>,User.class).getBody();</span><br></pre></td></tr></table></figure></p><p>æœ€åå¯ä»¥åœ¨å¦ä¸¤ä¸ªæœåŠ¡ä¸­å¯ä»¥çœ‹åˆ°è¯·æ±‚æŒ‰ç…§ä¸€ä¸ªä¸€æ¬¡çš„æ–¹å¼å‡åŒ€çš„åˆ†å¸ƒåœ¨è¿™ä¸¤ä¸ªå®ä¾‹ä¸­ã€‚å¦å¤–å°±æ˜¯å¦‚æœéœ€è¦è‡ªå·±ç¼–å†™è´Ÿè½½å‡è¡¡çš„è§„åˆ™çš„è¯ã€‚å¯ä»¥å‚ç…§å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RibbonConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IRule <span class="title">ribbonule</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è‡ªå®šä¹‰çš„è§„åˆ™åªéœ€è¦è¿”å›ä¸€ä¸ªIRuleè§„åˆ™å³å¯ã€‚</p>]]></content>
      
      <categories>
          
          <category> Spring Cloud </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springcloudçš„å¤šèŠ‚ç‚¹éƒ¨ç½²(äºŒ)</title>
      <link href="/2018/04/19/springcloud%E7%9A%84%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2-%E4%BA%8C/"/>
      <url>/2018/04/19/springcloud%E7%9A%84%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2-%E4%BA%8C/</url>
      <content type="html"><![CDATA[]]></content>
      
      
    </entry>
    
    <entry>
      <title>spring cloudåˆæ­¥é…ç½®ä¹‹èµ·æ­¥</title>
      <link href="/2018/04/18/spring-cloud%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3/"/>
      <url>/2018/04/18/spring-cloud%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3/</url>
      <content type="html"><![CDATA[<p>spring cloudæ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ²»ç†æ¡†æ¶ï¼Œä¸»è¦è§£å†³çš„æ˜¯ä»¥å‰å•åº”ç”¨è¿‡äºè‡ƒè‚¿çš„ä¸€äº›éš¾ç‚¹ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹åˆæ¬¡ä½¿ç”¨springcloudçš„ä¸€äº›è¿‡ç¨‹</p><h2 id="åˆ›å»ºä¸€ä¸ªspringbootåº”ç”¨"><a href="#åˆ›å»ºä¸€ä¸ªspringbootåº”ç”¨" class="headerlink" title="åˆ›å»ºä¸€ä¸ªspringbootåº”ç”¨"></a>åˆ›å»ºä¸€ä¸ªspringbootåº”ç”¨</h2><p>åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯IDEAçš„<code>spring Initializr</code>åˆ›å»ºçš„ï¼Œåˆ›å»ºå¥½äº†ä¹‹åå°†<code>application.properties</code>æ”¹æˆ<code>application.yml</code>,å…¶é¡¹ç›®ç»“æ„å›¾å¦‚ä¸‹ï¼š<br><img src="é¡¹ç›®ç»“æ„å›¾.PNG" alt=""></p><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç”±äºåœ¨è¿™é‡Œçš„Testæ–‡ä»¶ä¸­å«æœ‰ä¸€ä¸ª<code>@RunWith</code>æ³¨è§£ï¼Œæ‰€ä»¥éœ€è¦åœ¨pom.xmlä¸­å¼•å…¥springbootçš„teståŒ…ï¼Œå¦åˆ™é¡¹ç›®å¯èƒ½å¯åŠ¨ä¸èµ·æ¥</p><h2 id="å¼•å…¥spring-cloudåŒ…"><a href="#å¼•å…¥spring-cloudåŒ…" class="headerlink" title="å¼•å…¥spring cloudåŒ…"></a>å¼•å…¥spring cloudåŒ…</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>Camden.SR7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span><span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span><span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å®˜ç½‘çš„ä»¥ä¸€ä¸ªé…ç½®ï¼Œä½†æ˜¯åœ¨å¼•å…¥æœ¬åœ°çš„æ—¶å€™è¿˜æ˜¯éœ€è¦ç¨å¾®åšç‚¹ä¿®æ”¹ã€‚<br>ä¿®æ”¹ä¹‹åçš„ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>Camden.SR7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæ·»åŠ äº†<code>&gt;spring-cloud-starter-eureka-server</code>,è€Œä¸”åœ¨è¿™é‡Œå¼•å…¥çš„jaréƒ½ä¸éœ€è¦æ·»åŠ ç‰ˆæœ¬å·ã€‚</p><h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  application:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">stock-service</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8083</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line"><span class="attr">  client:</span></span><br><span class="line"><span class="attr">    registerWithEureka:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    fetchRegistry:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">    serviceUrl:</span></span><br><span class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:8084/eureka/</span></span><br></pre></td></tr></table></figure><p>æœ€åä¾¿å¯ä»¥å¯åŠ¨é¡¹ç›®äº†ã€‚</p><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p>è¿è¡Œå‡ºæ¥çš„ç»“æœå¦‚ä¸‹ï¼š<br><img src="eureka.PNG" alt=""></p>]]></content>
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> springcloud </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springæºç å¯¼å…¥IDEA</title>
      <link href="/2018/04/17/spring%E6%BA%90%E7%A0%81%E5%AF%BC%E5%85%A5IDEA/"/>
      <url>/2018/04/17/spring%E6%BA%90%E7%A0%81%E5%AF%BC%E5%85%A5IDEA/</url>
      <content type="html"><![CDATA[<p>åœ¨å°†Springæºç å¯¼å…¥IDEAçš„è¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€ä¸ªé”™è¯¯ï¼Œå°±æ˜¯çœ‹åˆ°springæºç é‡Œé¢æœ‰ä¸€ä¸ª<code>import-into-idea.md</code>è¿™ä¸ªæ–‡ä»¶ï¼ŒæŒ‰ç…§è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å‘½ä»¤åœ¨å¯¼å…¥æºç è‡³IDEAçš„è¿‡ç¨‹ä¸­ä¼šæç¤ºä¸€ä¸ªéæ³•å¼‚å¸¸ã€‚ç½‘ä¸Šä¹Ÿæ²¡æœ‰å¥½çš„è§£å†³åŠæ³•ï¼Œåæ¥ç›´æ¥åœ¨IDEAé‡Œé¢é€‰æ‹©å¯¼å…¥ï¼Œç„¶åé€‰æ‹©ä»¥gradleçš„æ–¹å¼å¯¼å…¥ä¹‹åå°±å¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚</p>]]></content>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> spring </tag>
            
            <tag> gradle </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºSQLåœ¨å·¥ä½œä¸­çš„ä¸€äº›æ³¨æ„äº‹é¡¹</title>
      <link href="/2018/04/16/%E5%85%B3%E4%BA%8ESQL%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2018/04/16/%E5%85%B3%E4%BA%8ESQL%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      <content type="html"><![CDATA[<p>åœ¨å·¥ä½œä¸­çš„è¯ï¼Œä¸€ä¸ªsqlè¯­å¥æœ€å¥½ä¸è¦è¿æ¥å¤ªå¤šçš„è¡¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹ä¹‹åæ•´ä¸ªè¡¨ç»“æ„å°±ä¼šå…¨éƒ¨çš„å‡ºé”™ï¼Œæ‰€ä»¥æ­£ç¡®çš„æ–¹æ³•æ˜¯å¦‚æœä¸€ä¸ªæ¥å£åœ¨è®¾è®¡çš„æ—¶å€™å°±éœ€è¦è¿”å›å¤§é‡çš„æ•°æ®ï¼Œé‚£ä¹ˆæœ€å¥½æ˜¯åœ¨åç«¯è¿›è¡Œå¤šä¸ªè¯­å¥çš„æŸ¥è¯¢ï¼Œæœ€åç»„åˆæˆä¸€ä¸ªjsonä¹¦è¿”å›ç»™å‰ç«¯ï¼Œæˆ–è€…åœ¨æ•°æ®åº“è®¾è®¡çš„æ—¶å€™å°±è€ƒè™‘åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå½“ç„¶è¿™ä¸ªé—®é¢˜ä¸€èˆ¬æ— æ³•é¿å…</p>]]></content>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springwebsocketç›¸å…³</title>
      <link href="/2018/04/16/springwebsocket%E7%9B%B8%E5%85%B3/"/>
      <url>/2018/04/16/springwebsocket%E7%9B%B8%E5%85%B3/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Springæ¥è¿›è¡Œwebsocketé€šä¿¡çš„æ—¶å€™éœ€è¦æ³¨æ„å‡ ç‚¹é—®é¢˜ï¼š</p><h2 id="localhostä¸127-0-0-1çš„åŒºåˆ«"><a href="#localhostä¸127-0-0-1çš„åŒºåˆ«" class="headerlink" title="localhostä¸127.0.0.1çš„åŒºåˆ«"></a>localhostä¸127.0.0.1çš„åŒºåˆ«</h2><p>åœ¨ä½¿ç”¨<code>127.0.0.1</code>çš„æ—¶å€™æ˜¯å¯ä»¥å’ŒæœåŠ¡å™¨å»ºç«‹websocketè¿æ¥çš„ï¼Œä½†æ˜¯å¦‚æœæƒ³åœ¨websocketçš„intercepté‡Œé¢æ‹¦æˆªrequestï¼Œå¹¶ä¸”è·å–sessioné‡Œé¢çš„ç”¨æˆ·çš„è¯ã€‚è‹¥åœ¨jsè„šæœ¬é‡Œå–å¼„ä½¿ç”¨<code>127.0.0.1</code>çš„è¯ä¼šä¼šå¯¼è‡´æµè§ˆå™¨åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¸ä¼šå¸¦ä¸Šcookiesï¼Œæ‰€ä»¥åœ¨è¿™é‡Œè·å–çš„ä¸€å®šä¼šæ˜¯ä¸€ä¸ªnullï¼Œè¿™é‡Œä¾¿éœ€è¦æ³¨æ„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„æ˜¯localhosté‚£ä¹ˆåœ¨websocketä¸­è¾“å…¥çš„ä¹Ÿå¿…é¡»æ˜¯localhostï¼Œå¦åˆ™ä¼šå¯¼è‡´æµè§ˆå™¨åœ¨è¿›è¡Œwebsocketè¯·æ±‚çš„æ—¶å€™ä¸ä¼šå¸¦ä¸Šcookie</p>]]></content>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>shirosè‡ªå®šä¹‰å¼‚å¸¸çš„è·³è½¬</title>
      <link href="/2018/04/14/shiros%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E7%9A%84%E8%B7%B3%E8%BD%AC/"/>
      <url>/2018/04/14/shiros%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E7%9A%84%E8%B7%B3%E8%BD%AC/</url>
      <content type="html"><![CDATA[<p>åœ¨shiroä¸­ç»å¸¸éœ€è¦å¯¹ç‰¹å®šçš„å¼‚å¸¸åŠè¿›è¡Œç‰¹æ®Šçš„å¤„ç†ã€‚ä¸€èˆ¬æ¥è®²åœ¨shiroä¸­é…ç½®çš„è¯æ˜¯é€šè¿‡å¦‚ä¸‹ä»£ç ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"shiroFilter"</span> <span class="attr">class</span>=<span class="string">"org.apache.shiro.spring.web.ShiroFilterFactoryBean"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"securityManager"</span> <span class="attr">ref</span>=<span class="string">"securityManager"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loginUrl"</span> <span class="attr">value</span>=<span class="string">"/login.jsp"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"unauthorizedUrl"</span> <span class="attr">value</span>=<span class="string">"/unauthorized.jsp"</span>  /&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;property name="filters"&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;map&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;entry key="roles" value-ref="roles" /&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;entry key="perms" value-ref="perms" /&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;/map&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--&lt;/property&gt;--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- è¿‡æ»¤é“¾å®šä¹‰ --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filterChainDefinitions"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--/role/** authc--&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--/login/main authc--&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--api/logincheck authc--&gt;</span></span><br><span class="line">               <span class="comment">&lt;!--message/detail role[EMPLOYEE]--&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯åœ¨è¿™é‡Œé…ç½®çš„è¯ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯é€šè¿‡æ³¨è§£<code>@RequireRoles()</code>è¿™ä¸ªæ¥é…ç½®çš„æƒé™ä¼šå¯¼è‡´è¿™é‡Œçš„é…ç½®ä¸€ç›´æ— æ³•ç”Ÿæ•ˆï¼Œä¹Ÿå°±æ˜¯å½“æ— æƒé™çš„äººè®¿é—®éœ€è¦ç‰¹å®šæƒé™çš„URLçš„æ—¶å€™å°±ä¼šç›´æ¥åœ¨é¡µé¢ä¸Šæ˜¾ç¤º500ï¼Œè€Œä¸æ˜¯è¿”å›æˆ‘è¿™ä¸ªæŒ‡å®šçš„URLï¼Œåæ¥æŸ¥è¯¢å¾—çŸ¥æœ‰å¦‚ä¸‹å‡ ä¸ªéœ€è¦æ³¨æ„çš„ï¼š</p><ol><li>ä½¿ç”¨é…ç½®çš„æ–¹å¼é…ç½®æƒé™çš„è¯è¯¥xmlå¯ä»¥ç”Ÿæ•ˆ</li><li>ä½¿ç”¨æ³¨è§£é…ç½®æƒé™çš„è¯ä½†æ˜¯ä½¿ç”¨xmlæ–¹å¼é…ç½®é”™è¯¯è·³è½¬é¡µé¢ä¸ä¼šè·³è½¬è‡³æŒ‡å®šURL</li></ol><p>æ‰€ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨æ³¨è§£é…ç½®æƒé™çš„è¯éœ€è¦åœ¨xmlé…ç½®æ–‡ä»¶ä¸­é…ç½®ä¸€ä¸ªå¼‚å¸¸å’Œå…¶å¤„ç†çš„ç›¸å…³urlï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å®šä¹‰éœ€è¦ç‰¹æ®Šå¤„ç†çš„å¼‚å¸¸ï¼Œç”¨ç±»åæˆ–å®Œå…¨è·¯å¾„åä½œä¸ºkeyï¼Œå¼‚å¸¸é¡µåä½œä¸ºå€¼ --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.handler.SimpleMappingExceptionResolver"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"exceptionMappings"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.apache.shiro.authz.NestedServletException"</span>&gt;</span>redirect:/unauthorized<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.apache.shiro.authz.UnauthenticatedException"</span>&gt;</span>redirect:/unauthorized<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">"org.apache.shiro.authz.AuthorizationException"</span>&gt;</span>redirect:/unauthorized<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> shiro </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Pythonä½¿ç”¨Plotlyæ¥ç”»å›¾</title>
      <link href="/2018/04/13/Python%E4%BD%BF%E7%94%A8Plotly%E6%9D%A5%E7%94%BB%E5%9B%BE/"/>
      <url>/2018/04/13/Python%E4%BD%BF%E7%94%A8Plotly%E6%9D%A5%E7%94%BB%E5%9B%BE/</url>
      <content type="html"><![CDATA[<p>Plotlyæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ç”»å›¾å·¥å…·ï¼Œä¸»è¦ç”¨äºæ•°æ®çš„å±•ç¤ºï¼Œä»¥åŠåˆ†æï¼Œæœ€å¥½é…åˆpandasä¸€èµ·ä½¿ç”¨å‘æŒ¥å‡ºæœ€å¤§çš„ä½œç”¨</p><h2 id="å¼•å…¥åŸºç¡€åº“"><a href="#å¼•å…¥åŸºç¡€åº“" class="headerlink" title="å¼•å…¥åŸºç¡€åº“"></a>å¼•å…¥åŸºç¡€åº“</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> plotly</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> plotly.plotly</span><br><span class="line"><span class="keyword">import</span> plotly.graph_objs <span class="keyword">as</span> go</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure><h2 id="ç”»å›¾ï¼š"><a href="#ç”»å›¾ï¼š" class="headerlink" title="ç”»å›¾ï¼š"></a>ç”»å›¾ï¼š</h2><p>åœ¨è¿™é‡Œç”»å›¾çš„è¯å¯ä»¥ä½¿ç”¨å‚ç…§å®˜ç½‘ç»™å‡ºçš„ä¸€ä¸ªé¥¼å½¢å›¾ä¾‹å­ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">labels = [<span class="string">'Oxygen'</span>,<span class="string">'Hydrogen'</span>,<span class="string">'Carbon_Dioxide'</span>,<span class="string">'Nitrogen'</span>]</span><br><span class="line">values = [<span class="number">4500</span>,<span class="number">2500</span>,<span class="number">1053</span>,<span class="number">500</span>]</span><br><span class="line">colors = [<span class="string">'#FEBFB3'</span>, <span class="string">'#E1396C'</span>, <span class="string">'#96D38C'</span>, <span class="string">'#D0F9B1'</span>]</span><br><span class="line"></span><br><span class="line">trace = go.Pie(labels=labels, values=values,</span><br><span class="line">               hoverinfo=<span class="string">'label+percent'</span>, textinfo=<span class="string">'value'</span>, </span><br><span class="line">               textfont=dict(size=<span class="number">20</span>),</span><br><span class="line">               marker=dict(colors=colors, </span><br><span class="line">                           line=dict(color=<span class="string">'#000000'</span>, width=<span class="number">2</span>)))</span><br></pre></td></tr></table></figure></p><p>go.pie()å‡½æ•°çš„å‚æ•°å«ä¹‰åˆ†åˆ«æ˜¯åå­—ï¼Œå€¼ï¼Œé¼ æ ‡è¦†ç›–åéœ€è¦æ˜¾ç¤ºçš„ä¿¡æ¯ï¼šæ ‡ç­¾å’Œå æ¯”ï¼Œæœ€åä¸€ä¸ªæ˜¯é¥¼å½¢å›¾æ¯ä¸€å—æ˜¾ç¤ºå†…å®¹ï¼Œæ˜¯é™åˆ¶æ•°é‡è¿˜æ˜¯ä»€ä¹ˆï¼Œæœ€åå¦‚æœéœ€è¦åœ¨æœ¬åœ°ä¼šåçš„è¯éœ€è¦è°ƒç”¨ç¦»çº¿ç”»å›¾å‡½æ•°ï¼Œä½†æ˜¯è²Œä¼¼å®ƒçš„å›¾å½¢ä¼šæ¯”åœ¨çº¿çš„å°‘ä¸å°‘ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plotly.offline.plot([trace])</span><br></pre></td></tr></table></figure><p>è‹¥éœ€è¦ç»˜åˆ¶å¤šä¸ªçš„è¯ç±»ä¼¼äºæŠ˜çº¿å›¾å¯ä»¥ä¿®æ”¹ä¸º<code>plotly.offline.plot([trace1,trace2])</code>æˆ–è€…ç›´æ¥<code>data=[trace1,trace2]</code>ç„¶å<code>plotly.offline.plot(data)</code></p>]]></content>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> plotly </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mybatisä¸­sqlæ’åºä»¥åŠ#å’Œ$çš„åŒºåˆ«(äºŒ)</title>
      <link href="/2018/04/12/Mybatisz%E4%B8%ADsql%E6%8E%92%E5%BA%8F%E4%BB%A5%E5%8F%8A-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB-%E4%BA%8C/"/>
      <url>/2018/04/12/Mybatisz%E4%B8%ADsql%E6%8E%92%E5%BA%8F%E4%BB%A5%E5%8F%8A-%E5%92%8C-%E7%9A%84%E5%8C%BA%E5%88%AB-%E4%BA%8C/</url>
      <content type="html"><![CDATA[<h2 id="mybatisçš„orderby"><a href="#mybatisçš„orderby" class="headerlink" title="mybatisçš„orderby"></a>mybatisçš„orderby</h2><p>åœ¨ä½¿ç”¨mybatisçš„æ—¶å€™ï¼Œä¸€èˆ¬æ¥è®²æ˜¯ä½¿ç”¨<code>#{}</code>è¿™ç§æ–¹å¼æ¥è®¾ç½®sqlçš„å‚æ•°ï¼Œå› ä¸ºmybatisåœ¨è§£æsqlçš„æ—¶å€™çš„æ—¶å€™å¯¹äºä½¿ç”¨<code>#{}</code>çš„å‚æ•°é¦–å…ˆä¼šè§£ææˆ<code>?</code>,ç„¶åå†åŠ å…¥å‚æ•°ã€‚å…·ä½“å¯ä»¥çœ‹mybatisçš„è§£ææ—¥å¿—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: select * from clazzentity where clazz_name = ? </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: ä¸€å¹´çº§(String)</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯åœ¨mybatisä¸­å¦‚æœéœ€è¦ä½¿ç”¨groupbyå’Œorderbyçš„è¯å°±éœ€è¦æ³¨æ„ä¸å¯ä»¥ä½¿ç”¨<code>#</code>äº†ï¼Œå› ä¸ºä½¿ç”¨<code>#</code>çš„è¯ä¼šå¯¼è‡´è§£æå‡ºæ¥çš„å‚æ•°è‡ªåŠ¨çš„å¸¦äº†ä¸€ä¸ªå¼•å·,è€Œä½¿ç”¨<code>$</code>çš„è¯å°±ä¼šç›´æ¥æŠŠå‚æ•°å¸¦è¿›å»ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œgroupbyçš„æ—¶å€™æ˜¯éœ€è¦ä½¿ç”¨<code>$</code>æ¥è¿›è¡Œå‚æ•°çš„æ›¿æ¢çš„ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨${}è¿™ä¸ªçš„æ—¶å€™éœ€è¦æ³¨æ„ä¸‹ã€‚</p><h1 id="mybatisçš„å¤šå‚æ•°å’Œå•å‚æ•°"><a href="#mybatisçš„å¤šå‚æ•°å’Œå•å‚æ•°" class="headerlink" title="mybatisçš„å¤šå‚æ•°å’Œå•å‚æ•°"></a>mybatisçš„å¤šå‚æ•°å’Œå•å‚æ•°</h1><h3 id="å•å‚æ•°"><a href="#å•å‚æ•°" class="headerlink" title="å•å‚æ•°"></a>å•å‚æ•°</h3><p>mybatisçš„å•å‚æ•°ä¸€èˆ¬æ¥è®²æ˜¯ä¼šè‡ªåŠ¨è¢«è¯†åˆ«çš„ï¼Œ<code>#</code>çš„è¯ç›´æ¥å¯ä»¥åŠ å‚æ•°åç§°ï¼Œ<code>$</code>çš„è¯åˆ™æ˜¯ä½¿ç”¨<code>_paramter</code>æ¥æ¥æ”¶</p><h3 id="å¤šå‚æ•°"><a href="#å¤šå‚æ•°" class="headerlink" title="å¤šå‚æ•°"></a>å¤šå‚æ•°</h3><h4 id="param"><a href="#param" class="headerlink" title="param"></a>param</h4><p>mybatisä¸­è‹¥éœ€è¦ä½¿ç”¨å¤šå‚æ•°çš„è¯è¦ä¹ˆä½¿ç”¨<code>@param</code>æ³¨è§£ï¼Œè¦ä¹ˆä½¿ç”¨é›†åˆæˆ–è€…å¯¹è±¡æ¥ä½œä¸ºå‚æ•°,å…¶ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Map&lt;String,Object&gt;&gt; queryStudnet2(<span class="meta">@Param</span>(<span class="string">"CLAZZID"</span>) String clazzId ,<span class="meta">@Param</span>(<span class="string">"name"</span>) String name);</span><br></pre></td></tr></table></figure></p><p>è€Œå…¶é…ç½®æ–‡ä»¶åˆ™å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryStudnet2"</span> <span class="attr">resultType</span>=<span class="string">"java.util.HashMap"</span> &gt;</span></span><br><span class="line">        select count(CLAZZ_ID) as 'id' , CLAZZ_ID from student GROUP by $&#123;CLAZZID&#125; order by $&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨${}é‡Œé¢çš„å‚æ•°å…¨éƒ¨æ˜¯@Param,æ‰€ä»¥è¿™æ˜¯ä¸€ç§å¤šå‚æ•°ä¼ é€’æ–¹å¼ï¼ŒåŒæ—¶è¿™ç§æ–¹å¼è¿›è¡Œä¼ å‚çš„è¯#å’Œ$éƒ½å¯ä»¥è§£æï¼Œ</p><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>Listçš„ä¼ å‚åº”è¯¥åªæ˜¯é€‚ç”¨äºforeachè¿­ä»£,ä¹Ÿå°±æ˜¯éœ€è¦åŠ¨æ€çš„æ‰§è¡Œå¤šæ¡è¯­å¥çš„æ—¶å€™æ‰ä¼šä½¿ç”¨List</p><h4 id="Javaå¯¹è±¡"><a href="#Javaå¯¹è±¡" class="headerlink" title="Javaå¯¹è±¡"></a>Javaå¯¹è±¡</h4><p>è€ŒJavaå¯¹è±¡ä¼ å‚çš„è¯åœ¨å…¥å‚çš„åœ°æ–¹éœ€è¦åŠ å…¥Javaå¯¹è±¡çš„å®ä½“ç±»ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢éœ€è¦è¿”å›ç»“æœçš„æ—¶å€™å¯ä»¥é€šè¿‡resultMapæ¥æ”¶ï¼Œä¸æ˜¯ä¸€ä¸ªmapä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªJavaå¯¹è±¡ä¹Ÿå¯ä»¥æ¥æ”¶ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯é€šè¿‡Javaå¯¹è±¡æ¥æ”¶çš„è¯è¦javaå­—æ®µå’Œsqlçš„å­—æ®µæ˜ å°„ã€‚ä¸€ç§å°±æ˜¯å·²ç»è¯´äº†çš„resultMapï¼Œå¦ä¸€ç§å°±æ˜¯æ•°æ®åº“è¿”å›å­—æ®µè®¾ç½®åˆ«åç„¶åè®©å…¶è¿”å›çš„æ˜¯Javaå¯¹è±¡çš„å­—æ®µ</p><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><p>mapåˆ™é€‚ç”¨äºå¤šå‚æ•°ä¼ é€’ï¼Œç±»ä¼¼äºjavaå¯¹è±¡<br>é€šè¿‡mapä¼ é€’å‚æ•°çš„è¯æ˜¯æœ€å¸¸è§çš„ä¸€ç§æ–¹å¼åœ¨ä¼ å…¥<code>#{}</code>çš„åŠ¨æ€å‚æ•°ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨mapçš„æ–¹å¼çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼Œé€šè¿‡mapä¼ å€¼çš„è¯ï¼Œç”¨<code>${}</code>æ˜¯æ¥å—ä¸åˆ°çš„ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">### Error querying database.  Cause: org.apache.ibatis.builder.BuilderException: Error evaluating expression &apos;_paramter.clazz&apos;. Cause: org.apache.ibatis.ognl.OgnlException: source is null for getProperty(null, &quot;clazz&quot;)</span><br><span class="line">### Cause: org.apache.ibatis.builder.BuilderException: Error evaluating expression &apos;_paramter.clazz&apos;. Cause: org.apache.ibatis.ognl.OgnlException: source is null for getProperty(null, &quot;clazz&quot;)</span><br></pre></td></tr></table></figure></p><p>æ‰€ä»¥mapä¼ å€¼çš„è¯æœ€å¥½æ˜¯ä¼ å…¥éœ€è¦<code>#{}</code>æ¥å—çš„å‚æ•°</p><h4 id="ç´¢å¼•ä¼ å‚"><a href="#ç´¢å¼•ä¼ å‚" class="headerlink" title="ç´¢å¼•ä¼ å‚"></a>ç´¢å¼•ä¼ å‚</h4><p>ä»…é€‚ç”¨äº#<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryStudnet3"</span> <span class="attr">resultType</span>=<span class="string">"java.util.HashMap"</span> &gt;</span></span><br><span class="line">        select count(CLAZZ_ID) as 'id' , CLAZZ_ID from student GROUP by #&#123;arg0&#125; order by #&#123;arg1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>Javaä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Daoå±‚ä»£ç </span></span><br><span class="line">List&lt;Map&lt;String,Object&gt;&gt; queryStudnet3(String clazzId ,String name);</span><br><span class="line"><span class="comment">//å®é™…æ–¹æ³•</span></span><br><span class="line"> List&lt;Map&lt;String,Object&gt;&gt; list =clazz.queryStudnet3(<span class="string">"CLAZZ_ID"</span>,<span class="string">"id"</span>);</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡è¿™ä¸ªæ–¹å¼ä¼ å‚çš„è¯éœ€è¦æ³¨æ„mybatisçš„æç¤ºä½¿ç”¨<code>arg0</code>è¿˜æ˜¯<code>param</code></p><h1 id="å¼‚å¸¸æ±‡æ€»"><a href="#å¼‚å¸¸æ±‡æ€»" class="headerlink" title="å¼‚å¸¸æ±‡æ€»"></a>å¼‚å¸¸æ±‡æ€»</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cause: org.apache.ibatis.executor.ExecutorException: A query was run and no Result Maps were found for the Mapped Statement &apos;study.dao.clazzStudent.queryStudnet2&apos;.  It&apos;s likely that neither a Result Type nor a Result Map was specified</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¡¨ç¤ºè‹¥è¿”å›çš„æ˜¯ä¸€ä¸ªé›†åˆçš„è¯éœ€è¦åˆ¶å®šä¸‹è¿”å›çš„ç±»å‹ã€‚å…¶ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python2.7ä½¿ç”¨Pandasè¿æ¥æ•°æ®åº“</title>
      <link href="/2018/04/11/PPython2-7%E4%BD%BF%E7%94%A8Pandas%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
      <url>/2018/04/11/PPython2-7%E4%BD%BF%E7%94%A8Pandas%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦å°†Excelä¸­çš„ä¸€äº›æ•°æ®å¯¼å…¥åˆ°mysqlä¸­ï¼Œç”±äºä¹‹å‰æ¥è§¦åˆ°äº†Pythonçš„Pandasï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ä¾¿æƒ³åˆ°äº†Pythonï¼Œä½†æ˜¯è¿æ¥æ•°æ®åº“çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼Œæ‰€ä»¥ä¾¿å†™ä¸€ä¸ªæ–‡ç« è®°å½•ä¸‹ã€‚</p><h2 id="è§£å†³åŠæ³•ï¼š"><a href="#è§£å†³åŠæ³•ï¼š" class="headerlink" title="è§£å†³åŠæ³•ï¼š"></a>è§£å†³åŠæ³•ï¼š</h2><ol><li>ä¸‹è½½Mysql_Pythonçš„ä¸€ä¸ªexeæ–‡ä»¶</li><li>æ³¨æ„<code>tosql</code>çš„è¿™ä¸ªæ–¹æ³•ä½¿ç”¨çš„ç±»ã€‚pd.io.sql.to_sql</li><li>æ³¨æ„æ·»åŠ <code>index=False</code>é˜²æ­¢å‡ºç°å‡ºå…¥çš„æ—¶å€™å¤šäº†ä¸€ä¸ªindex</li></ol><h2 id="sqlalchemyæ–¹å¼è¿æ¥"><a href="#sqlalchemyæ–¹å¼è¿æ¥" class="headerlink" title="sqlalchemyæ–¹å¼è¿æ¥"></a>sqlalchemyæ–¹å¼è¿æ¥</h2><h3 id="å¯¼å…¥åº“"><a href="#å¯¼å…¥åº“" class="headerlink" title="å¯¼å…¥åº“"></a>å¯¼å…¥åº“</h3><p>ç”±äºä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯Python2.7.14ï¼Œæ‰€ä»¥åœ¨å®‰è£…<code>MySQLdb</code>çš„æ—¶å€™ä¸€ç›´å‡ºç°é—®é¢˜ï¼Œå¤§æ„å°±æ˜¯è¯´éœ€è¦å‡çº§pipï¼Œä½†æ˜¯pipå·²ç»å‡çº§äº†ã€‚æ‰€ä»¥å»ç½‘ä¸ŠæŸ¥è¯¢è§£å†³åŠæ³•æ˜¯éœ€è¦å®‰è£…ä¸€ä¸ªæ–‡ä»¶<code>Mysql-Pythonã€‚ã€‚ã€‚.exe</code>ä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„ç‰ˆæœ¬ï¼Œå®˜ç½‘ä¸‹è½½çš„æ˜¯win32çš„ï¼Œæ‰€ä»¥å¯¼è‡´ä¸€ç›´è¯†åˆ«ä¸åˆ°Python2.7çš„è·¯å¾„ï¼Œå¯¼è‡´<code>MySQLdb</code>è¿™ä¸ªä¸€ç›´å®‰è£…ä¸ä¸Šã€‚</p><p>å¦å¤–éœ€è¦å¯¼å…¥çš„åº“å°±æ˜¯Pandasäº†</p><h3 id="to-sql"><a href="#to-sql" class="headerlink" title="to_sql()"></a>to_sql()</h3><p>åœ¨æŸ¥çœ‹å®˜ç½‘API(pandas1.6.0ç‰ˆæœ¬)çš„æ—¶å€™ï¼Œå‘ç°æ˜¯pd.to_sql()ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™é‡Œæ˜¯<code>pd.io.sql.to_sql()</code>,å‚æ•°è¿˜æ˜¯ä¸å˜ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ins</span><span class="params">(cls)</span>:</span></span><br><span class="line">    xls = pd.ExcelFile(U<span class="string">'C:\\Users\\SZH\\Desktop\\aaa\\productè¡¨.xlsx'</span>)</span><br><span class="line">    previous_score_csv_file = xls.parse(U<span class="string">'Sheet1'</span>);</span><br><span class="line">    conn = create_engine(<span class="string">'mysql+mysqldb://root:root//@localhost:3306/vendor?charset=utf8'</span>)</span><br><span class="line">    pd.io.sql.to_sql(previous_score_csv_file,<span class="string">"product"</span>,conn,if_exists=<span class="string">'append'</span>,index=<span class="keyword">False</span>)</span><br><span class="line">    <span class="comment"># c.commit()</span></span><br><span class="line">    <span class="keyword">print</span>  previous_score_csv_file</span><br></pre></td></tr></table></figure></p><p>æœ€åä¾¿å¯ä»¥äº†ã€‚</p><h2 id="MySQLdbæ–¹å¼è¿æ¥"><a href="#MySQLdbæ–¹å¼è¿æ¥" class="headerlink" title="MySQLdbæ–¹å¼è¿æ¥"></a>MySQLdbæ–¹å¼è¿æ¥</h2><p>æš‚æ—¶æ‰¾ä¸åˆ°è§£å†³åŠæ³•</p>]]></content>
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mysql </tag>
            
            <tag> pandas </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mybatiså’Œmysqlå¾—ç›¸å…³è®°å½•</title>
      <link href="/2018/04/10/mybatis%E5%92%8Cmysql%E5%BE%97%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/04/10/mybatis%E5%92%8Cmysql%E5%BE%97%E7%9B%B8%E5%85%B3%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆå¯¹äºMybatisæ¥è¯´ï¼Œå¦‚æœæ˜¯ç›´æ¥å¤åˆ¶mysqlé‡Œé¢çš„è¯­å¥ç²˜è´´åˆ°mybatisçš„mapperæ–‡ä»¶é‡Œé¢å»çš„è¯å¾ˆå®¹æ˜“å¯¼è‡´userè¯»å–å‡ºé”™ï¼Œå‡è®¾åœ¨mysqlä¸­<code>select * from user XX</code>ï¼Œè‹¥ç›´æ¥æŠŠè¿™æ¡sqlè¯­å¥å¤åˆ¶åˆ°mapperæ–‡ä»¶ä¸­çš„è¯ä¼šå¯¼è‡´userä¼šæˆä¸ºmapperæ–‡ä»¶ä¸­çš„å…³é”®å­—</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mybatisä¸­å¤šæ¡è¯­å¥æ’å…¥å’Œä¸»é”®è¿”å›</title>
      <link href="/2018/04/09/mybatis%E4%B8%AD%E5%A4%9A%E6%9D%A1%E8%AF%AD%E5%8F%A5%E6%8F%92%E5%85%A5%E5%92%8C%E4%B8%BB%E9%94%AE%E8%BF%94%E5%9B%9E/"/>
      <url>/2018/04/09/mybatis%E4%B8%AD%E5%A4%9A%E6%9D%A1%E8%AF%AD%E5%8F%A5%E6%8F%92%E5%85%A5%E5%92%8C%E4%B8%BB%E9%94%AE%E8%BF%94%E5%9B%9E/</url>
      <content type="html"><![CDATA[<p>åœ¨Mybatisçš„ä½¿ç”¨ä¸­ï¼Œæœ‰æ—¶å€™ä¼šå‡ºç°éœ€è¦ä¸€å¯¹å¤šçš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯åœ¨æ’å…¥çš„è¿‡ç¨‹ä¸­ï¼Œå³å‡è®¾å­˜åœ¨Aï¼ŒBä¸¤è¡¨ã€‚Aè¡¨å¯¹Bè¡¨æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œåœ¨æ’å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­éœ€è¦å…ˆæ’å…¥Aè¡¨ï¼Œé€šè¿‡Aè¡¨è¿”å›çš„ä¸»é”®ç„¶åå†è¿›è¡ŒBè¡¨çš„æŸ¥è¯¢ï¼Œè¿™ä¸ªæ—¶å€™ä¸€èˆ¬æœ‰ä¸¤ç§æ“ä½œã€‚</p><blockquote><p>æ–¹æ³•ä¸€ï¼šé¦–å…ˆè·å–Aè¡¨çš„ä¸»é”®ï¼Œç„¶åé€šè¿‡forå¾ªç¯è¿›è¡ŒBè¡¨çš„æ’å…¥<br>æ–¹æ³•äºŒï¼šä½¿ç”¨mybatisçš„<code>foreach</code>è¿›è¡Œå¤šæ¡è¯­å¥çš„æ’å…¥</p></blockquote><p>åœ¨è¿™é‡Œçš„è¯ä¸»è¦æ˜¯è®°å½•ä¸‹ç¬¬äºŒç§æ–¹æ³•ï¼Œå³é€šè¿‡mybatisçš„<code>foreach</code>æ¥å®ç°å¤šæ¡è¯­å¥çš„æ’å…¥:</p><h2 id="å»ºç«‹æ•°æ®åº“è¡¨"><a href="#å»ºç«‹æ•°æ®åº“è¡¨" class="headerlink" title="å»ºç«‹æ•°æ®åº“è¡¨"></a>å»ºç«‹æ•°æ®åº“è¡¨</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from clazz;</span><br><span class="line">+----------+------------+</span><br><span class="line">| CLAZZ_ID | CLAZZ_NAME |</span><br><span class="line">+----------+------------+</span><br><span class="line">|        1 | ä¸€å¹´çº§     |</span><br><span class="line">+----------+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from student;</span><br><span class="line">+----------+--------+----------+</span><br><span class="line">| CLAZZ_ID | STU_ID | STU_NAME |</span><br><span class="line">+----------+--------+----------+</span><br><span class="line">|        1 |    101 | a        |</span><br><span class="line">|        1 |    102 | b        |</span><br><span class="line">+----------+--------+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>åœ¨æ•°æ®åº“å»ºç«‹çš„ä¸¤å¼ è¡¨ä¼šå‘ç°ç­çº§è¡¨å’Œå­¦ç”Ÿè¡¨æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ­¤æ—¶å¦‚æœä¸€ä¸ªç­çº§éœ€è¦æ’å…¥è®¸å¤šä¸ªå­¦ç”Ÿçš„è¯ï¼Œæ­¤æ—¶å°±è¦ä½¿ç”¨mybatisçš„<code>foreach</code>è¿›è¡Œå¤šæ¡è¯­å¥çš„æ’å…¥äº†</p><h2 id="å ä½ç¬¦"><a href="#å ä½ç¬¦" class="headerlink" title="å ä½ç¬¦"></a>å ä½ç¬¦</h2><p>åœ¨è¿™é‡Œå¾—è¯éœ€è¦æ’å…¥å¤šæ¡è¯­å¥å¾—æ—¶å€™ä¸èƒ½ä½¿ç”¨<code>#</code>ï¼Œè€Œæ˜¯åº”è¯¥ä½¿ç”¨<code>$</code>ã€‚åœ¨è¿™é‡Œä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªç¾å…ƒçš„ç¬¦å·ï¼Œæš‚æ—¶å¾—çŒœæµ‹æ˜¯<code>$</code>è§£æå¾—ä¸ºé™æ€å¾—ï¼Œä¹Ÿå°±æ˜¯è¯´mybatisä¼šè®²é›†åˆé‡Œé¢çš„å€¼ç›´æ¥å¡«å……è¿›æ¥ï¼Œç±»ä¼¼äºåœ¨ApplicationContext.xmlä¸­åŠ¨æ€çš„åŠ è½½<code>jdbc.properties</code>ï¼Œéœ€è¦ä½¿ç”¨<code>$</code>ç¬¦å·ã€‚<br>æ–°å»ºDaoå±‚ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">clazzStudent</span> </span>&#123;</span><br><span class="line">    <span class="function">Integer <span class="title">insertToStudent</span><span class="params">(List&lt;Map&lt;String,Object&gt;&gt; map)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶åå»ºç«‹ä¸ä¹‹å¯¹åº”çš„mapperæ–‡ä»¶ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertToStudent"</span> &gt;</span></span><br><span class="line">        insert into student(CLAZZ_ID,STU_ID,STU_NAME) values </span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span>  <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            ($&#123;item.get("clazz")&#125;,$&#123;item.get("stu")&#125;,$&#123;item.get("name")&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æœ€åå»ºç«‹æµ‹è¯•ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Logger logger = <span class="keyword">null</span>;</span><br><span class="line">        logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">        logger.setLevel(Level.DEBUG);</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">            clazzStudent clazz = sqlSession.getMapper(clazzStudent.class);</span><br><span class="line">            List&lt;Map&lt;String,Object&gt;&gt; list =<span class="keyword">new</span> ArrayList&lt;Map&lt;String, Object&gt;&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">                Map&lt;String,Object&gt; itemmap =<span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">                itemmap.put(<span class="string">"clazz"</span>,<span class="number">1</span>);</span><br><span class="line">                itemmap.put(<span class="string">"stu"</span>,i);</span><br><span class="line">                itemmap.put(<span class="string">"name"</span>,<span class="string">"'adsads'"</span>);</span><br><span class="line">                list.add(itemmap);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> n=clazz.insertToStudent(list);</span><br><span class="line">            System.out.println(n);</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„å¾—æ˜¯<code>&lt;foreach collection=&quot;list&quot; item=&quot;item&quot;  index=&quot;index&quot; separator=&quot;,&quot;&gt;</code>åœ¨è¿™ä¸ªé‡Œé¢çš„è¯<code>collection=&quot;list&quot;</code>è¿™é‡Œçš„listå…¶å®ä¸éœ€è¦å’Œmainæ–¹æ³•ä¸­å¾—liståç§°å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨Javaå¾—mainæ–¹æ³•ä¸­å°†<code>List&lt;Map&lt;String,Object&gt;&gt; list =new ArrayList&lt;Map&lt;String, Object&gt;&gt;()</code>è¿™ä¸ªlistæ”¹æˆlist1ä¹Ÿå¯ä»¥æ’å…¥å¤šæ¡è¯­å¥ï¼Œè¿™é‡Œå‚æ•°<code>list</code>ä¸<code>collection</code>ä¸­å¾—åç§°æ— å…³ã€‚</p><h3 id="separator"><a href="#separator" class="headerlink" title="separator"></a>separator</h3><p>åˆ†éš”ç¬¦ï¼Œä½œç”¨æ˜¯foreachä¸‹é¢çš„è¯­å¥æ‰§è¡Œå®Œäº†ä¹‹åä¹‹åç”¨ä»€ä¹ˆè¿›è¡Œåˆ†å‰²ã€‚è€Œ<code>item</code>åˆ™ä»£è¡¨å¾—æ˜¯é‡Œé¢å¾—é‚£ä¸ªmapï¼Œ</p><h3 id="index"><a href="#index" class="headerlink" title="index"></a>index</h3><p>indexä»£è¡¨çš„æ˜¯ç´¢å¼•ï¼Œç›®å‰æš‚æ—¶æ²¡ç”¨åˆ°ï¼Œæ‰€ä»¥å°±å†™ä¸€ä¸ªç´¢å¼•</p><h2 id="åˆ©ç”¨Javaå¯¹è±¡è¿›è¡Œè¿­ä»£"><a href="#åˆ©ç”¨Javaå¯¹è±¡è¿›è¡Œè¿­ä»£" class="headerlink" title="åˆ©ç”¨Javaå¯¹è±¡è¿›è¡Œè¿­ä»£"></a>åˆ©ç”¨Javaå¯¹è±¡è¿›è¡Œè¿­ä»£</h2><p>ä¿®æ”¹ä»£ç ä¹‹åä¹Ÿå¯ä»¥åˆ©ç”¨Javaå¯¹è±¡è¿›è¡Œä¼ å‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Logger logger = <span class="keyword">null</span>;</span><br><span class="line">      logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">      logger.setLevel(Level.DEBUG);</span><br><span class="line">      SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">          clazzStudent clazz = sqlSession.getMapper(clazzStudent.class);</span><br><span class="line">          List&lt;Student&gt; list1 =<span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">          <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">           Student student =<span class="keyword">new</span> Student();</span><br><span class="line">           student.setCLAZZ_ID(<span class="number">1</span>);</span><br><span class="line">           student.setSTU_ID(i);</span><br><span class="line">           student.setSTU_NAME(<span class="string">"æµ‹è¯•"</span>);</span><br><span class="line">           list1.add(student);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">int</span> n=clazz.insertToStudentPojo(list1);</span><br><span class="line">          System.out.println(n);</span><br><span class="line">          sqlSession.commit();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          sqlSession.close();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯ä½¿ç”¨å¯¹è±¡ä¼ å‚çš„è¯éœ€è¦æ³¨æ„å¾—æ˜¯åœ¨mapperæ–‡ä»¶ä¸­ä½¿ç”¨<code>#</code>ç¬¦å·ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertToStudentPojo"</span>&gt;</span></span><br><span class="line">        insert into student(CLAZZ_ID,STU_ID,STU_NAME) values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span>  <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            (#&#123;item.CLAZZ_ID&#125;,#&#123;item.STU_ID&#125;,#&#123;item.STU_NAME&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h2 id="ç”¨Listä¼ å€¼ï¼š"><a href="#ç”¨Listä¼ å€¼ï¼š" class="headerlink" title="ç”¨Listä¼ å€¼ï¼š"></a>ç”¨Listä¼ å€¼ï¼š</h2><p>æ–°å»ºDaoå±‚æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Integer <span class="title">insertToStudentList</span><span class="params">(List&lt;String&gt; list)</span></span>;</span><br></pre></td></tr></table></figure></p><p>æ–°å»ºmapperæ–¹æ³•ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertToStudentList"</span>&gt;</span></span><br><span class="line">       insert into student(STU_NAME) values</span><br><span class="line">       <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span>  <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">           ($&#123;item&#125;)</span><br><span class="line">       <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>æµ‹è¯•æ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">insertList</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Logger logger = <span class="keyword">null</span>;</span><br><span class="line">        logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">        logger.setLevel(Level.DEBUG);</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">            clazzStudent clazz = sqlSession.getMapper(clazzStudent.class);</span><br><span class="line">            List&lt;String&gt; list1 =<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">             list1.add(String.valueOf(i));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> n=clazz.insertToStudentList(list1);</span><br><span class="line">            System.out.println(n);</span><br><span class="line">            sqlSession.commit();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><p>åœ¨è¿™é‡Œéœ€è¦å¯¹Javaå¯¹è±¡ä¼ å‚ä½¿ç”¨å¾—<code>#</code>å’Œmapä¼ å‚å¾—<code>$</code>è¿›è¡Œä¸€ä¸‹åŒºåˆ†ã€‚å¯ä»¥çœ‹ä¸‹æ‰“å°æ—¥å¿—ï¼š<br>javaå¯¹è±¡ä¼ å‚ä½¿ç”¨<code>#</code>ä¼ å‚å¾—æ—¥å¿—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: insert into student(CLAZZ_ID,STU_ID,STU_NAME) values (?,?,?) , (?,?,?) , (?,?,?) </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: 1(Integer), 0(Integer), æµ‹è¯•(String), 1(Integer), 1(Integer), æµ‹è¯•(String), 1(Integer), 2(Integer), æµ‹è¯•(String)</span><br><span class="line">DEBUG [main] - &lt;==    Updates: 3</span><br></pre></td></tr></table></figure></p><p>javaä½¿ç”¨List<map>è¿›è¡Œä¼ å‚:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: insert into student(CLAZZ_ID,STU_ID,STU_NAME) values (1,0,&apos;adsads&apos;) , (1,1,&apos;adsads&apos;) , (1,2,&apos;adsads&apos;) </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==    Updates: 3</span><br><span class="line">3</span><br></pre></td></tr></table></figure></map></p><p>å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºæ¥çš„æ—¥å¿—å‘ç°<code>$</code>å’Œ<code>#</code>åœ¨è§£æä¸Šå¾—åŒºåˆ«ï¼Œ<code>$</code>è¿™ä¸ªæ˜¯å…ˆè§£æï¼Œç”Ÿæˆäº†ä¸€ä¸ªsqlä¹‹åå†æ‰§è¡Œï¼Œè€Œ<code>#</code>åˆ™æ˜¯ä¸€ä¸ªå ä½ç¬¦ï¼Œæ˜¯åœ¨åæœŸçš„æ—¶å€™åŠ¨æ€åŠ å…¥çš„ã€‚</p><h2 id="ä¸»é”®è¿”å›"><a href="#ä¸»é”®è¿”å›" class="headerlink" title="ä¸»é”®è¿”å›"></a>ä¸»é”®è¿”å›</h2><p>mybatisçš„ä¸»é”®è¿”å›ç›®å‰ä»…ä»…äº†è§£é€šè¿‡å¯¹è±¡æ¥è¿”å›ã€‚éœ€è¦åœ¨mapperæ–‡ä»¶ä¸­åŠ å…¥ä¸€è¡Œé…ç½®å³å¯ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertToStudentPojo"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"CLAZZ_ID"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span> <span class="attr">resultType</span>=<span class="string">"java.lang.Integer"</span>&gt;</span></span><br><span class="line">            select LAST_INSERT_ID()</span><br><span class="line">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">        insert into student(CLAZZ_ID,STU_ID,STU_NAME) values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"item"</span>  <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">separator</span>=<span class="string">","</span>&gt;</span></span><br><span class="line">            (#&#123;item.CLAZZ_ID&#125;,#&#123;item.STU_ID&#125;,#&#123;item.STU_NAME&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p><code>keyProperty=&quot;CLAZZ_ID&quot;</code>è¡¨ç¤ºçš„æ˜¯éœ€è¦è¿”å›çš„å­—æ®µçš„å€¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">pojo</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Logger logger = <span class="keyword">null</span>;</span><br><span class="line">       logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">       logger.setLevel(Level.DEBUG);</span><br><span class="line">       SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">           clazzStudent clazz = sqlSession.getMapper(clazzStudent.class);</span><br><span class="line">           List&lt;Student&gt; list1 =<span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">           <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            Student student =<span class="keyword">new</span> Student();</span><br><span class="line">            student.setCLAZZ_ID(<span class="number">1</span>);</span><br><span class="line">            student.setSTU_ID(i);</span><br><span class="line">            student.setSTU_NAME(<span class="string">"æµ‹è¯•"</span>);</span><br><span class="line">            list1.add(student);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">int</span> n=clazz.insertToStudentPojo(list1);</span><br><span class="line">           System.out.println(list1.get(<span class="number">2</span>).getCLAZZ_ID());</span><br><span class="line">           System.out.println(n);</span><br><span class="line">           sqlSession.commit();</span><br><span class="line">       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">           sqlSession.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>éœ€è¦æ³¨æ„çš„æ˜¯<code>System.out.println(list1.get(2).getCLAZZ_ID());</code>å› ä¸ºæ˜¯å¤šæ¡è¯­å¥çš„æ’å…¥ï¼Œè‚¯å®šæ˜¯éœ€è¦è¿”å›çš„æœ€åä¸€æ¡æ’å…¥åçš„ä¸»é”®ï¼Œæ‰€ä»¥é€šè¿‡è¯¥æ–¹æ³•ä¾¿å¯ä»¥å¾—åˆ°æ’å…¥åçš„ä¸»é”®</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç›®å‰å°±æš‚æ—¶è¿™ä¹ˆå¤šäº†ï¼Œæºç ä»¥åå†äº†è§£äº†ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>gitä»£ç åŒæ­¥ä¹‹é—´çš„å†²çª</title>
      <link href="/2018/04/08/git%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5%E4%B9%8B%E9%97%B4%E7%9A%84%E5%86%B2%E7%AA%81/"/>
      <url>/2018/04/08/git%E4%BB%A3%E7%A0%81%E5%90%8C%E6%AD%A5%E4%B9%8B%E9%97%B4%E7%9A%84%E5%86%B2%E7%AA%81/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨gitçš„æ—¶å€™å•ç‹¬ä¸€äººè¿›è¡Œ<code>push</code>å’Œ<code>pull</code>çš„æ—¶å€™æ˜¯ä¸ä¼šå‡ºç°ä»£ç å†²çªçš„ï¼Œä½†æ˜¯å½“å›¢é˜Ÿä¸­æœ‰å¤šäººçš„æ—¶å€™è¿›è¡Œåä½œçš„æ—¶å€™éš¾å…ä¼šé€ æˆä»£ç é—´åŒæ­¥é—®é¢˜ã€‚<br>å…·ä½“å°±æ˜¯git pullçš„æ—¶å€™ä¼šæç¤ºçº¿ä¸Šä»£ç ä¼šè¦†ç›–æœ¬åœ°çš„ä»£ç ã€‚ç„¶åå°±ä¸è®©pullï¼Œæœ€åä¹Ÿä¸è®©pushã€‚æŸ¥è¯¢äº†ä¸‹è§£å†³åŠæ³•ï¼š</p><h2 id="æ–¹æ³•ä¸€ï¼š"><a href="#æ–¹æ³•ä¸€ï¼š" class="headerlink" title="æ–¹æ³•ä¸€ï¼š"></a>æ–¹æ³•ä¸€ï¼š</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git stash</span><br><span class="line">git pull </span><br><span class="line">git stash pop</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹æ³•pullä¸‹æ¥çš„ä»£ç ä¼šå¯¼è‡´IDEAè¯†åˆ«ä¸äº†ã€‚ä¹Ÿå°±æ˜¯javaæ–‡ä»¶ä¼šç›´æ¥ä¸æ˜¾ç¤ºï¼Œæœ€åæ˜¯å…³é—­IDEAç„¶åå†æ¬¡æ‰“å¼€æ‰è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚é‡æ–°å¯¼å…¥çš„æ—¶å€™é€‰æ‹©maven</p><h2 id="æ–¹æ³•äºŒï¼š"><a href="#æ–¹æ³•äºŒï¼š" class="headerlink" title="æ–¹æ³•äºŒï¼š"></a>æ–¹æ³•äºŒï¼š</h2><p>è¿™ä¸ªæ–¹æ³•ä¸»è¦åº”å¯¹çš„æ˜¯pushæäº¤ä¸ä¸Šå»ï¼Œä½†æ˜¯pullå´åˆæ˜¾ç¤ºæ˜¯çº¿ä¸Šæœ€æ–°ç‰ˆæœ¬<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> Git </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å¯¹Javaçš„Listè½¬Arrayçš„æºç ä¸€ç‚¹æ€è€ƒ</title>
      <link href="/2018/04/07/%E5%AF%B9Java%E7%9A%84List%E8%BD%ACArray%E7%9A%84%E6%BA%90%E7%A0%81%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/"/>
      <url>/2018/04/07/%E5%AF%B9Java%E7%9A%84List%E8%BD%ACArray%E7%9A%84%E6%BA%90%E7%A0%81%E4%B8%80%E7%82%B9%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<p>åœ¨Javaé‡Œé¢ï¼ŒListè½¬ä¸ºArrayæ˜¯è°ƒç”¨çš„Javaçš„ä¸€ä¸ªArrays.copyOf()è¿™ä¸ªæ–¹æ³•ï¼ŒæŸ¥çœ‹äº†ä¸‹æºä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object[] toArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> Arrays.copyOf(<span class="keyword">this</span>.elementData, <span class="keyword">this</span>.size);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T[] copyOf(T[] original, <span class="keyword">int</span> newLength) &#123;</span><br><span class="line">        <span class="keyword">return</span> (T[]) copyOf(original, newLength, original.getClass());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class="keyword">int</span> newLength, Class&lt;? extends T[]&gt; newType) &#123;</span><br><span class="line">        <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">        T[] copy = ((Object)newType == (Object)Object[].class)</span><br><span class="line">            ? (T[]) <span class="keyword">new</span> Object[newLength]</span><br><span class="line">            : (T[]) Array.newInstance(newType.getComponentType(), newLength);</span><br><span class="line">        System.arraycopy(original, <span class="number">0</span>, copy, <span class="number">0</span>,</span><br><span class="line">                         Math.min(original.length, newLength));</span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Object <span class="title">newInstance</span><span class="params">(Class&lt;?&gt; componentType, <span class="keyword">int</span> length)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> NegativeArraySizeException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> newArray(componentType, length);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨copyOf()æ–¹æ³•ä¸­çš„é‚£ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™é‡Œæ— è®ºæ‰§è¡Œçš„trueè¿˜æ˜¯falseï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ã€‚è€Œåœ¨è¿™é‡Œæœ‰ä¸€è¡Œä»£ç å°±æ˜¯<code>((Object)newType == (Object)Object[]).class)ï¼Œè¿™ä¸€å¥çœ‹èµ·æ¥æ²¡ä»€ä¹ˆï¼Œå…¶å®å¯ä»¥çœ‹å‚æ•°</code>Class&lt;? extends T[]&gt; newType<code>å’Œ</code>Object<code>ä¼šå‘ç°è¿™ä¸¤ä¸ªæ•°ç»„å¯¹è±¡éƒ½è¢«å¼ºè½¬æˆäº†</code>Object<code>ï¼Œè€Œ</code>==`æ¯”è¾ƒç¬¦æ˜¯ä¸èƒ½æ¯”è¾ƒä¸åŒç±»å‹çš„ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">te</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ad"</span> == <span class="number">2</span>);</span><br><span class="line">        System.out.println((String.class == Object.class));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢çš„ä»£ç åœ¨ä»£ç çš„ç¼–è¯‘æœŸå°±ä¼šè¢«æç¤º<code>==</code>ä¸å¯ä»¥é€‚ç”¨äºä¸Šè¿°çš„ä¸¤ç§æƒ…å†µ.å¦‚ä¸‹ï¼š<br><img src="ä¸å¯è½¬æˆªå›¾.png" alt=""></p><p>é‚£ä¹ˆå›åˆ°æ­£é¢˜ï¼Œè¿™é‡Œå…¶å®ä»”ç»†çœ‹å°±ä¼šå‘ç°æ— è®ºæ˜¯å¦ç›¸ç­‰ï¼Œåœ¨è¿™é‡Œä¸‰å…ƒè¡¨è¾¾å¼ä¸­ï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨è¿™é‡ŒåŠ å…¥äº†ä¸‰å…ƒè¡¨è¾¾å¼çš„æƒ³æ³•æ˜¯<code>newInstance()</code>æ˜¯é€šè¿‡åå°„è¿›è¡Œåˆ›å»ºçš„ï¼Œè€Œ<code>new Object[]</code>åˆ™æ˜¯éåå°„åˆ›å»ºçš„.</p><blockquote><p>Because reflection involves types that are dynamically resolved, certain Java virtual machine optimizations can not be performed. Consequently, reflective operations have slower performance than their non-reflective counterparts, and should be avoided in sections of code which are called frequently in performance-sensitive applications.</p></blockquote><p>æ‰€ä»¥åœ¨è¿™é‡ŒåŠ ä¸€ä¸ªåˆ¤æ–­ä½¿ä»£ç å°½é‡é€šè¿‡éåå°„çš„æ–¹å¼è¿›è¡Œåˆ›å»ºã€‚æœ€åè°ƒç”¨<code>System.arraycopy()</code>,ä½†æ˜¯è¿™é‡Œçš„éƒ½å·²ç»å¼ºè½¬æˆäº†Objectï¼Œåº”è¯¥ä¸ä¼šæœ‰å¤±è´¥çš„æƒ…å†µ</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åˆè¯†7å±‚æ¨¡å‹å’Œ5å±‚æ¨¡å‹</title>
      <link href="/2018/04/06/%E5%88%9D%E8%AF%867%E5%B1%82%E6%A8%A1%E5%9E%8B/"/>
      <url>/2018/04/06/%E5%88%9D%E8%AF%867%E5%B1%82%E6%A8%A1%E5%9E%8B/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©çªç„¶æƒ³çŸ¥é“åœ¨è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æ—¶å€™é‚£äº›è¯·æ±‚å¤´æ˜¯åœ¨ä½•æ—¶è¢«åŠ ä¸Šå»çš„ã€‚ä¾‹å¦‚è®¿é—®ç™¾åº¦çš„æ—¶å€™ï¼Œ<code>host</code>å’Œ<code>refer</code>æˆ–è€…å…¶ä»–çš„å­—æ®µæ˜¯åœ¨ä¸ƒå±‚æ¨¡å‹çš„å“ªä¸€å±‚è¢«åŠ å…¥çš„ã€‚</p><h2 id="WireaharkæŠ“åŒ…"><a href="#WireaharkæŠ“åŒ…" class="headerlink" title="WireaharkæŠ“åŒ…"></a>WireaharkæŠ“åŒ…</h2><p>åœ¨è¿™é‡Œå°è¯•äº†ä¸‹ç™¾åº¦çš„æŠ“åŒ…ï¼Œä½†æ˜¯ç™¾åº¦çš„æ˜¯æ˜¯HTTPSçš„è¿æ¥ï¼Œå¯¼è‡´ä¸€ç›´æ‰¾ä¸åˆ°é‚£ä¸ªHTTPè¿æ¥ï¼Œæ‰€ä»¥è¿˜æ˜¯æ”¾å¼ƒäº†ï¼Œä½†æ˜¯éšååˆæ‰¾äº†ä¸€ä¸ªéHTTPSçš„ç½‘ç«™ï¼Œè¿›è¡ŒæŠ“åŒ…ï¼Œç„¶åæµ‹è¯•äº†ä¸‹ï¼Œå‘ç°å¯ä»¥</p><h2 id="è§£ææŠ“åŒ…"><a href="#è§£ææŠ“åŒ…" class="headerlink" title="è§£ææŠ“åŒ…"></a>è§£ææŠ“åŒ…</h2><p>è¿™æ˜¯ç”¨wiresharkæŠ“å–çš„ç»“æœï¼š<br><img src="è¶…æ–‡æœ¬ä¼ è¾“åè®®.PNG" alt=""><br><img src="åè®®è¯¦æƒ….PNG" alt=""><br>å´å‘ç°è¿™é‡Œå¤šäº†ä¸€ä¸ª<code>Hypertext Transfer Protocol</code>ï¼Œåœ¨è¿™é‡Œçš„è¯å› ä¸ºæ˜¯GETè¯·æ±‚ï¼Œæ‰€ä»¥å‡†å¤‡ç”¨POSTè¯·æ±‚å†æ¬¡å°è¯•ï¼š<br><img src="http.PNG" alt=""><br>å‘ç°å…¶å®å†…å®¹éƒ½å·®ä¸å¤šï¼Œé‚£ä¹Ÿå°±è¯æ˜äº†è¿™äº›è¯·æ±‚å¤´éƒ½æ˜¯åœ¨åº”ç”¨å±‚è¢«æ·»åŠ è¿›å»çš„ã€‚<br>é‚£ä¹ˆåœ¨è¿™äº›æŠ“åŒ…ä¸­å¯ä»¥çœ‹åˆ°ä»–çš„å±‚æ¬¡æ˜¯5å±‚ï¼Œè€Œå¹¶éæ˜¯7å±‚æ¨¡å‹ã€‚åœ¨è¿™é‡Œçš„çš„äº”å±‚æ¨¡å‹åˆ†åˆ«æ˜¯<code>ç‰©ç†å±‚</code>,<code>æ•°æ®è¿ç»­å±‚</code>,<code>ç½‘ç»œå±‚</code>,<code>ä¼ è¾“å±‚</code>,<code>åº”ç”¨å±‚</code>ã€‚ç›¸è¾ƒäº7å±‚çš„OSIæ¨¡å‹å°‘äº†<code>ä¼šè¯å±‚</code>å’Œ<code>è¡¨ç¤ºå±‚</code>ã€‚</p><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><p>å…¶å®ä¸ä»£ç æ‰“äº¤é“çš„é‚£ä¸€å±‚æ˜¯åº”ç”¨å±‚ã€‚å¯ä»¥å‘ç°åœ¨Javaä»£ç ä¸­å¯ä»¥é€šè¿‡Response.setXXXæ¥è®¾ç½®è¯·æ±‚å¤´æˆ–è€…å›å¤å¤´ç­‰ã€‚è¿™ä¹Ÿå°±ä»æ—è¾¹æ¥è¯æ˜äº†æˆ‘ä»¬æ‰€ç¼–å†™çš„ç¨‹åºå…¶å®éƒ½æ˜¯åœ¨åº”ç”¨å±‚ã€‚</p>]]></content>
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Springé€šè¿‡åºåˆ—åŒ–è¿”å›jsonæ•°æ®</title>
      <link href="/2018/04/05/Spring%E9%80%9A%E8%BF%87%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%94%E5%9B%9Ejson%E6%95%B0%E6%8D%AE/"/>
      <url>/2018/04/05/Spring%E9%80%9A%E8%BF%87%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%94%E5%9B%9Ejson%E6%95%B0%E6%8D%AE/</url>
      <content type="html"><![CDATA[<p>ä¸€èˆ¬æ¥è®²åœ¨Springä¸­å¯ä»¥ç›´æ¥åŠ @ResponeBodyæ¥ç›´æ¥è¿”å›Jsonæ ¼å¼çš„æ•°æ®ï¼Œä½†æ˜¯è¿™æ ·åˆæœ‰ç‚¹åˆ«æ‰­ï¼Œå› ä¸ºStirngåŒæ—¶ä¹Ÿå¯ä»¥è¿”å›è§†å›¾åç§°ï¼Œä½†æ˜¯åŠ äº†@ResponseBodyä¹‹åä¾¿å¯ä»¥è¿”å›Jsonäº†ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è¿˜æœ‰ä¸€ç§è§£å†³åŠæ³•å°±æ˜¯æŒ‡å®šä¸€ä¸ªResultæ¥å®ç°åºåˆ—åŒ–æ¥å£ç„¶åç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œæœ€ååœ¨spring-mvc.xmlè¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­é…ç½®è§£æå™¨å°±å¯ä»¥äº†ã€‚</p><h2 id="æ·»åŠ ä¾èµ–ï¼š"><a href="#æ·»åŠ ä¾èµ–ï¼š" class="headerlink" title="æ·»åŠ ä¾èµ–ï¼š"></a>æ·»åŠ ä¾èµ–ï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="é…ç½®spring-mvc-xmlä¾èµ–ï¼š"><a href="#é…ç½®spring-mvc-xmlä¾èµ–ï¼š" class="headerlink" title="é…ç½®spring-mvc.xmlä¾èµ–ï¼š"></a>é…ç½®spring-mvc.xmlä¾èµ–ï¼š</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.StringHttpMessageConverter"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.http.converter.json.MappingJackson2HttpMessageConverter"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">mvc:message-converters</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mvc:annotation-driven</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç¼–å†™å®ä½“ç±»ï¼š"><a href="#ç¼–å†™å®ä½“ç±»ï¼š" class="headerlink" title="ç¼–å†™å®ä½“ç±»ï¼š"></a>ç¼–å†™å®ä½“ç±»ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonResult</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; result;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JsonResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        code =<span class="number">200</span>;</span><br><span class="line">        result =<span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParamter</span><span class="params">(String key ,String value)</span></span>&#123;</span><br><span class="line">        result.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹çš„æ˜¯å¦‚æœåˆ°æ—¶å€™éœ€è¦è¿”å›å¯¹è±¡çš„æ—¶å€™è‡ªåŠ¨è§£æè¿™ä¸ªç±»éœ€è¦æ·»åŠ getæ–¹æ³•å¹¶ä¸”å®ç°åºåˆ—åŒ–æ¥å£ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"jsonresult"</span>)</span><br><span class="line">  <span class="meta">@ResponseBody</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> JsonResult <span class="title">testJsonResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">      JsonResult jsonResult =<span class="keyword">new</span> JsonResult();</span><br><span class="line">      jsonResult.setParamter(<span class="string">"msg"</span>,<span class="string">"è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çš„demo"</span>);</span><br><span class="line">      <span class="keyword">return</span> jsonResult;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h2 id="æµ‹è¯•ç»“æœï¼š"><a href="#æµ‹è¯•ç»“æœï¼š" class="headerlink" title="æµ‹è¯•ç»“æœï¼š"></a>æµ‹è¯•ç»“æœï¼š</h2><p><img src="åºåˆ—åŒ–.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>javaæ³›å‹çš„ä¸€äº›æ€è€ƒ</title>
      <link href="/2018/04/04/java%E6%B3%9B%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
      <url>/2018/04/04/java%E6%B3%9B%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹"></a>ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹</h2><p>åœ¨Javaä¸­å…¶å®Objectè¿™ä¸ªç±»å·²ç»å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„æ³›å‹é—®é¢˜äº†ï¼Œé‚£ä¹ˆç°åœ¨ä¸ºä»€ä¹ˆè¿˜éœ€è¦æ³›å‹äº†ï¼Œä¸€ç§è¯´æ³•æ˜¯ä¸ºäº†å®‰å…¨ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æœŸä½¿ç”¨æ³›å‹çš„è¯ä¾¿å¯ä»¥åŸºæœ¬ç¡®å®šè¿™ä¸ªå‚æ•°çš„ç±»å‹äº†ï¼Œä½†æ˜¯ä½¿ç”¨Objectçš„è¯ï¼Œç”±äºObjectæ˜¯æ‰€æœ‰ç±»å‹çš„è¶…ç±»ï¼Œæ‰€ä»¥è¿™ä¼šç»™ä»£ç é€ æˆä¸€å®šçš„å®‰å…¨æ€§é—®é¢˜ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">(T t)</span></span>&#123;</span><br><span class="line">        List&lt;Object&gt; list =<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        List&lt;T&gt; list1 =<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="string">"1"</span>);</span><br><span class="line">        list.add(t);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>list1</code>ç”±äºå…¶ç±»å‹æ˜¯Tï¼Œè¿™å°±ä¼šå¯¼è‡´åœ¨å‘<code>list1</code>ä¸­æ’å…¥æ•°æ®çš„æ—¶å€™åªèƒ½æ˜¯æ³›å‹Tï¼Œä½†æ˜¯å¯¹äº<code>list</code>è€Œè¨€ï¼Œç”±äºObjectæ˜¯æ‰€æœ‰ç±»çš„è¶…ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªlistå°±å¯ä»¥æ’å…¥ä»»ä½•å€¼äº†ï¼Œæ‰€ä»¥è¿™å°±å¯¼è‡´äº†ä¸€äº›å®‰å…¨é—®é¢˜</p><h2 id="å…³äºJavaçš„åå˜å’Œé€†å˜ï¼š"><a href="#å…³äºJavaçš„åå˜å’Œé€†å˜ï¼š" class="headerlink" title="å…³äºJavaçš„åå˜å’Œé€†å˜ï¼š"></a>å…³äºJavaçš„åå˜å’Œé€†å˜ï¼š</h2><p>åœ¨Javaé‡Œé¢æ•°ç»„æ˜¯åå˜çš„ã€‚å¯¹äºæ•°ç»„æ¥è®²ä¸€ä¸ªObjectæ•°ç»„æ˜¯å¯ä»¥å­˜æ”¾ä»»ä½•å€¼ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object[] o =<span class="keyword">new</span> Object[<span class="number">12</span>];</span><br><span class="line">o[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">o[<span class="number">1</span>]=<span class="string">"1"</span>;</span><br></pre></td></tr></table></figure></p><p>è€Œå¯¹äºé›†åˆæ¥è¯´å‘¢ï¼Ÿæ˜¾ç„¶ä¸€ä¸ªListè‚¯å®šæ˜¯ä¸å…è®¸åŒæ—¶å­˜æ”¾<code>int</code>å’Œ<code>String</code>,æ‰€ä»¥å¯¹äºé›†åˆæ¥è®²å¾—è¯ï¼Œå®ƒå°±ä¸æ˜¯åå˜å¾—ã€‚<br>è¿™æ˜¯å› ä¸ºé›†åˆåœ¨è¿è¡Œå¾—æ—¶å€™æœ‰ä¸€ä¸ªç±»å‹æ“¦é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´<code>List&lt;String&gt;</code>æœ€ååœ¨ç¼–è¯‘å™¨çœ‹æ¥å°±æ˜¯ä¸€ä¸ªListï¼Œä¹Ÿå°±æ˜¯å®ƒçš„åŸç”Ÿç±»å‹ã€‚æ‰€ä»¥å¯¹äºé›†åˆæ¥è®²å¾—è¯å°±æ˜¯ä¸€ä¸ªé€†å˜å¾—ã€‚</p><h2 id="æ³›å‹å¾—ç”¨å¤„"><a href="#æ³›å‹å¾—ç”¨å¤„" class="headerlink" title="æ³›å‹å¾—ç”¨å¤„"></a>æ³›å‹å¾—ç”¨å¤„</h2><p>æ³›å‹æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ–è€…è¯´æ³›å‹å¾—ä¼˜ç¼ºç‚¹åœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>æ³›å‹ç”±äºåœ¨ç¼–è¯‘æœŸå¹¶ä¸çŸ¥é“ä»–ä¼šæ˜¯ä»€ä¹ˆç±»ï¼Œæ‰€ä»¥æ³›å‹åœ¨æ„é€ å¾—æ—¶å€™æ˜¯ä¸€ä¸ªéå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œç±»ä¼¼äºå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T t1 =<span class="keyword">new</span> T();</span><br></pre></td></tr></table></figure></p><p>è¿™è¡Œä»£ç æ˜æ˜¾æ˜¯é”™è¯¯å¾—ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºTåœ¨ç¼–è¯‘æœŸé—´å¹¶ä¸çŸ¥é“è¿™ä¸ªæ˜¯ä»€ä¹ˆç±»ï¼Œæ—¢ç„¶éƒ½ä¸çŸ¥é“è¿™ä¸ªæ˜¯ä»€ä¹ˆç±»ï¼Œé‚£ä¹ˆåˆæ€ä¼šçŸ¥é“è°ƒç”¨å“ªä¸€ä¸ªæ„é€ å‡½æ•°å‘¢ï¼Ÿ</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºå­—ç¬¦ä¸²å›æ–‡çš„Manacherç®—æ³•</title>
      <link href="/2018/04/04/%E5%85%B3%E4%BA%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9B%9E%E6%96%87%E7%9A%84%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/"/>
      <url>/2018/04/04/%E5%85%B3%E4%BA%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9B%9E%E6%96%87%E7%9A%84%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>å¯¹äº<code>Manacher</code>ç®—æ³•è‡ªå·±ç ”ç©¶äº†ä¸€ä¼šï¼Œæ€»ç®—æ˜¯ç†è§£äº†å…¶ä¸­çš„å«ä¹‰ï¼Œä¹˜ç€æœ‰æ—¶é—´æ­£å¥½å¯ä»¥è¿‡æ¥è®°å½•ä¸‹ï¼š</p><h2 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h2><ol><li>å°†å­—ç¬¦ä¸²å˜æˆå¥‡æ•°ï¼Œé€šè¿‡åŠ éå­—ç¬¦ä¸²é‡Œé¢çš„ç¬¦å·è¡¨ç¤ºï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯åŠ çš„<code>#</code></li><li>æ‰¾å‡ºä»¥å½“å‰ç´¢å¼•ä¸ºä¸­ç‚¹çš„æœ€é•¿å›æ–‡æ•°é•¿åº¦ï¼Œå¹¶ä¸”è®°å½•ï¼Œä¾‹å¦‚ï¼š<code>#a#b#a</code>,è¿™ä¸ªå­—ç¬¦ä¸²æ‰€å¯¹åº”çš„é•¿åº¦ä¾¿æ˜¯[1,2,1,2,1,1],å› ä¸ºåœ¨<code>#</code>çš„æ—¶å€™ç»„æˆä¸äº†å›æ–‡ï¼Œæ‰€ä»¥<code>#</code>è¿™é‡Œæ˜¯1ï¼Œè€Œåˆ°äº†<code>a</code>è¿™é‡Œï¼Œå› ä¸º<code>#a#</code>ç»„æˆäº†å›æ–‡ï¼Œæ‰€ä»¥<code>a</code>çš„æœ€é•¿å›æ–‡å­—ç¬¦ä¸²é•¿åº¦æ˜¯2,ä»¥æ­¤ç±»æ¨</li><li>forå¾ªç¯å¼€å§‹æ¯”è¾ƒï¼Œåœ¨è¿™é‡Œä¸€èˆ¬æ¥è®²æ˜¯é¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„è¾¹ç•Œå˜é‡ï¼Œä»¥é˜²æ­¢æ•°ç»„è¶Šç•Œï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯æœ€é•¿å›æ–‡å­—ç¬¦ä¸²çš„ä¸­ç‚¹åæ ‡ï¼Œä»¥æ­¤ç±»æ¨å°±å¯ä»¥</li></ol><h2 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h2><p>å°†å¡«å……ç¬¦å·è®¡å…¥åˆ°éœ€è¦åŒ¹é…çš„çš„å­—ç¬¦ä¸²ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ€å¤§å›æ–‡ä¸²çš„æ•°ç»„</span></span><br><span class="line">        StringBuilder sb =<span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"#"</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span> ;i&lt;str.length() ;i++)&#123;</span><br><span class="line">            sb.append(str.charAt(i));</span><br><span class="line">            sb.append(<span class="string">"#"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String s1 =sb.toString();</span><br></pre></td></tr></table></figure></p><p>ç„¶åå†å®šä¹‰ä¸€ä¸ªæœ€å¤§çš„å­—ç¬¦ä¸²é•¿åº¦å’Œä¸€ä¸ªæœ€é•¿å›æ–‡å­—ç¬¦ä¸²çš„ä¸­ç‚¹ä½ç½®çš„åæ ‡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> array=[s1.length()];</span><br><span class="line"><span class="keyword">int</span> maxRight =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> mid =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;s1.length() ;i++)&#123;</span><br><span class="line">    <span class="keyword">int</span> r=<span class="number">1</span>; <span class="comment">//å®šä¹‰æœ€å°çš„åŠå¾„</span></span><br><span class="line">    <span class="keyword">if</span>(i&gt; maxRight)&#123;</span><br><span class="line">        r=Math.min(array[<span class="number">2</span>*mid -i ],maxRight-i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä»¥æ­¤ä¸ºä¸­å¿ƒç‚¹ç»§ç»­æ‰©å¼ </span></span><br><span class="line">    <span class="keyword">while</span>(i - r &gt; &gt;<span class="number">0</span> &amp;&amp; i+r &lt;s1.length() &amp;&amp; s1.charAt(i-r) == s1.charAt(i+r) )&#123;</span><br><span class="line">        r++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åœ¨è¿™é‡Œéœ€è¦å‡ä¸€çš„åŸå› æ˜¯å› ä¸ºéœ€è¦å°†å½“å‰çš„å¤šåŠ ä¸€å»é™¤æ‰ï¼Œå› ä¸ºiç®—äº†ä¸€éå½“å‰çš„ç´¢å¼•,råˆç®—äº†ä¸€éå½“å‰çš„ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">if</span>(i+r -<span class="number">1</span> &lt;right)&#123;</span><br><span class="line">        right =i +r -<span class="number">1</span>;</span><br><span class="line">        mid =i;</span><br><span class="line">    &#125;</span><br><span class="line">    array[i]=r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æˆ–è€…å¯ä»¥å°†forå¾ªç¯ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s1.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (array[mid] + mid &gt; i) &#123;</span><br><span class="line">            r = Math.min(array[<span class="number">2</span> * mid - i], array[mid] + mid - i);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            r = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i - r &gt; <span class="number">0</span> &amp;&amp; i + r &lt; s1.length() &amp;&amp; s1.charAt(i - r) == s1.charAt(r + i)) &#123;</span><br><span class="line">            ++r;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mid + array[mid] &lt; array[i] + r) &#123;</span><br><span class="line">            mid = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (r &gt; maxLength) &#123;</span><br><span class="line">            maxLength = r;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//            if(i+r -1 &gt;maxLength)&#123;</span></span><br><span class="line"><span class="comment">//                maxLength =i+r-1;</span></span><br><span class="line"><span class="comment">//                mid=i;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            array[i] = r;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ç®€å•ä¸€ç‚¹çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span> ;i&lt;s1.length() ;i++)&#123;</span><br><span class="line">   r=Math.min(array[<span class="number">2</span>*mid -i],right -i):<span class="number">1</span>;</span><br><span class="line">   <span class="comment">//è¿™ç§æƒ…å†µè€ƒè™‘çš„æ˜¯å½“å‰ç´¢å¼•ä½ç½®å†æœ€é•¿å›æ–‡å­—ç¬¦ä¸²ä¹‹é—´ï¼Œè€Œä¸”è¿™ä¸ªç´¢å¼•è¯´ä¸å®šè¿˜æœ‰æ›´é•¿çš„å›æ–‡å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œéœ€è¦ä¸€ä¸ªwhileåˆ¤æ–­</span></span><br><span class="line">   <span class="keyword">while</span>(array[i-array[i]] == array[i+array[i]]) ++r; </span><br><span class="line">   <span class="keyword">if</span>( i +array[i] &gt;right)&#123;</span><br><span class="line">       right =i+array[i];</span><br><span class="line">       array[i]=r;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ä¸ºä»€ä¹ˆæ˜¯éè¦<code>array[i-array[i]] == array[i+array[i]]</code>ç›¸ç­‰æ‰ä¼šè¿›è¡ŒåŠå¾„çš„å¢åŠ å‘¢ï¼Ÿè¿™é‡Œå…¶å®æœ‰å‡ ç§æƒ…å†µéœ€è¦è€ƒè™‘çš„</p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å­—ç¬¦ä¸²åŒ¹é…ç›¸å…³ç®—æ³•</title>
      <link href="/2018/04/02/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/"/>
      <url>/2018/04/02/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%9B%B8%E5%85%B3%E7%AE%97%E6%B3%95/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©æ— æ„é—´ç¢°åˆ°äº†éœ€è¦å†™å­å­—ç¬¦ä¸²åŒ¹é…å¾—ç®—æ³•ï¼Œç”±äºä»¥å‰ä¸€ç›´å¯¹å­—ç¬¦ä¸²å¾—KMPç®—æ³•ä¸å¤ªäº†è§£ï¼Œæ‰€ä»¥ä»Šå¤©è¶ç€è¿™ä¸ªæœºä¼šæ­£å¥½è®°å½•ä¸‹è¿™ä¸‰ç§ç®—æ³•çš„å·®å¼‚ï¼š</p><ol><li>JavaApiå®ç°</li><li>æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•</li><li>KMPç®—æ³•</li></ol><h2 id="Javaçš„APIå®ç°å­å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼š"><a href="#Javaçš„APIå®ç°å­å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼š" class="headerlink" title="Javaçš„APIå®ç°å­å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼š"></a>Javaçš„APIå®ç°å­å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼š</h2><p>åœ¨Javaçš„Stringç±»é‡Œé¢æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯<code>indexof(str,index)</code>, è¿™ä¸ªç±»çš„è¯æ˜¯å¯ä»¥ä»ä¸€ä¸ªå­—ç¬¦ä¸²çš„æŒ‡å®šä½ç½®æŸ¥å‡ºæ˜¯å¦åŒ…å«å­å­—ç¬¦ä¸²ï¼Œè‹¥ä¸åŒ…å«åˆ™è¿”å›çš„æ˜¯-1ï¼Œè‹¥åŒ…å«çš„è¯åˆ™è¿”å›çš„æ˜¯è¯¥å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­çš„ç´¢å¼•ä½ç½®ã€‚ é‚£ä¹ˆè¿™ä¸ªç®—æ³•æ˜¯ä»€ä¹ˆåŸç†å‘¢ï¼Œè¿™ä¸ªç®—æ³•çš„åŸç†å°±æ˜¯<code>indexof</code>ä¼šè¿”å›åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²çš„ç´¢å¼•ï¼Œé‚£ä¹ˆå½“è¿™ä¸ªç®—æ³•åŒ¹é…åˆ°äº†ä¸€ä¸ªä¹‹åè·å–è¿”å›çš„ç´¢å¼•ï¼Œç„¶åå†åŠ ä¸Šå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæœ€åå†åœ¨å‰©ä¸‹çš„å­—ç¬¦ä¸²é‡Œé¢åŒ¹é…ï¼Œä¾¿ä¼šå¾—å‡ºæ‰€æœ‰çš„å­—ç¬¦ä¸²ä¸ªæ•°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public void test()&#123;</span><br><span class="line">        String findText= &quot;abcd&quot;;</span><br><span class="line">        String srcText =&quot;mabcdfafasabcdfa&quot;;</span><br><span class="line">        int count = 0;</span><br><span class="line">        int index = 0;</span><br><span class="line">        while ((index = srcText.indexOf(findText, index)) != -1) &#123;</span><br><span class="line">        index = index + findText.length();</span><br><span class="line">         count++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h2 id="æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼š"><a href="#æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼š" class="headerlink" title="æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼š"></a>æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ï¼š</h2><p>è¿™ä¸ªç®—æ³•å°±æ˜¯ä¸¤å±‚å¾ªç¯ï¼Œé¦–å…ˆç¬¬ä¸€å±‚å¾ªç¯ä¾¿åˆ©éœ€è¦å­—ç¬¦ä¸²ï¼Œè·å–ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åè¿›è¡Œç¬¬äºŒå±‚çš„å¾ªç¯ï¼Œç¬¬äºŒå±‚çš„å¾ªç¯ä¸»è¦æ˜¯è¿›è¡Œå­å­—ç¬¦ä¸²ï¼Œå½“å­å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œå¤–é¢çš„å­—ç¬¦ä¸²å½“å‰çš„å­—ç¬¦ç›¸åŒçš„è¯ï¼Œç„¶åè¿›è¡Œå­å­—ç¬¦ä¸²çš„ç¬¬äºŒä¸ªå­—ç¬¦ä¸å¤–å±‚çš„å½“å‰ä½ç½®çš„ç¬¬äºŒä¸ªå­—ç¬¦æ¯”è¾ƒï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public void test1()&#123;</span><br><span class="line">       String a =&quot;abcd&quot;;</span><br><span class="line">       String b=&quot;qweabcdaefgadfabcdojfojaofoafjabcdafsaf&quot;;</span><br><span class="line">       int count=0;</span><br><span class="line">       for(int i =0 ;i&lt;b.length() ;i++)&#123;</span><br><span class="line">           int index=i;</span><br><span class="line">           boolean flag =false;</span><br><span class="line">           for(int j=0;j&lt;a.length() ;j++)&#123;</span><br><span class="line">               char c =b.charAt(index);</span><br><span class="line">               if(a.charAt(j) == c)&#123;</span><br><span class="line">                   index++;</span><br><span class="line">               &#125;else&#123;</span><br><span class="line">                   flag=true;</span><br><span class="line">                   break;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           if(!flag) &#123;</span><br><span class="line">               count++;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¸ªé‡Œé¢éœ€è¦æ³¨æ„çš„å°±æ˜¯å¤–å±‚çš„iéœ€è¦ä¿å­˜ï¼ŒåŒæ—¶é‡Œé¢çš„å¾ªç¯jæ˜¯ä¸éœ€è¦çš„ï¼Œå› ä¸ºå­å­—ç¬¦ä¸²æ˜¯æ¯ä¸€æ¬¡éƒ½ä¼šéå†çš„ã€‚</p><h2 id="KMPç®—æ³•ï¼š"><a href="#KMPç®—æ³•ï¼š" class="headerlink" title="KMPç®—æ³•ï¼š"></a>KMPç®—æ³•ï¼š</h2><p>kmpç®—æ³•æ‰€è§£å†³çš„é—®é¢˜æ˜¯æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•æ¯æ¬¡åŒ¹é…å¤±è´¥ä¹‹åéƒ½è¦ä»å¤´å†æ¥è¿›è¡ŒåŒ¹é…çš„ä¸€ä¸ªéš¾ç‚¹ã€‚åœ¨KMPç®—æ³•ä¸­çš„ï¼š åŒ¹é…å¤±è´¥çš„è¯é¦–å…ˆä¼šæ£€æŸ¥åŒ¹é…å¤±è´¥çš„å¤´ä¸€ä¸ªå­—ç¬¦çš„çš„å‰ç¼€å’Œåç¼€ï¼Œç„¶åç”¨ä»¥åŒ¹é…çš„å­—ç¬¦æ•°å‡å»å…¶å‰ç¼€å’Œåç¼€çš„é‚£ä¸ªå€¼ï¼Œæœ€åå¾—å‡ºéœ€è¦åé€€çš„æ•°å­—ï¼Œæœ€åå†åœ¨é€€å‡ºçš„æ­¥æ•°ä¸Šè¿›åŒæ ·çš„æ“ä½œï¼Œæœ€åå†å¾—å‡ºç»“è®ºï¼Œå½“å­å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå­—ç¬¦éƒ½ä¸ç›¸åŒ¹é…çš„æ—¶å€™æœ€åå­å­—ç¬¦ä¸²æ•´ä½“åç§»ä¸€ä½ã€‚</p><h3 id="å…³äºNextæ•°ç»„çš„æ±‚æ³•ï¼š"><a href="#å…³äºNextæ•°ç»„çš„æ±‚æ³•ï¼š" class="headerlink" title="å…³äºNextæ•°ç»„çš„æ±‚æ³•ï¼š"></a>å…³äºNextæ•°ç»„çš„æ±‚æ³•ï¼š</h3><p>ä»Šå¤©çœ‹äº†ä¸‹èµ„æ–™æ€»ç®—äº†è§£äº†å†™KMPçš„Nextæ•°ç»„çš„æ±‚æ³•ã€‚ç°åœ¨ä¸€èˆ¬æ¥è®²æ˜¯æœ‰ä¸¤ç§æ±‚æ³•ï¼Œç¬¬ä¸€ç§æ˜¯æ±‚å‡ºåŒ¹é…å¤±è´¥åçš„è·³è½¬ç´¢å¼•çš„æ•°ç»„ã€‚ç¬¬äºŒç§åˆ™æ˜¯æ±‚å‡ºæ•°ç»„ä¸­å·²ç»åŒ¹é…çš„å‰åç¼€çš„æ•°ç»„ã€‚è¿™ä¸¤ç§æ•°ç»„çš„æ±‚æ³•éƒ½ä¼šå¯¼è‡´å†ä»¥åçš„è®¡ç®—å‡ºç°ä¸åŒçš„ç»“æœï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯éœ€è¦ç”¨åˆ°çš„ä¸€ä¸ªåŸç†å°±æ˜¯åŒ¹é…å¤±è´¥ï¼šå›é€€æ­¥æ•°å°±æ˜¯å·²ç»åŒ¹é…çš„å­—ç¬¦æ•°å‡å»åŒ¹é…çš„å‰åç¼€å­—ç¬¦æ•°ã€‚æœ€åå¾—å‡ºå›é€€æ­¥æ•°ã€‚</p><p>ç›®å‰æ¥è®²æœ‰ä¸¤ç§nextæ•°ç»„çš„æ±‚æ³•ï¼š</p><ol><li>å°†å‰ç¼€åç¼€åŒ¹é…æ•°æ”¾ç½®åˆ°æ•°ç»„ä¸­</li><li>å°†å¤±è´¥åå›é€€çš„ä½ç½®æ”¾ç½®åœ¨æ•°ç»„ä¸­</li></ol><p>å¯¹äºç¬¬ä¸€ç§nextæ•°ç»„æ¥è¯´ï¼Œç½‘ä¸Šçš„èµ„æ–™å¤šæ˜¯å°†å…¶åç§»ä¸€ä½ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²<code>abcab</code>ä»–çš„å‰ç¼€å’Œåç¼€æ•°ç»„æ˜¯[0,0,0,1,2]ï¼Œé‚£ä¹ˆç½‘ä¸Šå…¶ä»–äººçš„å†™æ³•å¤šæ˜¯å°†è¿™ä¸ªæ•°ç»„å†å³ç§»ä¸€ä½,æœ€åä¸º[-1,0,0,0,1]ã€‚åœ¨ä»Šå¤©ï¼Œä¹Ÿè‡ªå·±å°è¯•äº†å†™KMPç®—æ³•ï¼Œä½†æ˜¯è‡ªå·±çš„å†™æ³•æ²¡æœ‰åšå³ç§»æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥æ±‚è§£ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">generateNextArray</span><span class="params">(String str ,<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == str || str.length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">1</span>;</span><br><span class="line">        array[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; j &lt; str.length(); ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (str.charAt(i) == str.charAt(j)) &#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">                array[j - <span class="number">1</span>] = i;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(i!= <span class="number">0</span> &amp;&amp; j!=<span class="number">0</span>) &#123;</span><br><span class="line">                i = array[i-<span class="number">1</span>];  <span class="comment">//è¿™é‡Œéœ€è¦i-1æ˜¯å› ä¸ºæœ€åéœ€è¦æ•°ç»„å³ç§»ä¸€ä½ï¼Œä½†æ˜¯æˆ‘è¿™é‡Œæ²¡æœ‰ç§»ä½ï¼Œæ‰€ä»¥ç›´æ¥åœ¨è¿™é‡Œå‡ä¸€</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                array[j]=i;</span><br><span class="line">                j++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢è¿™ä¸ªæ±‚nextæ•°ç»„çš„æ–¹æ³•å…¶å®ä¹ŸæŒºç®€å•çš„ï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ç¬¬äºŒä¸ªifå’Œç¬¬ä¸‰ä¸ªçš„elseï¼Œä¸ºä»€ä¹ˆè¿™é‡Œä¼šå‡ºç°ä¸¤ä¸ªæ˜¯å› ä¸ºè¿™é‡Œéœ€è¦æ³¨æ„çš„æƒ…å†µä¼šæœ‰ä¸¤ç§ï¼Œç¬¬äºŒä¸ªifæ•è·çš„æ˜¯åœ¨åç»­å‡ºç°äº†æ–­å±‚éœ€è¦é‡æ–°ä»0å¼€å§‹åŒ¹é…çš„æƒ…å†µã€‚è€Œæœ€åä¸€ä¸ªelseåˆ™æ˜¯æ•è·çš„ä»å¤´å¼€å§‹çš„ä¸€ç§æƒ…å†µï¼Œå…·ä½“ä»¥<code>abcdeabcdabcdeabcdfg</code>åšæµ‹è¯•ä¾¿ä¼šäº†è§£ã€‚<br>è€Œç½‘ä¸Šçš„å…¶ä»–ç®—æ³•ä¸éœ€è¦è¿™ä¸‰ä¸ªåˆ¤æ–­æ˜¯å› ä¸ºç½‘ä¸Šçš„åŒ¹é…å¤±è´¥ä¹‹åKä¼šå˜æˆ-1ï¼Œç„¶åjæ˜¯ä¸å˜çš„ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getNext</span><span class="params">(String pattern, <span class="keyword">int</span> next[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> k = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> len = pattern.length();</span><br><span class="line">        next[<span class="number">0</span>] = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (j &lt; len - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (k == -<span class="number">1</span> || pattern.charAt(k) == pattern.charAt(j)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">                k++;</span><br><span class="line">                next[j] = k;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                k = next[k];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯è¯´ç½‘ä¸Šçš„ä¸€æ—¦åŒ¹é…å¤±è´¥ï¼Œkå°±ä¼šå˜æˆnext[next[k]]çš„å€¼ã€‚</p><h2 id="JDKä¸­çš„indexOfæ–¹æ³•ï¼š"><a href="#JDKä¸­çš„indexOfæ–¹æ³•ï¼š" class="headerlink" title="JDKä¸­çš„indexOfæ–¹æ³•ï¼š"></a>JDKä¸­çš„indexOfæ–¹æ³•ï¼š</h2><p>å†Javaä¸­çš„<code>indexOf</code>æ–¹æ³•åˆ™æ˜¯ä½¿ç”¨çš„æœ´ç´ å­—ç¬¦ä¸²åŒ¹é…ç®—æ³•ã€‚å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexOf</span><span class="params">(<span class="keyword">char</span>[] source, <span class="keyword">int</span> sourceOffset, <span class="keyword">int</span> sourceCount,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">char</span>[] target, <span class="keyword">int</span> targetOffset, <span class="keyword">int</span> targetCount,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> fromIndex)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fromIndex &gt;= sourceCount) &#123;</span><br><span class="line">            <span class="keyword">return</span> (targetCount == <span class="number">0</span> ? sourceCount : -<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (fromIndex &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            fromIndex = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (targetCount == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> fromIndex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">char</span> first = target[targetOffset];</span><br><span class="line">        <span class="keyword">int</span> max = sourceOffset + (sourceCount - targetCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = sourceOffset + fromIndex; i &lt;= max; i++) &#123;</span><br><span class="line">            <span class="comment">/* Look for first character. */</span></span><br><span class="line">            <span class="keyword">if</span> (source[i] != first) &#123;</span><br><span class="line">                <span class="keyword">while</span> (++i &lt;= max &amp;&amp; source[i] != first);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Found first character, now look at the rest of v2 */</span></span><br><span class="line">            <span class="keyword">if</span> (i &lt;= max) &#123;</span><br><span class="line">                <span class="keyword">int</span> j = i + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">int</span> end = j + targetCount - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = targetOffset + <span class="number">1</span>; j &lt; end &amp;&amp; source[j]</span><br><span class="line">                        == target[k]; j++, k++);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (j == end) &#123;</span><br><span class="line">                    <span class="comment">/* Found whole string. */</span></span><br><span class="line">                    <span class="keyword">return</span> i - sourceOffset;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> å­—ç¬¦ä¸² </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨Mybatisä¸­ä½¿ç”¨bindè¿›è¡Œæšä¸¾å’Œæ¨¡ç³ŠæŸ¥è¯¢</title>
      <link href="/2018/04/01/%E5%9C%A8Mybatis%E4%B8%AD%E4%BD%BF%E7%94%A8bind%E8%BF%9B%E8%A1%8C%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2/"/>
      <url>/2018/04/01/%E5%9C%A8Mybatis%E4%B8%AD%E4%BD%BF%E7%94%A8bind%E8%BF%9B%E8%A1%8C%E6%9E%9A%E4%B8%BE%E5%92%8C%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆåœ¨ç½‘ä¸ŠæŸ¥è¯¢äº†ä¸‹å…³äºbindå¾—ç”¨æ³•ï¼Œç½‘ä¸Šå¤§å¤šæ•°éƒ½æ˜¯bindå’Œæ¨¡ç³ŠæŸ¥è¯¢ç»‘å®šåœ¨ä¸€èµ·ï¼Œä½†æ˜¯åœ¨è¿™é‡Œçš„è¯å…¶å®bindå’Œæšä¸¾ä¸€èµ·ç»“åˆèµ·æ¥ä½¿ç”¨ä¼šæœ‰å¾ˆå¤§çš„ä¾¿åˆ©ï¼Œæ¯”å¦‚ä¸€ä¸ªç­çº§çš„åç§°å’Œç­çº§çš„IDï¼Œéœ€è¦æ ¹æ®ç­çº§çš„IDæŸ¥è¯¢å‡ºç­çº§çš„å§“åçš„è¯ï¼Œä¸€èˆ¬åœ¨mybatisä¸­çš„sqlè¯­å¥æ˜¯<code>select * from table where class_id =#{class_id}</code> ä½†æ˜¯è¿™æ ·å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå‡è®¾å­¦æ ¡ç°åœ¨ç³»ç»Ÿå‡çº§ï¼Œæ¯ä¸€ä¸ªç­çº§çš„IDéƒ½å˜äº†ï¼Œè¿™æ—¶å€™éœ€è¦åˆ°å¤„ä¿®æ”¹mybatisçš„å‚æ•°ï¼Œå°†å…¶ä¿®æ”¹æˆä¸ºæ­£ç¡®çš„ID,é‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªæµ©å¤§çš„å·¥ç¨‹ï¼ŒåŒæ—¶å¦‚æœä»¥åå†éœ€è¦æ”¹çš„è¯ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ã€‚å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p><ol><li>æšä¸¾å’Œ<code>typehandle</code>ç»„åˆè§£å†³é—®é¢˜ï¼›</li><li>æšä¸¾å’Œ<code>bind</code>ä¸€èµ·ç»„åˆè§£å†³ï¼›</li><li>æš‚æ—¶æ²¡æƒ³åˆ°</li></ol><p>##æšä¸¾å’Œbindç»„åˆè§£å†³ï¼š<br>æ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">clazzEntity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String clazz_name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> clazz_id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">clazzEntity</span><span class="params">(String clazz_name, <span class="keyword">int</span> clazz_id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clazz_name = clazz_name;</span><br><span class="line">        <span class="keyword">this</span>.clazz_id = clazz_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getClazz_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clazz_name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClazz_name</span><span class="params">(String clazz_name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clazz_name = clazz_name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getClazz_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> clazz_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClazz_id</span><span class="params">(<span class="keyword">int</span> clazz_id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.clazz_id = clazz_id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ–°å»ºä¸€ä¸ªæšä¸¾ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> clazz &#123;</span><br><span class="line">    CLASS_ONE(<span class="string">"ä¸€å¹´çº§"</span>,<span class="number">2018001</span>),CLASS_TWO(<span class="string">"ä¸€å¹´çº§"</span>,<span class="number">2018002</span>),CLASS_THREE(<span class="string">"ä¸€å¹´çº§"</span>,<span class="number">2018003</span>),CLASS_FOUR(<span class="string">"ä¸€å¹´çº§"</span>,<span class="number">2018004</span>),CLASS_FIVE(<span class="string">"ä¸€å¹´çº§"</span>,<span class="number">2018005</span>);</span><br><span class="line">    <span class="keyword">private</span> String className;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> classId;</span><br><span class="line"></span><br><span class="line">    clazz(String className, <span class="keyword">int</span> classId) &#123;</span><br><span class="line">        <span class="keyword">this</span>.className = className;</span><br><span class="line">        <span class="keyword">this</span>.classId = classId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getClassName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> className;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClassName</span><span class="params">(String className)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.className = className;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getClassId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> classId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setClassId</span><span class="params">(<span class="keyword">int</span> classId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.classId = classId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ–°å»ºä¸€ä¸ªmapperæ–‡ä»¶ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"study.dao.clazzEntityDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"clazzmap"</span> <span class="attr">type</span>=<span class="string">"study.entity.clazzEntity"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"clazz_name"</span> <span class="attr">column</span>=<span class="string">"clazz_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"clazz_id"</span> <span class="attr">column</span>=<span class="string">"clazz_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findAllCLass"</span> <span class="attr">resultMap</span>=<span class="string">"clazzmap"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"_CLASS"</span> <span class="attr">value</span>=<span class="string">"@study.entity.clazz@CLASS_ONE.className"</span>/&gt;</span></span><br><span class="line">        select * from clazzentity where clazz_name = #&#123;_CLASS&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œçš„çš„é‚£ä¸ª<code>&lt;bind name=&quot;_CLASS&quot; value=&quot;@study.entity.clazz@CLASS_ONE.className&quot;/&gt;</code>ä»£è¡¨çš„æ˜¯å·²ç»ç»‘å®šäº†è¿™ä¸ªæšä¸¾ä¸€å¹´çº§äº†ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨å‚æ•°é‡Œé¢æ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½ä¸ä¼šå†ä¿®æ”¹åˆ°è¿™ä¸ªsqlçš„å€¼äº†ï¼Œå¯ä»¥åšå¦‚ä¸‹æµ‹è¯•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String args[]) &#123;</span><br><span class="line">       Logger logger = null;</span><br><span class="line">       logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">       logger.setLevel(Level.DEBUG);</span><br><span class="line">       SqlSession sqlSession = null;</span><br><span class="line">       try &#123;</span><br><span class="line">           sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">           clazzEntityDao clazzEntityDao = sqlSession.getMapper(clazzEntityDao.class);</span><br><span class="line">           List&lt;clazzEntity&gt; list =clazzEntityDao.findAllCLass(clazz.CLASS_TWO.getClassName());</span><br><span class="line">           for( clazzEntity clazzEntity :list)&#123;</span><br><span class="line">               System.out.println(clazzEntity.getClazz_id());</span><br><span class="line">           &#125;</span><br><span class="line">           sqlSession.commit();</span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">           sqlSession.close();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥å‘ç°æˆ‘è¿™é‡Œå·²ç»å°†å‚æ•°ä¿®æ”¹ä¸ºäº†äºŒå¹´çº§çš„äº†ï¼Œä½†æ˜¯æŸ¥è¯¢ç»“æœè¿˜æ˜¯ä¼šæ˜¾ç¤ºçš„æ˜¯ä¸€å¹´çº§çš„.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DEBUG [main] - ==&gt;  Preparing: select * from clazzentity where clazz_name = ? </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: ä¸€å¹´çº§(String)</span><br><span class="line">TRACE [main] - &lt;==    Columns: clazz_name, clazz_id</span><br><span class="line">TRACE [main] - &lt;==        Row: ä¸€å¹´çº§, 2018001</span><br><span class="line">DEBUG [main] - &lt;==      Total: 1</span><br><span class="line">2018001</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œå…¶å®å·²ç»å¯ä»¥ä¸éœ€è¦ä»»ä½•å‚æ•°äº†ï¼Œä½†æ˜¯ä¸ºäº†æµ‹è¯•ç”¨æ³•è¿˜æ˜¯åŠ ä¸Šå»äº†ï¼Œè¿™æ ·çš„å†™æ³•åœ¨ä»¥åçš„ä½œç”¨å°±æ˜¯çœçš„å»æ”¹åŠ¨å¤§é‡çš„sqlï¼Œè‹¥ä»¥åä¸€å¹´çº§çš„IDå˜äº†çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹æšä¸¾çš„å€¼è€Œä¸éœ€è¦å¯¹sqlåšå¾ˆå¤šçš„æ”¹å˜ï¼Œè¿™å°±æ˜¯ç¬¬ä¸€ç§æ–¹æ³•ï¼Œå³æšä¸¾åŠ ä¸Š<code>bind</code>ä¸€èµ·ä½¿ç”¨ä»¥å‡å°‘sqlè¯­å¥çš„æ”¹åŠ¨ã€‚</p><h2 id="æšä¸¾åŠ ä¸Štypehandle"><a href="#æšä¸¾åŠ ä¸Štypehandle" class="headerlink" title="æšä¸¾åŠ ä¸Štypehandle"></a>æšä¸¾åŠ ä¸Štypehandle</h2><p>æ˜å¤©ç ”ç©¶ä¸‹è¡¥å……</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨Mybatisä¸­ä½¿ç”¨associationè¿›è¡Œä¸€å¯¹ä¸€æŸ¥è¯¢</title>
      <link href="/2018/03/31/%E5%9C%A8Mybatis%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%B7%A6%E8%BF%9E%E6%8E%A5%E6%88%96%E8%80%85%E5%8F%B3%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2/"/>
      <url>/2018/03/31/%E5%9C%A8Mybatis%E4%B8%AD%E8%BF%9B%E8%A1%8C%E5%B7%A6%E8%BF%9E%E6%8E%A5%E6%88%96%E8%80%85%E5%8F%B3%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2/</url>
      <content type="html"><![CDATA[<p>åœ¨ä»Šå¤©ä¸»è¦æ˜¯æµ‹è¯•äº†ä¸‹åœ¨mybatisä¸­ä½¿ç”¨ä¸¤ç§æ–¹å¼æ¥è¿›è¡Œä¸€å¯¹ä¸€æŸ¥è¯¢ã€‚åœ¨mybatisä¸­è¿›è¡Œæ™®é€šæŸ¥è¯¢çš„è¯è‚¯å®šæ˜¯ä¸€ä¸ªJavaBeanå¯¹åº”ä¸€ä¸ªSqlè¯­å¥ï¼Œä½†æ˜¯å½“éœ€è¦è¿›è¡Œä¸¤è¡¨æˆ–è€…å¤šè¡¨ä¹‹é—´ä¸€å¯¹ä¸€çš„æŸ¥è¯¢çš„æ—¶å€™å°±éœ€è¦ä½¿ç”¨mybatisä¸­çš„<code>association</code>è¿›è¡Œä¸€å¯¹ä¸€æŸ¥è¯¢ï¼Œè€Œ<code>association</code>çš„è®¾ç½®ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><p>##åŸºç¡€ç±»ï¼š<br>å‘˜å·¥ç±»ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">People</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> people_id;</span><br><span class="line"><span class="keyword">private</span> String people_card;</span><br><span class="line"><span class="keyword">private</span> Role role;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPeople_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> people_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPeople_id</span><span class="params">(<span class="keyword">int</span> people_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.people_id = people_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPeople_card</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> people_card;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPeople_card</span><span class="params">(String people_card)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.people_card = people_card;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Role <span class="title">getRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> role;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRole</span><span class="params">(Role role)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.role = role;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>æƒé™ç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span>  <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> myrole_id;</span><br><span class="line"><span class="keyword">private</span> String role_name;</span><br><span class="line"><span class="keyword">private</span>  RoleDetail roleDetail;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> RoleDetail <span class="title">getRoleDetail</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> roleDetail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRoleDetail</span><span class="params">(RoleDetail roleDetail)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.roleDetail = roleDetail;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMyrole_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> myrole_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMyrole_id</span><span class="params">(<span class="keyword">int</span> myrole_id)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.myrole_id = myrole_id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRole_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> role_name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRole_name</span><span class="params">(String role_name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.role_name = role_name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æƒé™æè¿°ç±»ï¼š</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoleDetail</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> rd_id;</span><br><span class="line">    <span class="keyword">private</span> String rd_detail;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getRd_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rd_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRd_id</span><span class="params">(<span class="keyword">int</span> rd_id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rd_id = rd_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRd_detail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rd_detail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRd_detail</span><span class="params">(String rd_detail)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rd_detail = rd_detail;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œé¢çš„è¯ï¼Œå‘˜å·¥å’Œæƒé™é»˜è®¤æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»(è¿™é‡Œä»…ä»…æ˜¯ä¸ºäº†æµ‹è¯•ï¼Œç°å®ä¸­è‚¯å®šæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»)ï¼Œæƒé™å’Œæƒé™æè¿°æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼š</p><h2 id="ä½¿ç”¨è¿›è¡Œé…ç½®ï¼š"><a href="#ä½¿ç”¨è¿›è¡Œé…ç½®ï¼š" class="headerlink" title="ä½¿ç”¨è¿›è¡Œé…ç½®ï¼š"></a>ä½¿ç”¨<association property="XXX" javatype="XXX">è¿›è¡Œé…ç½®ï¼š</association></h2><p>å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚å°±æ˜¯éœ€è¦æŸ¥è¯¢å‡ºä¸€ä¸ªäººçš„ä¿¡æ¯ä»¥åŠå…¶å¯¹åº”çš„æƒé™ï¼Œè¿™æ—¶åœ¨æ•°æ®åº“ä¸­å°±æ˜¯ä¸€ä¸ªå·¦è¿æ¥å’Œå³è¿æ¥çš„äº‹æƒ…ï¼Œä½†æ˜¯åœ¨Mybatisä¸­å› ä¸ºæ˜¯ä¸€ä¸ªJavaBeanå’Œæ•°æ®åº“ç›¸æ˜ å°„ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªä¸€å¯¹ä¸€æŸ¥è¯¢ï¼šæ–°å»ºä¸€ä¸ªRoleDaoçš„xmlæ–‡ä»¶<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"study.dao.RoleDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç”±äºæ˜¯éœ€è¦åœ¨æŸ¥è¯¢å‘˜å·¥çš„æ—¶å€™é¡ºå¸¦å°†å…¶æƒé™ä¹ŸæŸ¥å‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦åœ¨peopleçš„xmlæ–‡ä»¶ä¸­ä½¿ç”¨<code>association</code>:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"study.dao.PeopleDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"study.entity.People"</span> <span class="attr">id</span>=<span class="string">"people"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"people_id"</span> <span class="attr">column</span>=<span class="string">"people_id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"people_card"</span> <span class="attr">column</span>=<span class="string">"people_card"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">javaType</span>=<span class="string">"study.entity.Role"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"myrole_id"</span> <span class="attr">column</span>=<span class="string">"myrole_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role_name"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getPeopleCard"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"people"</span>&gt;</span></span><br><span class="line">        select p.people_id,p.people_card,m.* from people p, mybatisrole m where people_id=#&#123;role_id&#125; and  p.role_id  =m.myrole_id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--  select p.people_id,p.people_card,m.* from people p, mybatisrole m where people_id=#&#123;role_id&#125; -- &gt;</span></span><br></pre></td></tr></table></figure></p><p>æ³¨æ„ä¸Šé¢<code>association</code>ä¸­çš„propertyï¼Œè¿™æ˜¯peopleä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œ<code>javaType</code>åˆ™ä»£è¡¨çš„æ˜¯è¿™ä¸ªæ˜¯ä¸€ä¸ªä»€ä¹ˆç±»å‹ï¼›æµ‹è¯•æŸ¥çœ‹ç»“æœ:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisExample</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">Logger logger = <span class="keyword">null</span>;</span><br><span class="line">logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">logger.setLevel(Level.DEBUG);</span><br><span class="line">SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line"></span><br><span class="line">PeopleDao peopleDao = sqlSession.getMapper(PeopleDao.class);</span><br><span class="line">List&lt;People&gt; list = peopleDao.getPeopleCard(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">for</span>(People p : list) &#123;</span><br><span class="line">System.out.println(p.getRole().getRole_name());</span><br><span class="line">&#125;</span><br><span class="line">sqlSession.commit();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰“å°ç»“æœ:</p><blockquote><p>DEBUG [main] - ==&gt;  Preparing: select p.people_id,p.people_card,m.* from people p, mybatisrole m where people_id=?<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: people_id, people_card, myrole_id, role_name<br>TRACE [main] - &lt;==        Row: 1, qw, 1, a<br>DEBUG [main] - &lt;==      Total: 1<br>a</p></blockquote><h2 id=""><a href="#" class="headerlink" title=""></a><association property="XXX" column="XX" select="XXX"></association></h2><p>å½“ä½¿ç”¨å¦‚ä¸Šè¿™ç§é…ç½®çš„æ—¶å€™ä¼šæ‰§è¡Œ2æ¬¡ä¸åŒçš„sqlï¼š<br><strong>RoleDetailmapper.xml</strong>é…ç½®æ–‡ä»¶ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"study.dao.RoleDetailDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">"getRd_detail"</span> <span class="attr">type</span>=<span class="string">"study.entity.RoleDetail"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"rd_id"</span> <span class="attr">column</span>=<span class="string">"rd_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"rd_detail"</span> <span class="attr">column</span>=<span class="string">"rd_detail"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getDetailById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"study.entity.RoleDetail"</span>&gt;</span></span><br><span class="line">    SELECT * from roledetail where rd_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åå†<code>Rolemapper.xml</code>ä¸­è°ƒç”¨å®ƒï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"study.dao.RoleDao"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"study.entity.Role"</span> <span class="attr">id</span>=<span class="string">"Role"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"myrole_id"</span> <span class="attr">column</span>=<span class="string">"myrole_id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"role_name"</span> <span class="attr">column</span>=<span class="string">"role_name"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"roleDetail"</span> <span class="attr">column</span>=<span class="string">"rd_id"</span> <span class="attr">select</span>=<span class="string">"study.dao.RoleDetailDao.getDetailById"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">"myrole_id"</span> <span class="attr">column</span>=<span class="string">"rd_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">"rd_detail"</span> <span class="attr">column</span>=<span class="string">"rd_detail"</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--select * from mybatisrole m ,roledetail r  where m.myrole_id=#&#123;id&#125; and m.myrole_id=r.rd_id--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getRoleById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultMap</span>=<span class="string">"Role"</span>&gt;</span></span><br><span class="line">        select * from mybatisrole m ,roledetail r where m.myrole_id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¸ªåœ°æ–¹çš„è¯<code>association</code>åè·Ÿçš„æ˜¯columnå’Œselectå±æ€§ï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œçš„æ—¶å€™å…ˆæ‰§è¡Œ<code>getRoleById</code>,å†æ‰§è¡Œ<code>getDetailById</code>:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybtisRoleExample</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        Logger logger = <span class="keyword">null</span>;</span><br><span class="line">        logger = Logger.getLogger(MybatisExample.class.getName());</span><br><span class="line">        logger.setLevel(Level.DEBUG);</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sqlSession = study.mybatis.MybatisUtil.getSqlSessionFActory().openSession();</span><br><span class="line">            RoleDao roleDao= sqlSession.getMapper(RoleDao.class);</span><br><span class="line">            List&lt;Role&gt; list= roleDao.getRoleById(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(Role r : list) &#123;</span><br><span class="line">                System.out.println(r.getRoleDetail().getRd_detail());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ‰“å°æ—¥å¿—å¦‚ä¸‹ï¼š</p><blockquote><p>DEBUG [main] - ==&gt;  Preparing: select <em> from mybatisrole m ,roledetail r where m.myrole_id=?<br>DEBUG [main] - ==&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;==    Columns: myrole_id, role_name, rd_id, rd_detail<br>TRACE [main] - &lt;==        Row: 1, a, 1, ä¸»è¦æƒé™è´Ÿè´£äºº<br>DEBUG [main] - ====&gt;  Preparing: SELECT </em> from roledetail where rd_id=?<br>DEBUG [main] - ====&gt; Parameters: 1(Integer)<br>TRACE [main] - &lt;====    Columns: rd_id, rd_detail<br>TRACE [main] - &lt;====        Row: 1, ä¸»è¦æƒé™è´Ÿè´£äºº<br>DEBUG [main] - &lt;====      Total: 1<br>DEBUG [main] - &lt;==      Total: 1<br>ä¸»è¦æƒé™è´Ÿè´£äºº</p></blockquote><p>å¯ä»¥çœ‹åˆ°æ‰§è¡Œäº†2æ¡sqlï¼›</p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>è™½ç„¶å¯ä»¥è¿›è¡Œä¸€å¯¹ä¸€æŸ¥è¯¢äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“é—®ä»€ä¹ˆä¸¤ç§é…ç½®ä¼šå¯¼è‡´æ‰§è¡Œä¸åŒæ¬¡æ•°çš„sqlï¼Œå®˜æ–¹æ–‡æ¡£çš„è§£é‡Šæ˜¯<code>ä¸€ä¸ª Java ç±»çš„å®Œå…¨é™å®šå,æˆ–ä¸€ä¸ªç±»å‹åˆ«å(å‚è€ƒä¸Šé¢å†…å»ºç±»å‹åˆ«åçš„åˆ—è¡¨)ã€‚ å¦‚æœä½ æ˜ å°„åˆ°ä¸€ä¸ª JavaBean,MyBatis é€šå¸¸å¯ä»¥æ–­å®šç±»å‹ã€‚ç„¶è€Œ,å¦‚ æœä½ æ˜ å°„åˆ°çš„æ˜¯ HashMap,é‚£ä¹ˆä½ åº”è¯¥æ˜ç¡®åœ°æŒ‡å®š javaType æ¥ä¿è¯æœŸæœ›çš„ è¡Œä¸º</code>ã€‚ä½†æ˜¯å´æ²¡è¯´ä¸ºå•¥æˆ–è€…æ€æ ·æ˜ å°„å¾—ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> mybatis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨Springä¸­ä½¿ç”¨JWTç”Ÿæˆtokenæ¥éªŒè¯ç”¨æˆ·</title>
      <link href="/2018/03/30/%E5%9C%A8Spring%E4%B8%AD%E4%BD%BF%E7%94%A8JWT%E7%94%9F%E6%88%90token%E6%9D%A5%E9%AA%8C%E8%AF%81%E7%94%A8%E6%88%B7/"/>
      <url>/2018/03/30/%E5%9C%A8Spring%E4%B8%AD%E4%BD%BF%E7%94%A8JWT%E7%94%9F%E6%88%90token%E6%9D%A5%E9%AA%8C%E8%AF%81%E7%94%A8%E6%88%B7/</url>
      <content type="html"><![CDATA[<p>é¦–å…ˆJWTå…¨ç¨‹æ˜¯ JSON WEB TOKEN</p><h2 id="ä¸Springè¿›è¡Œä¸€ä¸ªæ•´åˆï¼š"><a href="#ä¸Springè¿›è¡Œä¸€ä¸ªæ•´åˆï¼š" class="headerlink" title="ä¸Springè¿›è¡Œä¸€ä¸ªæ•´åˆï¼š"></a>ä¸Springè¿›è¡Œä¸€ä¸ªæ•´åˆï¼š</h2><h3 id="è·å–JWT"><a href="#è·å–JWT" class="headerlink" title="è·å–JWT"></a>è·å–JWT</h3><p>é¦–å…ˆéœ€è¦åœ¨pomä¸­å¼•å…¥å‡ ä¸ªéœ€è¦çš„jaråŒ…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.auth0&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;java-jwt&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;3.3.0&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line">   &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;0.9.0&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br><span class="line">   &lt;dependency&gt;</span><br></pre></td></tr></table></figure></p><p>å¦å¤–è¿™é‡Œä¹Ÿéœ€è¦shiroçš„å‡ ä¸ªæ ¸å¿ƒjarï¼Œè¿™é‡Œå°±ä¸å†™å‡ºæ¥äº†ã€‚ jaråŒ…æ·»åŠ å®Œæ¯•ä¹‹åä¾¿å¯ä»¥ç¼–å†™åŠ å¯†çš„æ–¹æ³•äº†ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">byte[] apiKeySecretBytes = DatatypeConverter.parseBase64Binary(&quot;somersames&quot;);</span><br><span class="line">SignatureAlgorithm sigAlg = SignatureAlgorithm.HS256;</span><br><span class="line">Key signingKey = new SecretKeySpec(apiKeySecretBytes, sigAlg.getJcaName());</span><br><span class="line">JwtBuilder builder = Jwts.builder()</span><br><span class="line">        .setSubject(username)</span><br><span class="line">        .signWith(sigAlg, signingKey);</span><br><span class="line">String result =builder.compact();</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œéœ€è¦è§£é‡Šä¸‹çš„å°±æ˜¯å¯¹è¾“å…¥çš„Keyè¿›è¡Œä¸€ä¸ªBase64åŠ å¯†ï¼Œç„¶åå°†è·å–åˆ°çš„å¯†åŒ™å’ŒSignatureAlgorithmæŒ‡å®šçš„ä¸€ä¸ªåŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ï¼Œæ–‡ç« é‡Œé¢æ˜¯<code>HS256</code>åŠ å¯†ç®—æ³•ï¼Œæœ€åç”Ÿæˆä¸€ä¸ªKeyã€‚<br>å½“è·å–åˆ°è¿™ä¸ªkeyä¹‹åé€šè¿‡<code>JwtBuilder</code>æ¥è¿›è¡Œç”Ÿæˆä¸€ä¸ªJwtBuilderï¼Œæœ€ååœ¨è°ƒç”¨compact()ä»è€Œå¯ä»¥è·å¾—ä¸€ä¸ªJWT</p><h3 id="JWTéªŒè¯ç”¨æˆ·ï¼š"><a href="#JWTéªŒè¯ç”¨æˆ·ï¼š" class="headerlink" title="JWTéªŒè¯ç”¨æˆ·ï¼š"></a>JWTéªŒè¯ç”¨æˆ·ï¼š</h3><p>è¿™ä¸€æ­¥å°±æ˜¯éœ€è¦å’Œspringæ¥æ‰“äº¤é“äº†ï¼Œå…³äºç”Ÿæˆçš„tokenè¿”å›ç»™å‰ç«¯ä¹‹ååˆ°åº•å‚¨å­˜åœ¨å“ªé‡Œï¼Œä¸‹åˆæŸ¥äº†ä¸‹ç›®å‰æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼Œä¸€ç§æ˜¯å­˜åœ¨sessioné‡Œé¢ï¼Œç„¶åè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦å¤–ä¸€ç§åˆ™æ˜¯å­˜å‚¨åœ¨localstorage, å¯¹æ¯”è¿™ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼Œå‘ç°localstorageåœ¨å®¢æˆ·ç«¯çš„è¯ä»»ä½•äººéƒ½å¯ä»¥è·å–ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯è€ƒè™‘äº†é€šè¿‡sesisonæ¥å­˜å‚¨TOKENã€‚</p><p>æ–°å»ºSpringçš„æ§åˆ¶å™¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/provicer&quot;)</span><br><span class="line">   @ResponseBody</span><br><span class="line">   public String jwtTest(@RequestParam(value = &quot;username&quot;,required = false)String username,</span><br><span class="line">                         @RequestParam(value = &quot;password&quot;,required = false)String password,</span><br><span class="line">                         HttpServletRequest request,HttpServletResponse response</span><br><span class="line">                         )&#123;</span><br><span class="line">       if (username == null || password == null) &#123;</span><br><span class="line">           username = &quot;zhangsan&quot;;</span><br><span class="line">           Cookie[] cookie = request.getCookies();</span><br><span class="line">           if (cookie != null) &#123;</span><br><span class="line">               for (Cookie c : cookie) &#123;</span><br><span class="line">                   if (c.getName().equals(&quot;token&quot;)) &#123;</span><br><span class="line">                       if (decodeCookies(&quot;zheshijiakey&quot;, c.getValue()).equals(&quot;zhangsan&quot;)) &#123;</span><br><span class="line">                           return &quot;OK&quot;;</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       byte[] apiKeySecretBytes = DatatypeConverter.parseBase64Binary(&quot;zheshijiakey&quot;);</span><br><span class="line">       SignatureAlgorithm sigAlg = SignatureAlgorithm.HS256;</span><br><span class="line">       Key signingKey = new SecretKeySpec(apiKeySecretBytes, sigAlg.getJcaName());</span><br><span class="line">       System.out.println(signingKey);</span><br><span class="line">       System.out.println(username);</span><br><span class="line">       JwtBuilder builder = Jwts.builder()</span><br><span class="line">               .setSubject(username)</span><br><span class="line">               .signWith(sigAlg, signingKey);</span><br><span class="line"></span><br><span class="line">       String result =builder.compact();</span><br><span class="line">       Cookie cookie =new Cookie(&quot;token&quot;,result);</span><br><span class="line">       response.addCookie(cookie);</span><br><span class="line">       return result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   public static String decodeCookies(String Key , String jwt)&#123;</span><br><span class="line">       Jws&lt;Claims&gt; jws = Jwts.parser().setSigningKey(Key).parseClaimsJws(jwt);</span><br><span class="line">       return jws.getBody().getSubject();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªæµ‹è¯•ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰çœŸæ­£çš„æŸ¥è¯¢æ•°æ®åº“ï¼Œåœ¨è¿™é‡Œé»˜è®¤ä¸€ä¸ªç”¨æˆ·åå«zhangsan ,ä»£ç å°±æ˜¯åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†ï¼Œè‹¥æœªç™»å½•å°±ç”Ÿæˆä¸€ä¸ªåŒ…å«usenameä¸ºâ€™zhangsanâ€™çš„JWTtokenï¼Œç„¶åé€šè¿‡responseè¿”å›ç»™å‰ç«¯ï¼Œè‹¥åœ¨å‰ç«¯è¯·æ±‚çš„HTTPè¿æ¥ä¸­é€šè¿‡cookiesè·å–åˆ°äº†è¿™ä¸ªtokenï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œä¸€ä¸ªè§£æã€‚è¿™é‡Œè¿›è¡Œè§£æçš„æ—¶å€™è‹¥å‘ç°æ˜¯éæ³•tokençš„è¯ï¼Œæœ€å¥½è¿›è¡Œä¸€ä¸ªtry-catchç„¶åè¿”å›ç»™å‰ç«¯æŸäº›çº¦å®šçš„é”™è¯¯ç ç„¶åè·³è½¬ä¼šç™»é™†ç•Œé¢ã€‚<br>æµ‹è¯•ç»“æœ:<br>é¦–æ¬¡ç™»é™†å¦‚ä¸‹ï¼š<br><img src="ç”ŸæˆJWTå­—ç¬¦ä¸².PNG" alt=""></p><p>ç„¶åå½“ç™»é™†ä¸€æ¬¡ä¹‹åä¾¿ä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œæœ€ååœ¨ç¬¬äºŒæ¬¡è¯·æ±‚çš„æ—¶å€™ä¾¿ä¼šè¿”å›OK<br><img src="è¯·æ±‚ä¸€æ¬¡ä¹‹å.PNG" alt=""></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> Jwt </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>cssè®°å½•</title>
      <link href="/2018/03/30/css%E8%AE%B0%E5%BD%95/"/>
      <url>/2018/03/30/css%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<p>åœ¨cssçš„æ ·å¼åº”ç”¨ä¸­ï¼Œscriptæ˜¯ä¸€ä¸ªåŒæ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯è¯´scriptæ˜¯å¿…é¡»è¦é€šè¿‡æ ‡ç­¾é—­åˆçš„ä¹Ÿå°±æ˜¯<code>&lt;script&gt;&lt;/script&gt;</code>,è€Œä¸å¯ä»¥ä½¿ç”¨<code>&lt;script XXX/&gt;</code>è¿™æ ·å†™çš„è¯ä¼šå¯¼è‡´æµè§ˆå™¨è§£æä¸å‡ºæ¥é¡µé¢ï¼Œ<br>è€Œå•æ ‡ç­¾çš„è¯åˆ™æ˜¯å¯ä»¥é€šè¿‡<code>/&gt;</code>å…³é—­ã€‚ç±»ä¼¼äº<code>&lt;meta&gt;</code>æ ‡ç­¾çš„è¯åˆ™æ˜¯ä¸éœ€è¦<code>/&gt;</code>ä½†æ˜¯åœ¨å·¥ä½œä¸­çš„è¯æ˜¯æ¨èåŠ ä¸Šé—­åˆæ ‡ç­¾ï¼Œä»¥æ˜¯çš„ä»£ç æœ‰å¾ˆå¥½çš„å¯è¯»æ€§ã€‚</p><p>åŒç†åœ¨cssä¸­çš„pæ ‡ç­¾å¦‚æœåµŒå¥—äº†ä¸€ä¸ªh1æ ‡ç­¾çš„è¯ä¼šå‡ºç°è§£æé”™è¯¯,æ˜¯å› ä¸ºpæ ‡ç­¾çš„è¯åªèƒ½å‡ºç°è¡Œå†…å…ƒç´ å’Œæ–‡æœ¬ï¼Œè‹¥æ˜¯å‡ºç°äº†å—çº§å…ƒç´ çš„è¯:æµè§ˆå™¨çš„è§£ææ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;</span><br><span class="line">&lt;h1&gt;æµ‹è¯•çš„æ ‡é¢˜&lt;/h1&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">æµè§ˆå™¨è§£æï¼š</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;/p&gt;</span><br><span class="line">&lt;h1&gt;æµ‹è¯•çš„æ ‡é¢˜&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure></p><p>å‚ç›´æ–¹å‘ä¸Šçš„å¤–è¾¹è·ä¼šå åŠ ï¼Œå³å®½çš„å¤–è¾¹è·ä¼šå†³å®šå‚ç›´æ–¹å‘ä¸Šçš„è·ç¦»</p><p>ä¸ºè®¾ç½®äº†å®½åº¦çš„ç›’å­æ·»åŠ è¾¹è·å•¥çš„ä¼šå¯¼è‡´ç›’å­å˜å¾—æ›´å®½</p>]]></content>
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mysqlçš„ä¸€äº›æ€»ç»“</title>
      <link href="/2018/03/29/mysql%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/"/>
      <url>/2018/03/29/mysql%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©çªç„¶æœ‰ä¸€ä¸ªå†™sqlçš„æœºä¼šï¼Œä½†æ˜¯æ˜¯æ‰‹å†™ï¼Œä¸åƒä¹‹å‰é‚£æ ·å¯ä»¥åœ¨æ•°æ®åº“ä¸Šåšæµ‹è¯•ã€‚è¿™çªç„¶è®©æˆ‘æ„Ÿè§‰æœ‰çš„è¯­æ³•æœ‰ç‚¹ç”Ÿç–äº†ï¼Œæ‰€ä»¥ä¹˜ç€è¿™ä¸ªæœºä¼šæ¥åšä¸€ä¸ªå…¨éƒ¨çš„æ¢³ç†ã€‚</p><h2 id="groupbyå’Œwhereçš„é¡ºåºï¼š"><a href="#groupbyå’Œwhereçš„é¡ºåºï¼š" class="headerlink" title="groupbyå’Œwhereçš„é¡ºåºï¼š"></a>groupbyå’Œwhereçš„é¡ºåºï¼š</h2><p>ä»Šå¤©æ˜¯æœ‰ä¸¤è¡¨åšä¸€ä¸ªç­‰å€¼è¿æ¥æŸ¥è¯¢çš„ï¼Œåœ¨è¿™é‡Œåº”è¯¥æ˜¯å…ˆwhereä¹‹åå†è¿›è¡Œgroup byï¼Œ<code>group by</code>æ˜¯å¯¹<code>where</code>æ¡ä»¶è¿‡æ»¤ä¹‹åå†è¿›è¡Œåˆ†ç»„å¤„ç†ï¼Œæ‰€ä»¥whereåœ¨å‰ã€‚</p><h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><p>åœ¨è¿™é‡Œä¹‹å‰ä¸€ç›´å¯¹group byæœ‰ä¸€ä¸ªæ¯”è¾ƒé”™è¯¯çš„è®¤è¯†ï¼Œå…ˆçœ‹ä¸€ä¸‹è¡¨ç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT e.employeeNumber,e.firstName ,e.extension, o.state ,o.officeCode FROM employees e ,offices  o WHERE e.officeCode = o.officeCode;</span><br><span class="line">+----------------+-----------+-----------+------------+------------+</span><br><span class="line">| employeeNumber | firstName | extension | state      | officeCode |</span><br><span class="line">+----------------+-----------+-----------+------------+------------+</span><br><span class="line">|           1002 | Diane     | x5800     | CA         | 1          |</span><br><span class="line">|           1056 | Mary      | x4611     | CA         | 1          |</span><br><span class="line">|           1076 | Jeff      | x9273     | CA         | 1          |</span><br><span class="line">|           1143 | Anthony   | x5428     | CA         | 1          |</span><br><span class="line">|           1165 | Leslie    | x3291     | CA         | 1          |</span><br><span class="line">|           1166 | Leslie    | x4065     | CA         | 1          |</span><br><span class="line">|           1188 | Julie     | x2173     | MA         | 2          |</span><br><span class="line">|           1216 | Steve     | x4334     | MA         | 2          |</span><br><span class="line">|           1286 | Foon Yue  | x2248     | NY         | 3          |</span><br><span class="line">|           1323 | George    | x4102     | NY         | 3          |</span><br><span class="line">|           1102 | Gerard    | x5408     | NULL       | 4          |</span><br><span class="line">|           1337 | Loui      | x6493     | NULL       | 4          |</span><br><span class="line">|           1370 | Gerard    | x2028     | NULL       | 4          |</span><br><span class="line">|           1401 | Pamela    | x2759     | NULL       | 4          |</span><br><span class="line">|           1702 | Martin    | x2312     | NULL       | 4          |</span><br><span class="line">|           1621 | Mami      | x101      | Chiyoda-Ku | 5          |</span><br><span class="line">|           1625 | Yoshimi   | x102      | Chiyoda-Ku | 5          |</span><br><span class="line">|           1088 | William   | x4871     | NULL       | 6          |</span><br><span class="line">|           1611 | Andy      | x101      | NULL       | 6          |</span><br><span class="line">|           1612 | Peter     | x102      | NULL       | 6          |</span><br><span class="line">|           1619 | Tom       | x103      | NULL       | 6          |</span><br><span class="line">|           1501 | Larry     | x2311     | NULL       | 7          |</span><br><span class="line">|           1504 | Barry     | x102      | NULL       | 7          |</span><br><span class="line">+----------------+-----------+-----------+------------+------------+</span><br><span class="line">23 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™ä¹‹å‰ä¸€ç›´æ˜¯æƒ³é€šè¿‡groupbyè¾¾åˆ°å¦‚ä¸‹çš„æ•ˆæœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT e.employeeNumber,e.firstName ,e.extension, o.state ,o.officeCode FROM employees e ,offices  o WHERE e.officeCode = o.officeCode and o.officeCode=3;</span><br><span class="line">+----------------+-----------+-----------+-------+------------+</span><br><span class="line">| employeeNumber | firstName | extension | state | officeCode |</span><br><span class="line">+----------------+-----------+-----------+-------+------------+</span><br><span class="line">|           1286 | Foon Yue  | x2248     | NY    | 3          |</span><br><span class="line">|           1323 | George    | x4102     | NY    | 3          |</span><br><span class="line">+----------------+-----------+-----------+-------+------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>å…¶å®è¿™ç§åªèƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå†…è¿æ¥åŠ ä¸€ä¸ªæ¡ä»¶è¿‡æ»¤æ¥è¿›è¡Œå®ç°ï¼Œä½†æ˜¯åœ¨ä¹‹å‰çš„è¯æ˜¯ä¸€ç›´åœ¨è®°å¿†é‡Œé¢è®¤ä¸ºgroupbyå¯è¡Œï¼Œå…¶å®<strong>æ˜¯ä¸å¯è¡Œçš„</strong> ï¼Œä¸ºä»€ä¹ˆè¿™æ ·è¯´äº†ï¼Œå› ä¸ºgroup byæŒ‰ç…§æ¡ä»¶åˆ†ç»„ä¹‹åä»–æ¯ç»„åªä¼šæœ‰ä¸€æ¡ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œå°±å‡ºç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæ—¢ç„¶groupbyä¹‹åæ˜¾ç¤ºçš„æ˜¯ä¸€æ¡ï¼Œé‚£ä¹ˆè¿™ä¸¤è¡Œå¦‚ä½•æ˜¾ç¤ºå‘¢ï¼Ÿæ‰€ä»¥è¿™ç§é€šè¿‡groupbyæ¥æ˜¾ç¤ºçš„æ˜¯ä¸å¯è¡Œçš„ã€‚<br>é‚£ä¹ˆï¼Œgroupbyé€‚åˆä»€ä¹ˆå‘¢ï¼Ÿgroupbyé€‚åˆçš„æ˜¯æŒ‰ç…§åˆ†ç»„è¿›è¡Œç»Ÿè®¡çš„ï¼Œä¾‹å¦‚æ±‚æœ€å¤§è–ªæ°´ï¼Œå¹³å‡è–ªæ°´ç­‰ï¼Œè€Œä¸æ˜¯åˆ—å‡ºæŸä¸€ä¸ªåˆ†ç»„é‡Œé¢çš„æ‰€æœ‰äººçš„ã€‚åˆ—å‡ºæ‰€æœ‰äººè¿™æ˜¯whereæ“…é•¿çš„ï¼Œå¦‚ä¸‹æ•°æ®è¡¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT o.orderNUmber, o.orderDate, od.priceEach FROM orders o ,orderdetails od WHERE o.orderNumber =od.orderNumber limit 0,10;</span><br><span class="line">+-------------+------------+-----------+</span><br><span class="line">| orderNUmber | orderDate  | priceEach |</span><br><span class="line">+-------------+------------+-----------+</span><br><span class="line">|       10100 | 2003-01-06 |    136.00 |</span><br><span class="line">|       10100 | 2003-01-06 |     55.09 |</span><br><span class="line">|       10100 | 2003-01-06 |     75.46 |</span><br><span class="line">|       10100 | 2003-01-06 |     35.29 |</span><br><span class="line">|       10101 | 2003-01-09 |    108.06 |</span><br><span class="line">|       10101 | 2003-01-09 |    167.06 |</span><br><span class="line">|       10101 | 2003-01-09 |     32.53 |</span><br><span class="line">|       10101 | 2003-01-09 |     44.35 |</span><br><span class="line">|       10102 | 2003-01-10 |     95.55 |</span><br><span class="line">|       10102 | 2003-01-10 |     43.13 |</span><br><span class="line">+-------------+------------+-----------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæŒ‰ç…§orderNumber è¿›è¡Œgroupbyä¾¿å¯ä»¥æ±‚å‡ºæ¯ä¸€ä¸ªè®¢å•çš„æ€»ä»·äº†ï¼Œä¹Ÿè¯´æ˜äº†groupbyåªæ˜¯é€‚åˆäºåˆ†ç»„ç»Ÿè®¡ï¼Œè€Œä¸æ˜¯é€‚ç”¨äºåˆ†ç»„å±•ç¤ºï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SELECT o.orderNUmber, o.orderDate ,SUM(od.priceEach) FROM orders o ,orderdetails od WHERE o.orderNumber =od.orderNumber GROUP BY od.orderNumber limit 0,10;</span><br><span class="line">+-------------+------------+-------------------+</span><br><span class="line">| orderNUmber | orderDate  | SUM(od.priceEach) |</span><br><span class="line">+-------------+------------+-------------------+</span><br><span class="line">|       10100 | 2003-01-06 |            301.84 |</span><br><span class="line">|       10101 | 2003-01-09 |            352.00 |</span><br><span class="line">|       10102 | 2003-01-10 |            138.68 |</span><br><span class="line">|       10103 | 2003-01-29 |           1520.37 |</span><br><span class="line">|       10104 | 2003-01-31 |           1251.89 |</span><br><span class="line">|       10105 | 2003-02-11 |           1479.71 |</span><br><span class="line">|       10106 | 2003-02-17 |           1427.28 |</span><br><span class="line">|       10107 | 2003-02-24 |            793.21 |</span><br><span class="line">|       10108 | 2003-03-03 |           1432.86 |</span><br><span class="line">|       10109 | 2003-03-10 |            700.89 |</span><br><span class="line">+-------------+------------+-------------------+</span><br><span class="line">10 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p><p>è¿™æ‰æ˜¯groupbyçš„æ­£ç¡®ç”¨æ³•</p><h3 id="having-countå‡½æ•°ï¼š"><a href="#having-countå‡½æ•°ï¼š" class="headerlink" title="having countå‡½æ•°ï¼š"></a>having countå‡½æ•°ï¼š</h3><p><code>having count</code>å‡½æ•°å¯ä»¥é…åˆgroup by å¯¹åˆ†ç»„ä¹‹åçš„æ•°æ®è¿›è¡Œç­›é€‰ï¼Œè¿™æ˜¯whereè¿‡æ»¤æ‰€è¾¾ä¸åˆ°çš„ï¼Œå°±æ¯”å¦‚ä¸Šè¡¨ï¼Œéœ€è¦è¿‡æ»¤å‡ºè®¢å•ä»·æ ¼å¤§äº1000çš„ï¼Œé‚£ä¹ˆåœ¨ç”¨whereçš„æ—¶å€™åˆ™ä¼šæ˜¾å¾—å¾ˆä¹åŠ›ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT o.orderNUmber, o.orderDate ,SUM(od.priceEach) AS total FROM orders o ,orderdetails od WHERE o.orderNumber =od.orderNumber GROUP BY od.orderNumber HAVING TOTAL &gt; 1000 LIMIT 0,10;</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">| orderNUmber | orderDate  | total   |</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">|       10103 | 2003-01-29 | 1520.37 |</span><br><span class="line">|       10104 | 2003-01-31 | 1251.89 |</span><br><span class="line">|       10105 | 2003-02-11 | 1479.71 |</span><br><span class="line">|       10106 | 2003-02-17 | 1427.28 |</span><br><span class="line">|       10108 | 2003-03-03 | 1432.86 |</span><br><span class="line">|       10110 | 2003-03-18 | 1338.47 |</span><br><span class="line">|       10117 | 2003-04-16 | 1307.47 |</span><br><span class="line">|       10119 | 2003-04-28 | 1081.44 |</span><br><span class="line">|       10120 | 2003-04-29 | 1322.67 |</span><br><span class="line">|       10122 | 2003-05-08 | 1598.27 |</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>è¿™å°±æ˜¯havingé…åˆgroupbyçš„ä¾¿æ·æ€§ï¼Œé‚£ä¹ˆwhereé€‚åˆä»€ä¹ˆå½¢å¼çš„è¿‡æ»¤å‘¢ï¼Ÿæˆ‘ä¸ªäººè®¤ä¸ºwhereæ¯”è¾ƒé€‚åˆäºåœ¨groupbyä¹‹å‰å°±è¿›è¡Œæ•°æ®çš„è¿‡æ»¤ï¼Œè¿™æ ·ä¼šæ¯”è¾ƒå¥½ï¼Œè€Œhaving countåˆ™é€‚åˆäºgroupbyä¹‹åçš„ä¸€ä¸ªè¿‡æ»¤ã€‚</p><h3 id="OrderByå‡½æ•°ï¼š"><a href="#OrderByå‡½æ•°ï¼š" class="headerlink" title="OrderByå‡½æ•°ï¼š"></a>OrderByå‡½æ•°ï¼š</h3><p>orderbyå‡½æ•°å¯ä»¥å¯¹ç»“æœé›†è¿›è¡Œæ’åºï¼Œä»–æ—¢å¯ä»¥å’Œwhereæ­é…ä½¿ç”¨ï¼Œåˆå¯ä»¥å’Œgroupbyæ­é…ä½¿ç”¨ï¼Œåˆå¯ä»¥å’Œhavingä¸€èµ·æ­é…ä½¿ç”¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT o.orderNUmber, o.orderDate ,SUM(od.priceEach) AS total FROM orders o ,orderdetails od WHERE o.orderNumber =od.orderNumber GROUP BY od.orderNumber HAVING TOTAL &gt; 1000 order by total  LIMIT 0,10;</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">| orderNUmber | orderDate  | total   |</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">|       10341 | 2004-11-24 | 1003.19 |</span><br><span class="line">|       10293 | 2004-09-09 | 1004.59 |</span><br><span class="line">|       10246 | 2004-05-05 | 1006.78 |</span><br><span class="line">|       10420 | 2005-05-29 | 1014.01 |</span><br><span class="line">|       10311 | 2004-10-16 | 1033.82 |</span><br><span class="line">|       10380 | 2005-02-16 | 1034.10 |</span><br><span class="line">|       10412 | 2005-05-03 | 1034.15 |</span><br><span class="line">|       10278 | 2004-08-06 | 1034.86 |</span><br><span class="line">|       10361 | 2004-12-17 | 1052.87 |</span><br><span class="line">|       10271 | 2004-07-20 | 1054.03 |</span><br><span class="line">+-------------+------------+---------+</span><br><span class="line">10 rows in set (0.01 sec)</span><br></pre></td></tr></table></figure></p><h2 id="Mysqlçš„æ€»ç»“ï¼š"><a href="#Mysqlçš„æ€»ç»“ï¼š" class="headerlink" title="Mysqlçš„æ€»ç»“ï¼š"></a>Mysqlçš„æ€»ç»“ï¼š</h2><p>å…¶å®mysqlçš„è¿æ¥æ— éæ˜¯å·¦è¿æ¥ï¼Œå³è¿æ¥ï¼Œå†…è¿æ¥ï¼Œå…¨è¿æ¥ï¼Œä¹Ÿå°±left join ,right join ,inner join å’Œunionç­‰ï¼Œ<br>å…¶å®åœ¨è¿™é‡Œgroup by å’Œhaving countéƒ½å¯ä»¥å¯¹å¤šåˆ—è¿›è¡Œä¸€ä¸ªæ’åºæˆ–è€…è¿‡æ»¤ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€è¡Œ</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åˆ©ç”¨Jqueryå’ŒSpringå¼‚æ­¥ä¸Šä¼ æ–‡ä»¶</title>
      <link href="/2018/03/29/%E5%88%A9%E7%94%A8Jquery%E5%92%8CSpring%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/"/>
      <url>/2018/03/29/%E5%88%A9%E7%94%A8Jquery%E5%92%8CSpring%E5%BC%82%E6%AD%A5%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/</url>
      <content type="html"><![CDATA[<h2 id="å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶ï¼š"><a href="#å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶ï¼š" class="headerlink" title="å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶ï¼š"></a>å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶ï¼š</h2><p>ç”¨Jqueryçš„å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™éœ€è¦å¼•å…¥ä¸€ä¸ªjsæ–‡ä»¶<code>jquery.form.min.js</code>ï¼Œç”¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„$.ajaxSubmit()æ–¹æ³•æ¥å®ç°ä¸€ä¸ªå¼‚æ­¥çš„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$(this).ajaxSubmit(&#123;</span><br><span class="line">           type:&apos;POST&apos;,</span><br><span class="line">           url: &quot;/uploadfile&quot;,</span><br><span class="line">           dataType: &apos;json&apos;,</span><br><span class="line">           data: serializeData,</span><br><span class="line">           contentType: false,</span><br><span class="line">           cache: false,</span><br><span class="line">           processData:false,</span><br><span class="line">           beforeSubmit: function() &#123;</span><br><span class="line">       &#125;,</span><br><span class="line">       uploadProgress: function (event, position, total, percentComplete)&#123;</span><br><span class="line">       &#125;,</span><br><span class="line">       success:function()&#123;</span><br><span class="line"></span><br><span class="line">       &#125;,</span><br><span class="line">       error:function(data)&#123;</span><br><span class="line">           alert(&apos;ä¸Šä¼ å›¾ç‰‡å‡ºé”™&apos;);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;);</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œçš„è¯<code>$(&quot;&quot;)</code>å‡½æ•°éœ€è¦æ˜¯formçš„idï¼Œè€Œä¸”<code>beforeSubmit</code>å¯ä»¥åœ¨ä¸Šä¼ æ–‡ä»¶ä¹‹å‰å¯ä»¥åšä¸€äº›æ£€æŸ¥ï¼Œä¾‹å¦‚æ–‡ä»¶åç¼€æˆ–è€…æ–‡ä»¶å¤§å°ä¹‹ç±»çš„æ£€æŸ¥ã€‚</p><p>åœ¨åç«¯çš„è¯æ¥å—ä¸Šä¼ çš„æ–‡ä»¶å…¶å®è·ŸServletå·®ä¸å¤šï¼Œä¸»è¦æ˜¯ä»requestä¸­è·å–è¯·æ±‚æµï¼Œå‚æ•°çš„è¯éœ€è¦æ ‡è®°ä¸ºè¿™ä¸ª<code>@RequestParam(&quot;file&quot;) MultipartFile file</code>,æœ€ååœ¨SpringMvcä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å¯ä»¥å°†ä¸Šä¼ çš„æ–‡ä»¶é€šè¿‡ç§»åŠ¨æˆ–è€…å¤åˆ¶ç„¶åè½¬ç§»åˆ°æˆ‘ä»¬æŒ‡å®šçš„æ–‡ä»¶å¤¹ä¸­ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">void transferTo(java.io.File dest)</span><br><span class="line">         throws java.io.IOException,</span><br><span class="line">                java.lang.IllegalStateException</span><br><span class="line">Transfer the received file to the given destination file.</span><br><span class="line">This may either move the file in the filesystem, copy the file in the filesystem, or save memory-held contents to the destination file. If the destination file already exists, it will be deleted first.</span><br><span class="line"></span><br><span class="line">If the target file has been moved in the filesystem, this operation cannot be invoked again afterwards. Therefore, call this method just once in order to work with any storage mechanism.</span><br><span class="line"></span><br><span class="line">NOTE: Depending on the underlying provider, temporary storage may be container-dependent, including the base directory for relative destinations specified here (e.g. with Servlet 3.0 multipart handling). For absolute destinations, the target file may get renamed/moved from its temporary location or newly copied, even if a temporary copy already exists.</span><br><span class="line"></span><br><span class="line">Parameters:</span><br><span class="line">dest - the destination file (typically absolute)</span><br><span class="line">Throws:</span><br><span class="line">java.io.IOException - in case of reading or writing errors</span><br><span class="line">java.lang.IllegalStateException - if the file has already been moved in the filesystem and is not available anymore for another transfer</span><br><span class="line">See Also:</span><br><span class="line">FileItem.write(File), Part.write(String)</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–¹æ³•<code>transferTo</code>ä¼šå°†æ¥æ”¶åˆ°çš„æ–‡ä»¶ç§»åŠ¨æˆ–è€…copyåˆ°æŒ‡å®šçš„ä½ç½®ã€‚<br>é‚£ä¹ˆåœ¨Controllerä¸­çš„ä¸»è¦æ–¹æ³•ä½“æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/uploadfile&quot; ,method = RequestMethod.POST)</span><br><span class="line">        @ResponseBody</span><br><span class="line">        public String uploadfile( @RequestParam(&quot;file&quot;) MultipartFile file) throws IOException &#123;</span><br><span class="line">        Map&lt;String ,Object&gt; map =new HashMap&lt;&gt;();</span><br><span class="line">        /*  ä¸Šä¼ çš„æ–‡ä»¶ä¸ºç©º */</span><br><span class="line">        if(file ==  null || file.isEmpty())&#123;</span><br><span class="line">            map.put(&quot;code&quot;,&quot;0&quot;);</span><br><span class="line">            map.put(&quot;msg&quot;,&quot;fail&quot;);</span><br><span class="line">            return JSON.toJSONString(map);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            String rootPath = &quot;D:\\disk&quot;;</span><br><span class="line">            File dir = new File(rootPath + File.separator + &quot;tmpFiles&quot;);</span><br><span class="line">            File serverFile = new File(dir.getAbsolutePath() + File.separator + file.getOriginalFilename());</span><br><span class="line">            file.transferTo(serverFile);</span><br><span class="line">            map.put(&quot;code&quot;,&quot;1&quot;);</span><br><span class="line">            map.put(&quot;msg&quot;,&quot;success&quot;);</span><br><span class="line">            return JSON.toJSONString(map);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ–¹æ³•çš„è¯å¦‚æœæ–‡ä»¶ä¸Šä¼ æˆåŠŸä¼šè¿”å›ä¸€ä¸ªjsonæ ¼å¼çš„ä¿¡æ¯ï¼Œä»è€Œæç¤ºå‰ç«¯æ–‡ä»¶å·²ç»ä¸Šä¼ æˆåŠŸäº†ã€‚</p><h2 id="ç”ŸæˆéªŒè¯ç ï¼š"><a href="#ç”ŸæˆéªŒè¯ç ï¼š" class="headerlink" title="ç”ŸæˆéªŒè¯ç ï¼š"></a>ç”ŸæˆéªŒè¯ç ï¼š</h2><p>åœ¨è¿™é‡Œçš„è¯é¡ºå¸¦åœ¨è¯´ä¸‹å…³äºéªŒè¯ç çš„äº‹æƒ…ï¼Œåœ¨Springé‡Œé¢ä½¿ç”¨éªŒè¯ç çš„è¯å¯ä»¥ä½¿ç”¨googleçš„<code>kaptcha</code>è¿™ä¸ªjaråŒ…ï¼Œå› ä¸ºåœ¨mavenä»“åº“ä¸­çš„è¯æ˜¯æ²¡æœ‰è¿™ä¸ªç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥è¿™ä¸ªéœ€è¦è‡ªå·±ä¸‹è½½åˆ°æœ¬åœ°ç„¶åé€šè¿‡å‘½ä»¤è¡Œå¯¼å…¥ï¼Œæœ€åæ‰å¯ä»¥åœ¨pomæ–‡ä»¶ä¸­å¼•ç”¨è¿™ä¸ªåŒ…ï¼›å¯¼å…¥æ–¹æ³•å¦‚ä¸‹ï¼š<br><code>mvn install:install-file  -Dfile=jaråŒ…ä½ç½® -DgroupId=com.google.code -DartifactId=kaptcha -Dversion=2.3.2 -Dpackaging=jar</code>ï¼Œè¿™æ ·åœ¨pomæ–‡ä»¶ä¸­ä¾¿å¯ä»¥å¼•ç”¨äº†ã€‚<br>å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.google.code&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;kaptcha&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;2.3.2&lt;/version&gt;</span><br><span class="line">   &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶åœ¨ApplicationContext.xmlä¸­æ·»åŠ ä¸€ä¸ªbean.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;captchaProducer&quot; class=&quot;com.google.code.kaptcha.impl.DefaultKaptcha&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;config&quot;&gt;</span><br><span class="line">            &lt;bean class=&quot;com.google.code.kaptcha.util.Config&quot;&gt;</span><br><span class="line">                &lt;constructor-arg&gt;</span><br><span class="line">                    &lt;props&gt;</span><br><span class="line">                        &lt;!-- å›¾ç‰‡è¾¹æ¡† --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.border&quot;&gt;no&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- å›¾ç‰‡å®½åº¦ --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.image.width&quot;&gt;95&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- å›¾ç‰‡é«˜åº¦ --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.image.height&quot;&gt;45&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç èƒŒæ™¯é¢œè‰²æ¸å˜ï¼Œå¼€å§‹é¢œè‰² --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.background.clear.from&quot;&gt;248,248,248&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç èƒŒæ™¯é¢œè‰²æ¸å˜ï¼Œç»“æŸé¢œè‰² --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.background.clear.to&quot;&gt;248,248,248&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç çš„å­—ç¬¦ --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.char.string&quot;&gt;0123456789abcdefghijklmnopqrstuvwxyzè¿™æ˜¯ä¸€ä¸ªæµ‹è¯•éªŒè¯ç çš„ä¾‹å­&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç å­—ä½“é¢œè‰² --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.font.color&quot;&gt;0,0,255&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç çš„æ•ˆæœï¼Œæ°´çº¹ --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.obscurificator.impl&quot;&gt;com.google.code.kaptcha.impl.WaterRipple&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç å­—ä½“å¤§å° --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.font.size&quot;&gt;35&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç å­—æ•° --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.char.length&quot;&gt;4&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç æ–‡å­—é—´è· --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.char.space&quot;&gt;2&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- éªŒè¯ç å­—ä½“ --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.font.names&quot;&gt;new Font(&quot;Arial&quot;, 1, fontSize), new Font(&quot;Courier&quot;, 1, fontSize)&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- ä¸åŠ å™ªå£° --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.noise.impl&quot;&gt;com.google.code.kaptcha.impl.NoNoise&lt;/prop&gt;</span><br><span class="line">                    &lt;/props&gt;</span><br><span class="line">                &lt;/constructor-arg&gt;</span><br><span class="line">            &lt;/bean&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure></p><p>æœ€ååœ¨Controlleræ·»åŠ å¦‚ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;verificationcode&quot;, method = RequestMethod.GET)</span><br><span class="line">    public ModelAndView Verificationcode(ModelAndView modelAndView, HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">                                         @RequestParam(value = &quot;timestamp&quot;, required = false) String timestamp) throws IOException &#123;</span><br><span class="line">        /* æ·»åŠ æ—¶é—´æˆ³ï¼Œä»¥è®¾ç½®éªŒè¯ç çš„è¿‡æœŸæ—¶é—´*/</span><br><span class="line">        if (timestamp == null || timestamp.length() == 0) &#123;</span><br><span class="line">            modelAndView.addObject(&quot;timestamp&quot;, System.currentTimeMillis());</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            modelAndView.addObject(&quot;timestamp&quot;, timestamp);</span><br><span class="line">        &#125;</span><br><span class="line">        response.setDateHeader(&quot;Expires&quot;, 0);</span><br><span class="line">        response.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache, must-revalidate&quot;);</span><br><span class="line">        response.addHeader(&quot;Cache-Control&quot;, &quot;post-check=0, pre-check=0&quot;);</span><br><span class="line">        response.setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);</span><br><span class="line">        response.setContentType(&quot;image/jpeg&quot;);</span><br><span class="line">        String capText = captchaProducer.createText();</span><br><span class="line">        request.getSession().setAttribute(Constants.KAPTCHA_SESSION_KEY, capText);</span><br><span class="line">        BufferedImage bi = captchaProducer.createImage(capText);</span><br><span class="line">        ServletOutputStream out = response.getOutputStream();</span><br><span class="line">        ImageIO.write(bi, &quot;jpg&quot;, out);</span><br><span class="line">        try &#123;</span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>æœ€ååœ¨å‰ç«¯é¡µé¢å¼•ç”¨<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;verificationcode&quot;&gt;  //åœ¨è¿™é‡Œéšæ„è®¾ç½®å®½åº¦å’Œé«˜åº¦å³å¯ã€‚</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> jquery </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>é¡µé¢å¸ƒå±€ä»¥åŠJSè§£æjsonçš„æ€»ç»“</title>
      <link href="/2018/03/28/%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80%E4%BB%A5%E5%8F%8Ajquery%E8%A7%A3%E6%9E%90json%E7%9A%84%E6%80%BB%E7%BB%93/"/>
      <url>/2018/03/28/%E9%A1%B5%E9%9D%A2%E5%B8%83%E5%B1%80%E4%BB%A5%E5%8F%8Ajquery%E8%A7%A3%E6%9E%90json%E7%9A%84%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h2 id="å…³äºé¡µé¢çš„æ°´å¹³å‚ç›´å±…ä¸­ï¼š"><a href="#å…³äºé¡µé¢çš„æ°´å¹³å‚ç›´å±…ä¸­ï¼š" class="headerlink" title="å…³äºé¡µé¢çš„æ°´å¹³å‚ç›´å±…ä¸­ï¼š"></a>å…³äºé¡µé¢çš„æ°´å¹³å‚ç›´å±…ä¸­ï¼š</h2><p>é¡µé¢çš„æ°´å¹³å‚ç›´å±…ä¸­å¸ƒå±€çš„è¯ç›®å‰å°±æˆ‘è¿™é‡Œäº†è§£çš„è¯æ˜¯åˆä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ç›’å­å¸ƒå±€ï¼Œä¸€ç§æ˜¯æµå¼å¸ƒå±€ï¼š<br>ç›’å­å¸ƒå±€</p><h2 id="å…³äºJqueryè§£æJSONæ ¼å¼çš„é—®é¢˜"><a href="#å…³äºJqueryè§£æJSONæ ¼å¼çš„é—®é¢˜" class="headerlink" title="å…³äºJqueryè§£æJSONæ ¼å¼çš„é—®é¢˜"></a>å…³äºJqueryè§£æJSONæ ¼å¼çš„é—®é¢˜</h2><h3 id="JSON-parse-æ–¹æ³•"><a href="#JSON-parse-æ–¹æ³•" class="headerlink" title="JSON.parse()æ–¹æ³•"></a>JSON.parse()æ–¹æ³•</h3><p>åœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è§£æJsonæ ¼å¼çš„æ—¶å€™ä¸€ç›´ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¼ å…¥çš„å€¼å´åˆæ˜æ˜æ˜¯JSONæ ¼å¼çš„ï¼Œæ‰€ä»¥ä¸€ç›´åœ¨æ’æŸ¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=&apos;&#123;&quot;first&quot;:&quot;111&quot;&#125;&apos;;</span><br><span class="line">b=&quot;&#123;&apos;first&apos;:&apos;111&apos;&#125;&quot;;</span><br><span class="line">console.log(JSON.parse(a));</span><br><span class="line">console.log(JSON.parse(b))  //åœ¨è¿™é‡Œä¼šæŠ¥é”™ï¼Œæç¤ºUnexpected token &apos; in JSON at position 1</span><br></pre></td></tr></table></figure></p><p>è¿™å°±å¼•å‡ºäº†åœ¨JSä¸­ä½¿ç”¨JSONè§£æJsonå­—ç¬¦ä¸²çš„é—®é¢˜äº†ï¼Œä¸‹å›¾æ˜¯è§£æå­—ç¬¦ä¸²çš„é¡ºåºäº†ï¼Œåœ¨ä¸‹å›¾å¯ä»¥çœ‹åˆ°è§£ææ˜¯ä»¥<code>&quot;</code>ä¸ºèµ·ç‚¹ï¼Œç„¶åæ˜¯<code>/</code>ï¼Œè‹¥åœ¨å¼€å§‹çš„ä½ç½®æ²¡æœ‰å‘ç°è¿™ä¸¤ä¸ªèµ·å§‹ç¬¦å·çš„è¯é‚£ä¹ˆjsä¼šè·³è¿‡è¿™æ¬¡è§£æç›´æ¥åˆ°è¾¾æœ«å°¾ï¼Œç„¶åæŠ¥é”™ï¼Œè¿™ä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆåœ¨è§£æbçš„æ—¶å€™ä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸<code>Unexpected token &#39;</code><br><img src="JSè§£æJson.PNG" alt=""></p><h3 id="JSON-parse-æ–¹æ³•-1"><a href="#JSON-parse-æ–¹æ³•-1" class="headerlink" title="JSON.parse()æ–¹æ³•"></a>JSON.parse()æ–¹æ³•</h3><p>è¿™ä¸ªæ–¹å¼æ˜¯å°†ä¸€ä¸ªJsçš„Objectè§£ææˆä¸€ä¸ªJsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var obj=&#123;</span><br><span class="line">    &apos;a&apos;:123,</span><br><span class="line">    &quot;b&quot;:&quot;qq&quot;</span><br><span class="line">&#125;</span><br><span class="line">console.log(JSON.stringify(obj))</span><br><span class="line"></span><br><span class="line">è¾“å‡º&#123;&quot;a&quot;:123,&quot;b&quot;:&quot;qq&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡ä¸­çš„è¯ï¼Œå•å¼•å·ä¼šè¢«è½¬æˆåŒå¼•å·ã€‚</p><h3 id="JSONæ ¼å¼ï¼š"><a href="#JSONæ ¼å¼ï¼š" class="headerlink" title="JSONæ ¼å¼ï¼š"></a>JSONæ ¼å¼ï¼š</h3><p>JSONæ ¼å¼çš„è§„èŒƒå¦‚ä¸‹ï¼Œè€Œä½¿ç”¨JSON.parse()æ¥è§£æå•å¼•å·çš„å†…å®¹çš„è¯æ˜¯ä¸ç¬¦åˆè§„èŒƒçš„ã€‚</p><blockquote><p>JSON åç§°/å€¼å¯¹<br>JSON æ•°æ®çš„ä¹¦å†™æ ¼å¼æ˜¯ï¼šåç§°/å€¼å¯¹ã€‚</p></blockquote><p>åç§°/å€¼å¯¹åŒ…æ‹¬å­—æ®µåç§°ï¼ˆåœ¨åŒå¼•å·ä¸­ï¼‰ï¼Œåé¢å†™ä¸€ä¸ªå†’å·ï¼Œç„¶åæ˜¯å€¼ï¼š</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webå‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mysqlå’Œæ—¶é—´ç›¸å…³çš„æŸ¥è¯¢(äºŒ)</title>
      <link href="/2018/03/28/mysql%E5%92%8C%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3%E7%9A%84%E6%9F%A5%E8%AF%A2-%E4%BA%8C/"/>
      <url>/2018/03/28/mysql%E5%92%8C%E6%97%B6%E9%97%B4%E7%9B%B8%E5%85%B3%E7%9A%84%E6%9F%A5%E8%AF%A2-%E4%BA%8C/</url>
      <content type="html"><![CDATA[<h2 id="DATE-ADD"><a href="#DATE-ADD" class="headerlink" title="DATE_ADD():"></a>DATE_ADD():</h2><p>è¿™ä¸ªå‡½æ•°å¯ä»¥å°†æ—¥æœŸå¾€å‰åŠ ä¸Šè§„å®šçš„å¹´ï¼Œæœˆæˆ–è€…æ—¥ï¼Œä»è€Œæ–¹ä¾¿ç»Ÿè®¡ï¼Œä¾‹å¦‚éœ€è¦ç»Ÿè®¡æœ¬æœˆçš„æŸäº›æ•°æ®çš„è¯ï¼Œä¸€èˆ¬æ¥è®²è‚¯å®šæ˜¯åªéœ€è¦å¤§äºæœ¬æœˆæœˆåˆå³å¯ï¼Œä½†æ˜¯ä¸ºäº†è€ƒè™‘ç¨‹åºçš„å¥å£®æ€§çš„è¯è‚¯å®šæ˜¯éœ€è¦å†åŠ ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼Œæ¯”å¦‚è¯´å°äºä¸‹ä¸ªæœˆ1å·ã€‚é‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªä¸€ä¸ªDATE_ADD()å‡½æ•°ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">  *</span><br><span class="line">FROM</span><br><span class="line">  table</span><br><span class="line">WHERE time_columns &gt; CONCAT(LEFT(NOW() - INTERVAL 0 MONTH, 7), &apos;-01&apos;)</span><br><span class="line">  AND time_columns &lt; DATE_ADD(CURDATE()-DAY(CURDATE())+1,INTERVAL 1 MONTH);</span><br></pre></td></tr></table></figure></p><p>è¿™æ¡sqlä¾¿æ˜¯æ±‚çš„æœ¬æœˆçš„æ•°æ®ã€‚åŒæ—¶åœ¨è¿™é‡Œä¹Ÿå¯¹å½“å‰æ—¶é—´çš„å‡½æ•°è¿›è¡Œä¸€ä¸ªå¯¹æ¯”ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT CURDATE();</span><br><span class="line">+------------+</span><br><span class="line">| CURDATE()  |</span><br><span class="line">+------------+</span><br><span class="line">| 2018-03-28 |</span><br><span class="line">+------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select now();</span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2018-03-28 15:07:15 |</span><br><span class="line">+---------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select CURTIME();</span><br><span class="line">+-----------+</span><br><span class="line">| CURTIME() |</span><br><span class="line">+-----------+</span><br><span class="line">| 15:07:39  |</span><br><span class="line">+-----------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>é¡ºä¾¿åœ¨è¿™é‡Œå†è®°å½•ä¸‹mybatisä¸­çš„åˆ«åçš„ä½œç”¨ï¼Œåœ¨resultTypeä¸­è¿”å›çš„é€šå¸¸æ˜¯å…¨è·¯å¾„åŒ…åï¼Œä½†æ˜¯å…¶å®é…ç½®å¥½åˆ«åçš„è¯å…¶å®æ˜¯å¯ä»¥ç›´æ¥è¿”å›åˆ«å&gt; æ·±å…¥æµ…å‡ºmybatisæŠ€æœ¯åŸç†ä¸å®ç°P17ä»¥åŠåé¢çš„mapperæ–‡ä»¶çš„resultType</p><p>å¦å¤–å°±æ˜¯mybaytisçš„<code>$</code>å’Œ<code>#</code>çš„åŒºåˆ«ï¼Œå…¶å®<code>$</code>è¿™ä¸ªåœ¨é…ç½®æ–‡ä»¶ä¸­æ˜¯å¾ˆç»å¸¸ä½¿ç”¨çš„ï¼Œä¾‹å¦‚:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot; init-method=&quot;init&quot; destroy-method=&quot;close&quot;&gt;</span><br><span class="line">        &lt;!-- åŸºæœ¬å±æ€§ urlã€userã€password --&gt;</span><br><span class="line">        &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.jdbc.Driver&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;username&quot; value=&quot;root&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œå°±æ˜¯ç”¨çš„<code>$</code>,è€Œä¸”åœ¨mybatisçš„å®˜æ–¹æ–‡æ¡£é‡Œé¢ä¹Ÿæåˆ°è¿‡äº†å…³äº<code>#</code>å’Œ<code>$</code>çš„åŒºåˆ«â€</p><blockquote><p>String Substitution<br>  By default, using the #{} syntax will cause MyBatis to generate PreparedStatement properties and set the values safely against the PreparedStatement parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject an unmodified string into the SQL Statement. For example, for ORDER BY, you might use something like this:<br>  ORDER BY ${columnName}<br>  Here MyBatis wonâ€™t modify or escape the string.<br>  NOTE Itâ€™s not safe to accept input from a user and supply it to a statement unmodified in this way. This leads to potential SQL Injection attacks and therefore you should either disallow user input in these fields, or always perform your own escapes and checks.</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™é‡Œçš„è¯<code>$</code>æ˜¯ä¸€ä¸ªé™æ€å ä½ç¬¦,ä½†æ˜¯åœ¨mybatisçš„æºæ–‡ä»¶ä¸­ä¸€ç›´æ²¡æ‰¾åˆ°å…³äºè§£æ<code>$</code>çš„ç±»å’Œæ–¹æ³•ï¼Œåªæ‰¾åˆ°äº†å…³äºè§£æ<code>#</code>çš„æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public SqlSource parse(String originalSql, Class&lt;?&gt; parameterType, Map&lt;String, Object&gt; additionalParameters) &#123;</span><br><span class="line">       SqlSourceBuilder.ParameterMappingTokenHandler handler = new SqlSourceBuilder.ParameterMappingTokenHandler(this.configuration, parameterType, additionalParameters);</span><br><span class="line">       GenericTokenParser parser = new GenericTokenParser(&quot;#&#123;&quot;, &quot;&#125;&quot;, handler);</span><br><span class="line">       String sql = parser.parse(originalSql);</span><br><span class="line">       return new StaticSqlSource(this.configuration, sql, handler.getParameterMappings());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><p>å…³äºè¿™ä¸ª<code>${}</code>çš„è¯åœ¨mybatisé‡Œé¢æ˜¯ä¼šç›´æ¥å°†æˆ‘ä»¬æ‰€å†™çš„sqlæ”¾å…¥åˆ°é¢„å®šçš„sqlè¯­å¥ä¸­ï¼Œè€Œä¸æ˜¯åƒ<code>#{}</code>é‚£æ ·ä¼šè¿›è¡Œä¸€ä¸ªæ›¿æ¢ï¼Œæ‰€ä»¥ä¼šé€ æˆä¸€ä¸ªå®‰å…¨é—®é¢˜</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysqlæ—¶é—´ç›¸å…³ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>springè¿æ¥redisçš„ä¸€äº›åšæ³•ä»¥åŠmybatisçš„ä¸€äº›æ„Ÿæƒ³</title>
      <link href="/2018/03/27/spring%E8%BF%9E%E6%8E%A5redis%E7%9A%84%E4%B8%80%E4%BA%9B%E5%81%9A%E6%B3%95%E4%BB%A5%E5%8F%8Amybatis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%84%9F%E6%83%B3/"/>
      <url>/2018/03/27/spring%E8%BF%9E%E6%8E%A5redis%E7%9A%84%E4%B8%80%E4%BA%9B%E5%81%9A%E6%B3%95%E4%BB%A5%E5%8F%8Amybatis%E7%9A%84%E4%B8%80%E4%BA%9B%E6%84%9F%E6%83%B3/</url>
      <content type="html"><![CDATA[<h2 id="Rediså¯åŠ¨"><a href="#Rediså¯åŠ¨" class="headerlink" title="Rediså¯åŠ¨"></a>Rediså¯åŠ¨</h2><p>é¦–å…ˆå¼€å¯redisæœåŠ¡ï¼Œwindowsçš„redisä¸‹è½½åœ¨github <a href="https://github.com/MicrosoftArchive/redis/releases" target="_blank" rel="noopener">windowsçš„redisä¸‹è½½åœ°å€</a>,ç„¶åè§£å‹å‡ºæ¥æœ€åå¼€å¯é‚£ä¸ªredis-serverã€‚<br>å¯åŠ¨ä¹‹åæ˜¾ç¤ºå¦‚ä¸‹å›¾ï¼š<br><img src="redis.PNG" alt=""></p><h2 id="springé…ç½®ï¼š"><a href="#springé…ç½®ï¼š" class="headerlink" title="springé…ç½®ï¼š"></a>springé…ç½®ï¼š</h2><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>åœ¨Springä¸­ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶<code>redis.properties</code>é…ç½®ï¼Œä½†æ˜¯ç”±äºåœ¨è¿™ä¸ªé¡¹ç›®ä¸­çš„é…ç½®æ–‡ä»¶å·²ç»å¤ªå¤šäº†ï¼Œæ‰€ä»¥é€‰æ‹©ä½¿ç”¨ç±»çš„æ–¹å¼è¿›è¡Œé…ç½®:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    JedisConnectionFactory jedisConnectionFactory()</span><br><span class="line">    &#123;</span><br><span class="line">        JedisConnectionFactory connectionFactory = new JedisConnectionFactory();</span><br><span class="line">        connectionFactory.setHostName(&quot;127.0.0.1&quot;);</span><br><span class="line">        connectionFactory.setPort(6379);</span><br><span class="line">        return new JedisConnectionFactory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @Autowired</span><br><span class="line">    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory)</span><br><span class="line">    &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        template.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        return template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æœ€ååœ¨ä½¿ç”¨çš„æ—¶å€™è‡ªåŠ¨è£…é…å°±å¯ä»¥äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">      private RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure></p><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p>ç¼–å†™å•å…ƒæµ‹è¯•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@ContextConfiguration(&quot;classpath:ApplicationContext.xml&quot;)</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">public class TestRedis  extends AbstractJUnit4SpringContextTests &#123;</span><br><span class="line"></span><br><span class="line">      @Autowired</span><br><span class="line">      private RedisTemplate redisTemplate;</span><br><span class="line">      @Test</span><br><span class="line">      public void redisTest() throws UnsupportedEncodingException &#123;</span><br><span class="line">          redisTemplate.opsForValue().set(&quot;zhangsan&quot;, &quot;book1&quot;);</span><br><span class="line">          if (redisTemplate.hasKey(&quot;abc&quot;))&#123;</span><br><span class="line">              System.out.println(&quot;abcå·²ç»å­˜å…¥redis&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç„¶åä¼šå‘ç°æ•°æ®å·²ç»æ·»åŠ åˆ°äº†è¿™ä¸ªredisæœåŠ¡å™¨ä¸­äº†ã€‚</p><h2 id="Mybatisçš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š"><a href="#Mybatisçš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š" class="headerlink" title="Mybatisçš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š"></a>Mybatisçš„ä¸€äº›çŸ¥è¯†ç‚¹ï¼š</h2><p><code>SqlSesssionFactoryBuilder</code>:è¿™æ˜¯ä¸€ä¸ªå·¥å‚ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€äº›SqlSessioFactoryï¼Œå¯¹äºSqlSessionFactoryæ¥è¯´ï¼Œå®ƒçš„èŒè´£å°±æ˜¯åˆ›å»ºæ¯ä¸€ä¸ªSqlSessionï¼Œç„¶åè¿™ä¸ªSqlSessionçš„ä½œç”¨åˆ™æ˜¯è¿æ¥æ•°æ®åº“ï¼Œç±»ä¼¼äºä¼ ç»Ÿçš„JDBCçš„Connectionï¼Œ</p><p>SqlSesssionFactoryBuilderè¿™ä¸ªç±»ä¸»è¦æ˜¯åˆ›å»ºSqlSessioFactory,åœ¨è¿™ä¸ªç±»é‡Œé¢å¯ä»¥çœ‹åˆ°è®¸å¤šæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªSqlSessionFactoryï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯è§£æé…ç½®æ–‡ä»¶çš„æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public SqlSessionFactory build(Reader reader, String environment, Properties properties) &#123;</span><br><span class="line">        SqlSessionFactory var5;</span><br><span class="line">        try &#123;</span><br><span class="line">            XMLConfigBuilder parser = new XMLConfigBuilder(reader, environment, properties);</span><br><span class="line">            var5 = this.build(parser.parse());</span><br><span class="line">        &#125; catch (Exception var14) &#123;</span><br><span class="line">            throw ExceptionFactory.wrapException(&quot;Error building SqlSession.&quot;, var14);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            ErrorContext.instance().reset();</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                reader.close();</span><br><span class="line">            &#125; catch (IOException var13) &#123;</span><br><span class="line">                ;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return var5;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæµï¼Œè¿™ä¸ªæµæ˜¯å°†ä¸€ä¸ªpropertiesæˆ–è€…xmlæ–‡ä»¶è¯»å–ä¹‹åä¾›mybatisä½¿ç”¨çš„ã€‚<br>è€Œå¯¹äºSqlSessionFactoryæ¥è®²ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸»è¦çš„æ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public interface SqlSessionFactory &#123;</span><br><span class="line">    SqlSession openSession();</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(boolean var1);</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(Connection var1);</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(TransactionIsolationLevel var1);</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(ExecutorType var1);</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(ExecutorType var1, boolean var2);</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(ExecutorType var1, TransactionIsolationLevel var2);</span><br><span class="line"></span><br><span class="line">    SqlSession openSession(ExecutorType var1, Connection var2);</span><br><span class="line"></span><br><span class="line">    Configuration getConfiguration();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªFactoryä¸»è¦è´Ÿè´£çš„æ˜¯Sessionçš„å¼€å¯æ¥æŸ¥è¯¢æ•°æ®åº“</p><h3 id="æ³¨æ„çš„å‘ï¼š"><a href="#æ³¨æ„çš„å‘ï¼š" class="headerlink" title="æ³¨æ„çš„å‘ï¼š"></a>æ³¨æ„çš„å‘ï¼š</h3><p>åœ¨mybatyisé‡Œé¢çš„è¯è‹¥ä½¿ç”¨å¯¹è±¡ä¼ å‚çš„è¯éœ€è¦æ³¨æ„<code>#{XXX}=YYY</code>ï¼Œè¿™é‡Œçš„YYYçš„è¯æ˜¯éœ€è¦å’ŒPOJOç›¸å¯¹åº”çš„ï¼Œå¦åˆ™ä¼šæç¤º<code>there is no getter for property named</code></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mybatis </tag>
            
            <tag> spring </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºUnicodeå’Œå…¶ä»–çš„å­—ç¬¦é›†ä»¥åŠSpringä¹±ç å¤„ç†</title>
      <link href="/2018/03/26/%E5%85%B3%E4%BA%8EUnicode%E5%92%8C%E5%85%B6%E4%BB%96%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E4%BB%A5%E5%8F%8ASpring%E4%B9%B1%E7%A0%81%E5%A4%84%E7%90%86/"/>
      <url>/2018/03/26/%E5%85%B3%E4%BA%8EUnicode%E5%92%8C%E5%85%B6%E4%BB%96%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E4%BB%A5%E5%8F%8ASpring%E4%B9%B1%E7%A0%81%E5%A4%84%E7%90%86/</url>
      <content type="html"><![CDATA[<h2 id="Springå‡ºç°ä¹±ç çš„è§£å†³åŠæ³•ï¼š"><a href="#Springå‡ºç°ä¹±ç çš„è§£å†³åŠæ³•ï¼š" class="headerlink" title="Springå‡ºç°ä¹±ç çš„è§£å†³åŠæ³•ï¼š"></a>Springå‡ºç°ä¹±ç çš„è§£å†³åŠæ³•ï¼š</h2><p>è‹¥éœ€è¦å¿«é€Ÿçš„è§£å†³ä¹±ç é—®é¢˜å¯ä»¥ç›´æ¥çœ‹é…ç½®æ–‡ä»¶:</p><h3 id="åå°é€»è¾‘ï¼š"><a href="#åå°é€»è¾‘ï¼š" class="headerlink" title="åå°é€»è¾‘ï¼š"></a>åå°é€»è¾‘ï¼š</h3><p><strong>åœ¨é¡¹ç›®ä¸­çš„web.xmlä¸­æ·»åŠ Springçš„å­—ç¬¦è¿‡æ»¤å™¨</strong>ï¼Œé…ç½®å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;SpringEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter</span><br><span class="line">        &lt;/filter-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;encoding&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;UTF-8&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;forceEncoding&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;SpringEncodingFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/filter-mapping&gt;</span><br></pre></td></tr></table></figure></p><p>åŒæ—¶ä¹Ÿå¯ä»¥åœ¨<code>spring-mvc.xml</code>ä¸­é…ç½®å„ä¸ªè¯·æ±‚å¤´è¿‡æ¥çš„å¤„ç†æ–¹å¼ï¼š</p><h3 id="å‰ç«¯å¤„ç†ï¼š"><a href="#å‰ç«¯å¤„ç†ï¼š" class="headerlink" title="å‰ç«¯å¤„ç†ï¼š"></a>å‰ç«¯å¤„ç†ï¼š</h3><ul><li>åœ¨æ™®é€šçš„htmlé¡µé¢ä¸­å¯ä»¥åŠ å…¥<code>&lt;meta charset=&quot;UTF-8&gt;&quot;</code></li><li>åœ¨Jspä¸­éœ€è¦åŠ å…¥<code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</code></li><li>å¦å¤–å¯¹äºajaxçš„å¼‚æ­¥è¯·æ±‚çš„è¯è‹¥åœ¨urlä¸­åŒ…å«æ±‰å­—æœ€å¥½é‡‡ç”¨<code>encodeURI()</code>è¿›è¡Œä¸€ä¸ªå­—ç¬¦é›†å¤„ç†</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean class=&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;messageConverters&quot;&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;bean class=&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;&gt;</span><br><span class="line">                    &lt;property name=&quot;supportedMediaTypes&quot;&gt;</span><br><span class="line">                        &lt;list&gt;</span><br><span class="line">                            &lt;value&gt;text/plain;charset=UTF-8&lt;/value&gt;</span><br><span class="line">                            &lt;value&gt;text/html;charset=UTF-8&lt;/value&gt;</span><br><span class="line">                            &lt;value&gt;applicaiton/javascript;charset=UTF-8&lt;/value&gt;</span><br><span class="line">                        &lt;/list&gt;</span><br><span class="line">                    &lt;/property&gt;</span><br><span class="line">                &lt;/bean&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>å¦å¤–åœ¨å‡ºç°ä¹±ç ä¹‹åè¿˜å¯ä»¥è®¾ç½®request.setCharset()æˆ–è€…response.setCharset()çš„æ–¹å¼æ¥è§£å†³</p><h2 id="ç¼–ç çš„å†å²"><a href="#ç¼–ç çš„å†å²" class="headerlink" title="ç¼–ç çš„å†å²"></a>ç¼–ç çš„å†å²</h2><h3 id="Unicodeç¼–ç çš„å‡ºç°"><a href="#Unicodeç¼–ç çš„å‡ºç°" class="headerlink" title="Unicodeç¼–ç çš„å‡ºç°"></a>Unicodeç¼–ç çš„å‡ºç°</h3><p>ç”±äºåœ¨è®¡ç®—æœºä¸­åªèƒ½å­˜å‚¨çš„æ˜¯1å’Œ0ï¼Œé‚£ä¹ˆåœ¨æ—©æœŸç¾å›½é‚£è¾¹æ­£å¥½ä»¥2çš„8æ¬¡æ–¹ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚æ¥è¡¨ç¤ºæ‰€æœ‰çš„è‹±æ–‡å­—æ¯å’Œä¸€äº›ç¬¦å·ï¼Œæ‰€è°“çš„ASCIIç ï¼Œä½†æ˜¯å½“è¶Šæ¥è¶Šå¤šçš„äººè¿›å…¥åˆ°äº’è”ç½‘ä¹‹åå´å‘ç°æœ€åˆçš„ACSCIIç å·²ç»ä¸å¤Ÿä½¿ç”¨äº†ã€‚å› ä¸ºä»…ä¸­å›½çš„æ±‰å­—å°±å¤šè¾¾å‡ ä¸‡ç§ï¼Œé‚£ä¹ˆå¯æƒ³è€ŒçŸ¥ä¸–ç•Œä¸Šå…¶ä»–çš„å›½å®¶å’Œæ±‰å­—ã€‚<br>äºæ˜¯ä¸ºäº†ç»Ÿä¸€ç¼–ç çš„æ„¿æœ›å°±å‡ºç°äº†ï¼ŒUnicodeçš„ç›®çš„çš†åœ¨ä¸ºäº†å°†ä¸–ç•Œä¸Šçš„æ‰€æœ‰å­—ç¬¦å…¨éƒ¨ç»Ÿè®¡è¿›æ¥ã€‚åœ¨Unicodeä¸­ï¼Œé€šå¸¸æ˜¯ç”¨2ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯16ä¸ºæ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚ä½†æ˜¯åœ¨Unicodeä¸­åˆåˆ†äº†17ä¸ªä½é¢ï¼Œæ¯ä¸€ä¸ªä½é¢éƒ½å¯ä»¥ä»£è¡¨çš„ä¸é€šè¿‡çš„å­—ç¬¦ã€‚</p><h3 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h3><p>UTF-8å’Œunicodeçš„åŒºåˆ«åœ¨äºUTF-8æ˜¯unicodeçš„ä¸€ç§å®ç°æ–¹å¼ã€‚åœ¨UTF-8çš„ç¼–ç ä¹‹ä¸­ï¼Œå¯ä»¥å«æœ‰ä¸‰ä¸ªå­—èŠ‚æˆ–è€…æ›´å¤šçš„ä¸€ä¸ªå­—èŠ‚ã€‚è¯»å–è§„åˆ™ï¼š</p><blockquote><p>æœ€é«˜ä¸ºä¸º0 ï¼Œç±»ä¼¼äº00000100,åˆ™ä»¥ASCIIç çš„æ–¹å¼è¯»å–è¯¥å­—ç¬¦ã€‚<br>  è‹¥è¯»å–çš„å­—èŠ‚æœ€é«˜ä¸ºæ˜¯ä»¥1å¼€å¤´çš„ï¼Œæ£€æµ‹å«æœ‰å‡ ä¸ª1ï¼Œå«æœ‰å‡ ä¸ª1å°±ä»£è¡¨çš„æ˜¯è¯»å–åé¢çš„å‡ ä¸ªå­—èŠ‚ï¼Œä¾‹å¦‚ï¼š<code>11100000 1000000 10000000</code>è¡¨ç¤ºè¯¥å­—ç¬¦æ˜¯ç”±ä¸‰ä¸ªå­—èŠ‚ç»„æˆçš„ã€‚</p></blockquote>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨springmvcä¸­ä½¿ç”¨shiroæ³¨è§£</title>
      <link href="/2018/03/26/%E5%9C%A8springmvc%E4%B8%AD%E4%BD%BF%E7%94%A8shiro%E6%B3%A8%E8%A7%A3/"/>
      <url>/2018/03/26/%E5%9C%A8springmvc%E4%B8%AD%E4%BD%BF%E7%94%A8shiro%E6%B3%A8%E8%A7%A3/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€ï¼š"><a href="#å‰è¨€ï¼š" class="headerlink" title="å‰è¨€ï¼š"></a>å‰è¨€ï¼š</h2><p>åœ¨ä¹‹å‰å†™äº†ä¸€ç¯‡springå’Œshiroçš„ä¸€ä¸ªæ•´åˆï¼Œä½†æ˜¯åœ¨é‚£ä¸ªé¡¹ç›®ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨æ³¨è§£ï¼Œè€Œä¸”æ²¡æœ‰åŠ å…¥æƒé™ï¼Œåªæ˜¯åŠ å…¥äº†è§’è‰²ï¼Œæ‰€ä»¥åœ¨è¿™ç¯‡æ—¥å¿—ä¸­å°†è¿™ä¸ªé¡¹ç›®æ·»åŠ æ³¨è§£å¹¶ä¸”åŠ å…¥æƒé™ã€‚</p><h2 id="å¼€å¯Shiroçš„æ³¨è§£ï¼š"><a href="#å¼€å¯Shiroçš„æ³¨è§£ï¼š" class="headerlink" title="å¼€å¯Shiroçš„æ³¨è§£ï¼š"></a>å¼€å¯Shiroçš„æ³¨è§£ï¼š</h2><p>åˆšå¼€å§‹å¼€å¯è¿™ä¸ªæ³¨è§£çš„æ—¶å€™ï¼Œæ·»åŠ äº†ä½†æ˜¯ä¸€ç›´æ— æ•ˆã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">         String username = (String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">         List&lt;Resources&gt; resources =loginservice.getRoleById(username);</span><br><span class="line">         List&lt;String&gt; roles =new ArrayList&lt;String&gt;();</span><br><span class="line">         for (Resources  r: resources)&#123;</span><br><span class="line">             roles.add(r.getRole());</span><br><span class="line">         &#125;</span><br><span class="line">        SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();</span><br><span class="line">        info.addRoles(roles);</span><br><span class="line">        if( !username.equals(&quot;MANAGER&quot;) )&#123;</span><br><span class="line">            return info ;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            List&lt;String&gt; pre = new ArrayList&lt;String&gt;();</span><br><span class="line">            pre.add(&quot;user:insert&quot;);</span><br><span class="line">            info.addStringPermissions(pre);</span><br><span class="line">            return info;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/toinsert&quot;)</span><br><span class="line">    @RequiresPermissions(&quot;user:insert&quot;)</span><br><span class="line">    public String toinsert()&#123;</span><br><span class="line">        return &quot;getuser/userINsert&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæœ¬æ¥æƒ³è®¾è®¡çš„æ˜¯è®¿é—®<code>toinsert</code>è¿™ä¸ªURLçš„æ—¶å€™æ£€æŸ¥æƒé™ï¼Œè‹¥æ²¡æœ‰æƒé™åˆ™ä¼šç¦æ­¢è®¿é—®ï¼Œå¯ä»¥çœ‹åˆ°åœ¨<code>doGetAuthorizationInfo()</code>æ–¹æ³•ä¸­å·²ç»å°†æƒé™æ·»åŠ åˆ°é™¤äº†<code>MANAGER</code>ä»¥å¤–çš„ä»»æ„è§’è‰²ã€‚ä½†æ˜¯åœ¨æµ‹è¯•çš„æ—¶å€™å´ä¸€ç›´ä¸èƒ½è¿›è¡Œè¿™ä¸ªæƒé™æ£€æµ‹ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•äººéƒ½å¯ä»¥è®¿é—®è¿™ä¸ªURLã€‚åæ¥åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹å‘ç°æ˜¯éœ€è¦æ·»åŠ ä¸€äº›é…ç½®æ–‡ä»¶åˆ°<code>spring-mvc.xml</code>è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- shiroå¼€å¯æ³¨è§£ --&gt;</span><br><span class="line">    &lt;bean class=&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot; depends-on=&quot;lifecycleBeanPostProcessor&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;proxyTargetClass&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;bean class=&quot;org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;securityManager&quot; ref=&quot;securityManager&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure></p><p>åŠ äº†æ³¨è§£ä¹‹åä¾¿å¯ä»¥ä¾æ®è¿™ä¸ªè®¾ç½®çš„æƒé™è¿›è¡ŒURLæ‹¦æˆªï¼Œä¹Ÿå°±æ˜¯é™¤äº†MANAGERä¹‹å¤–çš„ä»»ä½•äººéƒ½å¯ä»¥è¿›è¡Œæ’å…¥ç”¨æˆ·æ“ä½œã€‚è€Œæ²¡æœ‰è¯¥æƒé™çš„ç”¨æˆ·è®¿é—®è¿™ä¸ªé¡µé¢çš„æ—¶å€™ä¾¿ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚<br><img src="æƒé™ä¸è¶³çš„å¼‚å¸¸.PNG" alt="&quot;æƒé™ä¸è¶³çš„å¼‚å¸¸&quot;"><br>åœ¨åå°å¯ä»¥æ•è·è¿™ä¸ªå¼‚å¸¸ä»è€Œè¿›è¡Œå¤„ç†æˆ–è€…åœ¨åå°ä½¿ç”¨<code>.isPermitted(&quot;æƒé™&quot;)</code>æ¥è¿›è¡Œåˆ¤æ–­ç”¨æˆ·çš„æƒé™</p><h2 id="è”æƒ³ï¼šå…³äºServletçš„æ‹¦æˆªå™¨å’ŒSpringçš„æ‹¦æˆªå™¨ä¹‹é—´çš„é¡ºåº"><a href="#è”æƒ³ï¼šå…³äºServletçš„æ‹¦æˆªå™¨å’ŒSpringçš„æ‹¦æˆªå™¨ä¹‹é—´çš„é¡ºåº" class="headerlink" title="è”æƒ³ï¼šå…³äºServletçš„æ‹¦æˆªå™¨å’ŒSpringçš„æ‹¦æˆªå™¨ä¹‹é—´çš„é¡ºåº"></a>è”æƒ³ï¼šå…³äºServletçš„æ‹¦æˆªå™¨å’ŒSpringçš„æ‹¦æˆªå™¨ä¹‹é—´çš„é¡ºåº</h2><p>åœ¨ç”¨shiroçš„æ—¶å€™é¡ºä¾¿çš„ä¹ŸæŠŠServletæ‹¦æˆªå™¨çš„é¡ºåºå’ŒSpringæ‹¦æˆªå™¨çš„é¡ºåºéƒ½å­¦ä¹ äº†ä¸‹ã€‚åœ¨è¿™é‡Œä¹Ÿé¡ºä¾¿åšäº†ä¸€ä¸ªå°çš„æµ‹è¯•:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">public class ServletFilter implements Filter&#123;</span><br><span class="line">    public void init(FilterConfig filterConfig) throws ServletException &#123;</span><br><span class="line">        System.out.println(&quot;Servletå¾—æ‹¦æˆªå™¨init()æ–¹æ³•&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;</span><br><span class="line">        System.out.println(&quot;Servletå¾—æ‹¦æˆªå™¨doFilter()æ–¹æ³•&quot;);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void destroy() &#123;</span><br><span class="line">        System.out.println(&quot;Servletå¾—æ‹¦æˆªå™¨destroy()æ–¹æ³•&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class SpringHandle implements HandlerInterceptor &#123;</span><br><span class="line">    public boolean preHandle(HttpServletRequest request,</span><br><span class="line">                             HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line">        System.out.println(request.getHeader(&quot;Accept&quot;).toString());</span><br><span class="line">        System.out.println(&quot;This is a intercept to test the web&quot;);</span><br><span class="line">//        handleError(request,response);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    private void handleError(HttpServletRequest request ,HttpServletResponse response) throws ServletException, IOException &#123;</span><br><span class="line">        RequestDispatcher rd = request.getRequestDispatcher(&quot;/&quot;);</span><br><span class="line">        System.out.println(&quot;å¤„ç†é”™è¯¯ï¼Œéœ€è¦è·³è½¬&quot;);</span><br><span class="line">        rd.forward(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç¼–å†™å¥½äº†ä¹‹åå¯åŠ¨é¡¹ç›®ï¼Œå‘ç°Servletçš„çš„è¿™ä¸ªæ‹¦æˆªå™¨æœ€å…ˆè¿è¡Œ<code>init()</code>æ–¹æ³•åœ¨æœ€åˆé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ä¾¿ä¼šäºè¿è¡Œï¼Œè€Œä¸”ä¸€ä¸ªè¯·æ±‚è¿‡æ¥ä¹‹åä¹Ÿæ˜¯<code>doFilter()</code>å…ˆè¿è¡Œï¼Œç„¶åå†æ˜¯Springçš„æ‹¦æˆªå™¨</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shiro </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨mysql5.7ç‰ˆæœ¬ä¸­ä½¿ç”¨groupbyæ‰€éœ€è¦æ³¨æ„çš„</title>
      <link href="/2018/03/25/%E5%9C%A8mysql5.7%E7%89%88%E6%9C%AC%E4%B8%AD%E4%BD%BF%E7%94%A8groupby%E6%89%80%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84/"/>
      <url>/2018/03/25/%E5%9C%A8mysql5.7%E7%89%88%E6%9C%AC%E4%B8%AD%E4%BD%BF%E7%94%A8groupby%E6%89%80%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84/</url>
      <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯ONLY-FULL-GROUP-BY-æ¨¡å¼"><a href="#ä»€ä¹ˆæ˜¯ONLY-FULL-GROUP-BY-æ¨¡å¼" class="headerlink" title="ä»€ä¹ˆæ˜¯ONLY_FULL_GROUP_BY æ¨¡å¼"></a>ä»€ä¹ˆæ˜¯ONLY_FULL_GROUP_BY æ¨¡å¼</h2><p>å…ˆçœ‹åœ¨mysql 5.7ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªçš„group byï¼Œä»¥ä¸‹æ˜¯è¿™ä¸ªæ•°æ®åº“è¡¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from testgroupby;</span><br><span class="line">+---------+-----------+------------+--------------+</span><br><span class="line">| user_id | user_name | user_score | user_subject |</span><br><span class="line">+---------+-----------+------------+--------------+</span><br><span class="line">|       1 | å¼ ä¸‰      |         99 | è¯­æ–‡         |</span><br><span class="line">|       2 | å¼ ä¸‰      |         90 | æ•°å­¦         |</span><br><span class="line">|       3 | å¼ ä¸‰      |         80 | è‹±è¯­         |</span><br><span class="line">|       4 | æå››      |         99 | è¯­æ–‡         |</span><br><span class="line">|       5 | ç‹äº”      |         85 | è¯­æ–‡         |</span><br><span class="line">|       6 | æå››      |         91 | æ•°å­¦         |</span><br><span class="line">|       7 | ç‹äº”      |        100 | è‹±è¯­         |</span><br><span class="line">+---------+-----------+------------+--------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯ä¸€ä¸ªå­¦ç”Ÿæˆç»©æ•°æ®åº“è¡¨ã€‚é‚£ä¹ˆåœ¨MySQL5.7ç‰ˆæœ¬ä¸­æ‰§è¡Œå®ƒçš„è¯æ˜¯ä¼šå‡ºç°ä¸€ä¸ªerrorçš„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from testgroupby group by user_name;</span><br><span class="line">ERROR 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column &apos;login.testgroupby.user_id&apos; which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</span><br></pre></td></tr></table></figure><p>æ³¨æ„æŸ¥çœ‹æŠ¥é”™ï¼š<code>nonaggregated column &#39;login.testgroupby.user_id&#39; which is not functionally dependent on columns</code>ã€‚è¿™æ®µè¯æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¤§æ„è¡¨ç¤ºçš„æ˜¯å¯¹äºgroupbyçš„usernameï¼Œuseridå¹¶æ²¡æœ‰å‡½æ•°ä¾èµ–äºå®ƒã€‚åœ¨è¿™å¼ è¡¨ä¸­ï¼Œå¯ä»¥ç”±<code>user_id</code>æ¨å¯¼å‡º<code>user_name</code>ã€‚å› ä¸ºæ¯ä¸€ä¸ª<code>user_id</code>éƒ½æ˜¯å”¯ä¸€çš„ï¼Œè‹¥å¯¹<code>user_id</code>è¿›è¡Œgroupby åˆ™å®ƒå¯ä»¥æ¨å¯¼å‡ºä»»ä½•ä¸€ä¸ªå­¦ç”Ÿå§“åï¼Œåˆ†æ•°ä»¥åŠå­¦ç§‘ã€‚å³æ¯ä¸€ä¸ªå­¦ç”ŸIdéƒ½æ˜¯å¯ä»¥ç¡®å®šä¸€è¡Œå€¼å¾—ï¼Œæ‰€ä»¥MySQLå¯ä»¥è¿”å›æ•°æ®ã€‚ é‚£ä¹ˆåè¿‡æ¥æ˜¯ä¸æ˜¯æ¯ä¸€ä¸ªå­¦ç”Ÿå§“åéƒ½å¯ä»¥æ¨å¯¼å‡ºå”¯ä¸€çš„<code>user_id</code>å‘¢ï¼Ÿ åœ¨è¿™å¼ è¡¨ä¸­ï¼Œæ¯ä¸€ä¸ª<code>user_name</code>éƒ½æ˜¯ä¸å¯ä»¥æ¨å¯¼å‡ºå”¯ä¸€çš„user_id-ä¹Ÿå°±æ˜¯è¯´å¯¹<code>user_name</code>åˆ†ç»„ä¹‹åä¼šæœ‰å¤šä½™çš„<code>user_id</code>-, æ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸º<code>user_id</code>å¹¶æ²¡æœ‰å‡½æ•°ä¾èµ–äº<code>user_name</code>ã€‚å…¶å®åœ¨è¿™é‡Œè¿˜å¯ä»¥è¿™æ ·æƒ³ï¼Œå› ä¸ºå¯¹<code>user_name</code>åˆ†ç»„ä¹‹åï¼Œåœ¨æ¯ä¸€ä¸ªç»„é‡Œé¢éƒ½ä¼šæœ‰å‡ ä¸ªå€¼ï¼Œé‚£ä¹ˆéšä¹‹è€Œæ¥çš„<code>user_id ,user_score,user_subject</code>éƒ½ä¸æ˜¯ä¸€ä¸ªç¡®å®šçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ä¸€ä¸ªåˆ†ç»„é‡Œé¢ï¼Œåœ¨è¿™å‡ åˆ—ä¸­ä¼šæœ‰å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆmysqlè¿™æ˜¯å°±ä¼šä¸çŸ¥é“åˆ°åº•è¯¥è¿”å›å“ªä¸€è¡Œå¾—ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å¼€å¯äº†è€Œè¿™ä¸ªæ¨¡å¼çš„mysqlå°±ä¼šæ‹’ç»æŸ¥è¯¢ã€‚</p><h2 id="è§£å†³æ–¹æ³•ï¼š"><a href="#è§£å†³æ–¹æ³•ï¼š" class="headerlink" title="è§£å†³æ–¹æ³•ï¼š"></a>è§£å†³æ–¹æ³•ï¼š</h2><h3 id="ä¸€ï¼š"><a href="#ä¸€ï¼š" class="headerlink" title="ä¸€ï¼š"></a>ä¸€ï¼š</h3><p>é‚£ä¹ˆå¦‚ä½•æ‰è®©å®ƒä¸æŠ¥è¿™ä¸ªé”™è¯¯å‘¢ï¼Œåœ¨mysqlçš„å®˜æ–¹æ–‡æ¡£ä¸Šé¢è¯´çš„æ˜¯:</p><blockquote><p>The query is valid if name is a primary key of t or is a unique NOT NULL column. In such cases, MySQL recognizes that the selected column is functionally dependent on a grouping column. For example, if name is a primary key, its value determines the value of address because each group has only one value of the primary key and thus only one row. As a result, there is no randomness in the choice of address value in a group and no need to reject the query</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœgroupbyçš„åˆ—æ˜¯ä¸€ä¸ªä¸»é”®çš„è¯ï¼Œmysqlä¼šè¯†åˆ«å‡ºä»–çš„ä¸€ä¸ªå‡½æ•°ä¾èµ–ã€‚åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œç”±äºå¯¹<code>user_id</code>è¿›è¡Œgroupbyï¼Œåœ¨åˆ†ç»„ä¹‹åmysqlæ˜¯å¯ä»¥è¿›è¡ŒæŸ¥è¯¢çš„ã€‚<br>é‡æ–°ä¿®æ”¹æŸ¥è¯¢è¯­å¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from testgroupby group by user_id;</span><br><span class="line">+---------+-----------+------------+--------------+</span><br><span class="line">| user_id | user_name | user_score | user_subject |</span><br><span class="line">+---------+-----------+------------+--------------+</span><br><span class="line">|       1 | å¼ ä¸‰      |         99 | è¯­æ–‡         |</span><br><span class="line">|       2 | å¼ ä¸‰      |         90 | æ•°å­¦         |</span><br><span class="line">|       3 | å¼ ä¸‰      |         80 | è‹±è¯­         |</span><br><span class="line">|       4 | æå››      |         99 | è¯­æ–‡         |</span><br><span class="line">|       5 | ç‹äº”      |         85 | è¯­æ–‡         |</span><br><span class="line">|       6 | æå››      |         91 | æ•°å­¦         |</span><br><span class="line">|       7 | ç‹äº”      |        100 | è‹±è¯­         |</span><br><span class="line">+---------+-----------+------------+--------------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯è¯´å¦‚æœå½“<code>groupby</code>åé¢çš„å­—æ®µæ˜¯æ˜¯ä¸€ä¸ªéç©ºä¸»é”®çš„æ—¶å€™ï¼Œç”±äºä¸»é”®æ˜¯ä¸€ä¸ªè¡¨ä¸­çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä¸å¯ä»¥é‡å¤ï¼Œæ‰€ä»¥MySQLå¯ä»¥æ­£ç¡®çš„æ¨æ–­å‡ºæ¯ä¸€ä¸ªåˆ†ç»„ã€‚</p><p>é‚£å¦‚æœè¿˜æ˜¯éœ€è¦åœ¨user_name è¿™ä¸€åˆ—è¿›è¡Œgroupbyæ€ä¹ˆåŠï¼Ÿ å¦‚æœç¡®å®éœ€è¦è¿™æ ·åšçš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å¯¹groupbyçš„å­—æ®µè¿›è¡Œä¸€ä¸ªå¤„ç†ï¼Œä»¥ç¡®ä¿å°±æ˜¯è¿™ä¸ªé›†åˆæ˜¯å¯ä»¥åœ¨åˆ†ç»„ä¹‹åéƒ½æ˜¯å”¯ä¸€çš„(å¯ä»¥ç†è§£ä¸ºåªæœ‰ä¸€è¡Œ)</p><h3 id="äºŒï¼š"><a href="#äºŒï¼š" class="headerlink" title="äºŒï¼š"></a>äºŒï¼š</h3><p>é™¤äº†ä¸Šé¢çš„æ–¹æ³•ï¼Œè¿˜å¯ä»¥å¯¹åˆ†ç»„æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®è¿›è¡Œä¸€ä¸ªèšåˆæ“ä½œã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT user_name ,COUNT(*) AS &apos;subject_num&apos; FROM testgroupby  GROUP BY  user_name;</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| user_name | subject_num |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">| å¼ ä¸‰      |           3 |</span><br><span class="line">| æå››      |           2 |</span><br><span class="line">| ç‹äº”      |           2 |</span><br><span class="line">+-----------+-------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>å¯¹äºèšåˆä¹‹åçš„æ“ä½œï¼ŒMySQLæ˜¯æ¥å—æŸ¥è¯¢çš„</p><h3 id="ä¸‰ï¼šANY-VALUE-å‡½æ•°ï¼š"><a href="#ä¸‰ï¼šANY-VALUE-å‡½æ•°ï¼š" class="headerlink" title="ä¸‰ï¼šANY_VALUE()å‡½æ•°ï¼š"></a>ä¸‰ï¼šANY_VALUE()å‡½æ•°ï¼š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ANY_VALUE(user_id),user_name  from testgroupby group by user_name;</span><br><span class="line">+--------------------+-----------+</span><br><span class="line">| ANY_VALUE(user_id) | user_name |</span><br><span class="line">+--------------------+-----------+</span><br><span class="line">|                  1 | å¼ ä¸‰      |</span><br><span class="line">|                  4 | æå››      |</span><br><span class="line">|                  5 | ç‹äº”      |</span><br><span class="line">+--------------------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>å½“ç„¶è¿™æ ·ä½¿ç”¨çš„è¯mysqlåªä¼šå–æ‰€åˆ†ç»„å¾—ç¬¬ä¸€è¡Œã€‚</p><h3 id="GROUP-CONCAT-å‡½æ•°ï¼š"><a href="#GROUP-CONCAT-å‡½æ•°ï¼š" class="headerlink" title="GROUP_CONCAT()å‡½æ•°ï¼š"></a>GROUP_CONCAT()å‡½æ•°ï¼š</h3><p>è¿™ä¸ªå‡½æ•°ä¼šå°†ä¸€ä¸ªæŸ¥è¯¢å¾—ç»“æœé›†è¿›è¡Œåˆå¹¶ï¼Œä»è€Œå¯ä»¥ä½¿å¯¹user_nameè¿›è¡Œgroupbyä¹‹åè¿”å›å¾—æ˜¯ä¸€è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT GROUP_CONCAT(user_id) AS &apos;user_id&apos;,user_name FROM testgroupby GROUP BY user_name;</span><br><span class="line">+---------+-----------+</span><br><span class="line">| user_id | user_name |</span><br><span class="line">+---------+-----------+</span><br><span class="line">| 1,2,3   | å¼ ä¸‰      |</span><br><span class="line">| 4,6     | æå››      |</span><br><span class="line">| 5,7     | ç‹äº”      |</span><br><span class="line">+---------+-----------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><h3 id="å…³äºè¿™ä¸ªæ¨¡å¼ï¼š"><a href="#å…³äºè¿™ä¸ªæ¨¡å¼ï¼š" class="headerlink" title="å…³äºè¿™ä¸ªæ¨¡å¼ï¼š"></a>å…³äºè¿™ä¸ªæ¨¡å¼ï¼š</h3><p>ä¸‹é¢è¿™ä¸ªå›¾å¤§è‡´çš„è§£é‡Šäº†ä¸‹ä¸ºä»€ä¹ˆä¼šæŠ¥å‡ºè¿™ä¸ªé”™è¯¯ã€‚<br><img src="mysqlçš„ç–‘æƒ‘.PNG" alt=""><br>å› ä¸ºæœ€åmysqlä¼šç–‘æƒ‘ï¼Œä½ åˆ†ç»„ä¹‹åé‚£ä¹ˆå¤šå¾—æ•°æ®ï¼Œæˆ‘çŸ¥é“é€‰åˆ™åˆ†ç»„ä¹‹åå¾—å“ªä¸€è¡Œï¼Ÿï¼Ÿï¼Ÿ</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€æ¬¡sqlå’Œæ—¶é—´æ®µæŸ¥è¯¢æœ‰å…³çš„è¯­å¥</title>
      <link href="/2018/03/23/%E8%AE%B0%E4%B8%80%E6%AC%A1sql%E5%92%8C%E6%97%B6%E9%97%B4%E6%AE%B5%E6%9F%A5%E8%AF%A2%E6%9C%89%E5%85%B3%E7%9A%84%E8%AF%AD%E5%8F%A5/"/>
      <url>/2018/03/23/%E8%AE%B0%E4%B8%80%E6%AC%A1sql%E5%92%8C%E6%97%B6%E9%97%B4%E6%AE%B5%E6%9F%A5%E8%AF%A2%E6%9C%89%E5%85%B3%E7%9A%84%E8%AF%AD%E5%8F%A5/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºè‡ªå·±æœ‰ç‚¹éœ€æ±‚éœ€è¦åœ¨mysqlä¸­æŒ‰ç…§æ—¶é—´æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œè‡ªå·±åˆå¯¹è¿™äº›ä¸å¤ªäº†è§£ï¼Œæ‰€ä»¥è¶ç€è¿™æ¬¡æœºä¼šå°†mysqlå’Œæ—¶é—´æ®µç›¸å…³çš„æŸ¥è¯¢è¯­å¥åšä¸€ä¸ªè®°å½•ï¼š</p><h2 id="å¸¸ç”¨å‡½æ•°ï¼š"><a href="#å¸¸ç”¨å‡½æ•°ï¼š" class="headerlink" title="å¸¸ç”¨å‡½æ•°ï¼š"></a>å¸¸ç”¨å‡½æ•°ï¼š</h2><h4 id="DATE-SUB-å‡½æ•°"><a href="#DATE-SUB-å‡½æ•°" class="headerlink" title="DATE_SUB()å‡½æ•°"></a>DATE_SUB()å‡½æ•°</h4><p><code>DATE_SUB(date,INTERVAL expr type)</code>è¿™ä¸ªå‡½æ•°çš„dateæ˜¯ä¸€ä¸ªæ—¶é—´è¡¨è¾¾å¼ï¼Œä¸€èˆ¬å–å¾—æ˜¯æ•°æ®åº“ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚åé¢çš„<code>INTERVAL</code>ä¸€èˆ¬æ¥è®²æ˜¯ä¸å˜çš„ï¼Œ<code>expr</code>ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ—¶é—´æ®µï¼Œä»£è¡¨è¿‡å»çš„ï¼Œæ¯”å¦‚æ˜¯30å¤©ï¼Œé‚£ä¹ˆè¿™é‡Œå°±æ˜¯30ï¼Œè‹¥æ˜¯60ï¼Œè¿™é‡Œå°±æ˜¯60ï¼Œ<code>type</code>åˆ™è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ—¶é—´å±æ€§(å¯èƒ½è¡¨è¾¾çš„ä¸æ˜¯å¾ˆå‡†ç¡®)ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MICROSECOND</span><br><span class="line">SECOND</span><br><span class="line">MINUTE</span><br><span class="line">HOUR</span><br><span class="line">DAY</span><br><span class="line">WEEK</span><br><span class="line">MONTH</span><br><span class="line">QUARTER</span><br><span class="line">YEAR</span><br><span class="line">SECOND_MICROSECOND</span><br><span class="line">MINUTE_MICROSECOND</span><br><span class="line">MINUTE_SECOND</span><br><span class="line">HOUR_MICROSECOND</span><br><span class="line">HOUR_SECOND</span><br><span class="line">HOUR_MINUTE</span><br><span class="line">DAY_MICROSECOND</span><br><span class="line">DAY_SECOND</span><br><span class="line">DAY_MINUTE</span><br><span class="line">DAY_HOUR</span><br><span class="line">YEAR_MONTH</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œæˆ‘ç”¨<code>YEAR_MONTH</code> å’Œ<code>MONTH</code> åŒæ—¶å†™äº†ä¸€ä¸ªsql<code>SELECT DATE_SUB(&#39;2015-09-30 11:19:00&#39;,INTERVAL2 MONTH)</code>åœ¨è¿™ä¸ªé‡Œé¢ï¼Œå°†MONTHå’ŒYEAR_MONTHäº’æ¢éƒ½æ˜¯æ²¡é—®é¢˜çš„ï¼Œè¿™æ˜¯ç›®å‰æš‚æ—¶æœªå‘ç°æœ‰ä»€ä¹ˆå·®å¼‚çš„ã€‚</p><h4 id="FROM-UNIXTIME-å‡½æ•°"><a href="#FROM-UNIXTIME-å‡½æ•°" class="headerlink" title="FROM_UNIXTIME()å‡½æ•°"></a>FROM_UNIXTIME()å‡½æ•°</h4><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†ä¸€ä¸²æ•°å­—æˆ–è€…ä¸€ä¸ªæ—¶é—´æˆ³è½¬æ¢æˆæŒ‡å®šæ ¼å¼çš„ä¸€ä¸ªæ—¥æœŸï¼Œåœ¨è¿™ä¸ªé‡Œé¢çš„è¯ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ˜¯ä¸€ä¸ªUNIXæ—¶é—´æˆ³,è€Œç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯ä¸€ä¸ªformatçš„å­—ç¬¦ä¸²ï¼Œæ³¨æ„è§‚å¯Ÿä¸‹é¢çš„ä¸‰ä¸ªä¾‹å­çš„ä¸åŒï¼Œç¬¬äºŒä¸ªsqlåœ¨åé¢åšäº†ä¸€ä¸ª+0çš„æ“ä½œç»“æœæ—¥æœŸæ ¼å¼ç›´æ¥è¢«è½¬æ¢æˆäº†ä¸€ä¸²æ•°å­—ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT FROM_UNIXTIME(1447430881);</span><br><span class="line">        -&gt; &apos;2015-11-13 10:08:01&apos;</span><br><span class="line">mysql&gt; SELECT FROM_UNIXTIME(1447430881) + 0;</span><br><span class="line">        -&gt; 20151113100801</span><br><span class="line">mysql&gt; SELECT FROM_UNIXTIME(UNIX_TIMESTAMP(),</span><br><span class="line">    -&gt;                      &apos;%Y %D %M %h:%i:%s %x&apos;);</span><br><span class="line">        -&gt; &apos;2015 13th November 10:08:01 2015&apos;</span><br></pre></td></tr></table></figure></p><h4 id="CONCAT-å‡½æ•°"><a href="#CONCAT-å‡½æ•°" class="headerlink" title="CONCAT()å‡½æ•°"></a>CONCAT()å‡½æ•°</h4><p><code>CONCAT()</code>å‡½æ•°å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²æŒ‰ç…§ç¬¬äºŒä¸ªå‚æ•°ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯å¯¹åº”ä»¥ä¸‹è¯­å¥<code>SELECT LEFT(&#39;2018-01-26 11:50:09&#39;,7)</code>è¿™æ¡è¯­å¥çš„æ‰§è¡Œç»“æœç»“æœæ˜¯2018-01,æ­£å¥½æ˜¯ä»å¤´æˆªå–äº†7ä¸ªå­—ç¬¦ã€‚<br>å‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªæ˜¯æˆªå–çš„é•¿åº¦ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT LEFT(&apos;2018-01-26 11:50:09&apos;,7);</span><br><span class="line">+-------------------------------+</span><br><span class="line">| LEFT(&apos;2018-01-26 11:50:09&apos;,7) |</span><br><span class="line">+-------------------------------+</span><br><span class="line">| 2018-01                       |</span><br><span class="line">+-------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><h4 id="LEFT-å‡½æ•°"><a href="#LEFT-å‡½æ•°" class="headerlink" title="LEFT()å‡½æ•°"></a>LEFT()å‡½æ•°</h4><p><code>LEFT()</code>å‡½æ•°å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºmysqlçš„è¯­å¥æ¥æ‰§è¡Œï¼Œç±»æ¯”åˆ°Pythonå°±æ˜¯pythonä¸­çš„<code>eval</code>å‡½æ•°ï¼Œä½†æ˜¯è¯¥å‡½æ•°è‹¥æ‰§è¡Œçš„å­—ç¬¦ä¸²ä¸­åŒ…å«ä¸€ä¸ª<code>null</code>:æ³¨æ„è¿™ä¸ªnullè‹¥æ˜¯å…³é”®å­—åˆ™æ˜¯ä¼šåˆ™ä¼šå¯¼è‡´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&apos;Mysql&apos;,null);</span><br><span class="line">+----------------------+</span><br><span class="line">| concat(&apos;Mysql&apos;,null) |</span><br><span class="line">+----------------------+</span><br><span class="line">| NULL                 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><h4 id="sum-å’ŒCount-åœ¨ç»Ÿè®¡1å’Œ0çš„åŒºåˆ«"><a href="#sum-å’ŒCount-åœ¨ç»Ÿè®¡1å’Œ0çš„åŒºåˆ«" class="headerlink" title="sum()å’ŒCount()åœ¨ç»Ÿè®¡1å’Œ0çš„åŒºåˆ«"></a>sum()å’ŒCount()åœ¨ç»Ÿè®¡1å’Œ0çš„åŒºåˆ«</h4><p>è¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«åœ¨ä¸€æ¬¡ä½¿ç”¨ç»Ÿè®¡çš„æ—¶å€™é‡åˆ°äº†ä¸€ç‚¹é—®é¢˜ï¼Œä¾‹å¦‚ä¸€ä¸ªå­—æ®µæ˜¯æ ‡è¯†ç¬¦ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—æ®µçš„å€¼é™¤äº†0å°±æ˜¯1ï¼Œé‚£ä¹ˆè¦ç»Ÿè®¡ä¸º1çš„è¯ä¸€èˆ¬æ¥è®²å°±æ˜¯<code>case when xxx=1 then 1 else 0 end</code>è¿™æ ·å°±å¯ä»¥å€¼é€‰æ‹©ä¸º1çš„è¡Œï¼Œé‚£ä¹ˆè¿™é‡Œå¦‚æœä½¿ç”¨çš„æ˜¯countçš„è¯ï¼Œè¿™é‡Œçš„è¿™ä¸ªè§„åˆ™æ˜¯æ— æ³•åº”ç”¨çš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; select * from testestatus;</span><br><span class="line">+-----------+---------------+</span><br><span class="line">| status_id | status_status |</span><br><span class="line">+-----------+---------------+</span><br><span class="line">|         1 |           b&apos;1&apos;|</span><br><span class="line">|         2 |           b&apos;0&apos;|</span><br><span class="line">|         3 |           b&apos;1&apos;|</span><br><span class="line">|         4 |           b&apos;1&apos;|</span><br><span class="line">+-----------+---------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>å› ä¸ºå½“æ—¶æ²¡æœ‰ä»”ç»†çš„åŒºåˆ†è¿™ä¸¤ç§ç”¨æ³•çš„åŒºåˆ«ï¼Œæ‰€ä»¥æ‰å¯¼è‡´äº†ç»Ÿè®¡é”™è¯¯ã€‚åœ¨è¿™é‡Œï¼Œcountåªæ˜¯ä¸€ä¸ªç»Ÿè®¡ï¼Œä»–åªæ˜¯ç»Ÿè®¡åº”ç”¨è§„åˆ™ä¹‹åçš„çš„ç¬¦åˆæ•°æ®ï¼Œä½†æ˜¯sumä¸åŒï¼Œsumé…åˆ<code>case when</code> åˆ™å¯ä»¥é€‰æ‹©å‡ºç›¸åŒ¹é…çš„ä¸€äº›æ•°æ®</p><h4 id="DATE-FORMAT-å‡½æ•°"><a href="#DATE-FORMAT-å‡½æ•°" class="headerlink" title="DATE_FORMAT()å‡½æ•°"></a>DATE_FORMAT()å‡½æ•°</h4><p>è¿™ä¸ªå‡½æ•°å¯ä»¥å°†ä¸€ä¸ªæ—¶é—´æŒ‰ç…§æŒ‡å®šçš„æ ¼å¼è¾“å‡ºï¼Œç±»ä¼¼äºJavaä¸­çš„dateformatå‡½æ•°ï¼Œæ˜¯å¯ä»¥å°†ä¸€ä¸ªæ—¶é—´è¿›è¡Œæ ¼å¼çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select date_format(now(),&apos;%Y&apos;);</span><br><span class="line">+-------------------------+</span><br><span class="line">| date_format(now(),&apos;%Y&apos;) |</span><br><span class="line">+-------------------------+</span><br><span class="line">| 2018                    |</span><br><span class="line">+-------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><h3 id="ä¸€äº›å¸¸ç”¨å‡½æ•°ç»„åˆï¼š"><a href="#ä¸€äº›å¸¸ç”¨å‡½æ•°ç»„åˆï¼š" class="headerlink" title="ä¸€äº›å¸¸ç”¨å‡½æ•°ç»„åˆï¼š"></a>ä¸€äº›å¸¸ç”¨å‡½æ•°ç»„åˆï¼š</h3><h6 id="æŸ¥è¯¢æœ¬æœˆçš„æ•°æ®ï¼š"><a href="#æŸ¥è¯¢æœ¬æœˆçš„æ•°æ®ï¼š" class="headerlink" title="æŸ¥è¯¢æœ¬æœˆçš„æ•°æ®ï¼š"></a>æŸ¥è¯¢æœ¬æœˆçš„æ•°æ®ï¼š</h6><p>åœ¨è¿™é‡Œæ˜¯å¯ä»¥ä½¿ç”¨<code>concat</code>å‡½æ•°å’Œ<code>left</code>å‡½æ•°ï¼Œé¦–å…ˆå¯ä»¥ä½¿ç”¨<code>left</code>å‡½æ•°æˆªå–ä¸€ä¸ªå­—ç¬¦ä¸²é•¿åº¦ã€‚æ¯”å¦‚è·å–å½“æœˆçš„è¯æ˜¯å¯ä»¥é€šè¿‡leftæ¥è·å–ç„¶åå†å°†1å·æ‹¼æ¥ä¸Šå»ï¼Œæœ€åç”¨æ•°æ®åº“çš„æ—¥æœŸå†å‡å»1å·å°±å¯ä»¥äº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">select left(now(),7);</span><br><span class="line">+---------------+</span><br><span class="line">| left(now(),7) |</span><br><span class="line">+---------------+</span><br><span class="line">| 2018-03       |</span><br><span class="line">+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; select concat(left(now(),7),&apos;-01&apos;);</span><br><span class="line">+-----------------------------+</span><br><span class="line">| concat(left(now(),7),&apos;-01&apos;) |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| 2018-03-01                  |</span><br><span class="line">+-----------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>æœ€åæœ¬æœˆçš„1å·å°±è¢«æŸ¥è¯¢å‡ºæ¥äº†ï¼Œç„¶åä¾¿å¯ä»¥è¿›è¡Œæ•°æ®æ“ä½œäº†</p><h6 id="æŸ¥è¯¢æŒ‡å®šå¤©æ•°çš„æ•°æ®"><a href="#æŸ¥è¯¢æŒ‡å®šå¤©æ•°çš„æ•°æ®" class="headerlink" title="æŸ¥è¯¢æŒ‡å®šå¤©æ•°çš„æ•°æ®"></a>æŸ¥è¯¢æŒ‡å®šå¤©æ•°çš„æ•°æ®</h6><p>å‡è®¾ç°åœ¨éœ€è¦æŸ¥è¯¢å¾€æœŸ30å¤©çš„æ•°æ®ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡<code>date_sub</code>å‡½æ•°æ¥è¿›è¡ŒæŸ¥è¯¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select date_sub(now(),INTERVAL 30 DAY );</span><br><span class="line">+----------------------------------+</span><br><span class="line">| date_sub(now(),INTERVAL 30 DAY ) |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| 2018-02-22 22:03:22              |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p>ç›®å‰å…³äºæ—¶é—´æ–¹é¢çš„sqlæ€»ç»“å·®ä¸å¤šå°±æ˜¯è¿™äº›äº†ï¼Œå…¶ä»–çš„ä»¥åå†è¿›è¡Œè¡¥å……ã€‚</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysqlæ—¶é—´ç›¸å…³ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>åœ¨SpringMvcä¸­ä½¿ç”¨shiroè¿›è¡Œå®‰å…¨é…ç½®</title>
      <link href="/2018/03/23/%E5%9C%A8SpringMvc%E4%B8%AD%E4%BD%BF%E7%94%A8shiro%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE/"/>
      <url>/2018/03/23/%E5%9C%A8SpringMvc%E4%B8%AD%E4%BD%BF%E7%94%A8shiro%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å»å¹´ä¸€å¹´ä¹‹é—´ç”¨è¿‡shiroçš„ä¸€äº›å†…å®¹ï¼Œä½†æ˜¯æœ€è¿‘åˆæœ‰ç‚¹å¿˜å´äº†ã€‚ç°åœ¨æ­£å¥½æœ‰ä¸€ä¸ªæœºä¼šï¼Œæ‰€ä»¥æ­£å¥½æ­å»ºèµ·æ¥äº†ç„¶åè‡ªå·±åšäº›è®°å½•</p><h2 id="æ­å»ºè¿‡ç¨‹"><a href="#æ­å»ºè¿‡ç¨‹" class="headerlink" title="æ­å»ºè¿‡ç¨‹"></a>æ­å»ºè¿‡ç¨‹</h2><h5 id="å¼•å…¥jaråŒ…ï¼š"><a href="#å¼•å…¥jaråŒ…ï¼š" class="headerlink" title="å¼•å…¥jaråŒ…ï¼š"></a>å¼•å…¥jaråŒ…ï¼š</h5><p>éœ€è¦ä½¿ç”¨shiroçš„è¯å…ˆåœ¨mavenä¸­å¼•å…¥ä»¥ä¸‹JaråŒ…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-spring --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-web --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;shiro-web&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-ehcache --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;shiro-ehcache&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.4.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><h5 id="ç¼–å†™æ–¹æ³•ä½“ï¼š"><a href="#ç¼–å†™æ–¹æ³•ä½“ï¼š" class="headerlink" title="ç¼–å†™æ–¹æ³•ä½“ï¼š"></a>ç¼–å†™æ–¹æ³•ä½“ï¼š</h5><p>åœ¨æ­¤ä¹‹å‰éœ€è¦åŠ å…¥ä»¥ä¸ŠjaråŒ…ï¼›å½“å¼•å…¥ä¹‹åä¾¿å¯ä»¥è¿›è¡Œspringå’Œshiroçš„æ„å»ºäº†ã€‚<br>åœ¨è¿›è¡Œæ­å»ºä¹‹å‰éœ€è¦å»ºç«‹ä¸¤ä¸€ä¸ª<code>Realm</code>ï¼Œä¸€ä¸ªshiroçš„æ ¸å¿ƒæ§åˆ¶å™¨ã€‚éœ€è¦ç»§æ‰¿<code>AuthorizingRealm</code>ç„¶åå®ç°ä¸¤ä¸ªæ–¹æ³•ï¼š</p><p>åœ¨<code>doGetAuthenticationInfo(AuthenticationToken authenticationToken)</code>æ–¹æ³•ä¸­ï¼š<br><strong>authenticationToken</strong>å‚æ•°æ˜¯ä»å‰ç«¯é¡µé¢æ¥å—çš„ä¸€ä¸ªå‚æ•°ï¼Œé‡Œé¢å°è£…çš„æ˜¯ä¸€ä¸ªtokenï¼Œè¯¥tokenæ˜¯ä»å‰ç«¯è·å–çš„ï¼Œå…·ä½“çš„è·å–æ–¹æ³•æ˜¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line">UsernamePasswordToken token =  new UsernamePasswordToken(username, password);</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™æ®µä»£ç ä¸­çš„Controllerè·å–åˆ°å‰ç«¯çš„ç”¨æˆ·åå’Œå¯†ç ä¹‹ååœ¨<code>new UsernamePasswordToken(username, password)</code>è¿™é‡Œä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œç„¶åè¿™ä¸ªtokenä¼šè¢«ä¼ åˆ°realmä¸­ï¼Œæœ€ååœ¨realmä¸­çš„<code>doGetAuthenticationInfo</code>æ¥æ”¶åˆ°ï¼Œç„¶ååœ¨è¿™é‡Œä¾¿å¯ä»¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œè¦ä¹ˆè¿”å›å¼‚å¸¸ï¼Œè¦ä¹ˆåˆ™æ˜¯è¿”å›ä¸€ä¸ª<code>SimpleAuthenticationInfo</code>ã€‚è¿™ä¸ªä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String username = (String) authenticationToken.getPrincipal(); // è·å–ç”¨æˆ·å</span><br><span class="line">String password = new String((char[])authenticationToken.getCredentials()); //å¾—åˆ°å¯†ç </span><br><span class="line">Map&lt;String ,String &gt; map =new HashMap&lt;String, String&gt;();</span><br><span class="line">map.put(&quot;username&quot; ,username);</span><br><span class="line">map.put(&quot;password&quot;,password);</span><br><span class="line">User user =loginservice.loginCheck(map);</span><br><span class="line">if (user == null || user.getId() == null)&#123;</span><br><span class="line">    throw new UnknownAccountException(); //å¦‚æœç”¨æˆ·åé”™è¯¯</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    return new SimpleAuthenticationInfo(username, password, &quot;myRealm&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢çš„ä»£ç åªæ˜¯ç®€å•çš„è¿›è¡Œäº†æ•°æ®åº“æŸ¥è¯¢ç„¶åå°è£…ä¸ºä¸€ä¸ªtokenã€‚ç„¶åè¿”å›å³å¯ï¼Œé‚£ä¹ˆå¯¹ç”¨æˆ·çš„æƒé™è¿›è¡Œæ“ä½œçš„å°±æ˜¯å¦‚ä¸‹è¿™ä¸ªä»£ç ï¼š</p><p><code>doGetAuthorizationInfo</code>è¿™ä¸ªæ˜¯è¿›è¡Œæƒé™åˆ†é…çš„æ–¹æ³•ï¼šå…·ä½“çš„æ–¹æ³•ä½“å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principalCollection) &#123;</span><br><span class="line">     String username = (String) principalCollection.getPrimaryPrincipal(); //é€šè¿‡principalCollectionæŸ¥è¯¢åˆ°ç”¨æˆ·çš„å§“åï¼Œ</span><br><span class="line">     List&lt;Resources&gt; resources =loginservice.getRoleById(username); é€šè¿‡mybatisé…ç½®sql</span><br><span class="line">     List&lt;String&gt; roles =new ArrayList&lt;String&gt;(); // è·å–url</span><br><span class="line">     for (Resources  r: resources)&#123;</span><br><span class="line">         roles.add(r.getRole());</span><br><span class="line">     &#125;</span><br><span class="line">    SimpleAuthorizationInfo info = new SimpleAuthorizationInfo();</span><br><span class="line">    info.addRoles(roles); //å­˜æ”¾æƒé™</span><br><span class="line">    return info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>è¿™é‡Œåº”è¯¥æ˜¯è¿˜å¯ä»¥æ”¾ä¸€ä¸ªæƒé™ï¼Œåé¢å‡ ç¯‡æ—¥å¿—åœ¨åŠ ä¸Š</strong></p><h5 id="ApplicationContext-xmlçš„é…ç½®ï¼š"><a href="#ApplicationContext-xmlçš„é…ç½®ï¼š" class="headerlink" title="ApplicationContext.xmlçš„é…ç½®ï¼š"></a>ApplicationContext.xmlçš„é…ç½®ï¼š</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- é…ç½®Shiro --&gt;</span><br><span class="line">    &lt;bean id=&quot;lifecycleBeanPostProcessor&quot; class=&quot;org.apache.shiro.spring.LifecycleBeanPostProcessor&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean class=&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span><br><span class="line">          depends-on=&quot;lifecycleBeanPostProcessor&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=&quot;securityManager&quot; class=&quot;org.apache.shiro.web.mgt.DefaultWebSecurityManager&quot;&gt;</span><br><span class="line">        &lt;!-- securityManager æ ¸å¿ƒæ§åˆ¶å™¨ --&gt;</span><br><span class="line">        &lt;property name=&quot;realm&quot; ref=&quot;myRealm&quot;/&gt;  &lt;!-- é…ç½®realm --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- è¿‡æ»¤å™¨é…ç½®, åŒæ—¶åœ¨web.xmlä¸­é…ç½®filter --&gt;</span><br><span class="line">    &lt;bean id=&quot;shiroFilter&quot; class=&quot;org.apache.shiro.spring.web.ShiroFilterFactoryBean&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;securityManager&quot; ref=&quot;securityManager&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;loginUrl&quot; value=&quot;/&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;successUrl&quot; value=&quot;/login/main.jsp&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;unauthorizedUrl&quot; value=&quot;/login/TestPage&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;filters&quot;&gt;</span><br><span class="line">            &lt;map&gt;</span><br><span class="line">                &lt;entry key=&quot;authc&quot;&gt;</span><br><span class="line">                    &lt;bean class=&quot;org.apache.shiro.web.filter.authc.PassThruAuthenticationFilter&quot; /&gt;</span><br><span class="line">                &lt;/entry&gt;</span><br><span class="line">            &lt;/map&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;filterChainDefinitions&quot;&gt;</span><br><span class="line">            &lt;value&gt;</span><br><span class="line">                /user/**          = authc    &lt;!-- éœ€è¦è®¤è¯é€šè¿‡, å³ç™»å½•æˆåŠŸ --&gt;</span><br><span class="line">                /user/insert = authc,roles[ADMIN]</span><br><span class="line">                /user/getUser = authc,roles[MANAGER]</span><br><span class="line">                /user/toinsert = authc,roles[ADMIN]</span><br><span class="line">                /role/admin = authc,roles[ADMIN]</span><br><span class="line">                /role/manager = authc,roles[SUPERMANAG]</span><br><span class="line">                /role/manager = authc,roles[MANAGER]</span><br><span class="line">                &lt;!--/blog/**.do        = authc,perms[blog] &amp;lt;!&amp;ndash; éœ€è¦åç§°ä¸ºblogçš„æƒé™permission&amp;ndash;&amp;gt;--&gt;</span><br><span class="line">                &lt;!--/admin/*.do        = authc,roles[admin] &amp;lt;!&amp;ndash; éœ€è¦åç§°ä¸ºadminçš„è§’è‰²role&amp;ndash;&amp;gt;--&gt;</span><br><span class="line">                &lt;!-- è¯´æ˜: /*åŒ¹é…çš„çš„æ˜¯/abc;  /** åŒ¹é…çš„æ˜¯å¤šä¸ª/*, æ¯”å¦‚/abc/def --&gt;</span><br><span class="line">            &lt;/value&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shiro </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>layuiä½¿ç”¨æ€»ç»“</title>
      <link href="/2018/03/22/layui%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"/>
      <url>/2018/03/22/layui%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç”±äºè‡ªå·±å¹³æ—¶å¯¹å‰ç«¯çš„csså’Œjså­¦çš„ä¸æ˜¯å¤ªå¥½ï¼Œè€Œç°åœ¨åˆéœ€è¦è‡ªå·±æ¥å†™ä¸€ä¸ªå‰ç«¯é¡µé¢ï¼Œæ— æ„é—´åœ¨GitHubä¸­çœ‹åˆ°äº†<code>layui</code>ï¼Œæ‰€ä»¥æŠ±ç€å°è¯•çš„å¿ƒæ€ï¼Œå­¦ä¹ äº†ä¸€ä¸‹ï¼Œç°åœ¨ä¸»è¦æ˜¯è‡ªå·±åšä¸€ä¸ªæ€»ç»“ã€‚å¯èƒ½ä¹‹åä¼šå­¦ä¹ Vueç­‰å‰ç«¯è·¨æ¡†æ¶</p><h2 id="å…³äºLayuiçš„tableç»„ä»¶"><a href="#å…³äºLayuiçš„tableç»„ä»¶" class="headerlink" title="å…³äºLayuiçš„tableç»„ä»¶"></a>å…³äºLayuiçš„tableç»„ä»¶</h2><p>é¦–å…ˆLayuiçš„tableç»„ä»¶ï¼šåœ¨Layuiä¸­åˆ›å»ºä¸€ä¸ªtableç»„ä»¶éœ€è¦å…ˆå†™ä¸€ä¸ªtableæ ‡ç­¾ï¼š<code>&lt;table class=&quot;layui-hide&quot; id=&quot;test&quot; lay-filter=&quot;demo&quot;&gt;&lt;/table&gt;</code>ï¼Œåœ¨è¿™ä¹‹ä¸­ id æ˜¯éœ€è¦åœ¨table.renderä¸­ä½¿ç”¨çš„ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">table.render(&#123;</span><br><span class="line">            elem: &apos;#test&apos;</span><br><span class="line">            ,height: 315</span><br><span class="line">            ,url: &apos;/user/getUser&apos; //æ•°æ®æ¥å£</span><br><span class="line">            ,page: true //å¼€å¯åˆ†é¡µ</span><br><span class="line">            ,cols: [[ //è¡¨å¤´</span><br><span class="line">                &#123;field: &apos;id&apos;, title: &apos;ID&apos;, width:80, sort: true, fixed: &apos;left&apos;&#125;</span><br><span class="line">                ,&#123;field: &apos;age&apos;, title: &apos;å¹´é¾„&apos;, width:80&#125;</span><br><span class="line">                ,&#123;field: &apos;dataname&apos;, title: &apos;ç”¨æˆ·å&apos;, width:80&#125;</span><br><span class="line">                ,&#123;field: &apos;sex&apos;, title: &apos;æ€§åˆ«&apos;, width:80&#125;</span><br><span class="line">                ,&#123;field: &apos;password&apos;, title: &apos;å¯†ç &apos;, width:80, sort: true&#125;</span><br><span class="line">                ,&#123;fixed: &apos;right&apos;, width: 165, align:&apos;center&apos;, toolbar: &apos;#barDemo&apos;&#125;</span><br><span class="line">            ]]</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™æ®µjsä¹‹ä¸­<code>elem</code>åé¢çš„å€¼è¡¨ç¤ºçš„å°±æ˜¯tableæ ‡ç­¾ä¹‹åçš„idï¼Œè€Œè¿™æ®µä»£ç è¡¨ç¤ºçš„å°±æ˜¯åœ¨tableä¸­å¼‚æ­¥åŠ è½½æ•°æ®ï¼Œåé¢çš„toolbar è¡¨ç¤ºçš„æ˜¯éœ€è¦åˆ›å»ºä¸‰ä¸ªbuttonã€‚<br>æ³¨æ„æœ€åä¸€è¡Œçš„<code>toolbar : #barDemo</code> å®ƒä¼šè·Ÿä¸‹é¢çš„ä¸‰ä¸ªæŒ‰é’®ä¸€èµ·å¯¹åº”ã€‚<br>å¹¶ä¸”å°†è¿™ä¸‰ä¸ªæŒ‰é’®ä¸€èµ·æ·»åŠ åˆ°é‚£ä¸ªè¡¨æ ¼çš„åé¢ï¼Œè¿™ä¹‹åçš„ä¸‰ä¸ªæ ‡ç­¾çš„åˆ›å»ºæ–¹å¼å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/html&quot; id=&quot;barDemo&quot;&gt;</span><br><span class="line">        &lt;a class=&quot;layui-btn layui-btn-primary layui-btn-xs&quot; lay-event=&quot;detail&quot;&gt;æ–°å¢&lt;/a&gt;</span><br><span class="line">        &lt;a class=&quot;layui-btn layui-btn-xs&quot; lay-event=&quot;edit&quot;&gt;ç¼–è¾‘&lt;/a&gt;</span><br><span class="line">        &lt;a class=&quot;layui-btn layui-btn-danger layui-btn-xs&quot; lay-event=&quot;del&quot;&gt;åˆ é™¤&lt;/a&gt;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸‰ä¸ª<a>åçš„<code>lay-event</code>çš„å€¼åœ¨ä¹‹åä¼šç”¨åˆ°çš„ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">table.on(&apos;tool(demo)&apos;, function(obj)&#123; //æ³¨ï¼štoolæ˜¯å·¥å…·æ¡äº‹ä»¶åï¼Œdemoæ˜¯tableåŸå§‹å®¹å™¨çš„å±æ€§ lay-filter=&quot;å¯¹åº”çš„å€¼&quot; </span><br><span class="line">            var data = obj.data //è·å¾—å½“å‰è¡Œæ•°æ®</span><br><span class="line">                ,layEvent = obj.event; //è·å¾— lay-event å¯¹åº”çš„å€¼</span><br></pre></td></tr></table></figure></a></p><p><code>function(obj)</code>çš„objä¼ å…¥è¿›æ¥çš„æ˜¯ä¸€äº›å‚æ•°ï¼Œobj.data æ˜¯è·å–æ‰€é€‰ä¸­çš„æ•°æ®è¡Œçš„ä¸€äº›å€¼ï¼Œobj.Event è·å–çš„æ˜¯å‰é¢çš„<code>lay-event</code>çš„å€¼ï¼Œåœ¨ä¹‹åå¯ä»¥åˆ¤æ–­<code>if(layEvent === &#39;detail&#39;)</code>ï¼Œç„¶åå°±å¯ä»¥åŠè¿›è¡Œæ“ä½œäº†ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">layer.open(&#123;</span><br><span class="line">                    type: 1,</span><br><span class="line">                    title: &quot;ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹&quot;,</span><br><span class="line">                    closeBtn: 1,</span><br><span class="line">                    area: &apos;auto&apos;,</span><br><span class="line">                    shadeClose: true,</span><br><span class="line">                    skin: &apos;yourclass&apos;,</span><br><span class="line">                    content: &apos;&apos;// åœ¨è¿™é‡Œå¯ä»¥å†™htmlæ ‡ç­¾ç„¶åä¼šåœ¨é‚£ä¸ªé¢æ¿æ˜¾ç¤ºäº†ã€‚ </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">layer.confirm(&apos;çœŸçš„åˆ é™¤è¡Œä¹ˆ&apos;, function(index)&#123;</span><br><span class="line">                    obj.del(); //åˆ é™¤å¯¹åº”è¡Œï¼ˆtrï¼‰çš„DOMç»“æ„</span><br><span class="line">                    //å‘æœåŠ¡ç«¯å‘é€åˆ é™¤æŒ‡ä»¤</span><br><span class="line">                    layer.close(index);</span><br><span class="line">                    $.ajax(&#123;</span><br></pre></td></tr></table></figure><p><code>confirm</code>å¯ä»¥å¼¹å‡ºä¸€ä¸ªæ¡†æ¥ç¡®è®¤æ˜¯å¦è¿›è¡Œåˆ é™¤ä»¥å…ç”¨æˆ·çš„è¯¯æ“ä½œï¼Œè€Œobj.del()åˆ™æ˜¯å¯ä»¥åˆ é™¤è¯¥è¡Œã€‚layer.close()åˆ™æ˜¯å¯ä»¥å…³é—­æ¬¡å¯¹è¯æ¡†ã€‚<br>è€Œ<code>lay.message</code>åˆ™æ˜¯ä¸€ä¸ªå¼¹çª—ï¼Œç”¨äºåœ¨é¡µé¢ä¸Šæç¤ºç”¨æˆ·è¿›è¡Œäº†ä»€ä¹ˆæ“ä½œã€‚</p><h2 id="å’ŒJqueryä¸€èµ·ä½¿ç”¨"><a href="#å’ŒJqueryä¸€èµ·ä½¿ç”¨" class="headerlink" title="å’ŒJqueryä¸€èµ·ä½¿ç”¨"></a>å’ŒJqueryä¸€èµ·ä½¿ç”¨</h2><p>è¿™ä¸ªUIæ¡†æ¶æ˜¯å¯ä»¥å’ŒJqueryä¸€èµ·æ¥ä½¿ç”¨ï¼ŒJqueryå¯ä»¥å‘èµ·å¼‚æ­¥è¯·æ±‚ä»è€Œæ¥è¿›è¡Œä¸€äº›æ•°æ®æ“ä½œã€‚</p><h2 id="ä½¿ç”¨æˆªå›¾ï¼š"><a href="#ä½¿ç”¨æˆªå›¾ï¼š" class="headerlink" title="ä½¿ç”¨æˆªå›¾ï¼š"></a>ä½¿ç”¨æˆªå›¾ï¼š</h2><p><img src="layuiæˆªå›¾.jpg" alt=""></p>]]></content>
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UI </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°è¸©è¿‡çš„SpringMvcçš„ä¸€äº›å‘</title>
      <link href="/2018/03/22/%E8%AE%B0%E8%B8%A9%E8%BF%87%E7%9A%84SpringMvc%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"/>
      <url>/2018/03/22/%E8%AE%B0%E8%B8%A9%E8%BF%87%E7%9A%84SpringMvc%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/</url>
      <content type="html"><![CDATA[<p>æ—¶éš”ä¸€å¹´å¤šï¼Œå†æ¬¡åœ¨æ–°å…¬å¸æœŸé—´æ¥è§¦äº†SpringMvcï¼Œç”±äºä¹‹å‰ä¸€æ®µæ—¶é—´å†ç”¨Pythonå’ŒSpringBootåšé¡¹ç›®ï¼Œæ‰€ä»¥ä¸€æ—¶é—´å¯¼è‡´SpringMvcé…ç½®ä¸­å‡ºç°äº†å¥½å¤šå‘ï¼Œé‚é€ä¸€è®°å½•ï¼š</p><h1 id="å…³äºDaoå±‚æ‰¾ä¸åˆ°çš„å¼‚å¸¸"><a href="#å…³äºDaoå±‚æ‰¾ä¸åˆ°çš„å¼‚å¸¸" class="headerlink" title="å…³äºDaoå±‚æ‰¾ä¸åˆ°çš„å¼‚å¸¸"></a>å…³äºDaoå±‚æ‰¾ä¸åˆ°çš„å¼‚å¸¸</h1><p>åœ¨é…ç½®çš„è¿‡ç¨‹ä¸­è¿™ä¸ªå¼‚å¸¸å‡ºç°çš„æ¬¡æ•°æ˜¯æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯æœ€çƒ¦äººçš„ï¼Œä¸€èˆ¬æ˜¯ç”±äºåœ¨Controllerå±‚ä¸­æ‰¾ä¸åˆ°Serviceå±‚ï¼Œç„¶åServiceå±‚çš„Implåœ¨è‡ªåŠ¨è£…é…daoçš„æ—¶å€™æ‰¾ä¸åˆ°daoï¼Œæ‰€ä»¥å¼‚å¸¸å°±ä¼šæ²¿ç€serviceåˆ°è¾¾contrllerå±‚ï¼Œä½†æ˜¯æ€»ç»“èµ·æ¥ï¼Œåœ¨ä»Šå¤©çš„é…ç½®ä¸­é‡åˆ°çš„æƒ…å†µä¸»è¦åˆä»¥ä¸‹å‡ ç§ï¼š</p><h5 id="web-xmlä¸­çš„é…ç½®å‡ºç°äº†é”™è¯¯ï¼š"><a href="#web-xmlä¸­çš„é…ç½®å‡ºç°äº†é”™è¯¯ï¼š" class="headerlink" title="web.xmlä¸­çš„é…ç½®å‡ºç°äº†é”™è¯¯ï¼š"></a>web.xmlä¸­çš„é…ç½®å‡ºç°äº†é”™è¯¯ï¼š</h5><p>åœ¨Spring5ä¸­é»˜è®¤xmlæ–‡ä»¶æ˜¯åœ¨WEB-INFä¸­çš„ï¼Œäºæ˜¯ä¹Ÿå°±æƒ³ç€å°‘é…ç½®ä¸€ç‚¹æ˜¯ä¸€ç‚¹çš„åŸåˆ™ï¼Œæ‰€ä»¥åœ¨web.xmlä¸­åªæ˜¯é…ç½®äº†åˆ†å‘å™¨ã€‚ä½†æ˜¯ä»Šå¤©å´åœ¨å…¶ä¸­å‘ç°äº†ä¸€äº›å¯èƒ½ä¼šå¯¼è‡´Daoå±‚æ‰¾ä¸åˆ°çš„åŸå› ï¼Œå¦‚ä¸‹æ‰€ç¤ºæ˜¯æˆ‘ä¹‹å‰åœ¨web.xmlä¸­é…ç½®çš„ä¸€ä¸ªè¯¦æƒ…ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;&lt;!-- éœ€è¦wenmvcè¿™ä¸ªjaråŒ…--&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></p><p>å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œæ‰€ä»¥ä¹Ÿæ‰å¯¼è‡´äº†Daoå±‚å‡ºé”™äº†ï¼Œå…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š<br>åœ¨StackOverFlowä¸­å‘ç°æœ‰ä¸€ä¸ªäººçš„è§£é‡Šååˆ†çš„ç‹¬ç‰¹ï¼Œå¤§æ„æ˜¯web.xmlä¸­çš„é…ç½®æœ‰é—®é¢˜ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It is because the servlet-context.xml is placed inside the dispatcher servlet. Since dispatcher servlet is child of parent context, the parent context does not have the dependencies of child, So if you put the servlet-context.xml inside context param, and you must have the appServlet-servlet.xml inside the init param it will work fine.</span><br></pre></td></tr></table></figure></p><p>äºæ˜¯æˆ‘è‡ªå·±å°±ä¿®æ”¹äº†web.xmlè¿™ä¸ªæ–‡ä»¶ï¼Œä¿®æ”¹ä¹‹åçš„web.xmlé…ç½®å¦‚ä¸‹:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;listener&gt;</span><br><span class="line">    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</span><br><span class="line">  &lt;/listener&gt;</span><br><span class="line">  &lt;context-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;</span><br><span class="line">      classpath:ApplicationContext.xml</span><br><span class="line">    &lt;/param-value&gt;</span><br><span class="line">  &lt;/context-param&gt;</span><br><span class="line">  &lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">      &lt;param-value&gt;</span><br><span class="line">        classpath:spring-mvc.xml</span><br><span class="line">      &lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></p><p>ç„¶åé©¬ä¸Šå°±è¿è¡ŒæˆåŠŸäº†ã€‚ã€‚ã€‚</p><h5 id="è¿™ä¸ªå°±å±äºè‡ªå·±ç²—å¿ƒäº†"><a href="#è¿™ä¸ªå°±å±äºè‡ªå·±ç²—å¿ƒäº†" class="headerlink" title="è¿™ä¸ªå°±å±äºè‡ªå·±ç²—å¿ƒäº†"></a>è¿™ä¸ªå°±å±äºè‡ªå·±ç²—å¿ƒäº†</h5><p>åœ¨mapperé…ç½®æ–‡ä»¶ä¸­æˆ‘è¿™è¾¹æ˜¯è¿”å›çš„ä¸€ä¸ªé›†åˆã€‚ç„¶åæ ‡ç­¾æ‰“é”™äº†ï¼Œå°±æˆäº†<code>resultType</code>äºæ˜¯ä¸€ç›´å‡ºé”™ï¼Œåæ¥æ¢æˆäº†æ­£ç¡®çš„<code>resultMap</code>å°±æ­£ç¡®äº†ã€‚</p><h5 id="ä¿®æ”¹web-xmlä¹‹åå¯¼è‡´çš„å‘½åç©ºé—´å‡ºé”™äº†"><a href="#ä¿®æ”¹web-xmlä¹‹åå¯¼è‡´çš„å‘½åç©ºé—´å‡ºé”™äº†" class="headerlink" title="ä¿®æ”¹web.xmlä¹‹åå¯¼è‡´çš„å‘½åç©ºé—´å‡ºé”™äº†"></a>ä¿®æ”¹web.xmlä¹‹åå¯¼è‡´çš„å‘½åç©ºé—´å‡ºé”™äº†</h5>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webåç«¯ </tag>
            
            <tag> spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºJavaçš„é“¾å¼ä»£ç†</title>
      <link href="/2018/03/20/%E5%85%B3%E4%BA%8EJava%E7%9A%84%E9%93%BE%E5%BC%8F%E4%BB%A3%E7%90%86/"/>
      <url>/2018/03/20/%E5%85%B3%E4%BA%8EJava%E7%9A%84%E9%93%BE%E5%BC%8F%E4%BB%A3%E7%90%86/</url>
      <content type="html"><![CDATA[<h1 id="å…³äºJavaçš„ä»£ç†"><a href="#å…³äºJavaçš„ä»£ç†" class="headerlink" title="å…³äºJavaçš„ä»£ç†"></a>å…³äºJavaçš„ä»£ç†</h1><h2 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h2><ol><li>äº†è§£Enhancerçš„æ„ä¹‰</li><li>æŸ¥çœ‹ç”Ÿæˆçš„å­—èŠ‚ç ï¼ˆå’ŒåŸæ¥çš„å¯¹æ¯”ï¼‰</li><li>åˆ†æä»£ç†çš„åŒºåˆ«</li><li>å®Œæˆä»£ç†é“¾</li></ol><p>é¦–å…ˆéœ€è¦æ–°å»ºä¸€ä¸ªä»£ç†ç®¡ç†ç±»ï¼Œè¿™ä¸ªç®¡ç†ç±»ä¼šå­˜å‚¨ç›®æ ‡ä»£ç†ç±»ï¼Œç›®æ ‡ä»£ç†æ–¹æ³•ï¼Œä»¥åŠä¸€ä¸ªListï¼ŒListä¸­å­˜å‚¨çš„æ˜¯ä¸€äº›ä»£ç†ç±»ï¼Œæœ€åæ˜¯éœ€è¦ä¸€ä¸ªæ“ä½œå°±æ˜¯</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€ä»£ç† </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€æ¬¡ä½¿ç”¨Spring5æ„ä»¶Webçš„è¿‡ç¨‹</title>
      <link href="/2018/03/20/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8Spring5%E6%9E%84%E4%BB%B6Web%E7%9A%84%E8%BF%87%E7%A8%8B/"/>
      <url>/2018/03/20/%E8%AE%B0%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8Spring5%E6%9E%84%E4%BB%B6Web%E7%9A%84%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>ç”±äºå½“æ—¶åœ¨å­¦ä¹ Springçš„æ—¶å€™è¿˜æ˜¯åœ¨ä¸€å¹´å‰ï¼Œé‚£æ—¶å€™Springæ‰æ˜¯åˆšåˆ°4.3è¿˜æ˜¯4.5.ç„¶ååšäº†ä¸€ä¸ªé¡¹ç›®ä¹‹åä¾¿äº†è§£åˆ°äº†SpringBootï¼Œäºæ˜¯ä¸€ç›´åœ¨ç”¨SpringBootï¼Œæ‰€ä»¥å¯¼è‡´ç°åœ¨é…ç½®èµ·æ¥å°±æœ‰ç‚¹å¿˜è®°äº†ã€‚æ‰€ä»¥ç°åœ¨è®°å½•ä¸‹æ­¤æ¬¡é…ç½®çš„è¿‡ç¨‹ä¸­æ‰€é‡åˆ°çš„å‘ã€‚</p><h1 id="è¸©è¿‡çš„å‘ï¼š"><a href="#è¸©è¿‡çš„å‘ï¼š" class="headerlink" title="è¸©è¿‡çš„å‘ï¼š"></a>è¸©è¿‡çš„å‘ï¼š</h1><h2 id="é‡åˆ°åœ¨web-xmlä¸­åˆ†å‘è¯·æ±‚çš„ç±»æ‰¾ä¸åˆ°"><a href="#é‡åˆ°åœ¨web-xmlä¸­åˆ†å‘è¯·æ±‚çš„ç±»æ‰¾ä¸åˆ°" class="headerlink" title="é‡åˆ°åœ¨web.xmlä¸­åˆ†å‘è¯·æ±‚çš„ç±»æ‰¾ä¸åˆ°"></a>é‡åˆ°åœ¨web.xmlä¸­åˆ†å‘è¯·æ±‚çš„ç±»æ‰¾ä¸åˆ°</h2><p>ç¬¬ä¸€ä¸ªå‘å°±æ˜¯<code>org.springframework.web.servlet.DispatcherServlet</code>è¿™ä¸ªç±»ä¸€ç›´æ‰¾ä¸åˆ°ï¼›äºæ˜¯åœ¨POMä¸­æ·»åŠ äº†ä¸ªå„ç§ä¾èµ–ç»ˆäºå‘ç°ç¼ºå°‘<code>Spring Web MVC</code>è¿™ä¸ªä¾èµ–åŒ…ã€‚ã€‚ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;&lt;!-- éœ€è¦webmvcè¿™ä¸ªjaråŒ…--&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br></pre></td></tr></table></figure></p><h2 id="å¼€å¯Tomcatçš„æ—¶å€™ä¸€ç›´æç¤ºä»€ä¹ˆCacheé”™è¯¯"><a href="#å¼€å¯Tomcatçš„æ—¶å€™ä¸€ç›´æç¤ºä»€ä¹ˆCacheé”™è¯¯" class="headerlink" title="å¼€å¯Tomcatçš„æ—¶å€™ä¸€ç›´æç¤ºä»€ä¹ˆCacheé”™è¯¯"></a>å¼€å¯Tomcatçš„æ—¶å€™ä¸€ç›´æç¤ºä»€ä¹ˆCacheé”™è¯¯</h2><p>é”™è¯¯æç¤ºï¼š<code>CacheManager No Bean Found - Not Trying to setup any Cache</code> å½“æ—¶ä¸€ç›´åœ¨åˆ°å¤„æŸ¥æ‰¾æ˜¯å¦å¼€å¯æ•°æ®åº“ä»€ä¹ˆçš„ï¼Œåæ¥åœ¨StackOverFlowä¸­æŸ¥è¯¢åˆ°äº†é—®é¢˜çš„è§£å†³åŠæ³•ï¼š<br><a href="https://stackoverflow.com/questions/24816502/cachemanager-no-bean-found-not-trying-to-setup-any-cache" target="_blank" rel="noopener">StackOverFlowä¸­å…³äºCacheçš„é”™è¯¯</a><br>æ ¹æ®ä»–äººçš„ç­”æ¡ˆåšä¸€ä¸ªæ€»ç»“å°±æ˜¯ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­å‘ç°è‹¥æ–‡ä»¶ä¸­å«æœ‰<code>&lt;tx</code>çš„è¯ï¼ŒIDEAä¼šè‡ªåŠ¨çš„å°†å¼•å…¥ç±»ä¼¼<code>***/cache</code>ç­‰çš„<code>xsd</code>æ–‡ä»¶ï¼Œæ‰€ä»¥å¯¼è‡´äº†è¿™ä¸ªå¼‚å¸¸çš„å‡ºç°ã€‚æ‰€ä»¥ä¸€èˆ¬æ¥è¯´åˆä¸¤ç§è§£å†³åŠæ³•ã€‚</p><h4 id="ç”¨IDEAçš„æ¨¡æ¿ç›´æ¥åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶ï¼š"><a href="#ç”¨IDEAçš„æ¨¡æ¿ç›´æ¥åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="ç”¨IDEAçš„æ¨¡æ¿ç›´æ¥åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶ï¼š"></a>ç”¨IDEAçš„æ¨¡æ¿ç›´æ¥åˆ›å»ºspringçš„é…ç½®æ–‡ä»¶ï¼š</h4><p>è¿‡ç¨‹ï¼š<code>File -&gt; new -&gt; XMLConfigurationFile -&gt; Spring Config</code> ç„¶åSpringè‡ªåŠ¨çš„å°†æ‰€éœ€è¦çš„å‘½åç©ºé—´æ·»åŠ åˆ°äº†æ–°å»ºçš„xmlæ–‡ä»¶ä¸­ã€‚æ­¤æ—¶åªéœ€è¦æ·»åŠ ç›¸åº”çš„æ ‡ç­¾å³å¯ã€‚</p><h4 id="åˆ é™¤å¯¼è‡´å¼‚å¸¸çš„xsd"><a href="#åˆ é™¤å¯¼è‡´å¼‚å¸¸çš„xsd" class="headerlink" title="åˆ é™¤å¯¼è‡´å¼‚å¸¸çš„xsd"></a>åˆ é™¤å¯¼è‡´å¼‚å¸¸çš„xsd</h4><p>æ­¥éª¤ï¼šåœ¨xmlé…ç½®æ–‡ä»¶ä¸­åˆ é™¤æ‰å¸¦æœ‰<code>cache</code>çš„çš„xsd</p><h2 id="é™æ€èµ„æºçš„é…ç½®å’Œå¼•ç”¨"><a href="#é™æ€èµ„æºçš„é…ç½®å’Œå¼•ç”¨" class="headerlink" title="é™æ€èµ„æºçš„é…ç½®å’Œå¼•ç”¨"></a>é™æ€èµ„æºçš„é…ç½®å’Œå¼•ç”¨</h2><p>åœ¨å»å¹´é…ç½®é™æ€èµ„æºçš„æ—¶å€™ä¸ä»Šå¹´çš„ç›¸å·®æ— å‡ ï¼Œä½†æ˜¯åœ¨å¼•ç”¨çš„æ—¶å€™å´å‡ºç°äº†ä¸€äº›å˜åŒ–ã€‚<br>å»å¹´åšé¢˜çš„ç½‘ç«™çš„ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">å»å¹´è·å–é™æ€èµ„æºçš„é…ç½®ï¼š</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/static/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/static/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/uploadimg/**&quot; location=&quot;/uploadimg/&quot; /&gt;</span><br><span class="line">å»å¹´çš„jspæ–‡ä»¶ä¸­çš„å¼•ç”¨ï¼š</span><br><span class="line"></span><br><span class="line">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;utf-8&quot;%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;è§£é¢˜ç›®å½•&lt;/title&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;</span><br><span class="line">src=&quot;$&#123;pageContext.request.contextPath&#125;/static/js/jquery-3.1.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;</span><br><span class="line">src=&quot;$&#123;pageContext.request.contextPath &#125;/static/js/bootstrap.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot;</span><br><span class="line">href=&quot;$&#123;pageContext.request.contextPath &#125;/static/css/bootstrap.css&quot;&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot;</span><br><span class="line">href=&quot;$&#123;pageContext.request.contextPath &#125;/static/css/bootstrap-theme.css&quot;&gt;</span><br><span class="line">&lt;link rel=&quot;stylesheet&quot;</span><br><span class="line">href=&quot;$&#123;pageContext.request.contextPath &#125;/static/css/examination.css&quot;&gt;</span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°ï¼šåœ¨jspä¸­æ˜¯é¦–å…ˆè·å–åˆ°é¡¹ç›®ç›®å½•ç„¶åä»¥ç»å¯¹è·¯å¾„æ¥è·å–é™æ€èµ„æº</p><p>ä»Šå¤©æ–°å»ºçš„é¡¹ç›®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">xmlé…ç½®æ–‡ä»¶ï¼š</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/WEB-INF/static/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/static/**&quot; location=&quot;/WEB-INF/static/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/uploadimg/**&quot; location=&quot;/WEB-INF/uploadimg/&quot; /&gt;</span><br><span class="line"></span><br><span class="line">jspæ–‡ä»¶ä¸­çš„å¼•ç”¨ï¼š</span><br><span class="line"></span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;link href=&quot;../static/css/TestPage.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></table></figure></p><p>åœ¨è¿™é‡Œä¼šå‘ç°ä»Šå¤©åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å¼•ç”¨å¤šäº†ä¸€ä¸ª<code>WEB-INF</code>ç„¶åå†æ˜¯staticæ–‡ä»¶å¤¹</p><h2 id="å…³äºä¸ºä»€ä¹ˆxmlç°åœ¨é»˜è®¤åœ¨WEB-INFä¸­ï¼š"><a href="#å…³äºä¸ºä»€ä¹ˆxmlç°åœ¨é»˜è®¤åœ¨WEB-INFä¸­ï¼š" class="headerlink" title="å…³äºä¸ºä»€ä¹ˆxmlç°åœ¨é»˜è®¤åœ¨WEB-INFä¸­ï¼š"></a>å…³äºä¸ºä»€ä¹ˆxmlç°åœ¨é»˜è®¤åœ¨WEB-INFä¸­ï¼š</h2><p>åœ¨å»å¹´çš„æ—¶å€™è®°å¾—springçš„é…ç½®æ–‡ä»¶éƒ½æ˜¯åœ¨resourcesä¸­çš„ï¼Œä½†æ˜¯ä»Šå¤©å´å‘ç°åœ¨resourcesä¸­é…ç½®çš„è¯å¯åŠ¨tomcatä¼šå¯¼è‡´ä¸€æ¡æç¤ºå°±æ˜¯<code>IOException parsing XML document from ServletContext resource [/WEB-INF/XXXXXX]</code><br>åæ¥æŸ¥è¯¢åˆ°å‘ç°æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œé»˜è®¤çš„è¯ç›´æ¥åœ¨WEB-INFä¸­æŒ‰ç…§å‰é¢åˆ›å»ºxmlçš„æ–¹å¼åˆ›å»ºä¸€ä¸ªå³å¯ï¼Œä½†æ˜¯è‹¥éœ€è¦ä¿®æ”¹çš„è¯å¯ä»¥å‚ç…§ä¸€ä¸‹é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">è¿™ä¸ªxmlé…ç½®è¡¨ç¤ºçš„æ˜¯åŸºæœ¬é…ç½®çš„Application.xmlçš„ä½ç½®</span><br><span class="line">&lt;context-param&gt;</span><br><span class="line">&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">&lt;param-value&gt;</span><br><span class="line">    classpath:ApplicationContext.xml</span><br><span class="line">    &lt;/param-value&gt;</span><br><span class="line">&lt;/context-param&gt;</span><br><span class="line"></span><br><span class="line">è¿™ä¸ªæ˜¯é…ç½®åˆ†å‘å™¨çš„é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼š</span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">&lt;servlet-name&gt;springDefault&lt;/servlet-name&gt;</span><br><span class="line">&lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">&lt;init-param&gt;</span><br><span class="line">&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">&lt;param-value&gt;</span><br><span class="line">            classpath:spring-mvc.xml</span><br><span class="line">            &lt;/param-value&gt;</span><br><span class="line">&lt;/init-param&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥å‘ç°åœ¨å»å¹´çš„æ—¶å€™éƒ½æ˜¯åˆ¶å®šäº†é…ç½®æ–‡ä»¶çš„è·¯å¾„çš„ï¼Œæ‰€ä»¥æ‰å¯ä»¥åœ¨resourcesä¸­é…ç½®xmlï¼Œä½†æ˜¯å†çœ‹ä»Šå¹´çš„é…ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;&lt;!-- éœ€è¦wenmvcè¿™ä¸ªjaråŒ…--&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">  &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">  &lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;spring-dispatcher&lt;/servlet-name&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">  &lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></p><p>ä¼šå‘ç°éƒ½æ²¡é…ç½®å¥½ï¼Œæ‰€ä»¥ä¼šå‡ºç°éœ€è¦é…ç½®åœ¨é»˜è®¤çš„ä½ç½®ä¸Šã€‚<br><a href="https://stackoverflow.com/questions/11652931/applicationcontext-xml-is-being-copied-to-web-inf-classes-from-src-main-resourc" target="_blank" rel="noopener">StackOverFlowä¸­é»˜è®¤WEB-INFé…ç½®çš„è§£é‡Š</a></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€æ¬¡sqlåµŒå¥—æŸ¥è¯¢çš„ä½¿ç”¨æ–¹æ³•</title>
      <link href="/2018/03/16/%E8%AE%B0%E4%B8%80%E6%AC%A1sql%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
      <url>/2018/03/16/%E8%AE%B0%E4%B8%80%E6%AC%A1sql%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡sqlåµŒå¥—æŸ¥è¯¢çš„ä½¿ç”¨æ–¹æ³•"><a href="#è®°ä¸€æ¬¡sqlåµŒå¥—æŸ¥è¯¢çš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="è®°ä¸€æ¬¡sqlåµŒå¥—æŸ¥è¯¢çš„ä½¿ç”¨æ–¹æ³•"></a>è®°ä¸€æ¬¡sqlåµŒå¥—æŸ¥è¯¢çš„ä½¿ç”¨æ–¹æ³•</h1><p>ä¸€èˆ¬æ¥è®²åœ¨sqlä¸­åµŒå¥—æŸ¥è¯¢åœ¨whereä¹‹åä»¥ä¾¿äºæŸ¥è¯¢èŒƒå›´çš„é™åˆ¶ã€‚<br>ç°åœ¨æœ‰ä¸€ä¸ªæƒ…å†µå°±æ˜¯å°±æ˜¯ç°åœ¨åµŒå¥—æŸ¥è¯¢çš„è¯æ˜¯éœ€è¦æŸ¥è¯¢å‡ºç»“æœå€¼ç„¶åè¿”å›ä¸ºä¸€ä¸ªå­—æ®µã€‚</p><h2 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h2><h4 id="æ€è·¯ä¸€ï¼šæ—¢ç„¶éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆæ˜¯éœ€è¦ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„è¡¨è¾¾å¼æ˜¯ï¼š"><a href="#æ€è·¯ä¸€ï¼šæ—¢ç„¶éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆæ˜¯éœ€è¦ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„è¡¨è¾¾å¼æ˜¯ï¼š" class="headerlink" title="æ€è·¯ä¸€ï¼šæ—¢ç„¶éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆæ˜¯éœ€è¦ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„è¡¨è¾¾å¼æ˜¯ï¼š"></a>æ€è·¯ä¸€ï¼šæ—¢ç„¶éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆæ˜¯éœ€è¦ä¸€ä¸ªåµŒå¥—æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸€èˆ¬çš„è¡¨è¾¾å¼æ˜¯ï¼š</h4><p><code>select &lt;è¡¨è¾¾å¼&gt;ï¼ˆselect&lt;è¡¨è¾¾å¼&gt;ï¼‰as name</code>è¿™æ ·ä½œä¸ºä¸€ä¸ªæŸ¥è¯¢ã€‚<br>é¦–å…ˆåœ¨æ‹¬å·<code>()</code>é‡Œé¢çš„ä¸€ä¸ªselectè¯­å¥æ˜¯å¯ä»¥ä½œä¸ºä¸€ä¸ªå­—æ®µçš„ï¼Œå¯ä»¥é€šè¿‡åœ¨åé¢åŠ ä¸€ä¸ªas <code>å­—æ®µ</code>ä»è€Œè¿”å›çš„æ˜¯ä¸€ä¸ªå­—æ®µã€‚ã€<br>é‚£ä¹ˆè¿™æ ·ä¹¦å†™sqlä¹‹åä¾¿å¯ä»¥ä½œä¸ºä¸€ä¸ªå­—æ®µç„¶åè¿”å›ç»“æœäº†ã€‚ä½†æ˜¯è¿™æ ·å†™æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯è‹¥æ²¡æœ‰groupbyï¼Œåˆ™ä¼šå¯¼è‡´æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ä¼šæœ‰å¤šä½™é‡å¤å¾—ã€‚<br>ç±»ä¼¼ä¸‹é¢è¿™æ¡sqlï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT * ,(SELECT SUM(CASE WHEN car_information.`car_status` =&apos;1&apos; THEN 1 ELSE 0 END)</span><br><span class="line">FROM car_information WHERE car_information.`cat_place`=&apos;æ­¦æ±‰&apos;) AS &apos;weifacishi&apos; </span><br><span class="line">FROM car LEFT JOIN car_information ON car.`car_num`=car_information.`car_num` ;</span><br></pre></td></tr></table></figure></p><p>æŸ¥è¯¢ç»“æœï¼š</p><p><img src="sqlé‡å¤æ•°æ®.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°é‡å¤äº†è®¸å¤šæ•°æ®ï¼Œæ‰€ä»¥è¡¨æ˜éœ€è¦å®ç°è¿™ä¸ªæŸ¥è¯¢é›†åˆéœ€è¦ä¿®æ”¹sqlè¯­å¥ã€‚</p><h4 id="æ€è·¯äºŒï¼š"><a href="#æ€è·¯äºŒï¼š" class="headerlink" title="æ€è·¯äºŒï¼š"></a>æ€è·¯äºŒï¼š</h4><p>å½“çœ‹åˆ°è¿™ç§å†™æ³•å‡ºç°é‡å¤å¾—æ—¶å€™ï¼Œä¾¿å†³å®šè¿™ä¸ªsqlå¿…é¡»è¿›è¡Œgroupbyï¼Œé¦–å…ˆå†™äº†ä¸€ä¸ªsqlæ¥æµ‹è¯•groupbyå¾—ï¼Œå‘ç°å¯ä»¥ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT car_information.`car_num`,car_information.`cat_place`, SUM(CASE WHEN car_information.`car_status` = &apos;1&apos; THEN  1  ELSE 0 END) AS &apos;weifacishi&apos;</span><br><span class="line"> FROM car_information GROUP BY car_information.`car_num`;</span><br></pre></td></tr></table></figure></p><p>æŸ¥è¯¢ç»“æœï¼š</p><p><img src="è¿›è¡ŒGroupbyæµ‹è¯•.png" alt=""><br>å‘ç°ï¼Œæ€è·¯ç¡®å®æ˜¯å¯¹çš„ï¼Œåªä¸è¿‡éœ€è¦å¯¹sqlé‡æ–°è¿›è¡Œæ’åºã€‚</p><h4 id="æ€è·¯ä¸‰ï¼š"><a href="#æ€è·¯ä¸‰ï¼š" class="headerlink" title="æ€è·¯ä¸‰ï¼š"></a>æ€è·¯ä¸‰ï¼š</h4><p>æœ‰äº†ä¸Šé¢å¾—ä¸¤æ­¥ä¹‹åä¾¿å·®ä¸å¤šçŸ¥é“å¦‚ä½•è¿›è¡Œæ“ä½œäº†ï¼šé¦–å…ˆåº”è¯¥è¿›è¡Œä¸€ä¸ªå·¦è¿æ¥ï¼Œä»¥carè¡¨ä¸ºå·¦è¡¨ï¼Œcar_informationä¸ºå³è¡¨ã€‚è¿æ¥ä¹‹åå†è¿™ä¸ªç»“æœé›†ä¸­è¿›è¡Œgroupbyç„¶åç»Ÿè®¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM (SELECT car.`car_num`,car.`car_wearhouse`,car_information.`car_status` FROM car LEFT JOIN car_information ON car.`car_num`=car_information.`car_num`) AS t GROUP BY t.car_num;</span><br></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="æ­£ç¡®å¾—ç»“æœ.png" alt=""></p><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><ol><li><p>åœ¨sqlè¯­å¥ä¸­ï¼Œå‡ ä¸ªè¡¨ä¹‹é—´å¾—è¿æ¥æ˜¯å¯ä»¥åšä¸€ä¸ªç»“æœé›†å¾—ï¼Œè¿™ä¸ªç»“æœé›†å¯ä»¥é€šè¿‡aså‘½åä¸ºåˆ«åç„¶åé€šè¿‡æ“ä½œè¿™ä¸ªåˆ«åæ¥æ“ä½œï¼›</p></li><li><p>ä¸ç†è§£å¾—åœ°æ–¹ï¼š<br> åœ¨sqlä¸­<code>select t.XXX</code>è¿™ä¸ªtæ˜¯åæ¥æ‰è¢«å‘½åå¾—ï¼Œä½†æ˜¯åœ¨ä¹‹å‰å´æ˜¯å¯ä»¥ä½¿ç”¨å¾—ï¼Œå› æ­¤æƒ³çŸ¥é“sqlå¾—è¿è¡ŒåŸç†â€”ä»¥åå†äº†è§£</p></li><li><p>åœ¨sqlä¸­ç»Ÿè®¡å¾—ç”¨æ³•<code>case when XX==&#39;XX&#39; then 1 else 0 end</code>ï¼Œå¹¶ä¸”åµŒå¥—å¾—ä½¿ç”¨å¾—() as â€˜XXXâ€™</p><h2 id="å…¶ä½™çš„ä»¥åå†è¡¥å……"><a href="#å…¶ä½™çš„ä»¥åå†è¡¥å……" class="headerlink" title="å…¶ä½™çš„ä»¥åå†è¡¥å……"></a>å…¶ä½™çš„ä»¥åå†è¡¥å……</h2></li></ol><h4 id="è¡¥å……ä¸€ï¼š"><a href="#è¡¥å……ä¸€ï¼š" class="headerlink" title="è¡¥å……ä¸€ï¼š"></a>è¡¥å……ä¸€ï¼š</h4><p>åœ¨sqlä¸­å·¦è¿æ¥å’Œå†…è¿æ¥çš„ä¼˜å…ˆé€‰æ‹©é—®é¢˜ï¼Œå†…è¿æ¥ä¼šè¿”å›åœ¨ä¸¤è¡¨ä¸­éƒ½åŒ…å«çš„å€¼ï¼Œè€Œå·¦è¿æ¥çš„è¯ï¼Œå½“å³è¾¹çš„è¡¨æ•°æ®åœ¨å·¦è¡¨ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ä¼šå‡ºç°nullï¼Œè€Œå†…è¿æ¥åˆ™ä¸ä¼šäº§ç”Ÿè¿™ç§æƒ…å†µã€‚<br>è¿˜æœ‰å°±æ˜¯UNIONçš„ä½¿ç”¨ï¼Œunionåœ¨ä¸¤å¼ è¡¨è¿”å›çš„ç»“æœé›†æ˜¯ä¸€æ ·çš„è¯è€Œä¸”ä¸¤è¡¨éœ€è¦æ‹¼æ¥çš„è¯æ˜¯éå¸¸æœ‰æ•ˆçš„</p>]]></content>
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysqlåµŒå¥—æŸ¥è¯¢ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>LeetCodeçš„ä¸€é“å­—ç¬¦ä¸²é¢˜ç›®ï¼šæœ€é•¿ä¸é‡å¤çš„å­å­—ç¬¦ä¸²é•¿åº¦</title>
      <link href="/2018/03/14/LeetCode%E7%9A%84%E4%B8%80%E9%81%93%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%A2%98%E7%9B%AE%EF%BC%9A%E6%9C%80%E9%95%BF%E4%B8%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6/"/>
      <url>/2018/03/14/LeetCode%E7%9A%84%E4%B8%80%E9%81%93%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%A2%98%E7%9B%AE%EF%BC%9A%E6%9C%80%E9%95%BF%E4%B8%8D%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%95%BF%E5%BA%A6/</url>
      <content type="html"><![CDATA[<h1 id="æ‰¾å‡ºæœ€é•¿çš„ä¸é‡å¤çš„å­å­—ç¬¦ä¸²"><a href="#æ‰¾å‡ºæœ€é•¿çš„ä¸é‡å¤çš„å­å­—ç¬¦ä¸²" class="headerlink" title="æ‰¾å‡ºæœ€é•¿çš„ä¸é‡å¤çš„å­å­—ç¬¦ä¸²"></a>æ‰¾å‡ºæœ€é•¿çš„ä¸é‡å¤çš„å­å­—ç¬¦ä¸²</h1><p>é¦–å…ˆä¸€æ‹¿åˆ°è¿™ä¸ªé¢˜ç›®çš„æ—¶å€™æƒ³åˆ°åˆ©ç”¨seté›†åˆæ¥å­˜å‚¨å­å­—ç¬¦ä¸²ï¼Œå½“å‘ç°å«æœ‰é‡å¤çš„å­—ç¬¦çš„æ—¶å€™å°±å°†è¿™ä¸ªsetæ¸…é›¶ã€‚è¿™ä¸ªåšæ³•æœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯å½“å­å­—ç¬¦ä¸²ä¸­çš„æŸä¸€ä¸ªå­—ç¬¦å’Œåé¢çš„é‡å¤çš„è¯ï¼Œé‚£ä¹ˆåé¢ä¸è¡ŒåŒçš„ä¹Ÿä¼šè¢«æ¸…æ¥šï¼šä¾‹å¦‚<code>dfvfab</code>ï¼Œåœ¨è¿™ä¸ªé‡Œé¢<code>vfab</code>åº”è¯¥æ˜¯æœ€çŸ­çš„å­å­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿™æ—¶å€™è¿™ä¸ªæ–¹æ³•ä¼šè¾“å‡ºé”™è¯¯çš„å€¼ã€‚</p><h2 id="æ€è·¯ï¼š"><a href="#æ€è·¯ï¼š" class="headerlink" title="æ€è·¯ï¼š"></a>æ€è·¯ï¼š</h2><p>è‡ªå·±æƒ³ä¸åˆ°è§£æ³•ä¹‹åå°±å‚è€ƒäº†Solution2ï¼Œè¿™ä¸ªæ–¹æ³•æƒ³äº†ä¸‹ä¹ŸæŒºå¥½çš„ï¼Œé‚è®°å½•ä¸‹ï¼š<br>è¯¥æ–¹æ³•æ˜¯è®¾ç½®ä¸¤ä¸ªæ¸¸æ ‡ï¼Œä¸€ä¸ªåœ¨å‰ï¼Œä¸€ä¸ªåœ¨å(å®šä¹‰ä¸ºi,j)ï¼Œå½“å‰é¢çš„ä¸€ä¸ªå‘ç°åœ¨seté›†åˆä¸­å«æœ‰é‡å¤çš„å­—ç¬¦ï¼Œé‚£æ­¤æ—¶åœæ­¢i,ç„¶åjè‡ªå¢ï¼Œå½“å‘ç°åœ¨seté›†åˆä¸­å·²ç»å°†é‡å¤çš„é‚£ä¸ªå­—ç¬¦å‰”é™¤ä¹‹åï¼Œæ­¤æ—¶åœ¨iè‡ªå¢<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public int lengthOfLongestSubstring(String s) &#123;</span><br><span class="line">        //é”™è¯¯çš„æ€è·¯ï¼Œä»¥ä¸ºå­˜å…¥setå°±å¯ä»¥</span><br><span class="line">        // if (s == null || s.length() == 0)&#123;</span><br><span class="line">        //     return 0;</span><br><span class="line">        // &#125;</span><br><span class="line">        // Set&lt;Character&gt; set =new HashSet&lt;&gt;();</span><br><span class="line">        // int max=0;</span><br><span class="line">        // for (int i =0 ;i&lt; s.length() ;i++)&#123;</span><br><span class="line">        //     char c = s.charAt(i);</span><br><span class="line">        //     if (set.contains(c))&#123;</span><br><span class="line">        //         set.clear();</span><br><span class="line">        //     &#125;</span><br><span class="line">        //     set.add(c);</span><br><span class="line">        //     if (set.size() &gt; max)&#123;</span><br><span class="line">        //         max = set.size();</span><br><span class="line">        //     &#125;</span><br><span class="line">        // &#125;</span><br><span class="line">        // return max;</span><br><span class="line">        if(s == null || s.length() ==0)&#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        Set&lt;Character&gt; set =new HashSet&lt;&gt;();</span><br><span class="line">        int i=0,j=0,result=0,n=s.length();</span><br><span class="line">        while(i &lt; n &amp;&amp; j &lt;n)&#123;</span><br><span class="line">            if(!set.contains(s.charAt(j)))&#123;</span><br><span class="line">                set.add(s.charAt(j++));</span><br><span class="line">                result=Math.max(result,j-i);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                set.remove(s.charAt(i++));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h2 id="ä¸æ±‚æœ€é•¿çš„å­å­—ç¬¦ä¸²ï¼ˆæœ´ç´ æ±‚è§£æ³•ï¼‰ç›¸æ¯”è¾ƒï¼š"><a href="#ä¸æ±‚æœ€é•¿çš„å­å­—ç¬¦ä¸²ï¼ˆæœ´ç´ æ±‚è§£æ³•ï¼‰ç›¸æ¯”è¾ƒï¼š" class="headerlink" title="ä¸æ±‚æœ€é•¿çš„å­å­—ç¬¦ä¸²ï¼ˆæœ´ç´ æ±‚è§£æ³•ï¼‰ç›¸æ¯”è¾ƒï¼š"></a>ä¸æ±‚æœ€é•¿çš„å­å­—ç¬¦ä¸²ï¼ˆæœ´ç´ æ±‚è§£æ³•ï¼‰ç›¸æ¯”è¾ƒï¼š</h2><pre><code>æœ´ç´ æ±‚è§£æ³•çš„ä¸€èˆ¬æ­¥éª¤æ˜¯å·²ç»ç»™å‡ºäº†å­å­—ç¬¦ä¸²ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­å­—ç¬¦ä¸²ã€‚é‚£ä¹ˆæ­¤æ—¶æ—¢ç„¶å·²çŸ¥å­å­—ç¬¦ä¸²çš„è¯ï¼Œå…¶æ­¥éª¤å°±æ˜¯é€šè¿‡å­å­—ç¬¦ä¸²ä¾æ¬¡æ¯”è¾ƒ</code></pre><h2 id="ä¸åˆ¤æ–­é“¾è¡¨æˆç¯ç›¸æ¯”è¾ƒï¼š"><a href="#ä¸åˆ¤æ–­é“¾è¡¨æˆç¯ç›¸æ¯”è¾ƒï¼š" class="headerlink" title="ä¸åˆ¤æ–­é“¾è¡¨æˆç¯ç›¸æ¯”è¾ƒï¼š"></a>ä¸åˆ¤æ–­é“¾è¡¨æˆç¯ç›¸æ¯”è¾ƒï¼š</h2><pre><code>åˆ¤æ–­é“¾è¡¨æˆç¯ä¹Ÿæœ‰ä¸€ä¸ªå¿«æ…¢æŒ‡é’ˆçš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨é‚£ä¸ªå¿«æ…¢æŒ‡é’ˆä¸­ï¼Œå¿«æ…¢æŒ‡é’ˆéƒ½æ˜¯åŒæ—¶åœ¨å˜åŒ–çš„</code></pre>]]></content>
      
      <categories>
          
          <category> Leetcode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å­—ç¬¦ä¸²ç›¸å…³ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Javaé€šè¿‡åå°„ç”¨æŒ‡å®šæ„é€ å™¨åˆå§‹åŒ–</title>
      <link href="/2018/03/12/Java%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E7%94%A8%E6%8C%87%E5%AE%9A%E6%9E%84%E9%80%A0%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96/"/>
      <url>/2018/03/12/Java%E9%80%9A%E8%BF%87%E5%8F%8D%E5%B0%84%E7%94%A8%E6%8C%87%E5%AE%9A%E6%9E%84%E9%80%A0%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96/</url>
      <content type="html"><![CDATA[<h1 id="Javaé€šè¿‡åå°„ç”¨æŒ‡å®šæ„é€ å™¨åˆå§‹åŒ–"><a href="#Javaé€šè¿‡åå°„ç”¨æŒ‡å®šæ„é€ å™¨åˆå§‹åŒ–" class="headerlink" title="Javaé€šè¿‡åå°„ç”¨æŒ‡å®šæ„é€ å™¨åˆå§‹åŒ–"></a>Javaé€šè¿‡åå°„ç”¨æŒ‡å®šæ„é€ å™¨åˆå§‹åŒ–</h1><p>é¦–å…ˆï¼Œ ä¸€èˆ¬æ¥è®²åœ¨Javaä¸­åˆå§‹åŒ–ä¸€ä¸ªç±»æ˜¯é€šè¿‡newæ¥æ“ä½œçš„ï¼Œ ä½†æ˜¯æœ‰ä¸€ç§æƒ…å†µå´ä¸é€‚åˆè¿™ç§newæ“ä½œï¼Œé‚£å°±æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶æ¥è¿›è¡Œå®ä¾‹åŒ–æ“ä½œã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨Springä¸­ï¼Œéœ€è¦åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„ç±»ï¼Œè¿™æ˜¯æ¯”è¾ƒå¸¸è§çš„é…ç½®ã€‚  é‚£ä¹ˆåœ¨Springå¯åŠ¨ç±»ä¸­å¦‚ä½•å°†è¿™ä¸ªç±»åŠ è½½è¿›å®¹å™¨ä¸­å‘¢ï¼Œæ˜¾ç„¶è¿›è¡Œnewæ“ä½œæ˜¯ä¸å¤ªç°å®çš„ã€‚ è¿™æ—¶å€™å°±éœ€è¦Javaçš„åå°„æ“ä½œäº†ï¼ŒJavaçš„åå°„æ“ä½œä¸€èˆ¬æ¥è®²æœ‰ä¸¤ç§ï¼šåˆ†åˆ«æ˜¯<code>Class.forName()</code>å’Œ<code>classLoader.loadCLass()</code> æœ€åéƒ½æ˜¯é€šè¿‡<code>newInstance()</code> æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†æ˜¯åœ¨è¿™é‡Œå´å‘ç°å‡è®¾åå°„çš„ç±»ä¸­å«æœ‰å¸¦å‚æ•°çš„æ„é€ å™¨ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿™ä¸ªnewInstance()å°±ä¼šæŠ›<code>NoSuchMethodException</code> ï¼Œè¿™æ˜¯å› ä¸ºnewInstance()å› ä¸ºä¸åŠ å‚æ•°æ‰€ä»¥è°ƒç”¨çš„æ˜¯é»˜è®¤æ„é€ å™¨ï¼Œè€Œåå°„ç±»ä¸­å·²ç»åŒ…å«äº†å¸¦å‚æ•°çš„æ„é€ å™¨ï¼Œæ‰€ä»¥æ— ä¸å¸¦å‚æ•°æ„é€ å™¨ï¼Œé‚æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>ä½†æ˜¯æ­¤æ—¶newInstance()æ˜¯åŠ ä¸äº†å‚æ•°çš„ï¼Œæ‰€ä»¥è‹¥éœ€è¦é€šè¿‡åˆ¶å®šæ„é€ å™¨æ¥è¿›è¡Œåå°„çš„è¯éœ€è¦ä¸€ä¸ªç±»å«Constructorï¼Œ</p><p>æ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package reflec.cglib_test.ConstructTest;</span><br><span class="line">public class Entity1 &#123;</span><br><span class="line">    static &#123;</span><br><span class="line">        System.out.println(&quot;staticåˆå§‹åŒ–&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Entity1() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int id;</span><br><span class="line">    String name;</span><br><span class="line">    public Entity1(int id, String name) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    public void say()&#123;</span><br><span class="line">        System.out.println(this.id);</span><br><span class="line">        System.out.println(this.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åå°„æµ‹è¯•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package reflec.cglib_test.ConstructTest;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Constructor;</span><br><span class="line">import java.lang.reflect.InvocationTargetException;</span><br><span class="line"></span><br><span class="line">public class Test1 &#123;</span><br><span class="line">    public static void main(String[] args) throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, ClassNotFoundException &#123;</span><br><span class="line">//        Entity1 en2=Entity1.class.getConstructor(int.class,String.class).newInstance(1,&quot;2&quot;);</span><br><span class="line">//        Class.forName(&quot;reflec.cglib_test.ConstructTest.Entity1&quot;).newInstance();</span><br><span class="line">//        Test1.class.getClassLoader().loadClass(&quot;reflec.cglib_test.ConstructTest.Entity1&quot;);</span><br><span class="line">//        en2.say();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void do1(Object object)&#123;</span><br><span class="line">        System.out.println(object.getClass().getName().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„Test1ä¸­ï¼Œä¸‹é¢ä¸¤è¡Œåœ¨newInstance()ä¸­æ·»åŠ å‚æ•°çš„è¯æ˜¯ä¼šæç¤ºå‡ºé”™çš„ã€‚é‚£ä¹ˆå¦‚ä½•è°ƒç”¨å“ªä¸ªå¸¦å‚æ•°çš„æ„é€ å™¨å‘¢ï¼Ÿ è¿™å°±æ˜¯<code>Constructor</code> ç±»çš„åŠŸèƒ½äº†ï¼Œä»–å¯ä»¥é€šè¿‡Class.getConstructor()æ¥é€‰æ‹©å‚æ•°ï¼Œåœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯intåŠå…¶ä»–çš„javaåŸºæœ¬æ•°æ®ç±»å‹éƒ½æ˜¯åŸç”Ÿçš„ç±»ï¼Œéå°è£…ç±»ã€‚ä¹‹åå†newInstance()ä¸­è¾“å…¥å‚æ•°æ—¢å¯ä»¥åå°„è°ƒç”¨äº†ã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaé«˜çº§ç‰¹æ€§ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>è®°ä¸€æ¬¡springboot-mybatisæ‰¾ä¸åˆ°daoå±‚çš„é”™è¯¯</title>
      <link href="/2018/03/05/%E8%AE%B0%E4%B8%80%E6%AC%A1springboot-mybatis%E6%89%BE%E4%B8%8D%E5%88%B0dao%E5%B1%82%E7%9A%84%E9%94%99%E8%AF%AF/"/>
      <url>/2018/03/05/%E8%AE%B0%E4%B8%80%E6%AC%A1springboot-mybatis%E6%89%BE%E4%B8%8D%E5%88%B0dao%E5%B1%82%E7%9A%84%E9%94%99%E8%AF%AF/</url>
      <content type="html"><![CDATA[<p>å†™äº†ä¸‰ä¸ªå¤šæœˆçš„Pythonï¼Œä»Šå¤©å†å†™ä¸€ä¸ªspringboot-mybatisçš„é¡¹ç›®çš„æ—¶å€™å¥½å¤šä¸œè¥¿éƒ½å¿˜è®°äº†ï¼Œå°¤å…¶æ˜¯åœ¨ä»Šå¤©ä¸‹åˆé‡åˆ°äº†ä¸€ä¸ªå…³äºmybatisçš„é”™è¯¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Description:</span><br><span class="line"></span><br><span class="line">Field peopleDao in com.example.serviceImpl.PeopleServiceImpl required a bean of type &apos;com.example.dao.PeopleDao&apos; that could not be found.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Action:</span><br><span class="line"></span><br><span class="line">Consider defining a bean of type &apos;com.example.dao.PeopleDao&apos; in your configuration</span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜æ˜¾å°±æ˜¯daoå±‚æ— æ³•è¢«æ‰«æåˆ°ï¼Œåœ¨ä¸€ä¸‹åˆçš„å°è¯•ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥äº†åŒ…ç»“æ„ï¼Œå¦‚ä¸‹:<br>com<br>â€”example<br>â€”â€”controller<br>â€”â€”â€”â€”XXX.java<br>â€”â€”dao<br>â€”â€”â€”â€”XXX.java<br>â€”â€”â€“***<br>â€”â€”Application.java</p><p>ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªåŒ…ç»“æ„æ˜¯å®Œå…¨ç¬¦åˆspringbootçš„è§„èŒƒçš„ï¼Œä¹Ÿå°±è¡¨ç¤ºåœ¨å¯åŠ¨ç±»ä¸Šé¢çš„æ³¨è§£æ˜¯å®Œå…¨å¯ä»¥æ‰«æåˆ°daoåŒ…ä¸‹é¢çš„é‚£ä¸ªæ¥å£çš„ã€‚æ‰€ä»¥æ³¨è§£ä¸å­˜åœ¨é—®é¢˜ã€‚</p><p>ç„¶åå°è¯•äº†ç¬¬äºŒç§æ–¹æ³•ã€‚ä¿®æ”¹å¯åŠ¨ç±»çš„æ‰«æç»“æ„ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication</span><br><span class="line">@ComponentScan(basePackages = &#123;com.example.dao&#125;)</span><br><span class="line">public class IpApplication &#123;</span><br><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">SpringApplication.run(IpApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¿®æ”¹ä¹‹åç¡®å®ä¸ä¼šæŠ¥é”™äº†ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯é™¤äº†è¿™ä¸ªdaoä¸‹é¢çš„åŒ…å¯ä»¥è¢«æ‰«æä¹‹åå…¶ä»–çš„ä¾‹å¦‚controlleråŒ…éƒ½æ— æ³•è¢«æ‰«æè¿›æ¥ã€‚æ‰€ä»¥ä¹Ÿæ˜¯æ— æ³•æ ¹æœ¬è§£å†³é—®é¢˜ï¼Œ</p><p>æœ€åæ— æ„é—´æ³¨æ„åˆ°äº†åœ¨Springbootçš„å¯åŠ¨æ—¥å¿—ä¸­å‡ºç°äº†ä¸€å¥è¯ï¼š<strong>NO Mybatis mapperXXX</strong>åé¢çš„å…·ä½“å¿˜äº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™é‡Œæ ¹æœ¬å°±æ²¡æœ‰æ‰«æåˆ°mapperï¼Œåæ¥å‘ç°æ˜¯æŸ¥äº†ä¸€ä¸ªjaråŒ…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;1.3.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯è¿™ä¸ªjaråŒ…å¯¼è‡´äº†é‚£ä¸ªmapperä¸€ç›´æ‰¾ä¸åˆ°ï¼Œä¸è¿‡å…·ä½“åŸå› å¾…åé¢æ—¶é—´å†è¡¥å……</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> springboot </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºJavaçº¿ç¨‹çš„ä¸€äº›æ€è€ƒ</title>
      <link href="/2018/02/07/%E5%85%B3%E4%BA%8EJava%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/"/>
      <url>/2018/02/07/%E5%85%B3%E4%BA%8EJava%E7%BA%BF%E7%A8%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%80%9D%E8%80%83/</url>
      <content type="html"><![CDATA[<h1 id="æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„æ¨¡å‹ï¼š"><a href="#æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„æ¨¡å‹ï¼š" class="headerlink" title="æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„æ¨¡å‹ï¼š"></a>æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„æ¨¡å‹ï¼š</h1><p>ä»Šå¤©åœ¨çœ‹ã€Šç°ä»£æ“ä½œç³»ç»Ÿã€‹P73é¡µçš„ä¸€ä¸ªå…³äºå¤šçº¿ç¨‹çš„ç«æ€æ¡ä»¶çš„æ—¶å€™ä¹¦ä¸­è¯´åˆ°äº†<code>å”¤é†’ç­‰å¾…ä½æ–¹æ³•</code>ï¼Œè¿™ä¸ªæ–¹æ³•ä½¿æˆ‘çªç„¶æƒ³èµ·è”æƒ³åˆ°ä»¥å‰åœ¨Javaå¤šçº¿ç¨‹ä¸­sleep()æ–¹æ³•ä¼šæ¸…é™¤ä¸­æ–­çŠ¶æ€çš„ä¸€äº›ç±»ä¼¼ä¹‹å¤„ï¼š<br>æ ‘ä¸Šçš„ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#definde N 100</span><br><span class="line">int count =0;</span><br><span class="line">void producer(void)&#123;</span><br><span class="line">int item;</span><br><span class="line">while(True)&#123;</span><br><span class="line">    item=producer_item();</span><br><span class="line">    if (count == N) sleep();</span><br><span class="line">    insert_item(item);</span><br><span class="line">    count=count+1;</span><br><span class="line">    if (count == 1 )wakeup(consumer);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void consumer(void)&#123;</span><br><span class="line">    int item;</span><br><span class="line">    while(true)&#123;</span><br><span class="line">        if (count == 0)sleep();</span><br><span class="line">        item =remove_item();</span><br><span class="line">        count=count -1;</span><br><span class="line">        if (count == N-1) wakeup(producer);</span><br><span class="line">        consumer_item()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>åœ¨ä¹¦ä¸­æåˆ°è¿‡ä¸€ä¸ªæƒ…å†µå°±æ˜¯ï¼šå½“æ¶ˆè´¹è€…åˆ¤æ–­count==0çš„æ—¶å€™æ˜¯ä¼šç¡çœ çš„ï¼Œä½†æ˜¯æ­¤æ—¶ç”±äºæŸç§æƒ…å†µ(çº¿ç¨‹çš„sleep()æ–¹æ³•è¿˜æ²¡è¢«æ‰§è¡Œå®Œ)ï¼Œè€Œæ°å·§ç”Ÿäº§è€…åˆç”Ÿäº§äº†ä¸€ä¸ªitemï¼Œå¯¼è‡´æ­¤æ—¶countåŠ ä¸€ä¸º1ï¼Œè€Œå½“countä¸º1çš„æ—¶å€™ç”Ÿäº§è€…æ˜¯ä¼šå‘å‡ºä¸€ä¸ªwakeupä¿¡å·ç»™æ¶ˆè´¹è€…çš„ï¼Œæ­¤æ—¶ï¼Œç”±äºæ¶ˆè´¹è€…å¹¶æ²¡æœ‰ç¡çœ å› æ­¤ä¼šå¿½ç•¥æ‰è¯¥ä¿¡å·ï¼Œè€Œå½“æ¶ˆè´¹è€…çœŸæ­£ç¡çœ ä¹‹ååˆç”±äºç”Ÿäº§è€…å†ä¸ä¼šè¿›è¡Œé€šçŸ¥ï¼Œå¯¼è‡´é˜Ÿåˆ—è¢«ç”Ÿäº§è€…å¡æ»¡ï¼Œä»è€Œè¯¥æ¨¡å‹é˜»å¡ã€‚<br>é‚£ä¹ˆä¸ºäº†è§£å†³è¯¥æ–¹æ³•ï¼Œä¹¦ä¸­å¼•å…¥äº†<code>å”¤é†’ç­‰å¾…ä½æ–¹æ³•</code>ï¼Œè¯¥æ–¹æ³•å°±æ˜¯åœ¨ç”Ÿäº§è€…å‘å‡ºä¿¡å·ç»™æ¶ˆè´¹è€…çš„æ—¶å€™æ·»åŠ ä¸€ä¸ªä¸­æ–­çŠ¶æ€ï¼Œè€Œå½“è¯¥çº¿ç¨‹éœ€è¦è¿›è¡Œç¡çœ çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­çŠ¶æ€ï¼Œè‹¥æ˜¯wakeupåˆ™ä¸è¿›è¡Œç¡çœ </p><h2 id="Javaå¤šçº¿ç¨‹ä¸­çš„å¼•ç”¨ï¼š"><a href="#Javaå¤šçº¿ç¨‹ä¸­çš„å¼•ç”¨ï¼š" class="headerlink" title="Javaå¤šçº¿ç¨‹ä¸­çš„å¼•ç”¨ï¼š"></a>Javaå¤šçº¿ç¨‹ä¸­çš„å¼•ç”¨ï¼š</h2><p>åœ¨Javaä¸­è°ƒç”¨interrupt()æ–¹æ³•çš„åŸç†ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œè®¾ç½®ä¸€ä¸ªä¸­æ–­çŠ¶æ€ï¼Œä½†æ˜¯è¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†<code>å®‰å…¨èµ·è§</code>ï¼Œå› ä¸ºé€šè¿‡å…¶ä»–çš„çº¿ç¨‹æ¥ä¸­æ–­å¦ä¸€ä¸ªçº¿ç¨‹æ˜¯åŠå…¶ä¸å®‰å…¨çš„ï¼Œåœ¨å…¶ä»–çº¿ç¨‹å‘å‡ºä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸ä¼šçŸ¥é“å¦ä¸€ä¸ªçº¿ç¨‹ç›®å‰æ­£åœ¨åšä»€ä¹ˆäº‹æƒ…ï¼Œæ‰€ä»¥å®‰å…¨çš„åšæ³•æ˜¯è®¾ç½®ä¸€ä¸ªä¸­æ–­çŠ¶æ€</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>pandasçš„transformå’Œapply</title>
      <link href="/2017/12/10/pandas%E7%9A%84transform%E5%92%8Capply/"/>
      <url>/2017/12/10/pandas%E7%9A%84transform%E5%92%8Capply/</url>
      <content type="html"><![CDATA[<h1 id="qåŒºåˆ«"><a href="#qåŒºåˆ«" class="headerlink" title="qåŒºåˆ«"></a>qåŒºåˆ«</h1><p>transformæ˜¯Pandasé‡Œé¢Groupbyçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä¸»è¦ä½œç”¨æ˜¯å¯¹groupbyä¹‹åçš„dataframeè¿›è¡Œå¤„ç†ï¼Œæ¥æ”¶çš„å‚æ•°ä¸€ä¸ªæ˜¯ä¸€ä¸ªSeries<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">18</span>]: df = pd.DataFrame(&#123;<span class="string">'B'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>,<span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'three'</span>],</span><br><span class="line">    ...:                    <span class="string">'C'</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>], <span class="string">'D'</span>: [<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="number">19</span>]: df</span><br><span class="line">Out[<span class="number">19</span>]: </span><br><span class="line">       B  C   D</span><br><span class="line"><span class="number">0</span>    one  <span class="number">1</span>  <span class="number">11</span></span><br><span class="line"><span class="number">1</span>    one  <span class="number">2</span>  <span class="number">12</span></span><br><span class="line"><span class="number">2</span>    two  <span class="number">3</span>  <span class="number">13</span></span><br><span class="line"><span class="number">3</span>  three  <span class="number">4</span>  <span class="number">14</span></span><br><span class="line"><span class="number">4</span>    two  <span class="number">5</span>  <span class="number">15</span></span><br><span class="line"><span class="number">5</span>    two  <span class="number">6</span>  <span class="number">16</span></span><br><span class="line"><span class="number">6</span>    one  <span class="number">7</span>  <span class="number">17</span></span><br><span class="line"><span class="number">7</span>  three  <span class="number">8</span>  <span class="number">18</span></span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆéœ€è¦å¯¹å…¶groupbyä¹‹åæ±‚Cçš„å¹³å‡å€¼æ€ä¹ˆåŠ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">n [23]: df.groupby(&apos;B&apos;).transform(lambda x : x.mean())</span><br><span class="line">Out[23]: </span><br><span class="line">   C   D</span><br><span class="line">0  3  13</span><br><span class="line">1  3  13</span><br><span class="line">2  4  14</span><br><span class="line">3  6  16</span><br><span class="line">4  4  14</span><br><span class="line">5  4  14</span><br><span class="line">6  3  13</span><br><span class="line">7  6  16</span><br><span class="line"></span><br><span class="line">In [24]: df.groupby(&apos;B&apos;).apply(lambda x : x.mean())</span><br><span class="line">Out[24]: </span><br><span class="line">              C          D</span><br><span class="line">B</span><br><span class="line">one    3.333333  13.333333</span><br><span class="line">three  6.000000  16.000000</span><br><span class="line">two    4.666667  14.666667</span><br></pre></td></tr></table></figure></p><p>åŒæ ·æ˜¯ä¸€ä¸ªlambdaè¡¨è¾¾å¼ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸¤ç§ä¸åŒçš„ç»“æœï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">In [40]: df1 = pd.DataFrame(&#123;&apos;B&apos;: [&apos;one&apos;, &apos;two&apos;, &apos;three&apos;,&apos;four&apos;],</span><br><span class="line">    ...:                    &apos;C&apos;: [1,2,1,1], &apos;D&apos;: [11,12,13,14]&#125;)</span><br><span class="line"></span><br><span class="line">In [41]: df1</span><br><span class="line">Out[41]: </span><br><span class="line">       B  C   D</span><br><span class="line">0    one  1  11</span><br><span class="line">1    two  2  12</span><br><span class="line">2  three  1  13</span><br><span class="line">3   four  1  14</span><br><span class="line"></span><br><span class="line">In [42]: def fun1(x):</span><br><span class="line">    ...:     print x</span><br><span class="line">    ...: </span><br><span class="line"></span><br><span class="line">In [43]: print df1.groupby(&apos;C&apos;).transform(fun1)</span><br><span class="line">0      one</span><br><span class="line">2    three</span><br><span class="line">3     four</span><br><span class="line">Name: B, dtype: object</span><br><span class="line">0    11</span><br><span class="line">2    13</span><br><span class="line">3    14</span><br><span class="line">Name: D, dtype: object</span><br><span class="line">       B   D</span><br><span class="line">0    one  11</span><br><span class="line">2  three  13</span><br><span class="line">3   four  14</span><br><span class="line"></span><br><span class="line">1    two</span><br><span class="line">Name: B, dtype: object</span><br><span class="line">1    12</span><br><span class="line">Name: D, dtype: object</span><br><span class="line">       B   D</span><br><span class="line">0    one  11</span><br><span class="line">1    two  12</span><br><span class="line">2  three  13</span><br><span class="line">3   four  14</span><br></pre></td></tr></table></figure></p><p>ä»ä¸Šé¢å¯ä»¥å‘ç°trandformæ¯æ¬¡ä¼ å…¥çš„æ˜¯ä¸€ä¸ªseriesï¼Œå³æŒ‰ç…§Cåˆ†ç»„ä¹‹åï¼Œé¦–å…ˆä¼ å…¥çš„æ˜¯â€˜Bâ€™åˆ—ï¼Œç„¶åæ˜¯â€˜Dâ€™åˆ—ï¼Œç„¶åæ˜¯â€™Bâ€™â€™Dâ€™åˆ—ï¼Œé‚£ä¹ˆå¯¹äºapplyæ¥è¯´ä»–ä¼ å…¥çš„æ˜¯ä»€ä¹ˆå‘¢ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [45]: df1.groupby(&apos;C&apos;).apply(fun1)</span><br><span class="line">       B  C   D</span><br><span class="line">0    one  1  11</span><br><span class="line">2  three  1  13</span><br><span class="line">3   four  1  14</span><br><span class="line">       B  C   D</span><br><span class="line">0    one  1  11</span><br><span class="line">2  three  1  13</span><br><span class="line">3   four  1  14</span><br><span class="line">     B  C   D</span><br><span class="line">1  two  2  12</span><br><span class="line">Out[45]: </span><br><span class="line">Empty DataFrame</span><br><span class="line">Columns: []</span><br><span class="line">Index: []</span><br></pre></td></tr></table></figure></p><p>æ‰“å°ç»“æœå¦‚ä¸Šï¼Œè¯´æ˜applyå’Œtransformåœ¨æ¥å—å‚æ•°ä¸Šçš„å·®å¼‚(ä¸€ä¸ªæ¥å—çš„æ˜¯DataFrameï¼Œä¸€ä¸ªæ˜¯Series)ï¼Œä¸Šå›¾ä¸­çš„æ‰“å°ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªé‡å¤é—®é¢˜å¾…ä¼šå†è§£é‡Šï¼Œ<br>é‚£ä¹ˆå‡è®¾æœ‰å¦‚ä¸‹çš„lambdaè¡¨è¾¾å¼ï¼š</p><blockquote><p>lambda x : return [â€˜Câ€™]-x[â€˜Dâ€™]<br>ç»“æœä¼šæ€æ ·æ˜¾ç¤º? æ–°å¢åŠ ä¸€åˆ—ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [49]: df1[&apos;E&apos;]=20</span><br><span class="line">In [50]: df1</span><br><span class="line">Out[50]: </span><br><span class="line">       B  C   D   E</span><br><span class="line">0    one  1  11  20</span><br><span class="line">1    two  2  12  20</span><br><span class="line">2  three  1  13  20</span><br><span class="line">3   four  1  14  20</span><br><span class="line">In [51]: df1.groupby(&apos;C&apos;).transform(lambda x :(x[&apos;D&apos;]-x[&apos;E&apos;]))</span><br><span class="line">Out[51]: </span><br><span class="line">       B   D   E</span><br><span class="line">0    one  11  20</span><br><span class="line">1    two  12  20</span><br><span class="line">2  three  13  20</span><br><span class="line">3   four  14  20</span><br></pre></td></tr></table></figure></p></blockquote><p>é‚£ä¹ˆå‡ºç°è¿™æ ·çš„æƒ…å†µçš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¦‚å‰é¢æ‰€ç¤ºçš„ï¼Œtransformä¼ å…¥çš„æ˜¯ä¸€ä¸ªseries</p>]]></content>
      
      
    </entry>
    
    <entry>
      <title>pandasçš„æ“ä½œä½¿ç”¨</title>
      <link href="/2017/12/03/pandas%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8/"/>
      <url>/2017/12/03/pandas%E7%9A%84%E6%93%8D%E4%BD%9C%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<h1 id="pandasè¯»å–csvæ–‡ä»¶"><a href="#pandasè¯»å–csvæ–‡ä»¶" class="headerlink" title="pandasè¯»å–csvæ–‡ä»¶"></a>pandasè¯»å–csvæ–‡ä»¶</h1><p>åœ¨pandasè¯»é‡Œé¢åŒ…å«äº†å‡ ä¸ªå‡½æ•°åˆ†åˆ«ç”¨æ¥è¯»å–csvæˆ–è€…excelæ–‡ä»¶ï¼š<br><code>read_csv</code>æ–¹æ³•ç”¨æ¥è¯»å–ä¸€ä¸ªcsvæ–‡ä»¶ä¸€èˆ¬å¸¸ç”¨å‚æ•°æ˜¯<code>path</code>:ç”¨äºæŒ‡å®šä¸€ä¸ªæ–‡ä»¶åŠå…¶ç›®å½•<br><code>sep</code>è¡¨ç¤ºè¯»å–è¯¥csvæ–‡ä»¶çš„æ—¶å€™æ˜¯ä»¥ä»€ä¹ˆåˆ¶è¡¨ç¬¦è¯»å–çš„ï¼Œä¸€èˆ¬æ˜¯â€™,â€™<br><code>usecols</code>è¡¨ç¤ºéœ€è¦è¯»å–csvçš„å¤šå°‘åˆ—ï¼Œè¿™æ˜¯ä¸€ä¸ªç»å¯¹ç´¢å¼•ï¼Œ0ä»£è¡¨çš„æ˜¯ç¬¬ä¸€åˆ—ï¼Œå‚æ•°ä¸ºä¸€ä¸ªlist</p><h1 id="Pandasçš„ç»“æ„ï¼š"><a href="#Pandasçš„ç»“æ„ï¼š" class="headerlink" title="Pandasçš„ç»“æ„ï¼š"></a>Pandasçš„ç»“æ„ï¼š</h1><p>pandasç»å¸¸ä½¿ç”¨çš„ç»“æ„ä¸€èˆ¬æ˜¯dataframeå’Œseries,DataFrameç±»ä¼¼äºäºŒç»´æ•°ç»„ï¼Œæˆ–è€…sqlé‡Œé¢çš„ä¸€å¼ è¡¨ï¼Œè‹¥åœ¨åˆ›å»ºçš„æ—¶å€™ä¸ºæŒ‡å®šç´¢å¼•çš„è¯åˆ™é»˜è®¤ä»0å¼€å§‹ä¸€æ¬¡é€’å¢ä¸ºç´¢å¼•ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">In [<span class="number">15</span>]: df_2=pd.DataFrame(data=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">16</span>]: df_2</span><br><span class="line">Out[<span class="number">16</span>]: </span><br><span class="line">   <span class="number">0</span></span><br><span class="line"><span class="number">0</span>  a</span><br><span class="line"><span class="number">1</span>  b</span><br><span class="line"><span class="number">2</span>  c</span><br><span class="line">ç”¨ä¸Šè¿°æ–¹å¼åˆ›å»ºçš„æ—¶å€™æ˜¯ä¸éœ€è¦æŒ‡å®šindexçš„ï¼Œä½†æ˜¯ç”¨æ ‡é‡åˆ›å»ºçš„æ—¶å€™æ˜¯éœ€è¦æŒ‡å®šindexçš„ï¼š</span><br><span class="line">pd.DataFrame(&#123;<span class="string">'a'</span>:<span class="string">'A'</span>,<span class="string">'b'</span>:<span class="string">'B'</span>&#125;)</span><br><span class="line">ValueError: If using all scalar values, you must <span class="keyword">pass</span> an index</span><br></pre></td></tr></table></figure></p><h1 id="åŸºæœ¬å®ä¾‹ï¼š"><a href="#åŸºæœ¬å®ä¾‹ï¼š" class="headerlink" title="åŸºæœ¬å®ä¾‹ï¼š"></a>åŸºæœ¬å®ä¾‹ï¼š</h1><p>è¯»å–åŒ—äº¬2017å¹´07æœˆ01æ—¥çš„ç©ºæ°”è´¨é‡æƒ…å†µï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> df_20170101 =pd.read_csv(path,sep=&apos;,&apos;,decimal=&apos;,&apos;,usecols=[0,1,2,3,4,5,6,7,8,9]) #pathæ˜¯æˆ‘çš„æ–‡ä»¶åœ°å€</span><br><span class="line">       date  hour       type  dongfour   å¤©å›   å®˜å›­  ä¸‡å¯¿è¥¿å®«  å¥¥ä½“ä¸­å¿ƒ  å†œå±•é¦†   ä¸‡æŸ³</span><br><span class="line">0  20170101    22      PM2.5       469  357  476   416   453  398  468</span><br><span class="line">1  20170101    22  PM2.5_24h       NaN  NaN  NaN   NaN   NaN  NaN  NaN</span><br><span class="line">2  20170101    22       PM10       594  449  548   474   467  469  518</span><br><span class="line">3  20170101    22   PM10_24h       NaN  NaN  NaN   NaN   NaN  NaN  NaN</span><br><span class="line">4  20170101    22        AQI       494  405  484   444   469  432  479</span><br><span class="line">5  20170101    23      PM2.5       470  351  500   403   417  392  459</span><br><span class="line">6  20170101    23  PM2.5_24h       NaN  NaN  NaN   NaN   NaN  NaN  NaN</span><br><span class="line">7  20170101    23       PM10       558  467  583   469   443  480  529</span><br><span class="line">8  20170101    23   PM10_24h       NaN  NaN  NaN   NaN   NaN  NaN  NaN</span><br><span class="line">9  20170101    23        AQI       480  401  500   435   445  428  473</span><br></pre></td></tr></table></figure></p><p>å‡è®¾éœ€è¦è·å–å¤©å›çš„22ç‚¹åˆ°23ç‚¹æƒ…å†µï¼Œé‚£ä¹ˆåªéœ€è¦ä½¿ç”¨df_20170101[â€˜å¤©å›â€™]ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0    357</span><br><span class="line">1    NaN</span><br><span class="line">2    449</span><br><span class="line">3    NaN</span><br><span class="line">4    405</span><br><span class="line">5    351</span><br><span class="line">6    NaN</span><br><span class="line">7    467</span><br><span class="line">8    NaN</span><br><span class="line">9    401</span><br></pre></td></tr></table></figure></p><p>è¿™å°±æ˜¯pandasçš„å¦ä¸€ç§ç»“æ„ï¼šseriesï¼Œç±»ä¼¼äºä¸€ä¸ªç«–ç€åœ°æ•°ç»„ï¼Œé‚£ä¹ˆå‡è®¾ç°åœ¨éœ€è¦è·å–å¤©å›çš„22ç‚¹çš„pm2.5<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ç§æ–¹å¼æ˜¯çŸ¥é“ç´¢å¼•:</span><br><span class="line">In [6]: df_20170101.loc[0][&apos;å¤©å›&apos;]</span><br><span class="line">Out[6]: 357.0</span><br><span class="line">ä¸€ç§åˆ™æ˜¯è·å–22ç‚¹å¹¶ä¸”typeä¸ºPM2.5çš„æ—¶å€™çš„å¤©å›</span><br><span class="line">In [7]: df_20170101.loc[(df_20170101[&apos;hour&apos;]==22) &amp; (df_20170101[&apos;type&apos;]==&apos;PM2.5&apos;),&apos;å¤©å›&apos;]</span><br><span class="line">Out[7]: </span><br><span class="line">0    357</span><br><span class="line">Name: å¤©å›, dtype: float64</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆè¿™ä¸ªæ•°æ®ä¸­æœ‰å¾ˆå¤šçš„NaNå€¼ï¼Œå…¶ä¸­PM2.5_24hçš„å€¼å‘ç°éƒ½ä¸ºNaNï¼Œåˆ™è¿™ä¸ªå€¼å…¶å®æ˜¯å¯ä»¥è¢«å‰”é™¤çš„ï¼Œé‚£ä¹ˆå¸¸ç”¨çš„åšæ³•å°±æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In [8]: df_20170101.loc[~df_20170101[&apos;dongfour&apos;].isnull()]</span><br><span class="line">Out[8]: </span><br><span class="line">       date  hour   type  dongfour   å¤©å›   å®˜å›­  ä¸‡å¯¿è¥¿å®«  å¥¥ä½“ä¸­å¿ƒ  å†œå±•é¦†   ä¸‡æŸ³</span><br><span class="line">0  20170101    22  PM2.5       469  357  476   416   453  398  468</span><br><span class="line">2  20170101    22   PM10       594  449  548   474   467  469  518</span><br><span class="line">4  20170101    22    AQI       494  405  484   444   469  432  479</span><br><span class="line">5  20170101    23  PM2.5       470  351  500   403   417  392  459</span><br><span class="line">7  20170101    23   PM10       558  467  583   469   443  480  529</span><br><span class="line">9  20170101    23    AQI       480  401  500   435   445  428  473</span><br><span class="line"></span><br><span class="line">è‡³äºä¸ºä»€ä¹ˆé€‰æ‹©dongfouræ˜¯å› ä¸ºé€‰æ‹©å…¶ä»–çš„ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥ï¼Œä½†æ˜¯å¦‚æœéœ€è¦å°†NaNçš„å€¼æ›¿æ¢æˆ0çš„è¯åªéœ€è¦æ‰§è¡Œ</span><br><span class="line">In [9]: df_20170101.fillna(0)</span><br><span class="line">Out[9]: </span><br><span class="line">       date  hour       type  dongfour   å¤©å›   å®˜å›­  ä¸‡å¯¿è¥¿å®«  å¥¥ä½“ä¸­å¿ƒ  å†œå±•é¦†   ä¸‡æŸ³</span><br><span class="line">0  20170101    22      PM2.5       469  357  476   416   453  398  468</span><br><span class="line">1  20170101    22  PM2.5_24h         0    0    0     0     0    0    0</span><br><span class="line">2  20170101    22       PM10       594  449  548   474   467  469  518</span><br><span class="line">3  20170101    22   PM10_24h         0    0    0     0     0    0    0</span><br><span class="line">4  20170101    22        AQI       494  405  484   444   469  432  479</span><br><span class="line">5  20170101    23      PM2.5       470  351  500   403   417  392  459</span><br><span class="line">6  20170101    23  PM2.5_24h         0    0    0     0     0    0    0</span><br><span class="line">7  20170101    23       PM10       558  467  583   469   443  480  529</span><br><span class="line">8  20170101    23   PM10_24h         0    0    0     0     0    0    0</span><br><span class="line">9  20170101    23        AQI       480  401  500   435   445  428  473</span><br><span class="line">å°±ä¼šå°†NaNå€¼å…¨éƒ¨è½¬ä¸º0</span><br></pre></td></tr></table></figure></p><h1 id="Groupå®ä¾‹ï¼š"><a href="#Groupå®ä¾‹ï¼š" class="headerlink" title="Groupå®ä¾‹ï¼š"></a>Groupå®ä¾‹ï¼š</h1><p>è‹¥ç°åœ¨éœ€è¦ç»Ÿè®¡dongfourçš„22åˆ°23ç‚¹çš„PM2.5å¹³å‡å€¼ï¼Œé‚£ä¹ˆéœ€è¦å¯¹typeè¿›è¡Œgroupby:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [29]: df_20170101[&apos;dongfourmean&apos;]=df_20170101.groupby(&apos;type&apos;)[&apos;dongfour&apos;].apply(lambda x : pd.Series(np.mean(x),index=x.index))</span><br><span class="line"></span><br><span class="line">In [30]: df_20170101</span><br><span class="line">Out[30]: </span><br><span class="line">       date  hour   type  dongfour   å¤©å›   å®˜å›­  å¥¥ä½“ä¸­å¿ƒ  å†œå±•é¦†   ä¸‡æŸ³  dongfourmean</span><br><span class="line">0  20170101    22  PM2.5       469  357  476   453  398  468         469.5</span><br><span class="line">2  20170101    22   PM10       594  449  548   467  469  518         576.0</span><br><span class="line">4  20170101    22    AQI       494  405  484   469  432  479         487.0</span><br><span class="line">5  20170101    23  PM2.5       470  351  500   417  392  459         469.5</span><br><span class="line">7  20170101    23   PM10       558  467  583   443  480  529         576.0</span><br><span class="line">9  20170101    23    AQI       480  401  500   445  428  473         487.0</span><br><span class="line">å› ä¸ºdf_20170101[&apos;dongfourmean&apos;]æ˜¯ä¸€ä¸ªSeriesæ‰€ä»¥è¿”å›çš„æ—¶å€™ä¹Ÿæ˜¯éœ€è¦Series</span><br></pre></td></tr></table></figure></p><p>è‹¥ç°åœ¨éœ€è¦æ±‚çš„æ˜¯dongfouråˆ°ä¸‡æŸ³çš„22ç‚¹çš„PM2.5å¹³å‡å€¼åˆ™æ˜¯å¯ä»¥å…ˆå¯¹df_20170101è¿›è¡Œä¸€ä¸ªè½¬ç½®æ“ä½œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [35]: df_T</span><br><span class="line">Out[35]: </span><br><span class="line">                     0         2         4         5         7         9</span><br><span class="line">date          20170101  20170101  20170101  20170101  20170101  20170101</span><br><span class="line">hour                22        22        22        23        23        23</span><br><span class="line">type             PM2.5      PM10       AQI     PM2.5      PM10       AQI</span><br><span class="line">dongfour           469       594       494       470       558       480</span><br><span class="line">å¤©å›                 357       449       405       351       467       401</span><br><span class="line">å®˜å›­                 476       548       484       500       583       500</span><br><span class="line">å¥¥ä½“ä¸­å¿ƒ               453       467       469       417       443       445</span><br><span class="line">å†œå±•é¦†                398       469       432       392       480       428</span><br><span class="line">ä¸‡æŸ³                 468       518       479       459       529       473</span><br><span class="line">dongfourmean     469.5       576       487     469.5       576       487</span><br><span class="line"></span><br><span class="line">In [38]: np.mean(df_T.ix[3:8][0])</span><br><span class="line">Out[38]: 430.60000000000002</span><br></pre></td></tr></table></figure></p><h1 id="æ³¨æ„ç»†èŠ‚ï¼š"><a href="#æ³¨æ„ç»†èŠ‚ï¼š" class="headerlink" title="æ³¨æ„ç»†èŠ‚ï¼š"></a>æ³¨æ„ç»†èŠ‚ï¼š</h1><p>pandasè¿›è¡Œgroupä¹‹åæ˜¯ä¸å¯ä»¥åœ¨ç”¨locè¿›è¡Œæ“ä½œçš„ï¼Œå³åœ¨pandasé‡Œé¢<code>GroupBy objects</code>è¿›è¡Œä¸€äº›æ“ä½œçš„è¯å¯ä»¥é‡‡ç”¨applyï¼Œè€Œä¸èƒ½ä½¿ç”¨loc<br>è‹¥éè¦ä½¿ç”¨locåˆ™åœ¨ä½¿ç”¨groupsä¹‹åè½¬åŒ–æˆä¸€ä¸ªdataframeä¹‹åå†è¿›è¡Œä¸€äº›dataframeçš„æ“ä½œ</p>]]></content>
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pandas </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºæµå’Œå¤šæ€çš„ä¸€äº›è®°å½•</title>
      <link href="/2017/11/10/%E5%85%B3%E4%BA%8E%E6%B5%81%E5%92%8C%E5%A4%9A%E6%80%81%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AE%B0%E5%BD%95/"/>
      <url>/2017/11/10/%E5%85%B3%E4%BA%8E%E6%B5%81%E5%92%8C%E5%A4%9A%E6%80%81%E7%9A%84%E4%B8%80%E4%BA%9B%E8%AE%B0%E5%BD%95/</url>
      <content type="html"><![CDATA[<h1 id="æµçš„è¯»å–é—®é¢˜"><a href="#æµçš„è¯»å–é—®é¢˜" class="headerlink" title="æµçš„è¯»å–é—®é¢˜"></a>æµçš„è¯»å–é—®é¢˜</h1><h2 id="read-æ–¹æ³•"><a href="#read-æ–¹æ³•" class="headerlink" title="read()æ–¹æ³•"></a>read()æ–¹æ³•</h2><p>read()æ–¹æ³•ç»å¸¸ç”¨äºè¯»å–ä¸€ä¸ªbyteæ•°ç»„æˆ–è€…charæ•°ç»„ï¼Œå…¶å†…éƒ¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span> b[])</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> in.read(b, <span class="number">0</span>, b.length);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>é¦–å…ˆåœ¨è¯»å–å­—èŠ‚æµçš„æ—¶å€™æ˜¯æ‰€æœ‰çš„å­—èŠ‚æµçš„é¡¶çº§ç±»çš„æ˜¯InputStream<strong>æŠ½è±¡ç±»</strong>ï¼Œè€Œç»§æ‰¿è‡ªInputstreamçš„ç±»éƒ½æ˜¯å¸¦æœ‰readæ–¹æ³•ï¼Œæ¯ä¸€ä¸ªç±»å‡ ä¹ä¸¢é‡å†™äº†è‡ªå·±çš„readæ–¹æ³•ï¼Œè€Œè¿™å°±æ˜¯å¤šæ€çš„ä¸€ç§ä½“ç°ã€‚</p><h2 id="å…³äºsocket-getInputStream-æ–¹æ³•è·å–çš„InputStream"><a href="#å…³äºsocket-getInputStream-æ–¹æ³•è·å–çš„InputStream" class="headerlink" title="å…³äºsocket.getInputStream()æ–¹æ³•è·å–çš„InputStream"></a>å…³äºsocket.getInputStream()æ–¹æ³•è·å–çš„InputStream</h2><p>è¿™ä¸ªè·å–çš„è¾“å…¥æµæ˜¯<code>SocketInputStream</code>,åœ¨è¿™ä¸ªç±»é‡Œé¢æœ‰ä¸€ä¸ªå˜é‡å°±æ˜¯<code>private boolean eof;</code><br>è¿™ä¸ªå˜é‡åœ¨readæ–¹æ³•ä¸­å¯ä»¥ç”¨äºåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å·²ç»åˆ°å°¾äº†<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span> b[], <span class="keyword">int</span> off, <span class="keyword">int</span> length, <span class="keyword">int</span> timeout)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// EOF already encountered</span></span><br><span class="line">        <span class="keyword">if</span> (eof) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">//çœç•¥åé¢æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><h1 id="å¤šæ€ï¼š"><a href="#å¤šæ€ï¼š" class="headerlink" title="å¤šæ€ï¼š"></a>å¤šæ€ï¼š</h1><p>å…¶å®åœ¨javaçš„å­—èŠ‚æµå¤„ç†ç±»ä¸­å°±å¾ˆå¥½çš„åˆ©ç”¨äº†å¤šæ€ï¼Œä»¥å‰åªæ˜¯äº†è§£ä½†æ˜¯å®é™…ä½¿ç”¨çš„ä¸å¤šã€‚è€Œä¸”æœ€é‡è¦çš„æ˜¯çˆ¶ç±»çš„é™æ€å˜é‡å­ç±»æ˜¯å¯ä»¥ç›´æ¥ç»§æ‰¿è¿‡æ¥çš„</p>]]></content>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºJavaçš„HashMap</title>
      <link href="/2017/11/09/%E5%85%B3%E4%BA%8EJava%E7%9A%84HashMap/"/>
      <url>/2017/11/09/%E5%85%B3%E4%BA%8EJava%E7%9A%84HashMap/</url>
      <content type="html"><![CDATA[<h1 id="Mapæ¥å£ï¼š"><a href="#Mapæ¥å£ï¼š" class="headerlink" title="Mapæ¥å£ï¼š"></a>Mapæ¥å£ï¼š</h1><ol><li>åœ¨mapæ¥å£ä¸­çš„å­˜åœ¨ä¸€ä¸ªä¸»æ¥å£ï¼š<code>public interface Map</code> å’Œä¸€ä¸ªå†…éƒ¨æ¥å£ï¼š<code>interface Entry</code></li><li>å…¶ä¸­<em>Mapæ¥å£</em>ä¸»è¦åŠŸèƒ½æ˜¯æä¾›mapçš„ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œä¾‹å¦‚put,inEmpty,getç­‰ï¼Œè€Œ<em>Entryæ¥å£</em>åˆ™ä¸»è¦æ˜¯è´Ÿè´£éå†æ“ä½œæ—¶çš„ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚<code>getKey(),getValue()ï¼ŒsetValue</code>ç­‰</li></ol><p>#HashMapå®ç°ç±»ï¼š</p><ol><li>åœ¨HaspMapè¿™ä¸ªç±»é‡Œé¢å…¶å®åŒ…å«äº†å¾ˆå¤šçš„å†…éƒ¨ç±»ï¼šå¦‚ä¸‹å›¾ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Node</span><br><span class="line">HashMap</span><br><span class="line">KeySet</span><br><span class="line">KeySpliterator</span><br><span class="line">EntrySet</span><br><span class="line">Values</span><br><span class="line">HashIterator</span><br><span class="line">KeyIterator</span><br><span class="line">ValueIterator</span><br><span class="line">EntryIterator</span><br><span class="line">HashMapSpliterator</span><br><span class="line">ValueSpliterator</span><br><span class="line">EntrySpliterator</span><br><span class="line">TreeNode</span><br></pre></td></tr></table></figure></li></ol><h2 id="TreeNodeç±»ï¼š-TreeNodeç±»æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼šé‡Œé¢åŒ…å«çš„æ˜¯ä¸€äº›çº¢é»‘æ ‘çš„æ“ä½œï¼›"><a href="#TreeNodeç±»ï¼š-TreeNodeç±»æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼šé‡Œé¢åŒ…å«çš„æ˜¯ä¸€äº›çº¢é»‘æ ‘çš„æ“ä½œï¼›" class="headerlink" title="TreeNodeç±»ï¼š TreeNodeç±»æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼šé‡Œé¢åŒ…å«çš„æ˜¯ä¸€äº›çº¢é»‘æ ‘çš„æ“ä½œï¼›"></a>TreeNodeç±»ï¼š TreeNodeç±»æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼šé‡Œé¢åŒ…å«çš„æ˜¯ä¸€äº›çº¢é»‘æ ‘çš„æ“ä½œï¼›</h2><h2 id="EntrySetç±»ï¼š-EntrySetç±»æ˜¯æä¾›ä¸€ä¸ªHashMapçš„éå†æ–¹å¼çš„ä¸€ä¸ªç±»ï¼ŒEntrySetç±»é‡Œé¢æœ‰iteratoræ–¹æ³•ï¼Œå…¶ä½œç”¨åœ¨äºmapçš„ä¸€ç§éå†æ–¹å¼ï¼š"><a href="#EntrySetç±»ï¼š-EntrySetç±»æ˜¯æä¾›ä¸€ä¸ªHashMapçš„éå†æ–¹å¼çš„ä¸€ä¸ªç±»ï¼ŒEntrySetç±»é‡Œé¢æœ‰iteratoræ–¹æ³•ï¼Œå…¶ä½œç”¨åœ¨äºmapçš„ä¸€ç§éå†æ–¹å¼ï¼š" class="headerlink" title="EntrySetç±»ï¼š EntrySetç±»æ˜¯æä¾›ä¸€ä¸ªHashMapçš„éå†æ–¹å¼çš„ä¸€ä¸ªç±»ï¼ŒEntrySetç±»é‡Œé¢æœ‰iteratoræ–¹æ³•ï¼Œå…¶ä½œç”¨åœ¨äºmapçš„ä¸€ç§éå†æ–¹å¼ï¼š"></a>EntrySetç±»ï¼š EntrySetç±»æ˜¯æä¾›ä¸€ä¸ªHashMapçš„éå†æ–¹å¼çš„ä¸€ä¸ªç±»ï¼ŒEntrySetç±»é‡Œé¢æœ‰iteratoræ–¹æ³•ï¼Œå…¶ä½œç”¨åœ¨äºmapçš„ä¸€ç§éå†æ–¹å¼ï¼š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator iterator =map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">    Map.Entry&lt;Object,Object&gt; map1 = (Map.Entry&lt;Object, Object&gt;) iterator.next();</span><br><span class="line">    System.out.println(map1.getKey());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ¶‰åŠçš„çŸ¥è¯†æ˜¯EntrySetæ˜¯ç»§æ‰¿äº†AbstractSeté—´æ¥å®ç°äº†Setæ¥å£ï¼Œè€Œmap.entrySet()æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªSet&lt;Map.Entry&lt;K,V&gt;&gt;è¿™ä¸ªå®ä¾‹ã€‚</p><h2 id="å…¶ä»–çš„æš‚æ—¶è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨"><a href="#å…¶ä»–çš„æš‚æ—¶è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨" class="headerlink" title="å…¶ä»–çš„æš‚æ—¶è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨"></a>å…¶ä»–çš„æš‚æ—¶è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨</h2><h1 id="å…³äºHashMapçš„å…¶ä»–ç»†èŠ‚"><a href="#å…³äºHashMapçš„å…¶ä»–ç»†èŠ‚" class="headerlink" title="å…³äºHashMapçš„å…¶ä»–ç»†èŠ‚"></a><strong>å…³äºHashMapçš„å…¶ä»–ç»†èŠ‚</strong></h1><h3 id="æ¯ä¸€æ‰©å®¹éƒ½æ˜¯2çš„næ¬¡æ–¹ï¼š"><a href="#æ¯ä¸€æ‰©å®¹éƒ½æ˜¯2çš„næ¬¡æ–¹ï¼š" class="headerlink" title="æ¯ä¸€æ‰©å®¹éƒ½æ˜¯2çš„næ¬¡æ–¹ï¼š"></a>æ¯ä¸€æ‰©å®¹éƒ½æ˜¯2çš„næ¬¡æ–¹ï¼š</h3><p>é¦–å…ˆä¸ºä»€ä¹ˆæ¯ä¸€æ¬¡éƒ½æ˜¯2çš„næ¬¡æ–¹è¿™æ˜¯ç”±äºhashå‡½æ•°å¯¼è‡´çš„ï¼Œå‡è®¾ä¸€ä¸ªå€¼æ˜¯1001ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªå€¼å¯ä»¥æ˜¯1101,1011,1111ï¼Œè¿™ä¸‰ç§æƒ…å†µåšä¸”è¿ç®—çš„è¯ç»“æœéƒ½æ˜¯1001ï¼Œå‘ç”Ÿäº†ä¸‰æ¬¡ç¢°æ’ï¼Œé‚£ä¹ˆå‡è®¾å›ºå®šå€¼æ˜¯2çš„næ¬¡æ–¹çš„è¯ï¼Œå‡ä¸€ä¹‹åæ˜¯1111ï¼ŒæŠ˜ä¸‰ä¸ªæ•°ä¸å…¶åšä¸”è¿ç®—çš„è¯éƒ½ä¸ä¼šç›¸åŒï¼Œæ‰€ä»¥ä¼šè¾ƒå°ç¢°æ’æ¬¡æ•°ã€‚</p><h3 id="å…è®¸nullä½œä¸ºé”®-å€¼"><a href="#å…è®¸nullä½œä¸ºé”®-å€¼" class="headerlink" title="å…è®¸nullä½œä¸ºé”®/å€¼"></a>å…è®¸nullä½œä¸ºé”®/å€¼</h3><p>é‚£ä¹ˆç›´æ¥çœ‹ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">     Node&lt;K,V&gt; e;</span><br><span class="line">     <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> h;</span><br><span class="line">     <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">     Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">     <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">         (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">             ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">             <span class="keyword">return</span> first;</span><br><span class="line">         <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">             <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                 <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">             <span class="keyword">do</span> &#123;</span><br><span class="line">                 <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                     ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                     <span class="keyword">return</span> e;</span><br><span class="line">             &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p><p>å¾ˆæ˜æ˜¾å½“æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯nullå¾—æ—¶å€™hashçš„å€¼æ˜¯0çš„æ—¶å€™<code>first = tab[(n - 1) &amp; hash]</code>è¿™ä¸ªfirstæ°¸è¿œæ˜¯tab[0];ä½†æ˜¯åˆç”±äºtabçš„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹,æ‰€ä»¥tab[0]è‚¯å®šæ˜¯nullï¼Œæ‰€ä»¥å½“é”®æ˜¯nullçš„æ—¶å€™å¾—åˆ°çš„ä¹Ÿæ˜¯nullã€‚</p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> é›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å…³äºArrayListçš„æ‰€è§æ‰€æƒ³</title>
      <link href="/2017/11/07/%E5%85%B3%E4%BA%8EArrayLIst%E7%9A%84%E6%89%80%E8%A7%81%E6%89%80%E6%83%B3/"/>
      <url>/2017/11/07/%E5%85%B3%E4%BA%8EArrayLIst%E7%9A%84%E6%89%80%E8%A7%81%E6%89%80%E6%83%B3/</url>
      <content type="html"><![CDATA[<h1 id="å…³äºArrrayListæ‰©å®¹ï¼š"><a href="#å…³äºArrrayListæ‰©å®¹ï¼š" class="headerlink" title="å…³äºArrrayListæ‰©å®¹ï¼š"></a>å…³äºArrrayListæ‰©å®¹ï¼š</h1><blockquote><p>ä»Šå¤©åœ¨é¢è¯•çš„æ—¶å€™é¢è¯•å®˜æåˆ°è¿‡ArrayListæ‰©å®¹æ˜¯åŸæ¥çš„1.5å€åŠ ä¸€ï¼Œä½†æ˜¯æˆ‘çœ‹jdk1.8çš„æ—¶å€™æ˜¯æ˜¾ç¤ºä¸º1.5å€</p></blockquote><h3 id="æŸ¥çœ‹æºç ï¼š"><a href="#æŸ¥çœ‹æºç ï¼š" class="headerlink" title="æŸ¥çœ‹æºç ï¼š"></a>æŸ¥çœ‹æºç ï¼š</h3> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Java1.8çš„æ‰©å®¹æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">grow</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// overflow-conscious code</span></span><br><span class="line">       <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">       <span class="keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">       <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">           newCapacity = minCapacity;</span><br><span class="line">       <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">           newCapacity = hugeCapacity(minCapacity);</span><br><span class="line">       <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">       elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p> é‚£ä¹ˆArrayListä¼šæ˜¯æ‰©å……1.5å€ä¹‹ååŠ ä¸€å‘¢ï¼Ÿ</p><blockquote><p>äºæ˜¯ç¿»çœ‹ä»¥å‰çš„jdkæºç ï¼Œå‘ç°åœ¨jdk1.6çš„æ—¶å€™å…¶ä»£ç ç¡®å®æ˜¯+1äº†<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java1.6ç‰ˆæœ¬çš„æ‰©å®¹æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       modCount++;</span><br><span class="line">       <span class="keyword">int</span> oldCapacity = elementData.length;</span><br><span class="line">       <span class="keyword">if</span> (minCapacity &gt; oldCapacity) &#123;</span><br><span class="line">           Object oldData[] = elementData;</span><br><span class="line">           <span class="keyword">int</span> newCapacity = (oldCapacity * <span class="number">3</span>)/<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">           <span class="keyword">if</span> (newCapacity &lt; minCapacity)</span><br><span class="line">               newCapacity = minCapacity;</span><br><span class="line">           <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">           elementData = Arrays.copyOf(elementData, newCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p></blockquote><h1 id="å…³äºå…¶æ‰©å®¹å…·ä½“åšæ³•ï¼š"><a href="#å…³äºå…¶æ‰©å®¹å…·ä½“åšæ³•ï¼š" class="headerlink" title="å…³äºå…¶æ‰©å®¹å…·ä½“åšæ³•ï¼š"></a>å…³äºå…¶æ‰©å®¹å…·ä½“åšæ³•ï¼š</h1><h3 id="jdk1-8"><a href="#jdk1-8" class="headerlink" title="jdk1.8"></a>jdk1.8</h3><p> å…¶æ¬¡å†jdk1.8ä¸­çš„ArrayListçš„ä¸€äº›åˆ†æï¼š<br> é¦–å…ˆéœ€è¦å‘Listä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼š</p><blockquote><p>è°ƒç”¨ boolean add(E e);<br> è¿™ä¸ªæ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨ ensureCapacityInternal(int)æ–¹æ³•<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ensureExplicitCapacity(minCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></blockquote><p> å½“ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™å› ä¸ºåœ¨æ„é€ æ–¹æ³•é‡Œé¢å·²ç»å°†è®¾ç½®ä¸ºâ€™elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAâ€™<br> æ‰€ä»¥ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™æ˜¯ç›´æ¥æ¥ç€è°ƒç”¨â€™private void ensureExplicitCapacity(int minCapacity)â€™æ–¹æ³•ã€‚<br> ä½†æ˜¯è¿™é‡Œä¼šå‘ç°ä¸€ä¸ªé—®é¢˜å°±æ˜¯jdk1.8å¹¶æœªæä¾›åˆå§‹çš„é»˜è®¤å€¼ï¼Œ<br> åœ¨jdk1.6ä¸­ArrayListçš„æ„é€ æ–¹æ³•ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>();</span><br><span class="line">      <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal Capacity: "</span>+</span><br><span class="line">                                             initialCapacity);</span><br><span class="line">      <span class="keyword">this</span>.elementData = <span class="keyword">new</span> Object[initialCapacity];</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p> ä½†æ˜¯åœ¨jdk1.8ä¸­å´å¹¶æœªæœ‰é»˜è®¤çš„åˆå§‹å€¼ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ArrayList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p> è€Œæ˜¯æä¾›äº†ä¸€ä¸ªä¿®æ”¹å®¹é‡çš„æ–¹æ³•ï¼š<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ensureCapacity</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">int</span> minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</span><br><span class="line">           <span class="comment">// any size if not default element table</span></span><br><span class="line">           ? <span class="number">0</span></span><br><span class="line">           <span class="comment">// larger than default for default empty table. It's already</span></span><br><span class="line">           <span class="comment">// supposed to be at default size.</span></span><br><span class="line">           : DEFAULT_CAPACITY;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (minCapacity &gt; minExpand) &#123;</span><br><span class="line">           ensureExplicitCapacity(minCapacity);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaé›†åˆ </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>å®‰è£…hexoçš„ä¸€äº›æ³¨æ„äº‹é¡¹</title>
      <link href="/2017/11/06/%E5%AE%89%E8%A3%85hexo%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/"/>
      <url>/2017/11/06/%E5%AE%89%E8%A3%85hexo%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/</url>
      <content type="html"><![CDATA[<h1 id="å®‰è£…æ­¥éª¤ï¼š"><a href="#å®‰è£…æ­¥éª¤ï¼š" class="headerlink" title="å®‰è£…æ­¥éª¤ï¼š"></a>å®‰è£…æ­¥éª¤ï¼š</h1><ol><li>é¦–å…ˆå®‰è£…npm â€” </li><li>ç„¶åå®‰è£…hexo    <code>npm install hexo-cli -g</code></li><li>åˆå§‹åŒ–ä¸€ä¸ªhexoé¡¹ç›®  <code>hexo init blog</code></li><li>æ·»åŠ é…ç½®æ–‡ä»¶  <code>pm install --save hexo-renderer-jade hexo-renderer-scss hexo-generator-feed                         hexo-generator-sitemap hexo-browsersync hexo-generator-archive</code></li><li>å®‰è£… <code>npm install</code></li></ol><h1 id="æ·»åŠ ä¸»é¢˜æ–‡ä»¶"><a href="#æ·»åŠ ä¸»é¢˜æ–‡ä»¶" class="headerlink" title="æ·»åŠ ä¸»é¢˜æ–‡ä»¶:"></a>æ·»åŠ ä¸»é¢˜æ–‡ä»¶:</h1><ul><li>åœ¨githubä¸Šæ‰¾å‡ºè‡ªå·±å–œæ¬¢çš„ä¸€ä¸ªä¸»é¢˜</li><li>ç”¨gitå‘½ä»¤cloneä¸‹æ¥</li><li>å°†æ–‡ä»¶æ”¾åˆ°themesæ–‡ä»¶å¤¹ï¼Œç„¶åä¿®æ”¹hexoæ–‡ä»¶çš„_config.yml</li><li>å°†themesæ–‡ä»¶å¤¹é‡Œé¢çš„é‚£ä¸ªä¸»é¢˜åç§°æ·»åŠ åˆ°themeè¿™ä¸ªæ ‡ç­¾ä¹‹å</li><li>å¯ä»¥åœ¨themeæ–‡ä»¶å¤¹é‡Œé¢ä¿®æ”¹_config.ymlè¿™ä¸ªæ–‡ä»¶æ¥è·å¾—æƒ³è¦çš„æ•ˆæœ</li></ul>]]></content>
      
      <categories>
          
          <category> hexoç›¸å…³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸ªäººè®°å½• </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>æ–‡ç« é¢˜ç›®</title>
      <link href="/2017/11/05/%E6%B5%8B%E8%AF%95%E5%8D%9A%E5%AE%A2/"/>
      <url>/2017/11/05/%E6%B5%8B%E8%AF%95%E5%8D%9A%E5%AE%A2/</url>
      <content type="html"><![CDATA[]]></content>
      
      <categories>
          
          <category> æµ‹è¯•ä½¿ç”¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ— èŠæµ‹è¯• </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
